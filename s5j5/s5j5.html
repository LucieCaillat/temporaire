<!DOCTYPE html>
<html class="loaded" lang="fr"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<script type="text/javascript" async="" src="s5j5_fichiers/insight.js"></script><script type="text/javascript" src="s5j5_fichiers/NRJS-71f55aa980e498e276b"></script><script src="s5j5_fichiers/nr-1212.js"></script><script type="text/javascript" async="" src="s5j5_fichiers/gtm_002.js"></script><script type="text/javascript" src="s5j5_fichiers/commons.js" async="" status="loaded"></script><script type="text/javascript" src="s5j5_fichiers/google-tag-manager.js" async="" status="loaded"></script><script src="s5j5_fichiers/conversations-embed.js" type="text/javascript" id="hubspot-messages-loader" data-loader="hs-scriptloader" data-hsjs-portal="9310539" data-hsjs-env="prod" data-hsjs-hublet="na1"></script><script src="s5j5_fichiers/9310539_003.js" type="text/javascript" id="hs-analytics"></script><script src="s5j5_fichiers/9310539_002.js" type="text/javascript" id="cookieBanner-9310539" data-cookieconsent="ignore" data-hs-ignore="true" data-loader="hs-scriptloader" data-hsjs-portal="9310539" data-hsjs-env="prod" data-hsjs-hublet="na1"></script><script src="s5j5_fichiers/fb.js" type="text/javascript" id="hs-ads-pixel-9310539" data-ads-portal-id="9310539" data-ads-env="prod" data-loader="hs-scriptloader" data-hsjs-portal="9310539" data-hsjs-env="prod" data-hsjs-hublet="na1"></script><script src="s5j5_fichiers/collectedforms.js" type="text/javascript" id="CollectedForms-9310539" crossorigin="anonymous" data-leadin-portal-id="9310539" data-leadin-env="prod" data-loader="hs-scriptloader" data-hsjs-portal="9310539" data-hsjs-env="prod" data-hsjs-hublet="na1"></script><script src="s5j5_fichiers/leadflows.js" type="text/javascript" id="LeadFlows-9310539" crossorigin="anonymous" data-leadin-portal-id="9310539" data-leadin-env="prod" data-loader="hs-scriptloader" data-hsjs-portal="9310539" data-hsjs-env="prod" data-hsjs-hublet="na1"></script><script type="text/javascript" async="" src="s5j5_fichiers/analytics.js"></script><script type="text/javascript" async="" src="s5j5_fichiers/mixpanel-2-latest.js"></script><script type="text/javascript" async="" src="s5j5_fichiers/conversion_async.js"></script><script async="" crossorigin="anonymous" src="s5j5_fichiers/fs.js"></script><script src="s5j5_fichiers/773401719499556.js" async=""></script><script async="" src="s5j5_fichiers/fbevents.js"></script><script async="" src="s5j5_fichiers/gtm.js"></script><script type="text/javascript" async="" src="s5j5_fichiers/analytics_002.js"></script><script>window.NREUM||(NREUM={});NREUM.info={"beacon":"bam.nr-data.net","errorBeacon":"bam.nr-data.net","licenseKey":"NRJS-71f55aa980e498e276b","applicationID":"576835834","transactionName":"dgpYEBRYDg9XQh8AA0YNVAsHRQZMVlFJF01GDVkT","queueTime":0,"applicationTime":4896,"agent":""}</script>
<script>(window.NREUM||(NREUM={})).init={ajax:{deny_list:["bam.nr-data.net"]}};(window.NREUM||(NREUM={})).loader_config={licenseKey:"NRJS-71f55aa980e498e276b",applicationID:"576835834"};window.NREUM||(NREUM={}),__nr_require=function(t,e,n){function r(n){if(!e[n]){var i=e[n]={exports:{}};t[n][0].call(i.exports,function(e){var i=t[n][1][e];return r(i||e)},i,i.exports)}return e[n].exports}if("function"==typeof __nr_require)return __nr_require;for(var i=0;i<n.length;i++)r(n[i]);return r}({1:[function(t,e,n){function r(){}function i(t,e,n,r){return function(){return s.recordSupportability("API/"+e+"/called"),o(t+e,[u.now()].concat(c(arguments)),n?null:this,r),n?void 0:this}}var o=t("handle"),a=t(10),c=t(11),f=t("ee").get("tracer"),u=t("loader"),s=t(4),d=NREUM;"undefined"==typeof window.newrelic&&(newrelic=d);var p=["setPageViewName","setCustomAttribute","setErrorHandler","finished","addToTrace","inlineHit","addRelease"],l="api-",v=l+"ixn-";a(p,function(t,e){d[e]=i(l,e,!0,"api")}),d.addPageAction=i(l,"addPageAction",!0),d.setCurrentRouteName=i(l,"routeName",!0),e.exports=newrelic,d.interaction=function(){return(new r).get()};var m=r.prototype={createTracer:function(t,e){var n={},r=this,i="function"==typeof e;return o(v+"tracer",[u.now(),t,n],r),function(){if(f.emit((i?"":"no-")+"fn-start",[u.now(),r,i],n),i)try{return e.apply(this,arguments)}catch(t){throw f.emit("fn-err",[arguments,this,t],n),t}finally{f.emit("fn-end",[u.now()],n)}}}};a("actionText,setName,setAttribute,save,ignore,onEnd,getContext,end,get".split(","),function(t,e){m[e]=i(v,e)}),newrelic.noticeError=function(t,e){"string"==typeof t&&(t=new Error(t)),s.recordSupportability("API/noticeError/called"),o("err",[t,u.now(),!1,e])}},{}],2:[function(t,e,n){function r(t){if(NREUM.init){for(var e=NREUM.init,n=t.split("."),r=0;r<n.length-1;r++)if(e=e[n[r]],"object"!=typeof e)return;return e=e[n[n.length-1]]}}e.exports={getConfiguration:r}},{}],3:[function(t,e,n){var r=!1;try{var i=Object.defineProperty({},"passive",{get:function(){r=!0}});window.addEventListener("testPassive",null,i),window.removeEventListener("testPassive",null,i)}catch(o){}e.exports=function(t){return r?{passive:!0,capture:!!t}:!!t}},{}],4:[function(t,e,n){function r(t,e){var n=[a,t,{name:t},e];return o("storeMetric",n,null,"api"),n}function i(t,e){var n=[c,t,{name:t},e];return o("storeEventMetrics",n,null,"api"),n}var o=t("handle"),a="sm",c="cm";e.exports={constants:{SUPPORTABILITY_METRIC:a,CUSTOM_METRIC:c},recordSupportability:r,recordCustom:i}},{}],5:[function(t,e,n){function r(){return c.exists&&performance.now?Math.round(performance.now()):(o=Math.max((new Date).getTime(),o))-a}function i(){return o}var o=(new Date).getTime(),a=o,c=t(12);e.exports=r,e.exports.offset=a,e.exports.getLastTimestamp=i},{}],6:[function(t,e,n){function r(t){return!(!t||!t.protocol||"file:"===t.protocol)}e.exports=r},{}],7:[function(t,e,n){function r(t,e){var n=t.getEntries();n.forEach(function(t){"first-paint"===t.name?p("timing",["fp",Math.floor(t.startTime)]):"first-contentful-paint"===t.name&&p("timing",["fcp",Math.floor(t.startTime)])})}function i(t,e){var n=t.getEntries();if(n.length>0){var r=n[n.length-1];if(f&&f<r.startTime)return;p("lcp",[r])}}function o(t){t.getEntries().forEach(function(t){t.hadRecentInput||p("cls",[t])})}function a(t){if(t instanceof g&&!y){var e=Math.round(t.timeStamp),n={type:t.type};e<=l.now()?n.fid=l.now()-e:e>l.offset&&e<=Date.now()?(e-=l.offset,n.fid=l.now()-e):e=l.now(),y=!0,p("timing",["fi",e,n])}}function c(t){"hidden"===t&&(f=l.now(),p("pageHide",[f]))}if(!("init"in NREUM&&"page_view_timing"in NREUM.init&&"enabled"in NREUM.init.page_view_timing&&NREUM.init.page_view_timing.enabled===!1)){var f,u,s,d,p=t("handle"),l=t("loader"),v=t(9),m=t(3),g=NREUM.o.EV;if("PerformanceObserver"in window&&"function"==typeof window.PerformanceObserver){u=new PerformanceObserver(r);try{u.observe({entryTypes:["paint"]})}catch(h){}s=new PerformanceObserver(i);try{s.observe({entryTypes:["largest-contentful-paint"]})}catch(h){}d=new PerformanceObserver(o);try{d.observe({type:"layout-shift",buffered:!0})}catch(h){}}if("addEventListener"in document){var y=!1,w=["click","keydown","mousedown","pointerdown","touchstart"];w.forEach(function(t){document.addEventListener(t,a,m(!1))})}v(c)}},{}],8:[function(t,e,n){function r(t,e){if(!i)return!1;if(t!==i)return!1;if(!e)return!0;if(!o)return!1;for(var n=o.split("."),r=e.split("."),a=0;a<r.length;a++)if(r[a]!==n[a])return!1;return!0}var i=null,o=null,a=/Version\/(\S+)\s+Safari/;if(navigator.userAgent){var c=navigator.userAgent,f=c.match(a);f&&c.indexOf("Chrome")===-1&&c.indexOf("Chromium")===-1&&(i="Safari",o=f[1])}e.exports={agent:i,version:o,match:r}},{}],9:[function(t,e,n){function r(t){function e(){t(c&&document[c]?document[c]:document[o]?"hidden":"visible")}"addEventListener"in document&&a&&document.addEventListener(a,e,i(!1))}var i=t(3);e.exports=r;var o,a,c;"undefined"!=typeof document.hidden?(o="hidden",a="visibilitychange",c="visibilityState"):"undefined"!=typeof document.msHidden?(o="msHidden",a="msvisibilitychange"):"undefined"!=typeof document.webkitHidden&&(o="webkitHidden",a="webkitvisibilitychange",c="webkitVisibilityState")},{}],10:[function(t,e,n){function r(t,e){var n=[],r="",o=0;for(r in t)i.call(t,r)&&(n[o]=e(r,t[r]),o+=1);return n}var i=Object.prototype.hasOwnProperty;e.exports=r},{}],11:[function(t,e,n){function r(t,e,n){e||(e=0),"undefined"==typeof n&&(n=t?t.length:0);for(var r=-1,i=n-e||0,o=Array(i<0?0:i);++r<i;)o[r]=t[e+r];return o}e.exports=r},{}],12:[function(t,e,n){e.exports={exists:"undefined"!=typeof window.performance&&window.performance.timing&&"undefined"!=typeof window.performance.timing.navigationStart}},{}],ee:[function(t,e,n){function r(){}function i(t){function e(t){return t&&t instanceof r?t:t?u(t,f,a):a()}function n(n,r,i,o,a){if(a!==!1&&(a=!0),!l.aborted||o){t&&a&&t(n,r,i);for(var c=e(i),f=m(n),u=f.length,s=0;s<u;s++)f[s].apply(c,r);var p=d[w[n]];return p&&p.push([b,n,r,c]),c}}function o(t,e){y[t]=m(t).concat(e)}function v(t,e){var n=y[t];if(n)for(var r=0;r<n.length;r++)n[r]===e&&n.splice(r,1)}function m(t){return y[t]||[]}function g(t){return p[t]=p[t]||i(n)}function h(t,e){l.aborted||s(t,function(t,n){e=e||"feature",w[n]=e,e in d||(d[e]=[])})}var y={},w={},b={on:o,addEventListener:o,removeEventListener:v,emit:n,get:g,listeners:m,context:e,buffer:h,abort:c,aborted:!1};return b}function o(t){return u(t,f,a)}function a(){return new r}function c(){(d.api||d.feature)&&(l.aborted=!0,d=l.backlog={})}var f="nr@context",u=t("gos"),s=t(10),d={},p={},l=e.exports=i();e.exports.getOrSetContext=o,l.backlog=d},{}],gos:[function(t,e,n){function r(t,e,n){if(i.call(t,e))return t[e];var r=n();if(Object.defineProperty&&Object.keys)try{return Object.defineProperty(t,e,{value:r,writable:!0,enumerable:!1}),r}catch(o){}return t[e]=r,r}var i=Object.prototype.hasOwnProperty;e.exports=r},{}],handle:[function(t,e,n){function r(t,e,n,r){i.buffer([t],r),i.emit(t,e,n)}var i=t("ee").get("handle");e.exports=r,r.ee=i},{}],id:[function(t,e,n){function r(t){var e=typeof t;return!t||"object"!==e&&"function"!==e?-1:t===window?0:a(t,o,function(){return i++})}var i=1,o="nr@id",a=t("gos");e.exports=r},{}],loader:[function(t,e,n){function r(){if(!T++){var t=P.info=NREUM.info,e=g.getElementsByTagName("script")[0];if(setTimeout(u.abort,3e4),!(t&&t.licenseKey&&t.applicationID&&e))return u.abort();f(O,function(e,n){t[e]||(t[e]=n)});var n=a();c("mark",["onload",n+P.offset],null,"api"),c("timing",["load",n]);var r=g.createElement("script");0===t.agent.indexOf("http://")||0===t.agent.indexOf("https://")?r.src=t.agent:r.src=v+"://"+t.agent,e.parentNode.insertBefore(r,e)}}function i(){"complete"===g.readyState&&o()}function o(){c("mark",["domContent",a()+P.offset],null,"api")}var a=t(5),c=t("handle"),f=t(10),u=t("ee"),s=t(8),d=t(6),p=t(2),l=t(3),v=p.getConfiguration("ssl")===!1?"http":"https",m=window,g=m.document,h="addEventListener",y="attachEvent",w=m.XMLHttpRequest,b=w&&w.prototype,E=!d(m.location);NREUM.o={ST:setTimeout,SI:m.setImmediate,CT:clearTimeout,XHR:w,REQ:m.Request,EV:m.Event,PR:m.Promise,MO:m.MutationObserver};var x=""+location,O={beacon:"bam.nr-data.net",errorBeacon:"bam.nr-data.net",agent:"js-agent.newrelic.com/nr-1212.min.js"},M=w&&b&&b[h]&&!/CriOS/.test(navigator.userAgent),P=e.exports={offset:a.getLastTimestamp(),now:a,origin:x,features:{},xhrWrappable:M,userAgent:s,disabled:E};if(!E){t(1),t(7),g[h]?(g[h]("DOMContentLoaded",o,l(!1)),m[h]("load",r,l(!1))):(g[y]("onreadystatechange",i),m[y]("onload",r)),c("mark",["firstbyte",a.getLastTimestamp()],null,"api");var T=0}},{}],"wrap-function":[function(t,e,n){function r(t,e){function n(e,n,r,f,u){function nrWrapper(){var o,a,s,p;try{a=this,o=d(arguments),s="function"==typeof r?r(o,a):r||{}}catch(l){i([l,"",[o,a,f],s],t)}c(n+"start",[o,a,f],s,u);try{return p=e.apply(a,o)}catch(v){throw c(n+"err",[o,a,v],s,u),v}finally{c(n+"end",[o,a,p],s,u)}}return a(e)?e:(n||(n=""),nrWrapper[p]=e,o(e,nrWrapper,t),nrWrapper)}function r(t,e,r,i,o){r||(r="");var c,f,u,s="-"===r.charAt(0);for(u=0;u<e.length;u++)f=e[u],c=t[f],a(c)||(t[f]=n(c,s?f+r:r,i,f,o))}function c(n,r,o,a){if(!v||e){var c=v;v=!0;try{t.emit(n,r,o,e,a)}catch(f){i([f,n,r,o],t)}v=c}}return t||(t=s),n.inPlace=r,n.flag=p,n}function i(t,e){e||(e=s);try{e.emit("internal-error",t)}catch(n){}}function o(t,e,n){if(Object.defineProperty&&Object.keys)try{var r=Object.keys(t);return r.forEach(function(n){Object.defineProperty(e,n,{get:function(){return t[n]},set:function(e){return t[n]=e,e}})}),e}catch(o){i([o],n)}for(var a in t)l.call(t,a)&&(e[a]=t[a]);return e}function a(t){return!(t&&t instanceof Function&&t.apply&&!t[p])}function c(t,e){var n=e(t);return n[p]=t,o(t,n,s),n}function f(t,e,n){var r=t[e];t[e]=c(r,n)}function u(){for(var t=arguments.length,e=new Array(t),n=0;n<t;++n)e[n]=arguments[n];return e}var s=t("ee"),d=t(11),p="nr@original",l=Object.prototype.hasOwnProperty,v=!1;e.exports=r,e.exports.wrapFunction=c,e.exports.wrapInPlace=f,e.exports.argsToArray=u},{}]},{},["loader"]);</script>
    <meta name="viewport" content="width=device-width, user-scalable=no">

    <meta name="csrf-param" content="authenticity_token">
<meta name="csrf-token" content="QODQBsqWx8OIhE1gUqt5BirgTn3+IDfw2v0tDsUp5x4zcP4iZXaQ8kDVO7GSusCajr69S9CB0rfDWmo6jH9Dgg==">
    <title>Le tableau de bord | The Hacking Project</title>
<meta name="description" content="Nous cassons les codes de l'éducation, vous apprenez d'où vous voulez, en communauté.">
<meta name="robots" content="noindex, nofollow">
<meta property="og:title" content="Le tableau de bord">
<meta property="og:site_name" content="The Hacking Project">
<meta name="url" content="https://www.thehackingproject.org/fr/dashboard/courses/1/weeks/2/days/5">
<meta name="image" content="https://www.thehackingproject.org/packs/images/logo/20210910-THP-Logo_color_transparent-31229dd881904e010092de63be97cdfa.png">


    <link rel="apple-touch-icon" sizes="180x180" href="https://www.thehackingproject.org/assets/favicon/apple-touch-icon-c01aaccf467f7cc3d79bbce743d60779f5b833fdc4500cebd07a5e11a07a5c31.png">
<link rel="apple-touch-icon" sizes="120x120" href="https://www.thehackingproject.org/assets/favicon/apple-touch-icon-120x120-precomposed-372de868f08319961b72ba7e3b1ed7121e75e29c8294334cb2c911409ea18131.png">
<link rel="apple-touch-icon" sizes="120x120" href="https://www.thehackingproject.org/assets/favicon/apple-touch-icon-120x120-372de868f08319961b72ba7e3b1ed7121e75e29c8294334cb2c911409ea18131.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://www.thehackingproject.org/assets/favicon/favicon-32x32-804b12d1c41c60fe721477b7c3b0a32811dc610580dd40ac92f1cc04cbd05ca4.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://www.thehackingproject.org/assets/favicon/favicon-16x16-d96ba65e5785d32474df9ebc6fbfd5442c751d527b10981a474bc3b7a4079d01.png">
<link rel="manifest" href="https://www.thehackingproject.org/assets/favicon/manifest-cf975201fd8ac78a1f1a203357573d50031f1cc33436d099743df6428b8a38a2.json">
<link rel="mask-icon" href="https://www.thehackingproject.org/assets/favicon/safari-pinned-tab-8af1cfcf7525ccdccb490f9f5adad396653a4969b419e0a9a9d3a1088140a912.svg" color="#5bbad5">
<link rel="shortcut icon" href="https://www.thehackingproject.org/assets/favicon/favicon-cbf10361dc90b277565960736d4897fddef5468bff6299811ea9498459d56d21.ico">
<meta name="msapplication-config" content="/assets/favicon/browserconfig-dab38db6040ef54ac56e91fdd77e3d7b06746a634e87b68c99b59b216cb8611a.xml">
<meta name="theme-color" content="#ffffff">

    <link rel="stylesheet" media="screen" href="s5j5_fichiers/vendor-dab9e12f0ba58215899de05f149caa5f.css">
    <link rel="stylesheet" media="screen" href="s5j5_fichiers/dashboard-4ab6ba9737cbfc4c38b17a9a4de7833a.css">
    <link rel="stylesheet" media="screen" href="s5j5_fichiers/dashboard-ea5a94b9045ccb8d8ce8974b71b640603915dc183d5907c643.css">
    <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async="" src="s5j5_fichiers/js.js"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-105991867-1');
  </script>
<!-- End Google Analytics -->

<!-- Google Tag Manager -->
<script>
  (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer',"GTM-P8XRQ3M");
</script>
<!-- End Google Tag Manager -->

<!-- Facebook Pixel Code -->
    <script>
        !function(f,b,e,v,n,t,s)
        {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
        n.callMethod.apply(n,arguments):n.queue.push(arguments)};
        if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
        n.queue=[];t=b.createElement(e);t.async=!0;
        t.src=v;s=b.getElementsByTagName(e)[0];
        s.parentNode.insertBefore(t,s)}(window,document,'script',
        'https://connect.facebook.net/en_US/fbevents.js');
         fbq('init', '773401719499556');
        fbq('track', 'PageView');
    </script>
    <noscript>
     <img height="1" width="1"
    src="https://www.facebook.com/tr?id=773401719499556&ev=PageView
    &noscript=1"/>
    </noscript>
<!-- End Facebook Pixel Code -->

<script>
window['_fs_debug'] = false;
window['_fs_host'] = 'fullstory.com';
window['_fs_script'] = 'edge.fullstory.com/s/fs.js';
window['_fs_org'] = '14AEET';
window['_fs_namespace'] = 'FS';
(function(m,n,e,t,l,o,g,y){
    if (e in m) {if(m.console && m.console.log) { m.console.log('FullStory namespace conflict. Please set window["_fs_namespace"].');} return;}
    g=m[e]=function(a,b,s){g.q?g.q.push([a,b,s]):g._api(a,b,s);};g.q=[];
    o=n.createElement(t);o.async=1;o.crossOrigin='anonymous';o.src='https://'+_fs_script;
    y=n.getElementsByTagName(t)[0];y.parentNode.insertBefore(o,y);
    g.identify=function(i,v,s){g(l,{uid:i},s);if(v)g(l,v,s)};g.setUserVars=function(v,s){g(l,v,s)};g.event=function(i,v,s){g('event',{n:i,p:v},s)};
    g.anonymize=function(){g.identify(!!0)};
    g.shutdown=function(){g("rec",!1)};g.restart=function(){g("rec",!0)};
    g.log = function(a,b){g("log",[a,b])};
    g.consent=function(a){g("consent",!arguments.length||a)};
    g.identifyAccount=function(i,v){o='account';v=v||{};v.acctId=i;g(o,v)};
    g.clearUserCookie=function(){};
    g.setVars=function(n, p){g('setVars',[n,p]);};
    g._w={};y='XMLHttpRequest';g._w[y]=m[y];y='fetch';g._w[y]=m[y];
    if(m[y])m[y]=function(){return g._w[y].apply(this,arguments)};
    g._v="1.3.0";
})(window,document,window['_fs_namespace'],'script','user');
</script>
<!-- Start of HubSpot Embed Code -->
<script async="" defer="defer" id="hs-script-loader" src="s5j5_fichiers/9310539.js" type="text/javascript"></script>
<!-- End of HubSpot Embed Code -->


    <script src="s5j5_fichiers/thp-3cc5aa6fdf57842a7b6c714621cc7f2d3d31b51cb700b1de4e795d773.js"></script>
    <script src="s5j5_fichiers/manifest-1613feea780cfc5342f4.js"></script>
    <script src="s5j5_fichiers/vendor-ff3cb5540e737de52c97.js"></script>
    <script src="s5j5_fichiers/dashboard-25875e14460b4458b1bccffaa93d4a8cbee9691b06d54976fde.js"></script>

    <link href="s5j5_fichiers/css.css" rel="stylesheet">
  <script src="s5j5_fichiers/a"></script></head>

  <body class="vertical-layout 2-columns fixed-navbar menu-hide vertical-overlay-menu" data-open="click" data-menu="vertical-menu" data-color="bg-gradient-x-primary-blue" data-col="2-columns" data-thp-controller="days" data-thp-action="show" data-thp-layout="dashboard"><style type="text/css">html.hs-messages-widget-open.hs-messages-mobile,html.hs-messages-widget-open.hs-messages-mobile body{overflow:hidden!important;position:relative!important}html.hs-messages-widget-open.hs-messages-mobile body{height:100%!important;margin:0!important}#hubspot-messages-iframe-container{display:initial!important;z-index:2147483647;position:fixed!important;bottom:0!important}#hubspot-messages-iframe-container.widget-align-left{left:0!important}#hubspot-messages-iframe-container.widget-align-right{right:0!important}#hubspot-messages-iframe-container.internal{z-index:1016}#hubspot-messages-iframe-container.internal iframe{min-width:108px}#hubspot-messages-iframe-container .shadow-container{display:initial!important;z-index:-1;position:absolute;width:0;height:0;bottom:0;content:""}#hubspot-messages-iframe-container .shadow-container.internal{display:none!important}#hubspot-messages-iframe-container .shadow-container.active{width:400px;height:400px}#hubspot-messages-iframe-container iframe{display:initial!important;width:100%!important;height:100%!important;border:none!important;position:absolute!important;bottom:0!important;right:0!important;background:transparent!important}</style>
    <!-- Google Tag Manager (noscript) -->
<noscript>
<iframe height='0' src='https://www.googletagmanager.com/ns.html?id=GTM-P8XRQ3M' style='display:none;visibility:hidden' width='0'></iframe>
</noscript>
<!-- End Google Tag Manager (noscript) -->



    <nav class="header-navbar navbar-expand-md navbar navbar-with-menu navbar-without-dd-arrow fixed-top navbar-semi-light" style="padding:0;">
<div class="navbar-wrapper">
<div class="navbar-container content">
<div class="collapse navbar-collapse show" id="navbar-mobile">
<ul class="nav navbar-nav mr-auto float-left">
<li class="nav-item mobile-menu d-md-none mr-auto">
<a class="nav-link nav-menu-main menu-toggle hidden-xs" href="#">
<i class="ft-menu font-large-1"></i>
</a>
</li>
<li class="nav-item d-none d-md-block">
<a class="nav-link nav-menu-main menu-toggle hidden-xs" href="#">
<i class="ft-menu"></i>
</a>
</li>
</ul>
<ul class="nav navbar-nav float-right">
<li class="dropdown dropdown-user nav-item">
<a class="dropdown-toggle nav-link dropdown-user-link" data-toggle="dropdown" href="#">
<span class="avatar avatar-online">

<img alt="avatar" style="max-height: 40px!important; width: auto" class="rounded-circle img-border" src="s5j5_fichiers/default_profile-a3318a5e66467f9958f16a172f9d15d6.jpg">

</span>
</a>
<div class="dropdown-menu dropdown-menu-right">
<div class="arrow_box_right">
<a class="dropdown-toggle nav-link dropdown-user-link" href="https://www.thehackingproject.org/fr/dashboard/profile/user"><span class="avatar avatar-online pt-0">

<img alt="avatar" style="max-height: 40px!important; width: auto" class="rounded-circle img-border" src="s5j5_fichiers/default_profile-a3318a5e66467f9958f16a172f9d15d6.jpg">

</span>
<span class="user-name text-bold-700 ml-1 text-dark">
Lucie
</span>
</a><div class="dropdown-divider"></div>
<a class="dropdown-item" href="https://www.thehackingproject.org/fr/dashboard/profile/user/edit"><i class="ft-edit"></i>Éditer profil
</a><div class="dropdown-divider"></div>
<a class="dropdown-item" href="https://www.thehackingproject.org/fr/dashboard/profile/user/edit?edit=danger"><i class="ft-alert-triangle"></i>Zone à risques
</a><div class="dropdown-divider"></div>
<a class="dropdown-item" rel="nofollow" data-method="delete" href="https://www.thehackingproject.org/users/sign_out?locale=fr"><i class="ft-power"></i>
Déconnexion
</a></div>
</div>
</li>
</ul>
</div>
</div>
</div>
</nav>

      <div class="main-menu menu-fixed menu-light menu-accordion menu-shadow" data-scroll-to-active="true">
<div class="navbar-header">
<ul class="nav navbar-nav flex-row">
<li class="nav-item mr-auto">
<a class="navbar-brand" href="https://www.thehackingproject.org/?locale=fr"><h3 class="brand-text">The Hacking Project</h3>
</a></li>
<li class="nav-item d-md-none">
<a class="nav-link close-navbar">
<i class="ft-x"></i>
</a>
</li>
</ul>
</div>
<div class="main-menu-content">
<ul class="navigation navigation-main" data-menu="menu-navigation" id="main-menu-navigation">
<li class="nav-item">
<a href="https://www.thehackingproject.org/fr/dashboard"><i class="ft-calendar"></i>
<span class="menu-title" data-i18n="">
Aujourd'hui
</span>
</a></li>
<li class="nav-item">
<a href="https://www.thehackingproject.org/fr/dashboard/dashboard"><i class="ft-monitor"></i>
<span class="menu-title" data-i18n="">
Mon dashboard
</span>
</a></li>
<li class="nav-item has-sub">
<a href="#"><i class="fas fa-user-graduate"></i>
<span class="menu-title" data-i18n="">
Mon inscription
</span>
</a><ul class="menu-content">
<li>
<a href="https://www.thehackingproject.org/parcours?locale=fr">Choisir un parcours</a>
</li>
<li>
<a href="https://www.thehackingproject.org/fr/dashboard/profile/curriculum_subscriptions/new">Nouveau parcours</a>
</li>
<li>
<a href="https://www.thehackingproject.org/fr/dashboard/profile/curriculum_subscriptions/7209/edit">Changer parcours</a>
</li>
<li>
<a href="https://www.thehackingproject.org/fr/dashboard/modalites">Modalités</a>
</li>
</ul>
</li>
<li class="nav-item">
<a href="https://www.thehackingproject.org/fr/dashboard/certifications"><i class="fa ft-download"></i>
<span class="menu-title" data-i18n="">
Documents
</span>
</a></li>
<br>
<li>
<a href="https://www.thehackingproject.org/fr/dashboard/help"><i class="fa ft-help-circle"></i>
<span class="menu-title" data-i18n="">
Aide
</span>
</a></li>
</ul>
</div>
</div>



    <div class="app-content content">
      <div class="content-wrapper">
        <div class="content-wrapper-before"></div>
        <div class="content-header row"></div>
        <div class="container">
<div class="row">
<div class="col-12">
<ol class="breadcrumb">
<li class="breadcrumb-item">
<a href="https://www.thehackingproject.org/fr/dashboard/dashboard">Dashboard</a>
</li>
<li class="breadcrumb-item">
<a href="https://www.thehackingproject.org/fr/dashboard/courses/1">Fullstack web</a>
</li>
<li class="breadcrumb-item">
<a href="https://www.thehackingproject.org/fr/dashboard/courses/1/weeks/2">Initiation à Rails</a>
</li>
<li class="breadcrumb-item active">
Validations &amp; Conceptions de BDD
</li>
</ol>
</div>
</div>
<!-- / PARTIAL FOR FREE MOUSSES -->
<!-- / PARTIAL FOR NEXT -->
<div class="row">
<div class="col-12">
<div class="card">
<div class="card-body">
<div class="row">
<div class="col-12 col-xl-12 text-center mb-3">
<h2 class="mb-2">
Initiation à Rails
</h2>
<h3>
Validations &amp; Conceptions de BDD
</h3>
<h4>
<i class="fa fa-pencil text-success" data-placement="bottom" data-toggle="tooltip" title="" data-original-title="Corrections cette journée là"></i>

</h4>
<h5>
Et allez encore des bases de données 😎
</h5>
</div>
<div class="col-12 col-xl-12 timeline-left" id="activity">
<div class="timeline pt-2">
<ul class="list-unstyled base-timeline activity-timeline">
<li>
<a href="https://www.thehackingproject.org/fr/dashboard/courses/1/weeks/2/days/1"><div class="timeline-icon bg-dark">
<i class="ft-check font-medium-1"></i>
</div>
</a><div class="act-time">
<a href="https://www.thehackingproject.org/fr/dashboard/courses/1/weeks/2/days/1">Lundi
</a></div>
<div class="base-timeline-info">
<div class="text-dark">
<i class="fa fa-rocket text-danger" data-placement="bottom" data-toggle="tooltip" title="" data-original-title="Projet à rendre ce jour-là"></i>

Franck Sinatra
</div>
</div>
<small class="text-muted">
Nous allons voir un framework minimaliste de Ruby pour faire du web : 
Sinatra. Sinatra est bien plus bas-niveau que Rails, et voir ce 
framework en premier te donnera les bases pour comprendre le web.
Dans l'après midi, les ateliers t'apprendront à faire des trucs bien 
coolos.
</small>
</li>
<li>
<a href="https://www.thehackingproject.org/fr/dashboard/courses/1/weeks/2/days/2"><div class="timeline-icon bg-dark">
<i class="ft-check font-medium-1"></i>
</div>
</a><div class="act-time">
<a href="https://www.thehackingproject.org/fr/dashboard/courses/1/weeks/2/days/2">Mardi
</a></div>
<div class="base-timeline-info">
<div class="text-dark">
<i class="fa fa-pencil text-success" data-placement="bottom" data-toggle="tooltip" title="" data-original-title="Corrections cette journée là"></i>

Découverte de SQL
</div>
</div>
<small class="text-muted">
Pour ce premier jour, tu verras l'univers des bases de données, comment 
créer ta première base de données, comment la concevoir, puis comment 
intéragir avec une base de données.
</small>
</li>
<li>
<a href="https://www.thehackingproject.org/fr/dashboard/courses/1/weeks/2/days/3"><div class="timeline-icon bg-dark">
<i class="ft-check font-medium-1"></i>
</div>
</a><div class="act-time">
<a href="https://www.thehackingproject.org/fr/dashboard/courses/1/weeks/2/days/3">Mercredi
</a></div>
<div class="base-timeline-info">
<div class="text-dark">

Passage de SQL à ActiveRecord
</div>
</div>
<small class="text-muted">
Nous allons voir comment utiliser ActiveRecord pour se simplifier la vie
 avec les bases de données. C’est également le pont entre le SQL et le 
Ruby
</small>
</li>
<li>
<a href="https://www.thehackingproject.org/fr/dashboard/courses/1/weeks/2/days/4"><div class="timeline-icon bg-dark">
<i class="ft-check font-medium-1"></i>
</div>
</a><div class="act-time">
<a href="https://www.thehackingproject.org/fr/dashboard/courses/1/weeks/2/days/4">Jeudi
</a></div>
<div class="base-timeline-info">
<div class="text-dark">
<i class="fa fa-rocket text-danger" data-placement="bottom" data-toggle="tooltip" title="" data-original-title="Projet à rendre ce jour-là"></i>

Relations entre BDD
</div>
</div>
<small class="text-muted">
Comment faire en sorte qu'un docteur puisse avoir plusieurs patients et 
que les patients puissent avoir plusieurs docteurs ? Grâce aux relations
 entre bases de données, bien entendu !
</small>
</li>
<li>
<div class="timeline-icon bg-primary">
<i class="ft-map-pin font-medium-1"></i>
</div>
<div class="act-time">
Vendredi
</div>
<div class="base-timeline-info">
<div class="text-dark">
<i class="fa fa-pencil text-success" data-placement="bottom" data-toggle="tooltip" title="" data-original-title="Corrections cette journée là"></i>

Validations &amp; Conceptions de BDD
</div>
</div>
<small class="text-muted">
Et allez encore des bases de données 😎
</small>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</div>

<!-- Les fameuses corrections qui n'arrivent que les jours concernés -->
<div class="row">
<div class="col-12">
<div class="card">
<div class="card-header" style="border-top: 3px solid #5E66E5">
<h1>
Ressource : 
PostgreSQL
</h1>
<a class="heading-elements-toggle">
<i class="la la-ellipsis-v font-medium-3"></i>
</a>
<div class="heading-elements">
<ul class="list-inline mb-0">
<li>
<a href="https://www.thehackingproject.org/fr/dashboard/courses/1/lessons/102/lesson_submissions/new"><i class="ft-edit" data-original-title="Proposer une amélioration" data-placement="top" data-toggle="tooltip"></i>
</a></li>
<li>
<a data-action="collapse">
<i class="ft-minus"></i>
</a>
</li>
<li>
<a data-action="expand">
<i class="ft-maximize"></i>
</a>
</li>
</ul>
</div>
</div>
<div class="card-content collapse show">
<div class="card-body">
<div class="tab-pane active" id="home1" role="tabpanel">
<h2>1. Introduction</h2>
<p>SQLite3 est comme son nom l'indique, léger. C'est bien pour faire des
 choses faciles en développement, mais on est rapidement limités par ses
 capacités. De plus, Heroku, le service leader de l'hébergement web, que
 nous allons utiliser pour nos applications en production, utilise 
uniquement PostgreSQL. Des bonnes galères de concordance à venir donc. 
Voici donc un tuto pour installer pg sur sa bécane et le faire marcher 
pour tes prochaines applications rails.</p>

<h2>2. Historique</h2>
<p>PostgreSQL est un système de gestion de base de données relationnelles créé en 1996.</p>


<h2>3. La ressource</h2>
<p>Cette ressource sera séparée en deux parties : la première concerne 
ceux qui sont sur macOS, la seconde concerne ceux qui sont sur Linux.</p>

<h3>3.1. macOS</h3>

<h4>3.1.1 - Prérequis</h4>
<p>En théorie, tous les outils sont déjà pré-installés. Dans le cas 
contraire, voici la liste des applications/librairies/gems requises 
avant l'installation de PG :</p>

<ul>
	<li>Xcode : librairies Apple pour accéder au développement sur macOS</li>
	<li>Homebrew : équivalent à wget sur linux mais sur macOS</li>
	<li>RVM et Ruby dans leurs dernières versions</li>
	<li>Git</li>
</ul>

<p>Dans le cas où ces outils ne seraient pas installés, je vous invite à suivre le fabuleux tuto <a href="http://installfest.railsbridge.org/installfest/" target="_blank">Installfest</a> du RailsBridge :</p>

<h4>3.1.2 - Mise à jour</h4>

Pour cela, tapez dans votre terminal la ligne de commande suivante :

<pre class=" language-shell"><code class=" language-shell">$ brew update &amp;&amp; brew doctor</code></pre>

<p>La première commande permet de mettre à jour tous les composants 
installés via homebrew sur l'ordinateur. La deuxième permet de s'assurer
 qu'aucun élément n'est défaillant. Si quelque chose cloche avec cette 
dernière commande, le terminal vous proposera une solution de 
ré-installation/désinstallation des éléments défaillants.</p>

<h4>3.1.3 - Installation de la gem PG :</h4>

<p>Lancez l'installation de la gem PG avec la commande suivante :</p>

<pre class=" language-shell"><code class=" language-shell">$ brew install postgresql</code></pre>

<p>L'installation est assez longue mais ne devrait causer aucun soucis. 
Une fois l'installation effectuée, veuillez initialiser le 
fonctionnement de la gem</p>

<pre class=" language-shell"><code class=" language-shell">$ brew services start postgresql</code></pre>

<p>On va ensuite initialiser la base de donnée</p>
<pre class=" language-shell"><code class=" language-shell">$ initdb /usr/local/var/postgres -E utf8</code></pre>

<p>Par défaut, Postgre crée un user avec le nom admin et le mot de passe
 de ton mac. Si ce n'est pas le cas, la ligne de commande suivante 
devrait faire l'affaire. </p>
<pre class=" language-shell"><code class=" language-shell">$ createuser -s postgres</code></pre>


<h3>3.2. Linux</h3>
<h4>3.2.1. Installation de PG :</h4>

<p>Il faut commencer par ce petit téléchargement des familles :</p>
<pre class=" language-shell"><code class=" language-shell">$ sudo sh -c 'echo "deb http://apt.postgresql.org/pub/repos/apt $(lsb_release -cs)-pgdg main" &gt; /etc/apt/sources.list.d/pgdg.list'</code></pre>

<p>ensuite :</p>

<pre class=" language-shell"><code class=" language-shell">$ wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | sudo apt-key add -</code></pre>

<p>Puis, mettons à jour la liste des paquets :</p>
<pre class=" language-shell"><code class=" language-shell">$ sudo apt-get update</code></pre>

<p>Et un peu de mise à niveau des paquets installés :</p>
<pre class=" language-shell"><code class=" language-shell">$ sudo apt-get upgrade</code></pre>

<p>Maintenant nous pouvons installer proprement Postgresql </p>
<pre class=" language-shell"><code class=" language-shell">$ sudo apt-get install postgresql</code></pre>
<pre class=" language-shell"><code class=" language-shell">$ sudo apt-get install libpq-dev</code></pre>

<p>Ça y est, postgresql est installé. Il nous suffit juste d’ajouter un 
nouveau rôle (à vrai dire c’est vous). Sachez que c’est Postgres qui 
joue le rôle par défaut une fois postgresql installé. Donc pour créer un
 nouveau rôle, on tape la commande ci-dessous dans le terminal.</p>

<p>A noter que le drapeau --interactive vous demande les informations 
nécessaires . A la place de nom, donnez lui le nom que vous utilisez 
lors de connexion sur votre ordi et c’est tout !</p>

<pre class=" language-shell"><code class=" language-shell">$ sudo -u postgres createuser --interactive</code></pre>

<h3>3.3. Utiliser PostreSQL pour ses app rails</h3>
<h4>3.3.1. Rails new</h4>
<p>Ca y est tu as PostgreSQL, oh yeah ! Maintenant, il te faudra dire à 
rails quand tu créés une application d'utiliser Postgre et non pas 
SQLite3 :</p>

<pre class=" language-shell"><code class=" language-shell">$ rails new -d postgresql nomdetasuperappli</code></pre>

<div class="card box-shadow-0 border-info">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">🚀 ALERTE BONNE ASTUCE</h4>
      <p class="card-text">Un petit alias pour que <code>$ rails new</code> ajoute le <code>-d postgresql</code> me semble être une bonne idée 😉</p>
    </div>
  </div>
</div>

<p>Ensuite tu vas dans le dossier de ton app rails et tu lances ton <code>bundle install</code>. Il faudra bien veiller à créer sa base de données PostgreSQL à chaque fois : </p>

<pre class=" language-shell"><code class=" language-shell">rails db:create</code></pre>

<h4>3.3.2. database.yml</h4>
<p>Si tu vas dans le fichier <code>config/database.yml</code>, tu peux 
voir comment paramétrer sa base de données. Des fois, il se peut qu'il 
t'envoie chier à cause de paramètres mal placés dans ce fichier. Comme 
le <code>username</code> ou le <code>password</code>. Ou alors des fois 
ce nom de base de données étant déjà utilisé par une autre app, il se 
peut qu'il te dise que le nom est déjà utilisé.</p>

<h4>3.3.3. Jette-moi cette merde que je ne saurais voir</h4>
<p>Maintenant que tu as Postgre installé, tu peux jeter à la poubelle 
SQLiteBDViewer, ou tout autre truc bidon du genre qui traite SQLite.</p>

<p>Si jamais tu tiens à visualiser ta base de données, il te faut un 
truc intégré dans rails, car la moitié de la base est gérée dans le 
models (les relations sont écrites dans les models par exemples), et 
donc un simple <a href="https://wiki.postgresql.org/wiki/GUI_Database_Design_Tools" target="_blank">Postegre vizualizer</a> ne suffira pas et t'induira en erreur.</p>

<p>Passe du côté des gems qui vont gérer cela, même si personnellement 
je ne m'en sers jamais. Une recherche GitHub avec les bons mots clés 
devrait t'aider.</p>

<h4>3.3.4. Fix d'un petit bug</h4>

<p>Attention, la partie ci-dessous est uniquement destinée à résoudre 
une erreur. Ne la suivez pas si vous arrivez à créer une app rails avec 
une base de données sous Postgre sans problème.</p>
<p>A la fin, si vous obtenez une erreur comme ceci, ne vous inquiétez pas:</p>

<pre class=" language-shell"><code class=" language-shell">Gem files will remain installed in /tmp/bundler20180511-4403-1u0yofgpg-0.21.0/gems/pg-0.21.0 for inspection.
Results logged to /tmp/bundler20180511-4403-1u0yofgpg-0.21.0/extensions/x86_64-linux/2.3.0/pg-
0.21.0/gem_make.out
An error occurred while installing pg (0.21.0), and Bundler cannot continue.
Make sure that "gem install pg -v '0.21.0'" succeeds before bundling.</code></pre>

<p>Essayons de résoudre ce problème tout de suite, en installant la gem pg :</p>

<pre class=" language-shell"><code class=" language-shell">$ sudo gem install pg</code></pre>

<p>Du coup vous tombez peut-être sur cette erreur, mais ne vous en faites pas c’est normal :</p>

<pre class=" language-shell"><code class=" language-shell">Gem::Ext::BuildError: ERROR: Failed to build gem native extension.
current directory: /tmp/bundler20180511-4403-1u0yofgpg-0.21.0/gems/pg-0.21.0/ext
/usr/bin/ruby2.3 -r ./siteconf20180511-4403-8bp9td.rb extconf.rb --with-pgconfig=/
Applications/Postgres.app/Contents/Versions/9.3/bin/pg_config
mkmf.rb can t find header files for ruby at /usr/lib/ruby/include/ruby.h
extconf failed, exit code 1</code></pre>

<p>c’est parce que le mkmf.rb fait parti du package ruby. Ce fichier contient les fichiers d’entêtes nécessaires
aux bibliothèques d’extensions pour ruby, donc on va installer ruby-dev :</p>

<pre class=" language-shell"><code class=" language-shell">$ sudo apt-get install ruby-dev</code></pre>

<p>Maintenant ,nous installons sans aucun soucis la gem pg</p>

<pre class=" language-shell"><code class=" language-shell">$ sudo gem install pg</code></pre>


<h2>4. Points importants à retenir</h2>
<p>Y'a quelques manipulations à faire dans PG pour le faire, mais c'est un process jouable.</p>

<h2>5. Pour aller plus loin</h2>
<p>Dans les fameux railscasts, tu peux retrouver <a href="https://www.youtube.com/watch?v=UpEQQ8mVpwY" target="_blank">un petit tuto</a> explicatif pour manipuler PG (la vidéo est vieille, il se peut que certains éléments ne soient plus d'actualité).</p>



</div>
</div>
</div>
</div>
</div>
</div>

<div class="row">
<div class="col-12">
<div class="card">
<div class="card-header" style="border-top: 3px solid #5E66E5">
<h1>
Ressource : 
Models robustes
</h1>
<a class="heading-elements-toggle">
<i class="la la-ellipsis-v font-medium-3"></i>
</a>
<div class="heading-elements">
<ul class="list-inline mb-0">
<li>
<a href="https://www.thehackingproject.org/fr/dashboard/courses/1/lessons/161/lesson_submissions/new"><i class="ft-edit" data-original-title="Proposer une amélioration" data-placement="top" data-toggle="tooltip"></i>
</a></li>
<li>
<a data-action="collapse">
<i class="ft-minus"></i>
</a>
</li>
<li>
<a data-action="expand">
<i class="ft-maximize"></i>
</a>
</li>
</ul>
</div>
</div>
<div class="card-content collapse show">
<div class="card-body">
<div class="tab-pane active" id="home1" role="tabpanel">

<h2>1. Introduction</h2>
<p>Un des principes fondamentaux de Rails est le fameux <b>"Fat model, skinny controller"</b>. En français, cette phrase pourrait se traduire par&nbsp;: <b>"mets un max de code dans ton model, un minimum dans tes controllers"</b>. Et l'équivalent en proverbe chinois serait "avec des models robustes, le sage peut emmener son app jusqu'à la lune argentée".</p>

<p>Un model robuste ne veut pas dire une base de données pensée et 
modélisée à la perfection. Ceci s'acquiert avec l'expérience. Même nous à
 THP notre base de données est perfectible&nbsp;! Non un model robuste, 
c'est un model qui fait un maximum de tâches :</p>

<ol>
  <li><b>Il préserve la BDD en empêchant de sauvegarder des instances dont les attributs ne sont pas propres</b>
 (e-mail vide, code postal à 15 chiffres, téléphone contenant des 
lettres, etc.). Exemple : une méthode tente de créer en BDD un 
utilisateur sans e-mail&nbsp;? Elle se fait recaler par le model !</li>
  <li><b>Il définit des méthodes d'instance qui donnent accès à des informations non disponibles en BDD pourtant très utiles</b>. Exemple&nbsp;: tes <code>appointments</code> disposent des informations <code>start_date</code> et <code>duration</code>&nbsp;? Le model peut définir une méthode <code>end_date</code> qui calcule l'heure de fin&nbsp;!</li>
  <li><b>Il effectue des actions qui doivent être coordonnées à une action en BDD</b>. Exemple&nbsp;: un utilisateur vient de s'inscrire sur ton application&nbsp;? Le model lui envoie un e-mail de bienvenue&nbsp;!</li>
</ol>

<p>Bref, quand tu as des models robustes et bien faits, tout le reste de
 ton application va glisser tout seul. À partir de là tu auras juste à 
appeler les bonnes méthodes de tes controllers, et puis c'est 
tout&nbsp;!</p>

<h2>2. Historique</h2>
<p>"Fat model, skinny controller" a été posé comme principe de base de Rails.</p>

<h2>3. La ressource</h2>
<p>Nous allons voir trois éléments importants dans cette ressource, liés aux 3 types de tâches que doit mener un bon model :</p>
<ol>
  <li><b>Les validations</b>, ou comment dire "impossible de créer cette entrée si telle condition n'est pas remplie"&nbsp;;</li>
  <li><b>Les méthodes d'instance</b>, ou comment dire "rends cette méthode exécutable sur toute instance de mon model"&nbsp;;</li>
  <li><b>Les callbacks</b>, ou comment dire "après la sauvegarde en BDD de mon instance, fais donc ceci stp".</li>
</ol>

<h3>3.1. Les validations</h3>
<p>Les validations permettent de vérifier certains éléments avant de 
pouvoir enregistrer ou modifier en BDD une instance de ton modèle. Par 
exemple : il est impossible de créer un utilisateur si ce dernier n'a 
pas renseigné d'adresse e-mail.</p>
<p>Nous allons voir ci-après plusieurs types de validations possibles.</p>

<h4>3.1.1. Valider la présence d'un attribut</h4>
<p>Tu as pu le voir hier&nbsp;: si tu ne mets pas <code>optional: true</code>
 dans une relation belongs_to de model, ton instance ne peut pas être 
sauvée en BDD tant qu'elle n'est pas liée à l'objet auquel elle belongs.
 Eh bien figure-toi qu'il est possible de mettre en place le même genre 
de sécurité sur n'importe quel attribut de l'instance (pas que ceux en 
belongs_to)&nbsp;!</p>

<p>Prenons l'exemple de l’e-mail&nbsp;: il faut qu'il soit <b>impossible</b>
 de créer un utilisateur en base sans e-mail. Pas de négociation à ce 
sujet&nbsp;: c'est l'identifiant principal de ton utilisateur et sans 
lui, l'utilisateur n'est rien. Eh bien avec les lignes suivantes, en 
haut du model <code>User</code>, c'est possible de l'imposer :</p>

<pre class=" language-ruby"><code class=" language-ruby"><span class="token keyword">class</span> <span class="token const">User</span> &lt; <span class="token const">ApplicationRecord</span>
  validates <span class="token symbol">:email</span><span class="token punctuation">,</span> presence<span class="token punctuation">:</span> <span class="token keyword">true</span>
<span class="token keyword">end</span></code></pre>

<p>Cette ligne dit&nbsp;: "dans le model <code>User</code>, je valide la sauvegarde en BDD d'une instance à condition que l’e-mail (<code>validates :email</code>) soit non <i>nil</i> (<code>presence: true</code>)". Bien entendu, tout ça n'a de sens que si <code>email</code> est un attribut de la classe <code>User</code> (il faut une colonne <code>email</code> dans ta table <code>users</code> 😉 ).</p>

<p>Faisons le test rapidement dans une app Rails créée à la volée avec un model <code>User</code> et une table <code>users</code> contenant un e-mail (je te laisse faire tout ça&nbsp;!). Pense bien à rajouter la ligne du <code>validates</code> dans le model <code>User</code>.<br>
Maintenant, amuse-toi à créer un utilisateur en console sans 
e-mail&nbsp;: tu devrais pouvoir récupérer une erreur. Voici ce que ça 
doit donner :</p>

<pre class=" language-ruby"><code class=" language-ruby"><span class="token number">2.5</span><span class="token punctuation">.</span><span class="token number">1</span> <span class="token punctuation">:</span><span class="token number">002</span> &gt; u <span class="token operator">=</span> <span class="token const">User</span><span class="token punctuation">.</span>create
   <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">.</span>2ms<span class="token punctuation">)</span>  <span class="token const">SAVEPOINT</span> active_record_1
   <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">.</span>1ms<span class="token punctuation">)</span>  <span class="token const">ROLLBACK</span> <span class="token const">TO</span> <span class="token const">SAVEPOINT</span> active_record_1
 <span class="token operator">=</span>&gt; <span class="token comment">#&lt;User id: nil, timestamps: nil, email: nil&gt; 
</span>
<span class="token number">2.5</span><span class="token punctuation">.</span><span class="token number">1</span> <span class="token punctuation">:</span><span class="token number">003</span> &gt; u<span class="token punctuation">.</span>errors
 <span class="token operator">=</span>&gt; <span class="token comment">#&lt;ActiveModel::Errors:0x00007f63541910e0 @base=#&lt;User id: nil, timestamps: nil, email: nil&gt;, @messages={:email=&gt;["can't be blank"]}, @details={:email=&gt;[{:error=&gt;:blank}]}&gt; 
</span>
<span class="token number">2.5</span><span class="token punctuation">.</span><span class="token number">1</span> <span class="token punctuation">:</span><span class="token number">004</span> &gt; u<span class="token punctuation">.</span>email <span class="token operator">=</span> <span class="token string">"bonjour@bonjour.com"</span>
 <span class="token operator">=</span>&gt; <span class="token string">"bonjour@bonjour.com"</span> 

<span class="token number">2.5</span><span class="token punctuation">.</span><span class="token number">1</span> <span class="token punctuation">:</span><span class="token number">005</span> &gt; u<span class="token punctuation">.</span>save
   <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">.</span>2ms<span class="token punctuation">)</span>  <span class="token const">SAVEPOINT</span> active_record_1
  <span class="token const">User</span> <span class="token const">Create</span> <span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">.</span>1ms<span class="token punctuation">)</span>  <span class="token const">INSERT</span> <span class="token const">INTO</span> <span class="token string">"users"</span> <span class="token punctuation">(</span><span class="token string">"email"</span><span class="token punctuation">)</span> <span class="token const">VALUES</span> <span class="token punctuation">(</span><span class="token operator">?</span><span class="token punctuation">)</span>  <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">"email"</span><span class="token punctuation">,</span> <span class="token string">"bonjour@bonjour.com"</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
   <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">.</span>3ms<span class="token punctuation">)</span>  <span class="token const">RELEASE</span> <span class="token const">SAVEPOINT</span> active_record_1
 <span class="token operator">=</span>&gt; <span class="token keyword">true</span> </code></pre>

<p>Quand il essaie de créer l'utilisateur, comme il n'a pas d’e-mail, Rails refuse l'inscription en BDD (<code>ROLLBACK</code>) et rajoute à l'instance une erreur. Au top&nbsp;!</p>

<div class="card box-shadow-0 border-info">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">🤓 QUESTION RÉCURRENTE</h4>
      <p class="card-text"><b>Dis donc Jamy, pourquoi risquer de créer 
des "errors"&nbsp;? Quel intérêt d'être aussi rigide&nbsp;? Il suffit de
 ne pas s'amuser à faire des utilisateurs sans e-mails et hop problème 
réglé&nbsp;!</b><br>
      C'est une très mauvaise idée pour deux raisons :</p>
      <ul>
        <li>La première est que si tu ne fais pas ça, il y aura 
forcément des éléments de ta base qui vont passer entre les mailles du 
filet. Lorsque tu voudras leur envoyer un e-mail avec <code>SendEmail(user.email)</code>,
 l'app va planter et te sortir un joli "cannot send_email sur 
nil:NilClass" bien casse-couille. Ça tu ne le veux pas&nbsp;: ça 
t'obligerait à repasser sur TOUTE ta BDD pour la laver des user sans 
e-mail. Et ça peut être long. Et on te parle en connaissance de cause.</li>
        <li>La seconde est que tu as envie de décharger au maximum le 
controller de ce genre de vérification. On y reviendra plus tard, mais 
1) ça réduit les risques de bugs du controller et 2) il devient plus 
lisible car plus court.</li>
      </ul>
      <p>Au final, il est important de ne pas polluer ta BDD avec des 
entrées incomplètes. Si tu laisses faire ça, la qualité de ta BDD 
décroît au fil du temps jusqu'à atteindre le stade ultime de la 
putréfaction. Et là, il reste plus qu'à la jeter au compost (qu'elle 
contribue au moins au cycle de la vie).</p>
    </div>
  </div>
</div>

<h4>3.1.2. Valider l'unicité d'un attribut</h4>
<p>Restons sur les e-mails&nbsp;: tu n'as pas envie que deux 
utilisateurs puissent s'inscrire avec le même email (sinon tu vas les 
confondre, ils vont reset leurs mots de passe entre eux, etc.). Pour 
ceci, rien de plus simple :</p>

<pre class=" language-ruby"><code class=" language-ruby"><span class="token keyword">class</span> <span class="token const">User</span> &lt; <span class="token const">ApplicationRecord</span>
  validates <span class="token symbol">:email</span><span class="token punctuation">,</span> uniqueness<span class="token punctuation">:</span> <span class="token keyword">true</span>
<span class="token keyword">end</span></code></pre>

<p>Hop, impossible de créer un utilisateur en BDD si l’e-mail est déjà pris par une entrée de la BDD.</p>

<h4>3.1.3. Format</h4>
<p>Encore un exemple applicable aux e-mails&nbsp;! Pour le moment, si l'on fait <code>validates :email, uniqueness: true, presence: true</code>, il est possible pour un utilisateur de s'enregistrer avec l'email <code>"coucou123"</code>, ce qui n'est pas un e-mail valide. On peut rajouter une validation de format à cet attribut :</p>

<pre class=" language-ruby"><code class=" language-ruby"><span class="token keyword">class</span> <span class="token const">User</span> &lt; <span class="token const">ApplicationRecord</span>
  validates <span class="token symbol">:email</span><span class="token punctuation">,</span>
    presence<span class="token punctuation">:</span> <span class="token keyword">true</span><span class="token punctuation">,</span>
    uniqueness<span class="token punctuation">:</span> <span class="token keyword">true</span><span class="token punctuation">,</span>
    format<span class="token punctuation">:</span> <span class="token punctuation">{</span> with<span class="token punctuation">:</span> <span class="token regex">/\A[^@\s]+@([^@\s]+\.)+[^@\s]+\z/</span><span class="token punctuation">,</span> message<span class="token punctuation">:</span> <span class="token string">"email adress please"</span> <span class="token punctuation">}</span>
<span class="token keyword">end</span></code></pre>

<p>Par contre, pour coder ce genre validation, il faut savoir écrire en <a href="https://fr.wikipedia.org/wiki/Expression_r%C3%A9guli%C3%A8re">regex</a> (prononcez [Raig' - Ex]).</p>


<h4>3.1.4. Longueur</h4>
<p>Des fois, tu veux imposer un certain nombre de caractères. Par 
exemple tu veux que ton mot de passe fasse 6 caractères minimum, ou que 
le <code>title</code> de ton article n'en fasse pas plus de 140. Tu peux valider la length de tes attributs :</p>

<pre class=" language-ruby"><code class=" language-ruby"><span class="token keyword">class</span> <span class="token const">Person</span> &lt; <span class="token const">ApplicationRecord</span>
  validates <span class="token symbol">:name</span><span class="token punctuation">,</span> length<span class="token punctuation">:</span> <span class="token punctuation">{</span> minimum<span class="token punctuation">:</span> <span class="token number">2</span> <span class="token punctuation">}</span>
  validates <span class="token symbol">:bio</span><span class="token punctuation">,</span> length<span class="token punctuation">:</span> <span class="token punctuation">{</span> maximum<span class="token punctuation">:</span> <span class="token number">500</span> <span class="token punctuation">}</span>
  validates <span class="token symbol">:password</span><span class="token punctuation">,</span> length<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token keyword">in</span><span class="token punctuation">:</span> <span class="token number">6</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">20</span> <span class="token punctuation">}</span>
  validates <span class="token symbol">:registration_number</span><span class="token punctuation">,</span> length<span class="token punctuation">:</span> <span class="token punctuation">{</span> is<span class="token punctuation">:</span> <span class="token number">6</span> <span class="token punctuation">}</span>
<span class="token keyword">end</span></code></pre>



<h4>3.1.5. Et bien d'autres</h4>
<p>Il existe plein d'autres validations que tu peux trouver dans <a href="https://guides.rubyonrails.org/active_record_validations.html" target="_blank">la doc de Rails</a>.</p>

<h4>3.1.6. La philosophie derrière les validations</h4>
<p>Rails n'est pas un langage fait pour emmerder le développeur, bien au
 contraire&nbsp;! Cette rigueur te permettra de décharger un maximum tes
 controllers. <br>
Exemple&nbsp;: imaginons que tu veuilles coder une méthode <code>create_user</code> dans ton controller. Avec un model bien fait et complet, elle se résumera à un petit <code>User.create(params)</code>
 (params étant un hash qui contient tous les attributs du nouveau User) 
et puis c'est tout&nbsp;! Pas besoin d'une méthode à rallonge du genre :</p>

<pre class=" language-ruby"><code class=" language-ruby"><span class="token keyword">def</span> create_user
  user <span class="token operator">=</span> <span class="token const">User</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span>
  <span class="token keyword">if</span> params<span class="token punctuation">[</span><span class="token symbol">:first_name</span><span class="token punctuation">]</span><span class="token punctuation">.</span>empty<span class="token operator">?</span>
    puts <span class="token string">"Erreur, pas possible de créer un utilisateur sans prénom"</span>
  <span class="token keyword">elsif</span> params<span class="token punctuation">[</span><span class="token symbol">:email</span><span class="token punctuation">]</span><span class="token punctuation">.</span>unique<span class="token operator">?</span>
    puts <span class="token string">"Email déjà pris"</span>
  <span class="token keyword">elsif</span> user<span class="token punctuation">.</span>save<span class="token operator">?</span>
    puts <span class="token string">"Utilisateur bien créé !"</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span></code></pre>

<p>L'objectif est de vider au max le controller. <br>
A noter qu'il y aura aussi des impacts dans tes views&nbsp;: celles-ci 
vont contenir les messages d'erreur liés à tes validations. Un exemple 
ci-dessous dans la barre rouge, en haut de fenêtre :</p>

<img src="s5j5_fichiers/Wh52PT6.png" class="img-fluid"><br>

<p>Ca, ça se fait très facilement avec les fameuses <a href="https://getbootstrap.com/docs/4.2/components/alerts/" target="_blank">alertes</a> de Bootstrap 😉</p>

<h3>3.2. Les méthodes d'instance</h3>
<p>Prenons l'exemple d'une session The Hacking Project. Chaque <code>Session</code> a une <code>start_date</code> et est liée à un objet <code>Course</code> dont l'attribut <code>weeks</code> indique le nombre de semaine que dure la formation. Les cyniques diront que les objets <code>Course</code>
 sont toujours les mêmes à chaque session (on n'a qu'un seul cours sur 
11 semaines) mais qui sait si un jour on aura pas 12 cursus 
différents&nbsp;? 😉 <br>
Bref, on voudrait pouvoir utiliser la date de fin dans notre code. Il n'est pas pertinent d'en faire une colonne de la table <code>sessions</code> car c'est une information redondante : si on a la <code>start_date</code> et la durée (via <code>course.weeks</code>), on peut la calculer. La solution&nbsp;? Créer une méthode d'instance dans <code>Session</code> qui permet de la calculer et la retourner quand nécessaire&nbsp;! </p>

<p>Avec les lignes ci-dessous, on va pouvoir exécuter des <code>.end_date</code> sur nos objets <code>Session</code>. On aura alors aussi bien accès à <code>ma_session.start_date</code> (un attribut) qu'à <code>ma_session.end_date</code> (une méthode d'instance) :</p>

<pre class=" language-ruby"><code class=" language-ruby"><span class="token keyword">class</span> <span class="token const">Session</span> &lt; <span class="token const">ApplicationRecord</span>

  <span class="token keyword">def</span> end_date
    <span class="token keyword">self</span><span class="token punctuation">.</span>start_date <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>course<span class="token punctuation">.</span>weeks<span class="token punctuation">.</span>count <span class="token operator">*</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">.</span>day
  <span class="token keyword">end</span>

<span class="token keyword">end</span></code></pre>

<p> Au final, les méthodes d'instance vont te permettre de récupérer des
 infos dont tu as souvent besoin mais qui ne sont pas inscrites en BDD. 
Autre exemple si tu veux pouvoir vérifier facilement qu'une <code>Session</code> a commencé avec un <code>ma_session.is_started</code> qui renvoie <code>true / false</code> :</p>

<pre class=" language-ruby"><code class=" language-ruby"><span class="token keyword">class</span> <span class="token const">Session</span> &lt; <span class="token const">ApplicationRecord</span>
  <span class="token keyword">def</span> is_started
    <span class="token keyword">self</span><span class="token punctuation">.</span>start_date &lt; <span class="token builtin">Time</span><span class="token punctuation">.</span>now
  <span class="token keyword">end</span>
<span class="token keyword">end</span></code></pre>

<p>Certes, tu pourrais écrire cette ligne <code>ma_session.start_date &lt; Time.now</code> dans tes controllers à chaque fois que nécessaire. Mais 1) c'est pas très DRY, 2) c'est pas très Ruby et 3) <code>ma_session.is_started</code> ça se comprend juste en le lisant non&nbsp;? BAM.</p>

<h3>3.3. Les callbacks</h3>
<p>Dernier élément pour cette introduction aux models propres&nbsp;: les callbacks. <br>
Un callback est une action que tu souhaites réaliser à un instant précis
 lorsque tu appelles ton model. Voici un exemple de moment où tu peux 
appeler les callbacks :</p>

<ul>
  <li>Juste AVANT la sauvegarde en BDD d'une instance de ton model&nbsp;;</li>
  <li>Juste APRES la sauvegarde en BDD d'une instance de ton model&nbsp;;</li>
  <li>Juste APRES la mise à jour en BDD d'une instance de ton model&nbsp;;</li>
  <li>Bref, y'en a d'autres.</li>
</ul>

<p>Prenons l'exemple d'un e-mail de bienvenue que tu aimerais bien 
envoyer à la création de ton utilisateur. Tu pourrais mettre dans ton 
controller :</p>

<pre class=" language-ruby"><code class=" language-ruby"><span class="token keyword">def</span> create_user
  user <span class="token operator">=</span> <span class="token const">User</span><span class="token punctuation">.</span>create<span class="token punctuation">(</span>form_params<span class="token punctuation">)</span>
  user<span class="token punctuation">.</span>send_welcome_email
<span class="token keyword">end</span></code></pre>

<p>Encore une fois, ce n'est pas au controller de faire ceci. 
Pourquoi&nbsp;? Car l'action est intimement liée à la sauvegarde en BDD 
et donc au taff du model&nbsp;: autant qu'il le prenne en charge. Sans 
compter que plusieurs controllers pourraient avoir à créer des <code>User</code>&nbsp;: il faudrait alors à chaque fois rajouter cette ligne d'envoi d'e-mail et là, c'est plus DRY du tout. <br>
On va donc implémenter un callback <code>after_create</code> pour envoyer un email de bienvenue à chaque sauvegarde en BDD d'un utilisateur :</p>

<pre class=" language-ruby"><code class=" language-ruby"><span class="token keyword">class</span> <span class="token const">User</span> &lt; <span class="token const">ActiveRecord</span>
  after_create <span class="token symbol">:send_welcome_email</span>

  <span class="token keyword">def</span> send_welcome_email
    <span class="token comment"># le code qui envoit l'email
</span>  <span class="token keyword">end</span>

<span class="token keyword">end</span></code></pre>

<p><a href="https://guides.rubyonrails.org/active_record_callbacks.html#available-callbacks">La documentation de Rails</a> te liste tout un tas d'autres Callbacks qui devraient te permettre de gérer tous les cas possibles.</p>



<h2>4. Points importants à retenir</h2>

<p><b>Fat model, skinny controllers</b>. Avec des models robustes, ta 
BDD reste propre longtemps, tes controllers sont plus simples et plus 
lisibles et ton code ne se répète pas (il est DRY). Bref, tu construis 
avec eux les bases d'une application Rails qui va durer dans le temps et
 qui sera facilement maintenable par une tierce personne. À partir de 
là, tu seras le champion du framework&nbsp;!</p>

<p>Et pour des models solides, voici 3 outils :</p>

<ul>
  <li>Les validations (<code>presence</code>, <code>uniqueness</code>, <code>format</code>, <code>length</code>, etc.)</li>
  <li>Les méthodes d'instance (à définir directement dans le model)</li>
  <li>Les callbacks (<code>after_create</code>, <code>before_save</code>, <code>before_validation</code>, etc.)</li>
</ul>

<h2>5. Pour aller plus loin</h2>
<p>Comme d'habitude, la doc est complète et contient tout ce que tu dois savoir. <a href="https://guides.rubyonrails.org/active_record_validations.html" target="_blank">Voici le chapitre sur les validations</a>, et <a href="https://guides.rubyonrails.org/active_record_callbacks.html" target="_blank">voici celui sur les callbacks</a>.</p>

<p>Si jamais (c'est assez rare, mais cela arrive) tu veux faire des <a href="https://guides.rubyonrails.org/active_record_validations.html#validates-with" target="_blank">validations personnalisées</a>, c'est possible grâce à la classe <code>Validator</code>.
 Prenons l'exemple de THP, qui peut générer un certificat personnalisé à
 chaque corsaire (prouvant qu'il a suivi une session). Bien entendu, la 
page pour générer ce certificat n'est accessible qu'aux corsaires (le 
blocage est au niveau de l'accès au views), mais on n'est jamais à 
l'abri d'un petit bug. Nous avons donc codé dans le model le fait qu'il 
était impossible de créer un certificat si la session de l'utilisateur 
concerné n'est pas finie. Ainsi, on rajoute une sécurité en BDD&nbsp;: 
pas de mauvaise surprise&nbsp;!</p>

<p>Bref, n'hésite pas à lire la doc et faire des recherches StackOverflow pour connaître les bonnes pratiques à ce sujet&nbsp;!</p>
</div>
</div>
</div>
</div>
</div>
</div>

<div class="row">
<div class="col-12">
<div class="card">
<div class="card-header" style="border-top: 3px solid #FF4081">
<h1>
Projets : 
Le Back-end de Airbnb
</h1>
<a class="heading-elements-toggle">
<i class="la la-ellipsis-v font-medium-3"></i>
</a>
<div class="heading-elements">
<ul class="list-inline mb-0">
<li>
<a href="https://www.thehackingproject.org/fr/dashboard/courses/1/projects/97/project_submissions/new"><i class="ft-edit" data-original-title="Proposer une amélioration" data-placement="top" data-toggle="tooltip"></i>
</a></li>
<li>
<a data-action="collapse">
<i class="ft-minus"></i>
</a>
</li>
<li>
<a data-action="expand">
<i class="ft-maximize"></i>
</a>
</li>
</ul>
</div>
</div>
<div class="card-content collapse show">
<div class="card-body">
<div class="tab-pane active" id="home1" role="tabpanel">
<h2>1. Introduction</h2>
<p>C'est parti ! Voici enfin un projet concret où tu vas réaliser une 
vraie base de données robuste. Pour l'occasion, nous allons te demander 
de refaire la BDD et les model d'une application bien connue du monde 
des startups : Airbnb. Oui, aujourd'hui, après même pas 4 semaines 
d'apprentissage au code tu vas refaire le back-end de Airbnb.</p>

<p>Pour le projet du jour, nous allons te donner simplement le pitch de 
l'application. À partir de ça, tu feras le design de la base de données 
tout seul comme un grand, puis tu rendras tes models robustes en mettant
 des validations.</p>

<p>Nous sommes très fiers de te proposer un projet aussi concret aussi 
rapidement et nous espérons que tu vas prendre autant de plaisir à le 
faire que nous en le rédigeant.</p>


<h2>2. Le projet</h2>
<h3>2.1. Présentation</h3>
<p>Nous sommes en 2007, tu habites dans une grande ville et galère à 
payer ton loyer. Tu remarques qu'il y a une super conférence sur 
Internet Explorer 6 pas loin de chez toi. Tu es passionné de web donc 
pour rien au monde tu ne manquerais cet événement. Cependant, tu 
constates avec ta coloc que tous les hôtels du coin sont pleins. Et là 
vous vous dites "on devrait faire un site où les particuliers peuvent 
proposer une chambre dans leur piaule moyennant un peu d'argent." <br>
L'idée est bonne, mais vous êtes pas les premiers à y penser. Pour la 
transformer en idée du siècle, il faut l'implémenter comme un chef. Et 
le point de départ, avant de coder les views, c'est de modéliser la base
 de données. Hop, une feuille, un stylo et des surligneurs !</p>

<h3>2.2. L'application</h3>
<p>Ci-dessous tu trouveras quelques parcours utilisateurs sur 
l'application. Ils te renseigneront sur les models à définir, leurs 
attributs et les relations entre eux.</p>

<ul>
  <li>Un utilisateur va arriver sur la page d'accueil du site qui 
présente les villes dans lesquelles le site opère. Pas de notion de pays
 dans cette première version qui sera consacrée uniquement à la France.</li>
  <li>Quand tu vas sur la page d'une ville, tu pourras voir les différents logements que cette ville propose.</li>
  <li>Pour chaque logement, tu peux avoir des informations précises sur :
  <ul>
    <li>Le nombre de lits disponibles
    </li><li>Le prix par nuit</li>
    <ul>
      <li>Note : pour cette première version, un logement sera forcément
 loué en entier : il ne peut accepter qu'une seule réservation par nuit.
 Si jamais ta startup cartonne, tu développeras une fonctionnalité qui 
permettra de louer un logement à plusieurs personnes différentes par 
nuit, en fonction du nombre de lits pris.</li>
    </ul>
    <li>Une description</li>
    <li>Est-ce qu'il a le wifi ?</li>
  </ul></li>
  <li>Une personne peut effectuer une réservation facilement sur le 
site, en payant le coût de la réservation. Une réservation a une date de
 début, une date de fin, et une durée.
  <ul>
    <li>Dans cette version du site, nous allons faire comme si toutes 
les réservations étaient instantanées, c’est-à-dire qu'une réservation 
sera automatiquement validée quand elle sera payée.</li>
    <li>Il est bien entendu impossible d'effectuer une réservation sur 
un logement si ce dernier a déjà une réservation sur tout ou une partie 
de la période qu'on cherche à réserver.</li>
  </ul></li>
  <li>Un utilisateur doit renseigner ses informations basiques : une 
adresse e-mail, un numéro de téléphone, une description de profil.
  <ul>
    <li>Nous n'allons pas gérer la notion de mot de passe pour le moment.</li>
  </ul></li>
  <li>Un logement est administré par un utilisateur. Dès qu'une 
réservation est passée dessus, les utilisateurs deviennent des invités.</li>
  <li>Un logement a un petit mot d'accueil réservé aux invités. C'est 
généralement un texte écrit pour donner quelques détails sur la 
réservation.</li>
  <li>On ne va pas encore coder la fonctionnalité de messages privés entre utilisateurs.</li>
</ul>

<p>Avec ces informations, tu devrais être capable de modéliser la base de données de l'application. En avant ! <br>
Une fois ce premier jet de fait, nous allons te proposer notre version 
de la base de données afin de te guider dans les migrations et créations
 de models. N'hésite pas à comparer notre version et celle à laquelle tu
 étais arrivé sur papier/tableau/ERD.</p>

<p>⚠️ Il est important que tu prennes au sérieux la partie modélisation 
sur papier : si tu ne te casses pas un peu la tête dessus, tu ne 
progresseras pas. Pour ton projet final THP (et encore plus pour ta vie 
future de dev) il n'y aura pas de correction à suivre. Et si tu ne t’es 
jamais entraîné avant, tu vas être à la ramasse.</p>


<h3>2.3. La base de données en détails</h3>
<p>Voici notre version de la BDD de cette V0 d'AirBnb. Cela ne 
correspond en rien à une correction, car il y a plusieurs façons 
d'arriver à un même résultat, sans forcément qu'une soit supérieure à 
l'autre. Mais cela va te donner une idée et surtout nous permettre de te
 guider.</p>

<p>⚠️ Avant de coder, lis toute la partie 2.3. Tu passeras à la mise en œuvre en 2.4.</p>


<p>Personnellement, j'aurais vu 4 models :</p>
<ul>
  <li>un model <code>User</code>, qui représente nos utilisateurs</li>
  <li>un model <code>Listing</code>, qui représente les logements disponibles (<code>Accommodation</code> aurait été pas mal non plus comme nom) </li>
  <li>un model <code>City</code>, qui représente les villes desservies par l'application</li>
  <li>un model <code>Reservation</code>, qui représente les séjours</li>
</ul>


<h4>2.3.1. Model <code>User</code></h4>
<p>Pour les utilisateurs, c'est plutôt simple. Ils ont les attributs de base :</p>
<ul>
  <li><code>email</code> : un string. Sa présence est obligatoire, il doit être unique et répondre au regex d'un email</li>
  <li><code>phone_number</code> : un string (ce n'est pas un integer) qui doit répondre à ce regex : <code>format:
 { with: 
/\A(?:(?:\+|00)33[\s.-]{0,3}(?:\(0\)[\s.-]{0,3})?|0)[1-9](?:(?:[\s.-]?\d{2}){4}|\d{2}(?:[\s.-]?\d{3}){2})\z/,
 message: "please enter a valid french number" }</code>. On peut rendre 
le numéro de téléphone obligatoire uniquement pour la création d'une 
réservation, mais en termes de code c'est pas ultra pratique, donc nous 
allons rendre le numéro de téléphone obligatoire tout court.</li>
  <li><code>description</code> : un <code>text</code></li>
</ul>

<p>Un utilisateur peut avoir plusieurs réservations: il devient alors un "invité" (guest). <br>
Un utilisateur peut être administrateur de plusieurs listings.</p>

<h4>2.3.2. Model <code>City</code></h4>
<p>Une ville a des attributs très simples :</p>
<ul>
  <li>Un <code>name</code>, qui est le nom de la ville. Sa présence est obligatoire.</li>
  <li>Un <code>zip_code</code> qui est le code postal. Ce sera un <code>string</code> au format suivant : <code>format: { with: /\A(([0-8][0-9])|(9[0-5])|(2[ab]))[0-9]{3}\z/, message: "please enter a valid french zip code" }</code>. Sa présence est obligatoire et il est unique.</li>
</ul>

<p>Une ville peut avoir plusieurs listings.</p>


<h4>2.3.3. Model <code>Listing</code></h4>
<p>Voici les attributs du listing :</p>

<ul>
  <li>Un <code>available_beds</code>, qui est un <code>integer</code>. Il doit être strictement positif, et est obligatoire</li>
  <li>Un <code>price</code> qui est un <code>integer</code>. Le prix 
correspondra au nombre d'euros qu'il faudra débourser pour rester une 
nuit. Dans cette application révolutionnaire, nous ne proposons que des 
prix entiers (pas de centimes). Il doit être strictement positif et est 
obligatoire.</li>
  <li>Une <code>description</code> qui est un <code>text</code>. Elle doit faire au moins 140 caractères de long et est obligatoire.</li>
  <li>Un <code>boolean</code> au nom de <code>has_wifi</code> qui permet de vérifier que le listing ait bien le wifi.</li>
  <li>Un <code>welcome_message</code> qui est un <code>text</code>. Sa présence est obligatoire.</li>
</ul>

<p>Un listing a un administrateur (qui est un utilisateur). <br>
Un listing a plusieurs réservations. <br>
Un listing appartient à une ville.</p>



<h4>2.3.4. Model <code>Reservation</code></h4>
<p>Voici les attributs de la réservation :</p>

<ul>
  <li>Une <code>start_date</code> qui est un <code>datetime</code></li>
  <li>Une <code>end_date</code> qui est un <code>datetime</code>. Il est impossible que la <code>end_date</code> soit avant la <code>start_date</code> (pour ceci, j'ai trouvé <a href="https://stackoverflow.com/questions/6401374/rails-validation-method-comparing-two-fields" target="_blank">ce thread</a> sur Stack overflow 😉)</li>
</ul>

<p>Pour connaître la durée d'une réservation, ce sera une méthode d'instance qui fait la différence entre la <code>end_date</code> et la <code>start_date</code>. Je te conseille de t'aider de <a href="https://railsware.com/blog/2014/04/01/time-comparison-in-ruby/" target="_blank">cet article sur Stack Overflow</a></p>

<p>Une réservation est associée à un guest (qui est un utilisateur) et un listing.</p>

<p>Enfin, il te faudra faire en sorte qu'il soit impossible de faire une
 réservation sur un événement si ce dernier est déjà pris. Pour ceci 
voici quelques astuces :</p>

<ul>
  <li>Il faut mettre en place une validation custom bien entendu.</li>
  <li>Il faudra que tu passes sur chaque réservation d'un listing et que
 tu vérifies que aucune ne tombe au moment de la réservation que tu veux
 valider.</li>
  <li>Faire <code>reservation.end_date &lt; other_reservation.start_date &amp;&amp; blabla</code> n'est pas ultra lisible. Rails aime bien les méthodes DRY comme cette méthode d'instance pour le model <code>Listing</code> :</li>
  <pre class=" language-ruby"><code class=" language-ruby"><span class="token keyword">def</span> overlaping_reservation<span class="token operator">?</span><span class="token punctuation">(</span>datetime<span class="token punctuation">)</span>
  <span class="token comment"># vérifie dans toutes les réservations du listing s'il y a une réservation qui tombe sur le datetime en entrée
</span><span class="token keyword">end</span></code></pre>
</ul>

<h3>2.4. À vos claviers !</h3>
<p>Tu vas pouvoir te lancer dans la création des models et la rédaction 
des migrations. Voici quelques conseils pour que tu réussisses le projet
 :</p>
<ul>
  <li>Procède model par model et branche bien les associations.</li>
  <li>N'hésite pas à abuser des migrations, à <code>drop</code> ta base de données si tu foires tout, à faire des rollbacks. Bref joue avec tout cela</li>
  <li>Vérifie tout en console avant de considérer qu'un model et ses associations sont ok.</li>
  <li>La méthode de validation <code>overlaping_reservation?</code> est de loin la partie la plus complexe. Garde la pour la fin.</li>
</ul>

<div class="card box-shadow-0 border-success">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">📚 INSTANT CULTURE GÉ</h4>
      <p class="card-text">Apprendre à bien maîtriser la création de 
model sur Rails c'est la base d'un bon back-end. Et comme on ne veut pas
 t'assommer d'informations, <b>on a sciemment fait l'impasse sur un gros morceaux : l'écriture de tests pour tes models</b>. Comme c'est une part importante de la vie d'un développeur professionnel, on va t'en parler rapidement.</p>
      <p>C'est dans le backend qu'on peut voir la puissance et la pertinence des tests. Par exemple la méthode <code>overlaping_reservation?</code> va être très souvent utilisée, et tu ne <u>dois pas</u>
 te tromper en la codant. Si, par un bug quelconque, un utilisateur 
réussi à créer une réservation en même temps qu'une autre sur le même 
logement, crois-moi que tu aurais eu bien l'air d'un con en appelant ton
 client pour lui dire qu'en fait ses vacances de rêve en Bretagne 
tombent à l'eau car "il y a eu un bug et le logement est déjà loué à 
cette date" 😅.</p>
      <p>Voici tout l'intérêt qu'auraient des tests en Rails : on pourrait vérifier à chaque mise à jour du code que la méthode <code>overlaping_reservation?</code>
 n'est pas cassée. Et bien évidemment, ça ne sera pas la seule méthode 
dans ce cas : dans l'idéal, il faudra, à chaque méthodes de model, des 
tests pour éviter les mauvaises surprises.</p>
      <p>Au final, un backend ET robuste ET testé c'est l'assurance-vie 
d'une application web et un vrai investissement pour éviter tout tracas.
 Par exemple si un petit développeur stagiaire venait à changer la 
petite méthode <code>overlaping_reservation?</code> de rien du tout et qu'elle ne fonctionne plus (Bouh le stagiaire 👺!).</p>
    </div>
  </div>
</div>

<p>Pense bien sûr à faire un petit seed qui va :</p>

<ul>
  <li>Détruire ta base actuelle</li>
  <li>Créer 20 utilisateurs</li>
  <li>Créer 10 villes</li>
  <li>Créer 50 listings</li>
  <li>Pour chaque listing   
  <ul>
    <li>Créer 5 réservations dans le passé</li>
    <li>Créer 5 réservations dans le futur</li>
  </ul></li>
</ul>

<p>Puisque c'est toi, permets-moi de te proposer un repo qui contient les bases de l'application (oh yeah !). <a href="https://github.com/felhix/airbnb-raw-project" target="_blank">Voici le dossier</a></p>

<h3>2.5. Et après ?</h3>
<p>Maintenant que tu as fait une base de données solide, il te sera très
 simple d'ajouter les views et les controllers qui feront tourner le 
tout. On appellera les bonnes méthodes dans des controllers, elles 
redirigeront vers les bonnes vues et les clients seront séduits !</p>

<p>La semaine prochaine, nous verrons comment faire ce branchement pour 
que tu puisses afficher en HTML le contenu de ta BDD, par exemple :</p>

<ul>
  <li>La page d'accueil affichera l'index de toutes les villes disponibles (<code>City.all</code>)</li>
  <li>Tu pourras cliquer sur la page d'une ville pour voir les logements dans la ville (<code>selected_city.listings</code>)</li>
  <li>Sur la page d'un logement, tu verras les détails du logement (<code>selected_listing.description</code>).</li>
  <li>Tu pourras payer et créer des réservations (<code>Reservation.create</code>)</li>
  <li>Une fois la réservation faite, l'utilisateur sera redirigé vers la
 page de la réservation, dans laquelle il verra le fameux mot de 
bienvenue</li>
  <li>etc.</li>
</ul>

<p>Puis, lors de la 3ème semaine de Rails, nous verrons des 
fonctionnalités avancées comme le paiement, ou l'ajout de photos des 
logements, etc.</p>


<h2>3. Rendu attendu</h2>
<p>Un dossier qui répond au cahier des charges cité ci-haut.</p>

</div>
</div>
</div>
</div>
</div>
</div>

</div>

      </div>
    </div>
<script type="text/javascript" id="hs-script-loader" src="s5j5_fichiers/9310539.js"></script><script type="text/javascript" id="">(function(e,c){if(!c.__SV){var l,h;window.mixpanel=c;c._i=[];c.init=function(q,r,f){function t(d,a){var g=a.split(".");2==g.length&&(d=d[g[0]],a=g[1]);d[a]=function(){d.push([a].concat(Array.prototype.slice.call(arguments,0)))}}var b=c;"undefined"!==typeof f?b=c[f]=[]:f="mixpanel";b.people=b.people||[];b.toString=function(d){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);d||(a+=" (stub)");return a};b.people.toString=function(){return b.toString(1)+".people (stub)"};l="disable time_event track track_pageview track_links track_forms track_with_groups add_group set_group remove_group register register_once alias unregister identify name_tag set_config reset opt_in_tracking opt_out_tracking has_opted_in_tracking has_opted_out_tracking clear_opt_in_out_tracking start_batch_senders people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user people.remove".split(" ");
for(h=0;h<l.length;h++)t(b,l[h]);var n="set set_once union unset remove delete".split(" ");b.get_group=function(){function d(p){a[p]=function(){call2_args=arguments;call2=[p].concat(Array.prototype.slice.call(call2_args,0));b.push([g,call2])}}for(var a={},g=["get_group"].concat(Array.prototype.slice.call(arguments,0)),m=0;m<n.length;m++)d(n[m]);return a};c._i.push([q,r,f])};c.__SV=1.2;var k=e.createElement("script");k.type="text/javascript";k.async=!0;k.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?
MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";e=e.getElementsByTagName("script")[0];e.parentNode.insertBefore(k,e)}})(document,window.mixpanel||[]);mixpanel.init("ab79c62023f2a925bfe5f7922c70de67");mixpanel.track("Sign up");</script>
<script type="text/javascript" id="">!function(){var a=window.analytics=window.analytics||[];if(!a.initialize)if(a.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{a.invoked=!0;a.methods="trackSubmit trackClick trackLink trackForm pageview identify reset group track ready alias debug page once off on addSourceMiddleware addIntegrationMiddleware setAnonymousId addDestinationMiddleware".split(" ");a.factory=function(b){return function(){var c=Array.prototype.slice.call(arguments);c.unshift(b);
a.push(c);return a}};for(var e=0;e<a.methods.length;e++){var f=a.methods[e];a[f]=a.factory(f)}a.load=function(b,c){var d=document.createElement("script");d.type="text/javascript";d.async=!0;d.src="https://cdn.segment.com/analytics.js/v1/"+b+"/analytics.min.js";b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(d,b);a._loadOptions=c};a._writeKey="HDfubo7D6T7lk8XiL2HZi2hZvIVFuK8j";a.SNIPPET_VERSION="4.13.2";a.load("HDfubo7D6T7lk8XiL2HZi2hZvIVFuK8j");a.page()}}();</script>



    <div class="thp-flashes"></div>



    <script src="s5j5_fichiers/dashboard-6681459c92372465340c.js"></script>
    <script charset="utf-8">
      $('input[name=authenticity_token]').val($('meta[name=csrf-token]').attr('content'));
    </script>

  

<iframe style="display: none; visibility: hidden;" owner="archetype" title="archetype"></iframe></body></html>