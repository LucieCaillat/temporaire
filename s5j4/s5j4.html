<!DOCTYPE html>
<html class="loaded" lang="fr"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<script type="text/javascript" async="" src="s5j4_fichiers/insight.js"></script><script type="text/javascript" src="s5j4_fichiers/NRJS-71f55aa980e498e276b"></script><script type="text/javascript" async="" src="s5j4_fichiers/gtm_002.js"></script><script src="s5j4_fichiers/nr-1212.js"></script><script type="text/javascript" src="s5j4_fichiers/commons.js" async="" status="loaded"></script><script type="text/javascript" src="s5j4_fichiers/google-tag-manager.js" async="" status="loaded"></script><script type="text/javascript" async="" src="s5j4_fichiers/analytics.js"></script><script type="text/javascript" async="" src="s5j4_fichiers/mixpanel-2-latest.js"></script><script type="text/javascript" async="" src="s5j4_fichiers/conversion_async.js"></script><script src="s5j4_fichiers/collectedforms.js" type="text/javascript" id="CollectedForms-9310539" crossorigin="anonymous" data-leadin-portal-id="9310539" data-leadin-env="prod" data-loader="hs-scriptloader" data-hsjs-portal="9310539" data-hsjs-env="prod" data-hsjs-hublet="na1"></script><script src="s5j4_fichiers/conversations-embed.js" type="text/javascript" id="hubspot-messages-loader" data-loader="hs-scriptloader" data-hsjs-portal="9310539" data-hsjs-env="prod" data-hsjs-hublet="na1"></script><script src="s5j4_fichiers/9310539_002.js" type="text/javascript" id="cookieBanner-9310539" data-cookieconsent="ignore" data-hs-ignore="true" data-loader="hs-scriptloader" data-hsjs-portal="9310539" data-hsjs-env="prod" data-hsjs-hublet="na1"></script><script src="s5j4_fichiers/fb.js" type="text/javascript" id="hs-ads-pixel-9310539" data-ads-portal-id="9310539" data-ads-env="prod" data-loader="hs-scriptloader" data-hsjs-portal="9310539" data-hsjs-env="prod" data-hsjs-hublet="na1"></script><script src="s5j4_fichiers/leadflows.js" type="text/javascript" id="LeadFlows-9310539" crossorigin="anonymous" data-leadin-portal-id="9310539" data-leadin-env="prod" data-loader="hs-scriptloader" data-hsjs-portal="9310539" data-hsjs-env="prod" data-hsjs-hublet="na1"></script><script src="s5j4_fichiers/9310539_003.js" type="text/javascript" id="hs-analytics"></script><script async="" crossorigin="anonymous" src="s5j4_fichiers/fs.js"></script><script src="s5j4_fichiers/773401719499556.js" async=""></script><script async="" src="s5j4_fichiers/fbevents.js"></script><script async="" src="s5j4_fichiers/gtm.js"></script><script type="text/javascript" async="" src="s5j4_fichiers/analytics_002.js"></script><script>window.NREUM||(NREUM={});NREUM.info={"beacon":"bam.nr-data.net","errorBeacon":"bam.nr-data.net","licenseKey":"NRJS-71f55aa980e498e276b","applicationID":"576835834","transactionName":"dgpYEBRYDg9XQh8AA0YNVAsHRQZMVlFJF01GDVkT","queueTime":3,"applicationTime":450,"agent":""}</script>
<script>(window.NREUM||(NREUM={})).init={ajax:{deny_list:["bam.nr-data.net"]}};(window.NREUM||(NREUM={})).loader_config={licenseKey:"NRJS-71f55aa980e498e276b",applicationID:"576835834"};window.NREUM||(NREUM={}),__nr_require=function(t,e,n){function r(n){if(!e[n]){var i=e[n]={exports:{}};t[n][0].call(i.exports,function(e){var i=t[n][1][e];return r(i||e)},i,i.exports)}return e[n].exports}if("function"==typeof __nr_require)return __nr_require;for(var i=0;i<n.length;i++)r(n[i]);return r}({1:[function(t,e,n){function r(){}function i(t,e,n,r){return function(){return s.recordSupportability("API/"+e+"/called"),o(t+e,[u.now()].concat(c(arguments)),n?null:this,r),n?void 0:this}}var o=t("handle"),a=t(10),c=t(11),f=t("ee").get("tracer"),u=t("loader"),s=t(4),d=NREUM;"undefined"==typeof window.newrelic&&(newrelic=d);var p=["setPageViewName","setCustomAttribute","setErrorHandler","finished","addToTrace","inlineHit","addRelease"],l="api-",v=l+"ixn-";a(p,function(t,e){d[e]=i(l,e,!0,"api")}),d.addPageAction=i(l,"addPageAction",!0),d.setCurrentRouteName=i(l,"routeName",!0),e.exports=newrelic,d.interaction=function(){return(new r).get()};var m=r.prototype={createTracer:function(t,e){var n={},r=this,i="function"==typeof e;return o(v+"tracer",[u.now(),t,n],r),function(){if(f.emit((i?"":"no-")+"fn-start",[u.now(),r,i],n),i)try{return e.apply(this,arguments)}catch(t){throw f.emit("fn-err",[arguments,this,t],n),t}finally{f.emit("fn-end",[u.now()],n)}}}};a("actionText,setName,setAttribute,save,ignore,onEnd,getContext,end,get".split(","),function(t,e){m[e]=i(v,e)}),newrelic.noticeError=function(t,e){"string"==typeof t&&(t=new Error(t)),s.recordSupportability("API/noticeError/called"),o("err",[t,u.now(),!1,e])}},{}],2:[function(t,e,n){function r(t){if(NREUM.init){for(var e=NREUM.init,n=t.split("."),r=0;r<n.length-1;r++)if(e=e[n[r]],"object"!=typeof e)return;return e=e[n[n.length-1]]}}e.exports={getConfiguration:r}},{}],3:[function(t,e,n){var r=!1;try{var i=Object.defineProperty({},"passive",{get:function(){r=!0}});window.addEventListener("testPassive",null,i),window.removeEventListener("testPassive",null,i)}catch(o){}e.exports=function(t){return r?{passive:!0,capture:!!t}:!!t}},{}],4:[function(t,e,n){function r(t,e){var n=[a,t,{name:t},e];return o("storeMetric",n,null,"api"),n}function i(t,e){var n=[c,t,{name:t},e];return o("storeEventMetrics",n,null,"api"),n}var o=t("handle"),a="sm",c="cm";e.exports={constants:{SUPPORTABILITY_METRIC:a,CUSTOM_METRIC:c},recordSupportability:r,recordCustom:i}},{}],5:[function(t,e,n){function r(){return c.exists&&performance.now?Math.round(performance.now()):(o=Math.max((new Date).getTime(),o))-a}function i(){return o}var o=(new Date).getTime(),a=o,c=t(12);e.exports=r,e.exports.offset=a,e.exports.getLastTimestamp=i},{}],6:[function(t,e,n){function r(t){return!(!t||!t.protocol||"file:"===t.protocol)}e.exports=r},{}],7:[function(t,e,n){function r(t,e){var n=t.getEntries();n.forEach(function(t){"first-paint"===t.name?p("timing",["fp",Math.floor(t.startTime)]):"first-contentful-paint"===t.name&&p("timing",["fcp",Math.floor(t.startTime)])})}function i(t,e){var n=t.getEntries();if(n.length>0){var r=n[n.length-1];if(f&&f<r.startTime)return;p("lcp",[r])}}function o(t){t.getEntries().forEach(function(t){t.hadRecentInput||p("cls",[t])})}function a(t){if(t instanceof g&&!y){var e=Math.round(t.timeStamp),n={type:t.type};e<=l.now()?n.fid=l.now()-e:e>l.offset&&e<=Date.now()?(e-=l.offset,n.fid=l.now()-e):e=l.now(),y=!0,p("timing",["fi",e,n])}}function c(t){"hidden"===t&&(f=l.now(),p("pageHide",[f]))}if(!("init"in NREUM&&"page_view_timing"in NREUM.init&&"enabled"in NREUM.init.page_view_timing&&NREUM.init.page_view_timing.enabled===!1)){var f,u,s,d,p=t("handle"),l=t("loader"),v=t(9),m=t(3),g=NREUM.o.EV;if("PerformanceObserver"in window&&"function"==typeof window.PerformanceObserver){u=new PerformanceObserver(r);try{u.observe({entryTypes:["paint"]})}catch(h){}s=new PerformanceObserver(i);try{s.observe({entryTypes:["largest-contentful-paint"]})}catch(h){}d=new PerformanceObserver(o);try{d.observe({type:"layout-shift",buffered:!0})}catch(h){}}if("addEventListener"in document){var y=!1,w=["click","keydown","mousedown","pointerdown","touchstart"];w.forEach(function(t){document.addEventListener(t,a,m(!1))})}v(c)}},{}],8:[function(t,e,n){function r(t,e){if(!i)return!1;if(t!==i)return!1;if(!e)return!0;if(!o)return!1;for(var n=o.split("."),r=e.split("."),a=0;a<r.length;a++)if(r[a]!==n[a])return!1;return!0}var i=null,o=null,a=/Version\/(\S+)\s+Safari/;if(navigator.userAgent){var c=navigator.userAgent,f=c.match(a);f&&c.indexOf("Chrome")===-1&&c.indexOf("Chromium")===-1&&(i="Safari",o=f[1])}e.exports={agent:i,version:o,match:r}},{}],9:[function(t,e,n){function r(t){function e(){t(c&&document[c]?document[c]:document[o]?"hidden":"visible")}"addEventListener"in document&&a&&document.addEventListener(a,e,i(!1))}var i=t(3);e.exports=r;var o,a,c;"undefined"!=typeof document.hidden?(o="hidden",a="visibilitychange",c="visibilityState"):"undefined"!=typeof document.msHidden?(o="msHidden",a="msvisibilitychange"):"undefined"!=typeof document.webkitHidden&&(o="webkitHidden",a="webkitvisibilitychange",c="webkitVisibilityState")},{}],10:[function(t,e,n){function r(t,e){var n=[],r="",o=0;for(r in t)i.call(t,r)&&(n[o]=e(r,t[r]),o+=1);return n}var i=Object.prototype.hasOwnProperty;e.exports=r},{}],11:[function(t,e,n){function r(t,e,n){e||(e=0),"undefined"==typeof n&&(n=t?t.length:0);for(var r=-1,i=n-e||0,o=Array(i<0?0:i);++r<i;)o[r]=t[e+r];return o}e.exports=r},{}],12:[function(t,e,n){e.exports={exists:"undefined"!=typeof window.performance&&window.performance.timing&&"undefined"!=typeof window.performance.timing.navigationStart}},{}],ee:[function(t,e,n){function r(){}function i(t){function e(t){return t&&t instanceof r?t:t?u(t,f,a):a()}function n(n,r,i,o,a){if(a!==!1&&(a=!0),!l.aborted||o){t&&a&&t(n,r,i);for(var c=e(i),f=m(n),u=f.length,s=0;s<u;s++)f[s].apply(c,r);var p=d[w[n]];return p&&p.push([b,n,r,c]),c}}function o(t,e){y[t]=m(t).concat(e)}function v(t,e){var n=y[t];if(n)for(var r=0;r<n.length;r++)n[r]===e&&n.splice(r,1)}function m(t){return y[t]||[]}function g(t){return p[t]=p[t]||i(n)}function h(t,e){l.aborted||s(t,function(t,n){e=e||"feature",w[n]=e,e in d||(d[e]=[])})}var y={},w={},b={on:o,addEventListener:o,removeEventListener:v,emit:n,get:g,listeners:m,context:e,buffer:h,abort:c,aborted:!1};return b}function o(t){return u(t,f,a)}function a(){return new r}function c(){(d.api||d.feature)&&(l.aborted=!0,d=l.backlog={})}var f="nr@context",u=t("gos"),s=t(10),d={},p={},l=e.exports=i();e.exports.getOrSetContext=o,l.backlog=d},{}],gos:[function(t,e,n){function r(t,e,n){if(i.call(t,e))return t[e];var r=n();if(Object.defineProperty&&Object.keys)try{return Object.defineProperty(t,e,{value:r,writable:!0,enumerable:!1}),r}catch(o){}return t[e]=r,r}var i=Object.prototype.hasOwnProperty;e.exports=r},{}],handle:[function(t,e,n){function r(t,e,n,r){i.buffer([t],r),i.emit(t,e,n)}var i=t("ee").get("handle");e.exports=r,r.ee=i},{}],id:[function(t,e,n){function r(t){var e=typeof t;return!t||"object"!==e&&"function"!==e?-1:t===window?0:a(t,o,function(){return i++})}var i=1,o="nr@id",a=t("gos");e.exports=r},{}],loader:[function(t,e,n){function r(){if(!T++){var t=P.info=NREUM.info,e=g.getElementsByTagName("script")[0];if(setTimeout(u.abort,3e4),!(t&&t.licenseKey&&t.applicationID&&e))return u.abort();f(O,function(e,n){t[e]||(t[e]=n)});var n=a();c("mark",["onload",n+P.offset],null,"api"),c("timing",["load",n]);var r=g.createElement("script");0===t.agent.indexOf("http://")||0===t.agent.indexOf("https://")?r.src=t.agent:r.src=v+"://"+t.agent,e.parentNode.insertBefore(r,e)}}function i(){"complete"===g.readyState&&o()}function o(){c("mark",["domContent",a()+P.offset],null,"api")}var a=t(5),c=t("handle"),f=t(10),u=t("ee"),s=t(8),d=t(6),p=t(2),l=t(3),v=p.getConfiguration("ssl")===!1?"http":"https",m=window,g=m.document,h="addEventListener",y="attachEvent",w=m.XMLHttpRequest,b=w&&w.prototype,E=!d(m.location);NREUM.o={ST:setTimeout,SI:m.setImmediate,CT:clearTimeout,XHR:w,REQ:m.Request,EV:m.Event,PR:m.Promise,MO:m.MutationObserver};var x=""+location,O={beacon:"bam.nr-data.net",errorBeacon:"bam.nr-data.net",agent:"js-agent.newrelic.com/nr-1212.min.js"},M=w&&b&&b[h]&&!/CriOS/.test(navigator.userAgent),P=e.exports={offset:a.getLastTimestamp(),now:a,origin:x,features:{},xhrWrappable:M,userAgent:s,disabled:E};if(!E){t(1),t(7),g[h]?(g[h]("DOMContentLoaded",o,l(!1)),m[h]("load",r,l(!1))):(g[y]("onreadystatechange",i),m[y]("onload",r)),c("mark",["firstbyte",a.getLastTimestamp()],null,"api");var T=0}},{}],"wrap-function":[function(t,e,n){function r(t,e){function n(e,n,r,f,u){function nrWrapper(){var o,a,s,p;try{a=this,o=d(arguments),s="function"==typeof r?r(o,a):r||{}}catch(l){i([l,"",[o,a,f],s],t)}c(n+"start",[o,a,f],s,u);try{return p=e.apply(a,o)}catch(v){throw c(n+"err",[o,a,v],s,u),v}finally{c(n+"end",[o,a,p],s,u)}}return a(e)?e:(n||(n=""),nrWrapper[p]=e,o(e,nrWrapper,t),nrWrapper)}function r(t,e,r,i,o){r||(r="");var c,f,u,s="-"===r.charAt(0);for(u=0;u<e.length;u++)f=e[u],c=t[f],a(c)||(t[f]=n(c,s?f+r:r,i,f,o))}function c(n,r,o,a){if(!v||e){var c=v;v=!0;try{t.emit(n,r,o,e,a)}catch(f){i([f,n,r,o],t)}v=c}}return t||(t=s),n.inPlace=r,n.flag=p,n}function i(t,e){e||(e=s);try{e.emit("internal-error",t)}catch(n){}}function o(t,e,n){if(Object.defineProperty&&Object.keys)try{var r=Object.keys(t);return r.forEach(function(n){Object.defineProperty(e,n,{get:function(){return t[n]},set:function(e){return t[n]=e,e}})}),e}catch(o){i([o],n)}for(var a in t)l.call(t,a)&&(e[a]=t[a]);return e}function a(t){return!(t&&t instanceof Function&&t.apply&&!t[p])}function c(t,e){var n=e(t);return n[p]=t,o(t,n,s),n}function f(t,e,n){var r=t[e];t[e]=c(r,n)}function u(){for(var t=arguments.length,e=new Array(t),n=0;n<t;++n)e[n]=arguments[n];return e}var s=t("ee"),d=t(11),p="nr@original",l=Object.prototype.hasOwnProperty,v=!1;e.exports=r,e.exports.wrapFunction=c,e.exports.wrapInPlace=f,e.exports.argsToArray=u},{}]},{},["loader"]);</script>
    <meta name="viewport" content="width=device-width, user-scalable=no">

    <meta name="csrf-param" content="authenticity_token">
<meta name="csrf-token" content="c/AEpIGd5wKtAekePRAzc4oIujn1iZFq3/RQVjfVDQoAYCqALn2wM2VQn8/9AYrvLlZJD9sodC3GUxdifoOplg==">
    <title>Le tableau de bord | The Hacking Project</title>
<meta name="description" content="Nous cassons les codes de l'√©ducation, vous apprenez d'o√π vous voulez, en communaut√©.">
<meta name="robots" content="noindex, nofollow">
<meta property="og:title" content="Le tableau de bord">
<meta property="og:site_name" content="The Hacking Project">
<meta name="url" content="https://www.thehackingproject.org/fr/dashboard/courses/1/weeks/2/days/4">
<meta name="image" content="https://www.thehackingproject.org/packs/images/logo/20210910-THP-Logo_color_transparent-31229dd881904e010092de63be97cdfa.png">


    <link rel="apple-touch-icon" sizes="180x180" href="https://www.thehackingproject.org/assets/favicon/apple-touch-icon-c01aaccf467f7cc3d79bbce743d60779f5b833fdc4500cebd07a5e11a07a5c31.png">
<link rel="apple-touch-icon" sizes="120x120" href="https://www.thehackingproject.org/assets/favicon/apple-touch-icon-120x120-precomposed-372de868f08319961b72ba7e3b1ed7121e75e29c8294334cb2c911409ea18131.png">
<link rel="apple-touch-icon" sizes="120x120" href="https://www.thehackingproject.org/assets/favicon/apple-touch-icon-120x120-372de868f08319961b72ba7e3b1ed7121e75e29c8294334cb2c911409ea18131.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://www.thehackingproject.org/assets/favicon/favicon-32x32-804b12d1c41c60fe721477b7c3b0a32811dc610580dd40ac92f1cc04cbd05ca4.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://www.thehackingproject.org/assets/favicon/favicon-16x16-d96ba65e5785d32474df9ebc6fbfd5442c751d527b10981a474bc3b7a4079d01.png">
<link rel="manifest" href="https://www.thehackingproject.org/assets/favicon/manifest-cf975201fd8ac78a1f1a203357573d50031f1cc33436d099743df6428b8a38a2.json">
<link rel="mask-icon" href="https://www.thehackingproject.org/assets/favicon/safari-pinned-tab-8af1cfcf7525ccdccb490f9f5adad396653a4969b419e0a9a9d3a1088140a912.svg" color="#5bbad5">
<link rel="shortcut icon" href="https://www.thehackingproject.org/assets/favicon/favicon-cbf10361dc90b277565960736d4897fddef5468bff6299811ea9498459d56d21.ico">
<meta name="msapplication-config" content="/assets/favicon/browserconfig-dab38db6040ef54ac56e91fdd77e3d7b06746a634e87b68c99b59b216cb8611a.xml">
<meta name="theme-color" content="#ffffff">

    <link rel="stylesheet" media="screen" href="s5j4_fichiers/vendor-dab9e12f0ba58215899de05f149caa5f.css">
    <link rel="stylesheet" media="screen" href="s5j4_fichiers/dashboard-4ab6ba9737cbfc4c38b17a9a4de7833a.css">
    <link rel="stylesheet" media="screen" href="s5j4_fichiers/dashboard-ea5a94b9045ccb8d8ce8974b71b640603915dc183d5907c643.css">
    <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async="" src="s5j4_fichiers/js.js"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-105991867-1');
  </script>
<!-- End Google Analytics -->

<!-- Google Tag Manager -->
<script>
  (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer',"GTM-P8XRQ3M");
</script>
<!-- End Google Tag Manager -->

<!-- Facebook Pixel Code -->
    <script>
        !function(f,b,e,v,n,t,s)
        {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
        n.callMethod.apply(n,arguments):n.queue.push(arguments)};
        if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
        n.queue=[];t=b.createElement(e);t.async=!0;
        t.src=v;s=b.getElementsByTagName(e)[0];
        s.parentNode.insertBefore(t,s)}(window,document,'script',
        'https://connect.facebook.net/en_US/fbevents.js');
         fbq('init', '773401719499556');
        fbq('track', 'PageView');
    </script>
    <noscript>
     <img height="1" width="1"
    src="https://www.facebook.com/tr?id=773401719499556&ev=PageView
    &noscript=1"/>
    </noscript>
<!-- End Facebook Pixel Code -->

<script>
window['_fs_debug'] = false;
window['_fs_host'] = 'fullstory.com';
window['_fs_script'] = 'edge.fullstory.com/s/fs.js';
window['_fs_org'] = '14AEET';
window['_fs_namespace'] = 'FS';
(function(m,n,e,t,l,o,g,y){
    if (e in m) {if(m.console && m.console.log) { m.console.log('FullStory namespace conflict. Please set window["_fs_namespace"].');} return;}
    g=m[e]=function(a,b,s){g.q?g.q.push([a,b,s]):g._api(a,b,s);};g.q=[];
    o=n.createElement(t);o.async=1;o.crossOrigin='anonymous';o.src='https://'+_fs_script;
    y=n.getElementsByTagName(t)[0];y.parentNode.insertBefore(o,y);
    g.identify=function(i,v,s){g(l,{uid:i},s);if(v)g(l,v,s)};g.setUserVars=function(v,s){g(l,v,s)};g.event=function(i,v,s){g('event',{n:i,p:v},s)};
    g.anonymize=function(){g.identify(!!0)};
    g.shutdown=function(){g("rec",!1)};g.restart=function(){g("rec",!0)};
    g.log = function(a,b){g("log",[a,b])};
    g.consent=function(a){g("consent",!arguments.length||a)};
    g.identifyAccount=function(i,v){o='account';v=v||{};v.acctId=i;g(o,v)};
    g.clearUserCookie=function(){};
    g.setVars=function(n, p){g('setVars',[n,p]);};
    g._w={};y='XMLHttpRequest';g._w[y]=m[y];y='fetch';g._w[y]=m[y];
    if(m[y])m[y]=function(){return g._w[y].apply(this,arguments)};
    g._v="1.3.0";
})(window,document,window['_fs_namespace'],'script','user');
</script>
<!-- Start of HubSpot Embed Code -->
<script async="" defer="defer" id="hs-script-loader" src="s5j4_fichiers/9310539.js" type="text/javascript"></script>
<!-- End of HubSpot Embed Code -->


    <script src="s5j4_fichiers/thp-3cc5aa6fdf57842a7b6c714621cc7f2d3d31b51cb700b1de4e795d773.js"></script>
    <script src="s5j4_fichiers/manifest-1613feea780cfc5342f4.js"></script>
    <script src="s5j4_fichiers/vendor-ff3cb5540e737de52c97.js"></script>
    <script src="s5j4_fichiers/dashboard-25875e14460b4458b1bccffaa93d4a8cbee9691b06d54976fde.js"></script>

    <link href="s5j4_fichiers/css.css" rel="stylesheet">
  <script src="s5j4_fichiers/a"></script></head>

  <body class="vertical-layout 2-columns fixed-navbar menu-hide vertical-overlay-menu" data-open="click" data-menu="vertical-menu" data-color="bg-gradient-x-primary-blue" data-col="2-columns" data-thp-controller="days" data-thp-action="show" data-thp-layout="dashboard"><style type="text/css">html.hs-messages-widget-open.hs-messages-mobile,html.hs-messages-widget-open.hs-messages-mobile body{overflow:hidden!important;position:relative!important}html.hs-messages-widget-open.hs-messages-mobile body{height:100%!important;margin:0!important}#hubspot-messages-iframe-container{display:initial!important;z-index:2147483647;position:fixed!important;bottom:0!important}#hubspot-messages-iframe-container.widget-align-left{left:0!important}#hubspot-messages-iframe-container.widget-align-right{right:0!important}#hubspot-messages-iframe-container.internal{z-index:1016}#hubspot-messages-iframe-container.internal iframe{min-width:108px}#hubspot-messages-iframe-container .shadow-container{display:initial!important;z-index:-1;position:absolute;width:0;height:0;bottom:0;content:""}#hubspot-messages-iframe-container .shadow-container.internal{display:none!important}#hubspot-messages-iframe-container .shadow-container.active{width:400px;height:400px}#hubspot-messages-iframe-container iframe{display:initial!important;width:100%!important;height:100%!important;border:none!important;position:absolute!important;bottom:0!important;right:0!important;background:transparent!important}</style>
    <!-- Google Tag Manager (noscript) -->
<noscript>
<iframe height='0' src='https://www.googletagmanager.com/ns.html?id=GTM-P8XRQ3M' style='display:none;visibility:hidden' width='0'></iframe>
</noscript>
<!-- End Google Tag Manager (noscript) -->



    <nav class="header-navbar navbar-expand-md navbar navbar-with-menu navbar-without-dd-arrow fixed-top navbar-semi-light" style="padding:0;">
<div class="navbar-wrapper">
<div class="navbar-container content">
<div class="collapse navbar-collapse show" id="navbar-mobile">
<ul class="nav navbar-nav mr-auto float-left">
<li class="nav-item mobile-menu d-md-none mr-auto">
<a class="nav-link nav-menu-main menu-toggle hidden-xs" href="#">
<i class="ft-menu font-large-1"></i>
</a>
</li>
<li class="nav-item d-none d-md-block">
<a class="nav-link nav-menu-main menu-toggle hidden-xs" href="#">
<i class="ft-menu"></i>
</a>
</li>
</ul>
<ul class="nav navbar-nav float-right">
<li class="dropdown dropdown-user nav-item">
<a class="dropdown-toggle nav-link dropdown-user-link" data-toggle="dropdown" href="#">
<span class="avatar avatar-online">

<img alt="avatar" style="max-height: 40px!important; width: auto" class="rounded-circle img-border" src="s5j4_fichiers/default_profile-a3318a5e66467f9958f16a172f9d15d6.jpg">

</span>
</a>
<div class="dropdown-menu dropdown-menu-right">
<div class="arrow_box_right">
<a class="dropdown-toggle nav-link dropdown-user-link" href="https://www.thehackingproject.org/fr/dashboard/profile/user"><span class="avatar avatar-online pt-0">

<img alt="avatar" style="max-height: 40px!important; width: auto" class="rounded-circle img-border" src="s5j4_fichiers/default_profile-a3318a5e66467f9958f16a172f9d15d6.jpg">

</span>
<span class="user-name text-bold-700 ml-1 text-dark">
Lucie
</span>
</a><div class="dropdown-divider"></div>
<a class="dropdown-item" href="https://www.thehackingproject.org/fr/dashboard/profile/user/edit"><i class="ft-edit"></i>√âditer profil
</a><div class="dropdown-divider"></div>
<a class="dropdown-item" href="https://www.thehackingproject.org/fr/dashboard/profile/user/edit?edit=danger"><i class="ft-alert-triangle"></i>Zone √† risques
</a><div class="dropdown-divider"></div>
<a class="dropdown-item" rel="nofollow" data-method="delete" href="https://www.thehackingproject.org/users/sign_out?locale=fr"><i class="ft-power"></i>
D√©connexion
</a></div>
</div>
</li>
</ul>
</div>
</div>
</div>
</nav>

      <div class="main-menu menu-fixed menu-light menu-accordion menu-shadow" data-scroll-to-active="true">
<div class="navbar-header">
<ul class="nav navbar-nav flex-row">
<li class="nav-item mr-auto">
<a class="navbar-brand" href="https://www.thehackingproject.org/?locale=fr"><h3 class="brand-text">The Hacking Project</h3>
</a></li>
<li class="nav-item d-md-none">
<a class="nav-link close-navbar">
<i class="ft-x"></i>
</a>
</li>
</ul>
</div>
<div class="main-menu-content">
<ul class="navigation navigation-main" data-menu="menu-navigation" id="main-menu-navigation">
<li class="nav-item">
<a href="https://www.thehackingproject.org/fr/dashboard"><i class="ft-calendar"></i>
<span class="menu-title" data-i18n="">
Aujourd'hui
</span>
</a></li>
<li class="nav-item">
<a href="https://www.thehackingproject.org/fr/dashboard/dashboard"><i class="ft-monitor"></i>
<span class="menu-title" data-i18n="">
Mon dashboard
</span>
</a></li>
<li class="nav-item has-sub">
<a href="#"><i class="fas fa-user-graduate"></i>
<span class="menu-title" data-i18n="">
Mon inscription
</span>
</a><ul class="menu-content">
<li>
<a href="https://www.thehackingproject.org/parcours?locale=fr">Choisir un parcours</a>
</li>
<li>
<a href="https://www.thehackingproject.org/fr/dashboard/profile/curriculum_subscriptions/new">Nouveau parcours</a>
</li>
<li>
<a href="https://www.thehackingproject.org/fr/dashboard/profile/curriculum_subscriptions/7209/edit">Changer parcours</a>
</li>
<li>
<a href="https://www.thehackingproject.org/fr/dashboard/modalites">Modalit√©s</a>
</li>
</ul>
</li>
<li class="nav-item">
<a href="https://www.thehackingproject.org/fr/dashboard/certifications"><i class="fa ft-download"></i>
<span class="menu-title" data-i18n="">
Documents
</span>
</a></li>
<br>
<li>
<a href="https://www.thehackingproject.org/fr/dashboard/help"><i class="fa ft-help-circle"></i>
<span class="menu-title" data-i18n="">
Aide
</span>
</a></li>
</ul>
</div>
</div>



    <div class="app-content content">
      <div class="content-wrapper">
        <div class="content-wrapper-before"></div>
        <div class="content-header row"></div>
        <div class="container">
<div class="row">
<div class="col-12">
<ol class="breadcrumb">
<li class="breadcrumb-item">
<a href="https://www.thehackingproject.org/fr/dashboard/dashboard">Dashboard</a>
</li>
<li class="breadcrumb-item">
<a href="https://www.thehackingproject.org/fr/dashboard/courses/1">Fullstack web</a>
</li>
<li class="breadcrumb-item">
<a href="https://www.thehackingproject.org/fr/dashboard/courses/1/weeks/2">Initiation √† Rails</a>
</li>
<li class="breadcrumb-item active">
Relations entre BDD
</li>
</ol>
</div>
</div>
<!-- / PARTIAL FOR FREE MOUSSES -->
<!-- / PARTIAL FOR NEXT -->
<div class="row">
<div class="col-12">
<div class="card">
<div class="card-body">
<div class="row">
<div class="col-12 col-xl-12 text-center mb-3">
<h2 class="mb-2">
Initiation √† Rails
</h2>
<h3>
<i class="ft-check-square success" data-placement="top" data-toggle="tooltip" title="" data-original-title="Projet bien re√ßu !"></i>
Relations entre BDD
</h3>
<h4>
<i class="fa fa-rocket text-danger" data-placement="bottom" data-toggle="tooltip" title="" data-original-title="Projet √† rendre ce jour-l√†"></i>

</h4>
<h5>
Comment faire en sorte qu'un docteur puisse avoir plusieurs patients et 
que les patients puissent avoir plusieurs docteurs ? Gr√¢ce aux relations
 entre bases de donn√©es, bien entendu !
</h5>
</div>
<div class="col-12 col-xl-12 timeline-left" id="activity">
<div class="timeline pt-2">
<ul class="list-unstyled base-timeline activity-timeline">
<li>
<a href="https://www.thehackingproject.org/fr/dashboard/courses/1/weeks/2/days/1"><div class="timeline-icon bg-dark">
<i class="ft-check font-medium-1"></i>
</div>
</a><div class="act-time">
<a href="https://www.thehackingproject.org/fr/dashboard/courses/1/weeks/2/days/1">Lundi
</a></div>
<div class="base-timeline-info">
<div class="text-dark">
<i class="fa fa-rocket text-danger" data-placement="bottom" data-toggle="tooltip" title="" data-original-title="Projet √† rendre ce jour-l√†"></i>

Franck Sinatra
</div>
</div>
<small class="text-muted">
Nous allons voir un framework minimaliste de Ruby pour faire du web : 
Sinatra. Sinatra est bien plus bas-niveau que Rails, et voir ce 
framework en premier te donnera les bases pour comprendre le web.
Dans l'apr√®s midi, les ateliers t'apprendront √† faire des trucs bien 
coolos.
</small>
</li>
<li>
<a href="https://www.thehackingproject.org/fr/dashboard/courses/1/weeks/2/days/2"><div class="timeline-icon bg-dark">
<i class="ft-check font-medium-1"></i>
</div>
</a><div class="act-time">
<a href="https://www.thehackingproject.org/fr/dashboard/courses/1/weeks/2/days/2">Mardi
</a></div>
<div class="base-timeline-info">
<div class="text-dark">
<i class="fa fa-pencil text-success" data-placement="bottom" data-toggle="tooltip" title="" data-original-title="Corrections cette journ√©e l√†"></i>

D√©couverte de SQL
</div>
</div>
<small class="text-muted">
Pour ce premier jour, tu verras l'univers des bases de donn√©es, comment 
cr√©er ta premi√®re base de donn√©es, comment la concevoir, puis comment 
int√©ragir avec une base de donn√©es.
</small>
</li>
<li>
<a href="https://www.thehackingproject.org/fr/dashboard/courses/1/weeks/2/days/3"><div class="timeline-icon bg-dark">
<i class="ft-check font-medium-1"></i>
</div>
</a><div class="act-time">
<a href="https://www.thehackingproject.org/fr/dashboard/courses/1/weeks/2/days/3">Mercredi
</a></div>
<div class="base-timeline-info">
<div class="text-dark">

Passage de SQL √† ActiveRecord
</div>
</div>
<small class="text-muted">
Nous allons voir comment utiliser ActiveRecord pour se simplifier la vie
 avec les bases de donn√©es. C‚Äôest √©galement le pont entre le SQL et le 
Ruby
</small>
</li>
<li>
<div class="timeline-icon bg-primary">
<i class="ft-map-pin font-medium-1"></i>
</div>
<div class="act-time">
Jeudi
</div>
<div class="base-timeline-info">
<div class="text-dark">
<i class="fa fa-rocket text-danger" data-placement="bottom" data-toggle="tooltip" title="" data-original-title="Projet √† rendre ce jour-l√†"></i>

Relations entre BDD
</div>
</div>
<small class="text-muted">
Comment faire en sorte qu'un docteur puisse avoir plusieurs patients et 
que les patients puissent avoir plusieurs docteurs ? Gr√¢ce aux relations
 entre bases de donn√©es, bien entendu !
</small>
</li>
<li>
<a href="https://www.thehackingproject.org/fr/dashboard/courses/1/weeks/2/days/5"><div class="timeline-icon bg-dark">
<i class="ft-check font-medium-1"></i>
</div>
</a><div class="act-time">
<a href="https://www.thehackingproject.org/fr/dashboard/courses/1/weeks/2/days/5">Vendredi
</a></div>
<div class="base-timeline-info">
<div class="text-dark">
<i class="fa fa-pencil text-success" data-placement="bottom" data-toggle="tooltip" title="" data-original-title="Corrections cette journ√©e l√†"></i>

Validations &amp; Conceptions de BDD
</div>
</div>
<small class="text-muted">
Et allez encore des bases de donn√©es üòé
</small>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</div>

<!-- Les fameuses corrections qui n'arrivent que les jours concern√©s -->
<div class="row">
<div class="col-12">
<div class="card">
<div class="card-header" style="border-top: 3px solid #5E66E5">
<h1>
Ressource : 
Associations entre models de BDD
</h1>
<a class="heading-elements-toggle">
<i class="la la-ellipsis-v font-medium-3"></i>
</a>
<div class="heading-elements">
<ul class="list-inline mb-0">
<li>
<a href="https://www.thehackingproject.org/fr/dashboard/courses/1/lessons/29/lesson_submissions/new"><i class="ft-edit" data-original-title="Proposer une am√©lioration" data-placement="top" data-toggle="tooltip"></i>
</a></li>
<li>
<a data-action="collapse">
<i class="ft-minus"></i>
</a>
</li>
<li>
<a data-action="expand">
<i class="ft-maximize"></i>
</a>
</li>
</ul>
</div>
</div>
<div class="card-content collapse show">
<div class="card-body">
<div class="tab-pane active" id="home1" role="tabpanel">

<h2>1. Introduction</h2>
<p>Hier tu as vu comment utiliser ActiveRecord pour mettre en place tes 
premi√®res bases de donn√©es dans Rails. Aujourd'hui nous allons 
approfondir tes comp√©tences en construction de bases de donn√©es en 
t'apprenant √† lier diff√©rents models (et donc diff√©rentes tables) entre 
eux.</p>

<p>Si tu te rappelles bien de la journ√©e SQL, on peut lier les tables de
 BDD entre elles via des relations 1-1, 1-N ou N-N. Comme en Rails on a 
une table = un model, on va t'apprendre √† faire cela √©galement au niveau
 des models.</p>

<h2>2. Historique et contexte</h2>
<p>Pourquoi lier des models entre eux ? √Ä quoi servent ces relations ?</p>

<p>Si tu te rappelles du dernier exercice du projet d'hier, on avait une BDD avec 2 models : <code>Album</code> et <code>Track</code>. Sauf qu'entre ces deux models, il y avait de fortes redondances :</p>
<ul>
  <li>Le model <code>Track</code> contient un attribut "Album" au format string.</li>
  <li>Les deux models contiennent un attribut "Artist" au format string.</li>
</ul>

<p>Ce genre de redondance pose plusieurs probl√®mes en informatique :</p>
<ol>
  <li>Si une des chansons (de type <code>Track</code>) a une faute de 
frappe sur son attribut "Album", une requ√™te de BDD sur le crit√®re de 
recherche "le nom de l'album est XXX" retrouvera toutes les <code>Track</code>
 SAUF celle-l√†. Alors que s'il ne trouvait rien, tu aurais pu suspecter 
une erreur, l√† tu n'y verrais que du feu (et les fautes de frappe sont 
courantes...). <br>
  <b>=&gt; Cette BDD sera peu fiable.</b></li>

  <li>On stocke en doublon l'information de l'artiste : pourquoi s'emb√™ter √† pr√©ciser l'artiste sur chaque <code>Track</code> alors que si on a l'album, on le retrouve de fa√ßon √©vidente ? <br>
  <b>=&gt; Cette BDD prendra plus de place que n√©cessaire (info en double).</b></li>

  <li>Imaginons que le model <code>Album</code> stocke des informations int√©ressantes comme son prix, son ann√©e de sortie, etc. Si on a une <code>Track</code>, pour retrouver le prix de <code>Album</code> correspondant il faut 1) extraire le nom de l'album de l'objet <code>Track</code>, 2) chercher l'objet <code>Album</code> correspondant √† partir du nom, 3) extraire l'info du prix de l'album. <br>
  <b>=&gt; Cette BDD n√©cessitera beaucoup de requ√™tes pour passer d'un model √† l'autre</b>.</li>
</ol>

<p>Au final, en liant chaque <code>Track</code> √† un objet <code>Album</code>,
 on va facilement, √† partir d'une chanson, faire appel √† l'album 
correspondant et bosser dessus. Tout va plus vite, les informations ne 
sont stock√©es qu'une fois et les objets sont plus coh√©rents entre eux.</p>

<h2>3. La ressource</h2>
<p>Nous allons t'expliquer comment lier des models entre eux sous Rails.
 Pour commencer, on va aborder la relation 1-N qui est clairement la 
plus courante et une des moins compliqu√©es √† saisir. Puis nous passerons
 √† la relation N-N qui est un peu plus complexe mais relativement 
classique.</p>

<p>Et la relation 1-1 dans tout √ßa ? Nous allons faire l'impasse sur 
cette relation pour aujourd'hui car elle est relativement rare et √ßa 
fait d√©j√† pas mal de choses √† ingurgiter pour toi !</p>

<h3>3.1. La relation 1-N</h3>
<p>Prenons un exemple simple de site web avec deux models que l'on souhaite lier : celui d'un blog. D'un c√¥t√© on a des <code>Article</code> et de l'autre des <code>User</code>. Chaque <code>Article</code> a forc√©ment un <code>User</code> qui lui est li√© (c'est son auteur) et chaque <code>User</code> peut avoir plusieurs <code>Article</code> (qu'il a √©crits). On est typiquement dans le cas d'une relation 1-N : un <code>User</code> par <code>Article</code> et N <code>Article</code> par <code>User</code> !</p>

<h4>3.1.1. La relation 1-N dans les tables de la BDD</h4>
<p>La premi√®re √©tape, pour mettre en place cette relation 1-N, est de bien d√©finir nos tables.</p>
<p>On a donc une premi√®re table <code>users</code> qui ressemblerait √† quelque chose comme √ßa :</p>

<div class="table-responsive">
  <table class="table">
    <thead>
      <tr>
        <th>id</th>
        <th>first_name</th>
        <th>last_name</th>
        <th>age</th>
        <th>city</th>
      </tr>
    </thead>
    <tbody><tr>
      <th>1</th>
      <th>Martin</th>
      <th>Dupond</th>
      <th>27</th>
      <th>Paris</th>
    </tr>
    <tr>
      <th>2</th>
       <th>Jack</th>
       <th>Quilley</th>
       <th>38</th>
       <th>London</th>
     </tr>
       <tr>
        <th>3</th>
       <th>Vittorio</th>
       <th>Piccolini</th>
       <th>18</th>
       <th>Milan</th>
     </tr>
  </tbody></table>
</div>

<p>Et une seconde table <code>articles</code> qui contiendrait les informations suivantes :</p>

<div class="table-responsive">
<table class="table">
  <thead>
  <tr>
    <th>id</th>
    <th>title</th>
    <th>subject</th>
    <th>content</th>
    <th>user_id</th>
  </tr>
  </thead>
  <tbody><tr>
    <th>1</th>
    <th>The Most Important Skill <br> Nobody Taught You</th>
    <th>Personal Growth</th>
    <th>Before dying at the age of 39, Blaise <br> Pascal made huge contributions to both <br> physics and mathematics, notably in fluids (...)</th>
    <th>2</th>
  </tr>
  <tr>
    <th>2</th>
    <th>Something is wrong on <br> the internet</th>
    <th>Opinion</th>
    <th>As someone who grew up on the internet,<br> I credit it as one of the most (...)</th>
    <th>2</th>
  </tr>
  <tr>
    <th>3</th>
    <th>7 Practical Tips for <br> Cheating at Design</th>
    <th>Design MOOC</th>
    <th>Every web developer inevitably runs <br> into situations where they need to make <br> visual design decisions, whether (...)</th>
    <th>1</th>
  </tr>
</tbody></table>
</div>

<p>Le point essentiel √† noter est la <b>pr√©sence d'une colonne <code>user_id</code> au sein de la table <code>articles</code>. Elle sert √† stocker l'<code>id</code> de l'auteur de l'article : on peut alors facilement retrouver la ligne de la table <code>users</code> qui correspond √† l'auteur</b>
 : c'est une r√©f√©rence externe ou clef externe. Ainsi, l'article 1 "The 
Most Important skill (...)" a √©t√© √©crit par le user 2, Jack Quilley (38 
ans) de Londres. Il est aussi l'auteur de l'article 2 "Something is 
wrong on the internet". Etc.</p>

<p><b>En r√©sum√©</b> : dans une relation 1-N entre 2 tables, l'une des 
deux tables stocke les identifiants des entr√©es de l'autre table. On a 
bien 1 user par article et chaque user peut √™tre li√© √† plusieurs 
articles.</p>

<div class="card box-shadow-0 border-info">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">ü§ì QUESTION R√âCURRENTE</h4>
      <p class="card-text">
        <b>Mais dis donc Jamy, dans une relation 1-N, comment savoir dans quelle table je mets les identifiants de l'autre ?</b><br>
        Il suffit de r√©fl√©chir 2 secondes et te dire "OK, on ne peut 
rajouter qu'une seule colonne d'identifiants. Si je mets dans la table <code>users</code> les <code>id</code>
 de chaque article qu'il a √©crit, je vais en avoir parfois 1, parfois 5 
ou parfois 1000 (rien n'emp√™che un user d'√©crire 1000 articles). √áa 
n'est pas possible car je n'ai la place que pour 1 colonne <code>id</code>. Par contre, si je mets dans la table <code>articles</code> l'<code>id</code>
 du user correspondant √† chaque article, comme il est unique (un seul 
auteur), il n'y en aura toujours qu'un seul !" Du coup tu as ta r√©ponse :
 c'est la table <code>articles</code> qui porte l'<code>id</code> du user.
      </p>
    </div>
  </div>
</div>

<h4>3.1.2. Mettre en place les tables</h4>
<p>On a donc une table qui contient une colonne d'identifiants d'une autre table : voyons comment mettre cela en place dans Rails.</p>

<h5>a) Cas 1 : aucune des 2 tables n'existe</h5>
<p>Nous allons lier les 2 tables d√®s leur cr√©ation. On va donc devoir cr√©er 2 models pour suivre notre exemple : <code>User</code> et <code>Article</code>. Cr√©e une application Rails de test afin de faire les manipulations en m√™me temps que moi.</p>

<p>On commence par le model <code>User</code> auquel on ajoute 4 colonnes (first_name, last_name, etc.) d√®s le d√©but. Voici la commande de cr√©ation :</p>

<pre class=" language-shell"><code class=" language-shell">$ rails g model User first_name:string last_name:string age:integer city:string</code></pre>

<p>Ceci a pour effet de cr√©er le model dans <code>app/model/user.rb</code> et de rajouter la migration suivante : </p>

<pre class=" language-ruby"><code class=" language-ruby"><span class="token keyword">class</span> <span class="token const">CreateUsers</span> &lt; <span class="token const">ActiveRecord</span><span class="token punctuation">:</span><span class="token symbol">:Migration</span><span class="token punctuation">[</span><span class="token number">5.2</span><span class="token punctuation">]</span>
  <span class="token keyword">def</span> change
    create_table <span class="token symbol">:users</span> <span class="token keyword">do</span> <span class="token operator">|</span>t<span class="token operator">|</span>
      t<span class="token punctuation">.</span>string <span class="token symbol">:first_name</span>
      t<span class="token punctuation">.</span>string <span class="token symbol">:last_name</span>
      t<span class="token punctuation">.</span>integer <span class="token symbol">:age</span>
      t<span class="token punctuation">.</span>string <span class="token symbol">:city</span>

      t<span class="token punctuation">.</span>timestamps
    <span class="token keyword">end</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span></code></pre>

<p>Parfait. Maintenant nous allons faire le travail avec le model <code>Article</code> et ses diff√©rents attributs (conform√©ment √† la table <code>articles</code> vue plus haut): </p>

<pre class=" language-ruby"><code class=" language-ruby">$ rails g model <span class="token const">Article</span> title<span class="token symbol">:string</span> subject<span class="token symbol">:string</span> content<span class="token symbol">:text</span></code></pre>

<p>Cette commande cr√©e √©galement le model et une migration mais celle-ci ne contient pas l'information de la colonne <code>user_id</code> (r√©f√©rence de l'auteur de chaque article) : on va devoir la rajouter ! Modifie la migration en rajoutant la ligne <code>t.belongs_to :user, index: true</code> dans la migration :</p>

<pre class=" language-ruby"><code class=" language-ruby"><span class="token keyword">class</span> <span class="token const">CreateArticles</span> &lt; <span class="token const">ActiveRecord</span><span class="token punctuation">:</span><span class="token symbol">:Migration</span><span class="token punctuation">[</span><span class="token number">5.2</span><span class="token punctuation">]</span>
  <span class="token keyword">def</span> change
    create_table <span class="token symbol">:articles</span> <span class="token keyword">do</span> <span class="token operator">|</span>t<span class="token operator">|</span>
      t<span class="token punctuation">.</span>string <span class="token symbol">:title</span>
      t<span class="token punctuation">.</span>string <span class="token symbol">:subject</span>
      t<span class="token punctuation">.</span>text <span class="token symbol">:content</span>
      t<span class="token punctuation">.</span>belongs_to <span class="token symbol">:user</span><span class="token punctuation">,</span> index<span class="token punctuation">:</span> <span class="token keyword">true</span> <span class="token comment">#cette ligne rajoute la r√©f√©rence √† la table users
</span>
      t<span class="token punctuation">.</span>timestamps
    <span class="token keyword">end</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span></code></pre>

<p>Cette ligne dit √† ta BDD "cr√©e une colonne qui va servir √† stocker un integer, celui-ci sera la r√©f√©rence (l'<code>id</code>) du user qui est li√© √† l'article". Maintenant, tu n'as plus qu'√† passer tes 2 migrations : <code>$ rails db:migrate</code>.</p>

<div class="card box-shadow-0 border-info">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">ü§ì QUESTION R√âCURRENTE</h4>
      <p class="card-text">
        <b>Mais dis donc Jamy, j'ai d√©j√† vu un truc du genre </b><code>t.references :user, foreign_key: true, index: true</code><b>, <br> quelle est la diff√©rence avec </b><code>t.belongs_to :user, index: true</code> ?<br>
        Absolument aucune, elles veulent dire exactement la m√™me chose.
      </p>
      <p><b>Et c'est important ce <code>index: true</code> ?</b> <br>
      Cela cr√©e une table d'index qui va permettre d'acc√©l√©rer les 
requ√™tes sur cet attribut. √áa n'est pas indispensable mais √ßa ne co√ªte 
pas grand-chose donc n'h√©site pas √† le rajouter. Quand ton app aura une 
tr√®s grosse BDD, cela peut faire une diff√©rence significative.</p>
    </div>
  </div>
</div>

<h5>b) Cas 2 : les 2 tables existent d√©j√†</h5>
<p>Prenons le cas o√π les 2 tables sont d√©j√† cr√©√©es <b>mais n'ont jamais encore √©t√© li√©es</b> : aucune des 2 tables n'a de <code>foreign key</code> ou <code>belongs_to</code> dans ce cas de figure.<br>
Eh bien il suffit de rajouter l'identifiant de la table <code>users</code> dans la table <code>articles</code>.</p>

<p>On fait une migration pour cela :</p>

<pre class=" language-bash"><code class=" language-bash">$ rails generate migration AddIndexToArticles</code></pre>

<p>Ensuite on rentre la ligne ci-dessous dans le fichier de migration. Cette ligne indique juste "rajoute dans <code>articles</code> un identifiant de <code>user</code>". avant de la passer :</p>

<pre class=" language-ruby"><code class=" language-ruby"><span class="token keyword">def</span> change
  add_reference <span class="token symbol">:articles</span><span class="token punctuation">,</span> <span class="token symbol">:user</span><span class="token punctuation">,</span> foreign_key<span class="token punctuation">:</span> <span class="token keyword">true</span>
<span class="token keyword">end</span></code></pre>

<div class="card box-shadow-0 border-danger">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">‚ö†Ô∏è ALERTE ERREUR COMMUNE</h4>
      <p class="card-text">Petit d√©tail assez important dans la fa√ßon d'√©crire la migration : dans <code>add_reference :articles, :user, foreign_key: true</code>, "articles" est au pluriel car il fait r√©f√©rence √† la table. Par contre "user" <b>est au singulier</b> car on a un seul user par article.</p>
    </div>
  </div>
</div>

<h4>3.1.3. Lier les models entre eux</h4>
<p>A ce stade, tes deux tables sont bien en place et li√©es. Tu peux d'ores et d√©j√† cr√©er des entr√©es avec des articles qui ont des <code>user_id</code>. Tout √ßa peut √™tre stock√© en BDD, c'est nickel.</p>

<p>Mais si les 2 tables <code>articles</code> et <code>users</code> sont li√©es, √ßa n'est pas encore le cas des 2 models <code>Article</code> et <code>User</code>. En mentionnant dans chaque mod√®le l'existence de cette association, tu vas pouvoir tr√®s facilement sauter d'un <b>objet</b> √† un autre : si tu as un objet <code>Article</code> sous la main, tu pourras facilement appeler l'objet <code>User</code> qui lui est li√© (son auteur). Et vice et versa.</p>

<p>Tu te rappelles que Rails transforme les entr√©es de BDD en objets 
Ruby ? En liant 2 tables, tu stockes l'information que 2 entr√©es de BDD 
sont li√©es. Et en liant 2 models <code>A</code> et <code>B</code>, tu vas dire qu'on peut facilement passer d'un objet Ruby <code>A</code> √† l'objet <code>B</code>.</p>

<p>Assez parl√©, je te montre comment rajouter l'information de ce lien dans chaque model. Tout d'abord dans <code>Article</code> (stock√© dans <code>app/models/article.rb</code> :</p>
<pre class=" language-ruby"><code class=" language-ruby"><span class="token keyword">class</span> <span class="token const">Article</span> &lt; <span class="token const">ApplicationRecord</span>
  belongs_to <span class="token symbol">:user</span>
<span class="token keyword">end</span></code></pre>

<p>Puis dans <code>User</code> (stock√© dans <code>app/models/user.rb</code>) :</p>
<pre class=" language-ruby"><code class=" language-ruby"><span class="token keyword">class</span> <span class="token const">User</span> &lt; <span class="token const">ApplicationRecord</span>
  has_many <span class="token symbol">:articles</span>
<span class="token keyword">end</span></code></pre>


<div class="card box-shadow-0 border-danger">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">‚ö†Ô∏è ALERTE ERREUR COMMUNE</h4>
      <p class="card-text">Encore un petit d√©tail tr√®s important : dans une relation de type 1-N, on met un "s" (pluriel) apr√®s le <code>has_many</code> (un user a plusieurs articles : <code>has_many :articles</code>).<br>
      Par contre du c√¥t√© du <code>belongs_to</code>, √ßa reste au singulier (un article n'a qu'un seul user : <code>belongs_to :user</code>).</p>
      <p>Comment s'en rappeler ? Lisez-le comme si c'√©tait une phrase, tout simplement ! <br>
      <code>has_many :trucs</code> = "A plusieurs trucs", plusieurs donc au pluriel. <br>
      <code>belongs_to :truc</code> = "Appartient √† un truc", donc singulier.</p>
    </div>
  </div>
</div>

<h4>3.1.4. Fonctionnellement, √ßa rajoute quoi une relation 1-N ?</h4>

<p>Comme je te l'expliquais, en liant entre eux les deux models <code>Article</code> et <code>User</code>, Rails va te permettre tr√®s facilement de passer de l'un √† l'autre. <br>
Ainsi, si tu disposes d'une instance de <code>Article</code>, tu peux imm√©diatement r√©cup√©rer l'instance <code>User</code> qui lui est li√©e (son auteur) en faisant <code>.user</code> dessus (tu noteras le singulier de "user"). <br>
Sym√©triquement, si tu disposes d'une instance de <code>User</code> tu peux imm√©diatement r√©cup√©rer <b>un array des instances</b> <code>Article</code> qui lui sont li√©es (les articles qu'il a √©crits) en faisant <code>.articles</code> dessus (tu noteras le pluriel de "articles").</p>

<p>Testons en console ! Assure-toi avant d'avoir bien li√© les deux 
tables et les deux models comme expliqu√© ci-dessus. Maintenant lance la 
console de Rails et fais les op√©rations suivantes :</p>

<pre class=" language-shell"><code class=" language-shell"># Commen√ßons par cr√©er un Article sans le sauver en BDD
&gt; my_article = Article.new(title: "THP", subject: "publicit√©", content: "The Hacking Project est une formation tellement incroyable que (...)")

&gt; my_article.user
# Tu vas recevoir un "nil" car aucun objet User n'est encore li√© √† cet article.
# S'il te renvoie une erreur, c'est que le lien entre les 2 models est mal fait : il te faut le refaire.

&gt; my_user = User.create(first_name: "moi", last_name: "m√™me", city: "Montpellier", age: 25)
# On cr√©e une instance de User, enregistr√©e directement en BDD avec create.

&gt; my_article.user = my_user
# √ßa y est, on lie l'objet "my_article" (Article) avec l'objet "my_user" (User). 
# S'il te renvoie une erreur, c'est que le lien entre les 2 mod√®les est mal fait : il te faut le refaire.

&gt; my_article.save
# On √©crit l'objet "my_article" en BDD. S'il te renvoie une erreur, tu as mal suivi ce tuto.

&gt; article1 = Article.last
# R√©cup√®re le dernier article √©crit en base (celui que tu viens de cr√©er)

&gt;article1.user
# Renvoie th√©oriquement l'objet "my_user" (Moi M√™me, 25 ans, Montpellier)

&gt;my_user.articles
# Devrait te renvoyer un array avec tous les articles √©crits par "my_user". Parmi eux, tu devrais trouver celui que tu viens de cr√©er</code></pre>

<p>Gr√¢ce √† ceci, tu v√©rifies que :</p>
<ul>
  <li>Tes articles sont bien li√©s aux users</li>
  <li>Tes users sont bien li√©s aux articles</li>
</ul>

<div class="card box-shadow-0 border-info">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">üöÄ ALERTE BONNE ASTUCE</h4>
      <p class="card-text">Parfois tu feras <code>Truc.create</code> et la console te renverra un message o√π il y a marqu√© en rouge <code>ROLLBACK</code>. Cela veut dire que la sauvegarde n'a pas √©t√© prise en compte. Pour rem√©dier √† ceci, la m√©thode <code>#errors</code> va te sauver la vie et t'expliquer ce qui a foir√©. Teste l'exemple ci-dessous avec un nouvel article :</p>
      <pre class=" language-ruby"><code class=" language-ruby">&gt; article2 <span class="token operator">=</span> <span class="token const">Article</span><span class="token punctuation">.</span>create
<span class="token comment">#=&gt; Renvoie un message en mode ROLLBACK
</span>
&gt; article2<span class="token punctuation">.</span>errors

&gt; article2<span class="token punctuation">.</span>errors<span class="token punctuation">.</span>messages
<span class="token comment">#=&gt; Dedans tu peux lire "User must exist"</span></code></pre>

      <p class="card-text">Pourquoi obtient-on un Rollback ici ? √âtant donn√© que ton article doit <code>belongs_to</code> un user, eh bien <b>il faut absolument qu'un auteur soit d√©fini pour ton article AVANT de pouvoir le sauvegarder en BDD.</b> Sinon, une erreur intervient. </p>
    </div>
  </div>
</div>

<h4>3.1.5. Tester ses models</h4>
<p>Quand tu as fait les 2 √©tapes pour lier tes models (les tables puis les models), tu dois avoir le r√©flexe d'aller <b>syst√©matiquement</b> dans la console pour les tester. <br>
C'est une bonne pratique de le faire √† chaque fois pour v√©rifier que tu 
n'as pas fait d'erreur mais aussi pour t'habituer √† utiliser les liens 
que tu viens de cr√©er entre objets. <br>
Voici par exemple comment tester (en 6 lignes de console) qu'un <code>Article</code> appartient √† un <code>User</code> et un <code>User</code> a plusieurs <code>Articles</code> :</p>

<pre class=" language-ruby"><code class=" language-ruby">&gt; a <span class="token operator">=</span> <span class="token const">Article</span><span class="token punctuation">.</span><span class="token keyword">new</span>
<span class="token comment">#=&gt; Un article pas encore sauvegard√©
</span>
&gt; a<span class="token punctuation">.</span>user
<span class="token comment">#=&gt; il doit te renvoyer nil. S'il te renvoie une erreur, le lien est mal fait !
</span>
&gt; u <span class="token operator">=</span> <span class="token const">User</span><span class="token punctuation">.</span>first
<span class="token comment">#=&gt; un superbe user. S'il n'y en a pas encore, cr√©es-en un.
</span>
&gt; a<span class="token punctuation">.</span>user <span class="token operator">=</span> u
<span class="token comment">#=&gt; A nouveau, s'il te renvoie une erreur, le lien est mal fait !
</span>
&gt; a<span class="token punctuation">.</span>save
<span class="token comment">#=&gt; COMMIT. S'il te renvoie une erreur, tu as mal suivi ce tuto
</span>
&gt; <span class="token const">Article</span><span class="token punctuation">.</span>last<span class="token punctuation">.</span>user<span class="token punctuation">.</span>articles <span class="token comment">#=&gt; R√©cup√®re les articles du user li√© au dernier article cr√©√© en base (celui que tu viens de cr√©er)
</span><span class="token comment">#=&gt; Devrait te renvoyer un array qui contient l'article que tu viens de cr√©er. Sinon c'est que le lien est mal fait.</span></code></pre>

<h3>3.2. La relation N-N</h3>

<p>Un exemple typique de relation N-N est la relation patient-m√©decin. 
Chaque patient peut avoir plusieurs m√©decins (g√©n√©raliste, 
ophtalmologue, dermatologue, etc.) et chaque m√©decin peut avoir 
plusieurs patients (sauf s'il est compl√®tement nul, mais c'est une autre
 histoire). Comment mod√©liser dans Rails ce lien doublement multiple ?</p>

<p>Quand tu con√ßois une relation 1-N entre 2 tables, il suffit qu'une des 2 tables h√©berge une <code>foreign key</code>, qui est l'<code>id</code>
 (la r√©f√©rence d'une entr√©e en BDD) d'une table externe. Cette astuce 
est possible car, dans une relation 1-N, la table A a ses √©l√©ments qui 
sont li√©s √† <b>un seul</b> autre √©l√©ment de la table B : on a une seule <code>foreign_key</code> √† h√©berger. <br>
Ainsi, pour revenir √† nos utilisateurs qui peuvent √©crire des articles, la table <code>articles</code> aura une colonne qui repr√©sentera la <code>foreign key</code> de son unique auteur : le lien est alors √©vident. C√¥t√© table utilisateurs, inutile de stocker une <code>foreign key</code> : pour retrouver les articles d'un utilisateur, on a juste √† chercher la r√©f√©rence de l'utilisateur du c√¥t√© de la table des <code>articles</code>, directement dans la colonne des <code>foreign key</code>. La technique est tr√®s habile et permet de faire facilement des relations 1-N.</p>

<p>Mais si on se penche sur le cas d'une relation N-N, chaque √©l√©ment 
est li√© √† plusieurs autres (souvent en nombre variable). Peut-on ins√©rer
 plusieurs <code>foreign key</code> dans une des tables ? En base de 
donn√©es, on ne peut pas h√©berger un array dans une colonne, ni d√©finir 
un nombre de colonnes variable selon si un √©l√©ment est li√© √† 1, 4, 30 ou
 200 autres. Du coup, l'utilisation des <code>foreign key</code> dans une des deux tables est impossible.</p>

<p>Comment concevoir une relation N-N alors ? Eh bien dans son mod√®le 
des bases de donn√©es relationnelles, Edgar Codd avait tout simplement 
imagin√© <b>cr√©er une table interm√©diaire entre les 2</b>. Elle listerait les couples d'√©l√©ments qui sont li√©s et, par transitivit√©, on pourrait faire des relations N-N.</p>

<h4>3.2.1. La relation N-N dans les tables de la BDD</h4>

<p>Pour illustrer la cr√©ation d'une table interm√©diaire, rien de mieux 
qu'un bel exemple. Prenons l'exemple de nos m√©decins et patients (il est
 issu de <a href="https://guides.rubyonrails.org/association_basics.html#the-has-many-through-association" target="_blank">la doc de Rails</a>) et imaginons que tu veuilles concevoir le futur Doctolib.</p>

<p>Tu auras donc une table pour tes patients, et une table pour tes 
docteurs. Un patient peut avoir plusieurs docteurs et un docteur peut 
avoir plusieurs patients. Pour cr√©er cette relation N-N, il suffit 
d'avoir une table interm√©diaire qui ressemblerait √† √ßa :</p>

<div class="table-responsive">
  <table class="table">
    <thead>
    <tr>
      <th>id</th>
      <th>doctor_id</th>
      <th>patient_id</th>
    </tr>
    </thead>
    <tbody><tr>
      <th>1</th>
      <th>42</th>
      <th>55</th>
    </tr>
    <tr>
      <th>2</th>
      <th>42</th>
      <th>66</th>
    </tr>
    <tr>
      <th>3</th>
      <th>42</th>
      <th>89</th>
    </tr>
    <tr>
      <th>4</th>
      <th>36</th>
      <th>55</th>
    </tr>
  </tbody></table>
</div>

<p>On voit par exemple que le docteur portant l'<code>id</code> 42 est li√© aux patients portant les <code>id</code> 55, 66 et 89. Inversement, le patient √† l'<code>id</code> 55 est li√© √† 2 docteurs: le 42 et le 36.</p>

<p>Cette table interm√©diaire peut rester en l'√©tat et ne faire que 
lister les liens patients-docteurs : on parlera alors de "Table de 
Jointure" ou "Join table" en anglais. Typiquement on l‚Äôappellera <code>join_table_patients_doctors</code> et elle aura un model au doux nom de <code>JoinTablePatientDoctor</code>.</p>

<p>Mais cette table peut devenir bien plus. On peut imaginer qu'elle 
h√©berge des informations additionnelles sur ce lien entre un patient et 
son docteur. Qu'est ce qui fait qu'un patient et un docteur sont li√©s ? 
=&gt; Le fait qu'ils aient un jour pris un RDV ! <br>
Cette table peut tout √† fait h√©berger les informations du rendez-vous : 
un rendez-vous ne concerne qu'un seul patient et un seul docteur ; 
patients et docteurs peuvent avoir autant de rendez-vous que n√©cessaire.
 Donc, gr√¢ce aux rendez-vous, nous avons l'information du lien entre 
docteurs et patients ! <br>
La table devient alors : </p>

<div class="table-responsive">
  <table class="table">
    <thead>
    <tr>
      <th>id</th>
      <th>doctor_id</th>
      <th>patient_id</th>
      <th>date</th>
      <th>place</th>
    </tr>
    </thead>
    <tbody><tr>
      <th>1</th>
      <th>42</th>
      <th>55</th>
      <th>2018-09-23T12:30:00+00:00</th>
      <th>"5 rue du Bearn"</th>
    </tr>
    <tr>
      <th>2</th>
      <th>42</th>
      <th>66</th>
      <th>2018-12-15T17:30:00+00:00</th>
      <th>"5 rue du Bearn"</th>
    </tr>
    <tr>
      <th>3</th>
      <th>42</th>
      <th>89</th>
      <th>2019-07-02T09:00:00+00:00</th>
      <th>"18 rue des cagoles"</th>
    </tr>
    <tr>
      <th>4</th>
      <th>36</th>
      <th>55</th>
      <th>2019-03-17T10:00:00+00:00</th>
      <th>"17 avenue des chouquettes"</th>
    </tr>
  </tbody></table>
</div>

<p>Finalement, on vient de cr√©er un nouvel objet <code>Appointment</code> √† part enti√®re, avec ses attributs <code>date</code> et <code>place</code> ! Les implications de cette id√©e sont nombreuses (nous les d√©taillerons plus bas) :</p>

<ul>
  <li>On doit nommer la table <code>appointments</code> et son model <code>Appointment</code> afin de pouvoir appeler et modifier, dans le code de ton app, ces RDV.</li>
  <li>Chaque appointment est li√© √† un docteur mais un docteur peut avoir plusieurs appointments : il y a une relation 1-N entre <code>appointments</code> et <code>doctors</code> !</li>
  <li>Sym√©triquement, chaque appointment est li√© √† un patient mais un 
patient peut avoir plusieurs appointments : il y a une relation 1-N 
entre <code>appointments</code> et <code>patients</code> !</li>
</ul>

<p>Au final, on a d√©coup√© la relation N-N en deux relations 1-N. Voyons, en d√©tail, comment mettre en place la relation N-N.</p>

<h4>3.2.2. Mettre en place les tables</h4>
<p>Pour suivre avec moi les √©tapes, je te propose de cr√©er une nouvelle 
application Rails dont le but sera d'envoyer Doctolib √† l'hosto. On va 
enregistrer des patients et des m√©decins et les lier par une relation 
N-N (ou "many-to-many" en anglais). <br>
Pour impl√©menter cette relation dans ton code, il y a deux choses √† faire :</p>

<ol>
  <li>Faire la migration pour cr√©er les trois tables (patients, doctors 
et la table interm√©diaire), et ins√©rer les foreign keys aux bons 
endroits ;</li>
  <li>Cr√©er les models et leur ajouter les liens gr√¢ce aux lignes <code>has_many</code>, <code>belongs_to</code>, etc.</li>
</ol>

<p>On va g√©n√©rer les 3 models et les 3 migrations de cr√©ation de table avec la commande habituelle <code>$ rails g model NomDuModel</code>. Fais-le pour les 3 models <code>Patient</code>, <code>Doctor</code> et <code>Appointment</code> (on va faire les flemmards et ne pas mettre d'autres colonnes dans ces models).</p>

<p>Maintenant, tu vas te retrouver avec 3 migrations de cr√©ation de 
table. Modifie uniquement celle concernant la table interm√©diaire <code>appointments</code> de fa√ßon √† lui rajouter les <code>id</code> des m√©decins et patients :</p>

<pre class=" language-ruby"><code class=" language-ruby"><span class="token keyword">def</span> change
  create_table <span class="token symbol">:appointments</span> <span class="token keyword">do</span> <span class="token operator">|</span>t<span class="token operator">|</span>
    t<span class="token punctuation">.</span>belongs_to <span class="token symbol">:doctor</span><span class="token punctuation">,</span> index<span class="token punctuation">:</span> <span class="token keyword">true</span>
    t<span class="token punctuation">.</span>belongs_to <span class="token symbol">:patient</span><span class="token punctuation">,</span> index<span class="token punctuation">:</span> <span class="token keyword">true</span>
    t<span class="token punctuation">.</span>timestamps
  <span class="token keyword">end</span>
<span class="token keyword">end</span></code></pre>

<p>Si tes 3 tables existaient d√©j√†, il t'aurait fallu simplement cr√©er une migration pour modifier la table <code>appointments</code>  afin de lui ajouter les foreign keys. Voici √† quoi aurait ressembl√© la migration de modification :</p>

<pre class=" language-ruby"><code class=" language-ruby"><span class="token keyword">def</span> change
  add_reference <span class="token symbol">:appointments</span><span class="token punctuation">,</span> <span class="token symbol">:doctor</span><span class="token punctuation">,</span> foreign_key<span class="token punctuation">:</span> <span class="token keyword">true</span>
  add_reference <span class="token symbol">:appointments</span><span class="token punctuation">,</span> <span class="token symbol">:patient</span><span class="token punctuation">,</span> foreign_key<span class="token punctuation">:</span> <span class="token keyword">true</span>
<span class="token keyword">end</span></code></pre>

<h4>3.2.3. Lier les models entre eux</h4>
<p>Tes tables sont en place, il te reste √† informer les models du lien 
qui les unit. Cela se fera gr√¢ce √† 6 lignes de code (2 par model). En 
r√©sum√©, ces lignes vont dire que :</p>

<ol>
  <li>Un rendez-vous appartient √† un docteur ;</li>
  <li>Un rendez-vous appartient √† un patient ;</li>
  <li>Un docteur peut avoir plusieurs rendez-vous ;</li>
  <li>Un docteur peut avoir plusieurs patients, √† travers les rendez-vous ;</li>
  <li>Un patient peut avoir plusieurs rendez-vous ;</li>
  <li>Un patient peut avoir plusieurs docteurs, √† travers les rendez-vous.</li>
</ol>

<p>Tu l'as compris, "appartient √†" s'√©crira avec un <code>belongs_to</code>, "peut avoir plusieurs" s'√©crira avec <code>has_many</code>. Et la nouveaut√© ici est le faire de "pouvoir avoir plusieurs X √† travers Y" : c'est la relation <code>has_many through</code>. <br>
En d√©finitive, <code>Patient</code> et <code>Doctor</code> seront li√©s <b>√† travers</b> <code>Appointment</code>.</p>

<p>Voici donc les 6 lignes, √† la base de la relation N-N en Rails, pour chacun des models :</p>

<ul>
  <li>Les rendez-vous, dans le fichier <code>app/models/appointment.rb</code></li>
<pre class=" language-ruby"><code class=" language-ruby"><span class="token keyword">class</span> <span class="token const">Appointment</span> &lt; <span class="token const">ApplicationRecord</span>
  belongs_to <span class="token symbol">:doctor</span>
  belongs_to <span class="token symbol">:patient</span>
<span class="token keyword">end</span></code></pre>
  <li>Les docteurs, dans le fichier <code>app/models/doctor.rb</code> :</li>
<pre class=" language-ruby"><code class=" language-ruby"><span class="token keyword">class</span> <span class="token const">Doctor</span> &lt; <span class="token const">ApplicationRecord</span>
  has_many <span class="token symbol">:appointments</span>
  has_many <span class="token symbol">:patients</span><span class="token punctuation">,</span> through<span class="token punctuation">:</span> <span class="token symbol">:appointments</span>
<span class="token keyword">end</span></code></pre>

  <li>Les patients, dans le fichier <code>app/models/patient.rb</code></li>
<pre class=" language-ruby"><code class=" language-ruby"><span class="token keyword">class</span> <span class="token const">Patient</span> &lt; <span class="token const">ApplicationRecord</span>
  has_many <span class="token symbol">:appointments</span>
  has_many <span class="token symbol">:doctors</span><span class="token punctuation">,</span> through<span class="token punctuation">:</span> <span class="token symbol">:appointments</span>
<span class="token keyword">end</span></code></pre>

</ul>

<div class="card box-shadow-0 border-danger">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">‚ö†Ô∏è ALERTE ERREUR COMMUNE</h4>
      <p class="card-text">Pour impl√©menter un <code>has_many through</code>, l'ordre des lignes dans le model est primordial. En effet, on ne peut pas d√©clarer une relation <code>through: :trucs</code> sans que la relation √† la table <code>trucs</code> ait √©t√© d√©finie en premier par un <code>has_many :trucs</code>.</p>
      <p>En gros, les lignes ci-dessous bugueraient :</p>
<pre class=" language-ruby"><code class=" language-ruby"><span class="token keyword">class</span> <span class="token const">Doctor</span> &lt; <span class="token const">ApplicationRecord</span>
  has_many <span class="token symbol">:patients</span><span class="token punctuation">,</span> through<span class="token punctuation">:</span> <span class="token symbol">:appointments</span>
  has_many <span class="token symbol">:appointments</span>
<span class="token keyword">end</span></code></pre>
    </div>
  </div>
</div>

<p>Et voil√† ! Recopie ces lignes dans ton app Rails : tu as r√©ussi √† 
cr√©er une relation many-to-many ! Hyper tranquille ‚ù§ On va voir comment 
tester le tout en console, c'est hyper important.</p>

<h4>3.2.4. Tester en console</h4>
<p>En cr√©ant cette relation N-N et en liant les models entre eux, on permet de facilement sauter d'un objet √† l'autre :</p>
<ul>
  <li>Sur un objet <code>Doctor</code> on peut obtenir un array de ses patients avec <code>my_doctor.patients</code> ou un array de ses RDV avec <code>my_doctor.appointments</code>.</li>
  <li>Sur un objet <code>Patient</code> on peut obtenir un array de ses docteurs avec <code>my_patient.doctors</code> ou un array de ses RDV avec <code>my_patient.appointments</code>.</li>
  <li>Sur un objet <code>Appointments</code> on peut obtenir le patient concern√© avec <code>my_appoint.patient</code> (vous noterez le singulier) ou le docteur concern√© avec <code>my_appoint.doctor</code> (idem - singulier).</li>
</ul>


<div class="card box-shadow-0 border-info">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">üöÄ ALERTE BONNE ASTUCE</h4>
      <p class="card-text">Tu as d√ª remarquer dans les exemples ci-dessus : <code>.patients</code> retourne un array alors que <code>.patient</code> retourne un objet. Encore une fois, cela montre l'importance du nommage des variables et m√©thodes en Ruby. <br>
      <b>Pluriel =&gt; array d'objets. Singulier =&gt; objet seul.</b></p>
    </div>
  </div>
</div>

<p>Mais pour que ces appels fonctionnent, il faut que la relation N-N 
ait √©t√© faite proprement ! On se doit donc de v√©rifier cela en console. 
Ci-dessous tu as, par exemple, quelques lignes qui vont tester que tes 
models sont bien cr√©√©s et bien reli√©s entre eux :</p>

<pre class=" language-shell"><code class=" language-shell">&gt;d = Doctor.create
&gt;p = Patient.create
&gt;a = Appointment.create(doctor: d, patient: p)
#=&gt; je cr√©e une instance de chaque objet

&gt;a.doctor
#=&gt; on devrait obtenir en retour le docteur "d" cr√©√© plus haut. Sinon c'est qu'on a fait une erreur

&gt;a.patient
#=&gt; on devrait obtenir en retour le patient "p" cr√©√© plus haut. Sinon c'est qu'on a fait une erreur

&gt;d.patients
#=&gt; on devrait obtenir en retour un array contenant le patient "p" cr√©√© plus haut. Sinon c'est qu'on a fait une erreur

&gt;p.doctors
#=&gt; on devrait obtenir en retour un array contenant le doctor "d" cr√©√© plus haut. Sinon c'est qu'on a fait une erreur</code></pre>


<h3>3.3. Rappels importants : les √©tapes indispensables pour faire une belle base de donn√©es en Rails</h3>
<p>Oui on va se r√©p√©ter mais si on le fait pas, √ßa rentrera pas ! Tu nous remercieras plus tard.</p>

<h4>3.3.1. Toujours se poser SANS CODER pour mod√©liser sa BDD</h4>
<p>On commence TOUJOURS par un dessin sur une feuille blanche o√π on 
√©crit les diff√©rents mod√®les (sous forme de bulles) et la relation (1-1,
 1-N, ou N-N) entre eux (sous forme de traits les reliant). Pour rappel :</p>

<ul>
  <li><b>Une relation 1-1, √ßa veut dire que les deux instances vont de pair mais sont des objets s√©par√©s</b>.
 Par exemple en France, on a une relation 1-1 entre les personnes et 
leur num√©ro de s√©curit√© sociale (un num√©ro correspond √† une personne et 
cette personne n'a qu'un seul num√©ro).</li>

  <li><b>Une relation 1-N, c‚Äôest quand une instance "poss√®de" plusieurs instances d'un autre type et a l'exclusivit√© sur chacun</b>.
 Exemple : sur mon compte Youtube, j‚Äôai publi√© plein de vid√©os, et 
toutes ses vid√©os sont rattach√©es √† MON compte Youtube et lui seulement.</li>

  <li><b>Pour une relation N-N</b>, pense √† Doctolib : Il y a des 
docteurs et des patients. Chaque docteur peut avoir plusieurs patients, 
et un patient peut avoir plusieurs docteurs (le dentiste, le 
g√©n√©raliste, etc.). Du coup on doit mod√©liser un objet interm√©diaire, 
par exemple un RDV qui lie un docteur et un patient. En passant par la 
table RDV, on d√©coupe la relation N-N en 2 relations 1-N (un docteur par
 RDV, un patient par RDV). ü§ì</li>
</ul>

<h4>3.3.2. Toujours tester ses associations en console</h4>
<p>Tester ses mod√®les en console c'est la base ! Comment v√©rifier si les
 associations ont √©t√© faites correctement ? Il faut avoir en t√™te le 
type de relation 1-N ou N-N. </p>

<p><b>Pour des relations 1-N</b>, on a vu l'exemple <code>User</code> et <code>Article</code> mais on aurait pu faire de m√™me avec <code>Author</code> et <code>Book</code>. Un author peut avoir un ou plusieurs books, mais un book ne peut correspondre qu'√† un seul author.

</p><pre class=" language-ruby"><code class=" language-ruby"><span class="token comment">#On cr√©e des instances en base 
</span>shakespeare <span class="token operator">=</span> <span class="token const">Author</span><span class="token punctuation">.</span>create
macbeth <span class="token operator">=</span> <span class="token const">Book</span><span class="token punctuation">.</span>create<span class="token punctuation">(</span>author<span class="token punctuation">:</span> shakespeare<span class="token punctuation">)</span>
king_lear <span class="token operator">=</span> <span class="token const">Book</span><span class="token punctuation">.</span>create<span class="token punctuation">(</span>author<span class="token punctuation">:</span> shakespeare<span class="token punctuation">)</span>

<span class="token comment"># on v√©rifie que le lien est OK:
</span>macbeth<span class="token punctuation">.</span>author
king_lear<span class="token punctuation">.</span>author
<span class="token comment"># =&gt; doivent retourner l'objet shakespeare
</span>
shakespeare<span class="token punctuation">.</span>books
<span class="token comment">#=&gt; doit retourner un array contenant les objets macbeth et king_lear</span></code></pre><p></p>

<p>‚ö†Ô∏è Attention aux pluriels : Un auteur peut avoir plusieurs livres, on utilisera donc le pluriel en faisant <code>.books</code> pour r√©cup√©rer un array de book qu'il a √©crit.</p>

<p><b>Pour des relations N-N</b>, on utilisera des pluriels sur les deux mod√®les.
Prenons l'exemple d'un service de location de v√©los (model <code>Bicycle</code>) pouvant √™tre utilis√© par plusieurs utilisateurs (model <code>User</code>) au travers de locations (model <code>Rental</code>). On va cr√©er un v√©lo et lui attribuer un utilisateur :</p>

<pre class=" language-ruby"><code class=" language-ruby">bicycle_234 <span class="token operator">=</span> <span class="token const">Bicycle</span><span class="token punctuation">.</span>create
bicycle_234<span class="token punctuation">.</span>users &lt;&lt; <span class="token const">User</span><span class="token punctuation">.</span>create<span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string">"Michel"</span><span class="token punctuation">)</span></code></pre>

<p>√áa signifie que Michel a utilis√© le v√©lo "bicycle_234". Les deux sont
 maintenant li√©s et d'ailleurs Rails a automatiquement cr√©√© un objet <code>rental</code> qui lie les deux ! On pourrait le v√©rifier en faisant <code>Rental.last</code>.</p><p>

</p><p>Maintenant je peux rajouter d‚Äôautres utilisateurs √† ce v√©lo. </p>
<pre class=" language-ruby"><code class=" language-ruby">bicycle_234<span class="token punctuation">.</span>users &lt;&lt; <span class="token const">User</span><span class="token punctuation">.</span>create<span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string">"Jack"</span><span class="token punctuation">)</span>
bicycle_234<span class="token punctuation">.</span>users &lt;&lt; <span class="token const">User</span><span class="token punctuation">.</span>create<span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string">"John"</span><span class="token punctuation">)</span></code></pre>

<p>La commande <code>bicycle_234.users</code> doit me retourner un array contenant un objet <code>user</code> par utilisateur du V√©lo 234.<br>
Pareillement, je peux associer plusieurs v√©los √† un user :</p>

<pre class=" language-ruby"><code class=" language-ruby">bicycle_27 <span class="token operator">=</span> <span class="token const">Bicycle</span><span class="token punctuation">.</span>create
bicycle_74 <span class="token operator">=</span> <span class="token const">Bicycle</span><span class="token punctuation">.</span>create
michel <span class="token operator">=</span> <span class="token const">User</span><span class="token punctuation">.</span>first
michel<span class="token punctuation">.</span>bicycles &lt;&lt; bicycle_27
michel<span class="token punctuation">.</span>bicycles &lt;&lt; bicycle_74</code></pre>
<p>

La commande <code>michel.bicycles</code> me donnera donc un array de tous les objets v√©los emprunt√©s par mon utilisateur !
</p>


<h2>4. Points importants √† retenir</h2>


<p>Pour lier en 1-N deux tables et models entre eux, il faut proc√©der en 2 √©tapes : </p>
<ol>
  <li>Ajouter la cl√© √©trang√®re dans <b>la table qui repr√©sente l'objet appartenant √† l'autre</b>. Exemple : <code>Article</code> appartient √† son <code>User</code>, donc c'est la table <code>articles</code> qui portera la cl√© √©trang√®re. Tu peux soit le faire d√®s la cr√©ation de la table, soit faire une migration avec : <code>add_reference :articles, :user, foreign_key: true</code></li>
  <li>Lier les models en utilisant <code>has_many :articles</code> et <code>belongs_to :user</code> (attention au singulier et pluriel).</li>
</ol>

<p>Pour mod√©liser une relation N-N entre 2 models, il faut 
n√©cessairement mettre en place une table (et donc un model) 
interm√©diaire. Cette table interm√©diaire est reli√©e aux 2 autres par une
 relation 1-N standard. Il y a deux choses √† faire :</p>
<ul>
  <li>Cr√©er les trois tables avec les foreign keys dans la table de jointure (ou table interm√©diaire).</li>
  <li>Ajouter deux lignes par model pour "brancher" les models entre eux. On utilisera notamment <code>has_many through</code> pour mod√©liser la relation N-N.</li>
</ul>

<p>Bonus : dans une relation 1-1, il faut utiliser un <code>has_one</code> pour les deux mod√®les (c‚Äôest une relation assez rare, il y a d‚Äôautres mani√®res de le faire mais c‚Äôest pas tr√®s important)</p>

<p>Une fois une relation √©tablie, il faut la tester dans la console Rails !</p>

<h2>5. Pour aller plus loin</h2>

<p>Il est possible que tu entendes parler de la relation N-N utilisant un <code>has_and_belongs_to_many</code>. C'est une sorte de raccourci de la m√©thode <code>has_many through</code>
 o√π la table interm√©diaire ne dispose pas de model : tu ne peux pas 
acc√©der √† son contenu dans ton code. Les rubyistes seniors la 
d√©conseillent aux d√©butants car souvent, on l'impl√©mente ("hop, j'ai 
juste besoin de savoir quel patient est li√© √† quel m√©decin") pour 
finalement se rendre compte que la table interm√©diaire est un objet 
int√©ressant ("üí© ! En fait c'est utile pour mon app de savoir quand et 
o√π ils se voient. Je dois maintenant tout changer et en faire un objet 
"appointment" avec des attributs"). Donc dans le doute, fait toujours du
 <code>has_many through</code>, tu passeras au <code>has_and_belongs_to_many</code> avec un peu plus d'exp√©rience. <br>
Mais tu peux <a href="https://guides.rubyonrails.org/association_basics.html#the-has-and-belongs-to-many-association">aller voir la doc Rails sur le sujet</a> si tu es curieux ! </p>

<p>Quelques autres ressources si tu veux continuer √† creuser les BDD relationnelles :</p>
<ul>
  <li>La doc contient une super grande page sur les associations entre 
diff√©rents mod√®les d'une app Rails, et sur les bonnes pratiques pour les
 r√©ussir : <a href="http://guides.rubyonrails.org/association_basics.html" target="_blank">la voici</a>. On verra plus en d√©tail les associations demain mais essaye de prendre ce que tu peux dans cette doc pour le projet du jour.</li>
  <li>Voici <a href="https://www.youtube.com/watch?v=DAjfsW4gqGo" target="_blank">une vid√©o</a> qui reprend la partie sur les associations, et qui montre quelques m√©thodes en console pour jouer avec nos models.</li>
  <li>Regarde la <a href="https://grafikart.fr/tutoriels/models-associations-848" target="_blank">vid√©o de Grafikart</a> sur les BDD relationnelles. Il va super loin, mais explique bien les bases au d√©but.</li>
  <li>SitePoints ont fait <a href="https://www.sitepoint.com/brush-up-your-knowledge-of-rails-associations/" target="_blank">un bon tuto</a> qui reprend les bases des associations et <a href="https://www.sitepoint.com/master-many-to-many-associations-with-activerecord/" target="_blank">un autre tuto</a> sur les BDD relationnelles avanc√©es.</li>
  <li>Nos amis de The Odin Project ont fait un cours pas mal du tout sur les associations, <a href="https://www.theodinproject.com/courses/ruby-on-rails/lessons/active-record-associations" target="_blank">voici le lien</a>.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>

<div class="row">
<div class="col-12">
<div class="card">
<div class="card-header" style="border-top: 3px solid #5E66E5">
<h1>
Ressource : 
Petites m√©thodes pratiques dans les bases de donn√©es
</h1>
<a class="heading-elements-toggle">
<i class="la la-ellipsis-v font-medium-3"></i>
</a>
<div class="heading-elements">
<ul class="list-inline mb-0">
<li>
<a href="https://www.thehackingproject.org/fr/dashboard/courses/1/lessons/101/lesson_submissions/new"><i class="ft-edit" data-original-title="Proposer une am√©lioration" data-placement="top" data-toggle="tooltip"></i>
</a></li>
<li>
<a data-action="collapse">
<i class="ft-minus"></i>
</a>
</li>
<li>
<a data-action="expand">
<i class="ft-maximize"></i>
</a>
</li>
</ul>
</div>
</div>
<div class="card-content collapse show">
<div class="card-body">
<div class="tab-pane active" id="home1" role="tabpanel">

<h2>1. Introduction</h2>
<p>Dans cette ressource, nous allons te donner quelques astuces pour pousser un peu plus loin les associations dans Rails :</p>

<ul>
  <li>Le <code>class_name</code> qui permet d'utiliser un nom d'association diff√©rent de celui du model&nbsp;;</li>
  <li>Le <code>optional</code> qui permet de rendre un belongs_to optionnel&nbsp;;</li>
  <li>Le <code>dependent</code> qui permet de rendre un model d√©pendant de l'autre.</li>
</ul>

<h2>2. Historique</h2>
<p>Ces 3 fonctionnalit√©s d'ActiveRecord permettent d'√©largir les possibilit√©s et de mod√©liser encore plus de cas particuliers.</p>

<h2>3. La ressource</h2>

<h3>3.1. Utiliser Class_name</h3>

<p>La m√©thode <code>class_name</code> est r√©serv√©e √† ceux qui ont bien 
compris les bases de la mod√©lisation de base de donn√©es, et qui veulent 
aller un niveau au-dessus. Vu que t'es au top, tu vas comprendre √ßa 
hyper rapidement.</p>

<p>Imagine que tu veux mettre en place un model pour une application de 
messagerie. Tu veux que tes utilisateurs puissent envoyer des messages 
priv√©s ET en recevoir. Tu auras donc, pour chaque message, un <code>sender</code> et un <code>recipient</code>, mais qui seront tous les deux du m√™me type <code>User</code>. Si tu utilises tes connaissances actuelles, tu vas te retrouver avec un objet <code>message</code> avec des <code>users</code> qui lui sont li√©s sans pouvoir diff√©rencier l'exp√©diteur du destinataire&nbsp;: faire un <code>message.users</code> va pas t'aider‚Ä¶ Ce serait bien de pouvoir faire <code>message.sender</code> ou <code>message.recipient</code>.
 Eh bien c‚Äôest justement l‚Äôint√©r√™t de class_name, qui va te permettre de
 renommer tes m√©thodes d'association. Voyons comment ce serait 
impl√©ment√©.</p>

<p>Imaginons que la table <code>users</code> existe d√©j√† avec son model <code>User</code>. Pour rajouter les messages, on cr√©e un model <code>PrivateMessage</code> avec une migration pour cr√©er la table <code>private_messages</code> :</p>
<pre class=" language-ruby"><code class=" language-ruby"><span class="token keyword">class</span> <span class="token const">CreatePrivateMessages</span> &lt; <span class="token const">ActiveRecord</span><span class="token punctuation">:</span><span class="token symbol">:Migration</span><span class="token punctuation">[</span><span class="token number">5.2</span><span class="token punctuation">]</span>
  <span class="token keyword">def</span> change
    create_table <span class="token symbol">:private_messages</span> <span class="token keyword">do</span> <span class="token operator">|</span>t<span class="token operator">|</span>
      t<span class="token punctuation">.</span>references <span class="token symbol">:recipient</span><span class="token punctuation">,</span> index<span class="token punctuation">:</span> <span class="token keyword">true</span>
      t<span class="token punctuation">.</span>references <span class="token symbol">:sender</span><span class="token punctuation">,</span> index<span class="token punctuation">:</span> <span class="token keyword">true</span>

      t<span class="token punctuation">.</span>timestamps
    <span class="token keyword">end</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span></code></pre>

<p>Tu vois que, directement, on annonce que la table contient des foreign key de type <code>recipient</code> et <code>sender</code>‚Ä¶
 Seul petit probl√®me&nbsp;: ces tables n'existent pas, car les 
destinataires et exp√©diteurs sont des utilisateurs avant tout&nbsp;!
C'est l√† que la m√©thode class_name intervient. Pour l'impl√©menter, on va
 dans le model (fichier <code>private_message.rb</code>) et on fait :</p>

<pre class=" language-ruby"><code class=" language-ruby"><span class="token keyword">class</span> <span class="token const">PrivateMessage</span> &lt; <span class="token const">ApplicationRecord</span>
  belongs_to <span class="token symbol">:sender</span><span class="token punctuation">,</span> class_name<span class="token punctuation">:</span> <span class="token string">"User"</span>
  belongs_to <span class="token symbol">:recipient</span><span class="token punctuation">,</span> class_name<span class="token punctuation">:</span> <span class="token string">"User"</span>
<span class="token keyword">end</span></code></pre>

<p>Et dans la classe User, tu mettras :</p>

<pre class=" language-ruby"><code class=" language-ruby"><span class="token keyword">class</span> <span class="token const">User</span> &lt; <span class="token const">ApplicationRecord</span>
  has_many <span class="token symbol">:sent_messages</span><span class="token punctuation">,</span> foreign_key<span class="token punctuation">:</span> <span class="token string">'sender_id'</span><span class="token punctuation">,</span> class_name<span class="token punctuation">:</span> <span class="token string">"PrivateMessage"</span>
  has_many <span class="token symbol">:received_messages</span><span class="token punctuation">,</span> foreign_key<span class="token punctuation">:</span> <span class="token string">'recipient_id'</span><span class="token punctuation">,</span> class_name<span class="token punctuation">:</span> <span class="token string">"PrivateMessage"</span>
<span class="token keyword">end</span></code></pre>

<p>En gros, voici ce que tu as fait (si on se concentre sur le c√¥t√© sender / sent_messages) :</p>
<ul>
  <li>Tu as fait une migration pour cr√©er une table <code>private_messages</code> avec une r√©f√©rence <code>sender</code>. Comme la table senders n'existe pas, tu ne mets pas <code>foreign_key: true</code>, mais <code>index: true</code>. <b>La table <code>private_messages</code> a donc une colonne <code>sender_id</code></b>.</li>
  <li>Dans le model <code>PrivateMessage</code>, tu dis que ce dernier appartient √† un sender, <b>qui est en fait de la classe User</b></li>
  <li>Dans le model <code>User</code>, tu dis que ce dernier has_many <code>sent_messages</code>. Ces messages envoy√©s correspondent √† la colonne <code>sender_id</code> de la classe PrivateMessage</li>
</ul>
<p>Tu vas voir que le r√©sultat est super cool car au lieu d'avoir des m√©thodes vagues <code>.users</code> et <code>.private_messages</code>, tu vas avoir des m√©thodes tr√®s explicites pour bien diff√©rencier la partie "envoi de message" (<code>.sender</code> et <code>.sent_messages</code>) de la partie "r√©ception de message" (<code>.recipient</code> et <code>.received_messages</code>).</p>

<p>On fait alors un tour en console pour illustrer tout √ßa et v√©rifier que √ßa fonctionne. √áa donne :</p>

<pre class=" language-ruby"><code class=" language-ruby"><span class="token comment">#on cr√©e deux users
</span>john <span class="token operator">=</span> <span class="token const">User</span><span class="token punctuation">.</span>create
alex <span class="token operator">=</span> <span class="token const">User</span><span class="token punctuation">.</span>create

<span class="token comment">#on cr√©e un message
</span>pm <span class="token operator">=</span> <span class="token const">PrivateMessage</span><span class="token punctuation">.</span><span class="token keyword">new</span>

<span class="token comment">#on indique qui est l'exp√©diteur et qui est le destinataire
</span>pm<span class="token punctuation">.</span>sender <span class="token operator">=</span> alex
pm<span class="token punctuation">.</span>recipient <span class="token operator">=</span> john

<span class="token comment">#maintenant on peut tester nos supers m√©thodes d'association
</span>
john<span class="token punctuation">.</span>received_messages
<span class="token comment">#=&gt; doit retourner un array contenant l'objet "pm"
</span>
alex<span class="token punctuation">.</span>sent_messages
<span class="token comment">#=&gt; doit retourner un array contenant l'objet "pm"
</span>
pm<span class="token punctuation">.</span>sender
<span class="token comment">#=&gt; evidemment, doit retourner l'objet "alex"
</span>pm<span class="token punctuation">.</span>recipient
<span class="token comment">#=&gt; evidemment, doit retourner l'objet "john"</span></code></pre>


<h3>3.2. Optional</h3>
<p>Imaginons que tu veuilles une relation 1-N entre un author et un book
 mais avec la possibilit√© qu'un book soit cr√©√© sans author. En temps 
normal, impossible&nbsp;: ActiveRecords refuserait et te renverrait des 
gros <code>ROLLBACK</code>. <br>
Pour rem√©dier √† ceci, <code>optional</code> est l√† pour toi&nbsp;! Voici comment rendre un author optionnel pour un book :</p>

<pre class=" language-ruby"><code class=" language-ruby"><span class="token keyword">class</span> <span class="token const">Book</span> &lt; <span class="token const">ApplicationRecord</span>
  belongs_to <span class="token symbol">:author</span><span class="token punctuation">,</span> optional<span class="token punctuation">:</span> <span class="token keyword">true</span>
<span class="token keyword">end</span></code></pre>

<p>Et voil√† ! Maintenant tu peux faire en console <code>Book.create</code> sans avoir peur d'un <code>ROLLBACK</code> √† la sauce claque de gitan.</p>

<h3>3.3. Dependent</h3>
<p>Dans certains cas, les associations entre tables de ta BDD sont tr√®s 
forts. Par l√†, je veux dire que si un objet dispara√Æt, l'existence des 
objets qui lui sont li√©s n'a peut-√™tre plus de sens et il serait 
pr√©f√©rable qu'ils disparaissent aussi pour ne pas polluer ta BDD. Un 
exemple&nbsp;? Les RDV entre patients et docteurs. Si un docteur vient √†
 demander √† sortir de ta BDD, il faut probablement supprimer tous les 
appointments o√π il appara√Æt (et bien s√ªr pr√©venir les patients). C'est 
le r√¥le de <code>dependent: :destroy</code> d'effectuer cette suppression automatiquement.</p>

<pre class=" language-ruby"><code class=" language-ruby"><span class="token keyword">class</span> <span class="token const">Doctors</span> &lt; <span class="token const">ApplicationRecord</span>
  has_many <span class="token symbol">:appointments</span><span class="token punctuation">,</span> dependent<span class="token punctuation">:</span> <span class="token symbol">:destroy</span>
<span class="token keyword">end</span></code></pre>

<p>Avec ces lignes, quand tu d√©truis un docteur, tu vas d√©truire les RDV qui lui sont li√©s. Dependent marche aussi avec belong_to.</p>

<h2>4. Points importants √† retenir</h2>
<ul>
  <li>Pour renommer tes m√©thodes d'association et ne pas leur donner le nom du model (ex: changer un <code>.users</code> en <code>.sender</code> ou <code>.recipient</code>), utilise <code>class_name</code></li>
  <li>Pour rendre une association en <code>belongs_to</code> optionnelle, utilise <code>optional: :true</code></li>
  <li>Pour faire des suppressions en chaine entre tables li√©es, utilise <code>dependent: :destroy</code></li>
</ul>


<h2>5. Pour aller plus loin</h2>
<p>Tous ces exemples sont tir√©s de <a href="https://guides.rubyonrails.org/association_basics.html" target="_blank">la doc</a>, cette bible de Rails qui explique tout.</p>
</div>
</div>
</div>
</div>
</div>
</div>

<div class="row">
<div class="col-12">
<div class="card">
<div class="card-header" style="border-top: 3px solid #FF4081">
<h1>
Projets : 
Petits sites de BDD relationnelles
</h1>
<a class="heading-elements-toggle">
<i class="la la-ellipsis-v font-medium-3"></i>
</a>
<div class="heading-elements">
<ul class="list-inline mb-0">
<li>
<a href="https://www.thehackingproject.org/fr/dashboard/courses/1/projects/23/project_submissions/new"><i class="ft-edit" data-original-title="Proposer une am√©lioration" data-placement="top" data-toggle="tooltip"></i>
</a></li>
<li>
<a data-action="collapse">
<i class="ft-minus"></i>
</a>
</li>
<li>
<a data-action="expand">
<i class="ft-maximize"></i>
</a>
</li>
</ul>
</div>
</div>
<div class="card-content collapse show">
<div class="card-body">
<div class="tab-pane active" id="home1" role="tabpanel">
<h2>1. Introduction</h2>
<p>Pour ce projet, nous allons te demander de cr√©er les models de 
plusieurs applications. Ce seront tes premi√®res tables avanc√©es, mais √† 
ton niveau plus rien ne t'arr√™te.</p>
<p>Pour tous ces sites, nous allons te demander de cr√©er uniquement les mod√®les, pas de views / controller. ‚úåÔ∏è<br>
Par contre n'oublie pas qu'une fois ton travail valid√© en console, tu 
dois faire un joli seeds.rb pour que les autres moussaillons puissent te
 corriger facilement.</p>
<p>Comme chaque projet chez THP, il faut le faire en pair-programming&nbsp;!</p>

<h2>2. Le projet</h2>
<h3>2.1. FreeDoc - R√©serve ton docteur </h3>
<h4>2.1.1. Le pitch</h4>
<p>Allez, on va impl√©menter pour de vrai ce concurrent de Doctolib dont 
on te parle √† longueur de ressource&nbsp;! √Ä toi d'√™tre chirurgical 
üë©‚Äç‚öïÔ∏è</p>

<h4>2.1.2. Les models</h4>
<p>Pour ce premier exercice, nous allons t'aider et te donner les models √† cr√©er :</p>

<ul>
  <li>un model <code>Doctor</code>, qui a comme attributs&nbsp;:
  <ul>
    <li>un <code>first_name</code>, qui est un string</li>
    <li>un <code>last_name</code>, qui est un string</li>
    <li>un <code>specialty</code>, qui est un string</li>
    <li>un <code>zip_code</code>, qui est un string</li>
  </ul></li>
  <li>un model <code>Patient</code>, qui a comme attributs&nbsp;:
  <ul>
    <li>un <code>first_name</code>, qui est un string</li>
    <li>un <code>last_name</code>, qui est un string</li>
  </ul></li>
  <li>un model <code>Appointment</code>, qui a comme attributs :
  <ul>
    <li>un <code>date</code>, qui est un datetime</li>
  </ul></li>
</ul>

<p>Une fois les attributs fix√©s, on s'attaque aux relations :</p>
<ul>
  <li>Un <code>appointment</code> ne peut avoir qu'un seul <code>doctor</code>, mais un <code>doctor</code> peut avoir plusieurs <code>appointment</code>.</li>
  <li>Un <code>appointment</code> ne peut avoir qu'un seul <code>patient</code>, mais un <code>patient</code> peut avoir plusieurs <code>appointment</code>.</li>
  <li>Un <code>doctor</code> peut avoir plusieurs <code>patient</code>, au travers des <code>appointments</code>, et vice versa.</li>
</ul>

<p>Je t'invite √† cr√©er les models et les migrations puis √† les passer.</p>

<h4>2.1.3. Tester</h4>
<p>Pour tester, tu peux aller dans la console, cr√©er des <code>doctor</code>, <code>patient</code>, et <code>appointment</code> √† la vol√©e, puis les lier.</p>

<div class="card box-shadow-0 border-danger">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">‚ö†Ô∏è ALERTE ERREUR COMMUNE</h4>
      <p class="card-text">Comme les <code>doctor</code> et les <code>patient</code> sont li√©s en N-N, rappelle-toi qu'un <code>patients_list = doctor_instance.patients</code> va te retourner <b>un array</b> d'objets de class <code>Patient</code>. <br>
      Si tu fais <code>patients_list.last_name</code> dessus, √ßa va te renverra une erreur car un array n'a pas de <code>last_name</code>. <br>
      Par contre tu peux faire dessus un <code>patients_list.first.last_name</code> ou <code>patients_list[0].last_name</code> üòâ.</p>
    </div>
  </div>
</div>

<p>Une fois que c'est bon, n'oublie pas le seeds.rb qui va bien.</p>

<h4>2.1.4. Petit coup de boost</h4>
<p>Ta startup de docteurs marche √† merveille, tellement que tu aimerais ajouter plusieurs tables :</p>

<ul>
  <li><code>city</code>. Chaque docteur, patient, et rendez-vous est li√© √† une <code>city</code>. Une city peut avoir plusieurs docteurs, patients, et rendez-vous.</li>
  <li>tu voudrais virer la ligne <code>specialty</code> de ta table <code>doctor</code> et la remplacer par un model √† part enti√®re&nbsp;: tu vas donc cr√©er un model <code>specialty</code>. Un docteur aurait plusieurs <code>specialty</code> (DEAL_WITH_IT), et une <code>specialty</code> pourrait concerner plusieurs <code>doctor</code>.</li>
</ul>
<p>Comme d'hab tu vas tester et tu compl√©teras le seeds.rb pour prendre en compte ces changements.</p> 
<p>Et voil√† pour FreeDoc&nbsp;! Doctolib est en PLS.</p>


<h3>2.2. Le Airbnb des promenades de chiens</h3>
<h4>2.2.1. Le pitch</h4>
<p>En cours de "Bizness Growth Money Maker", on t'avait demand√© de cr√©er
 une entreprise √† fort potentiel. √Ä l'√©poque tu t'√©tais dit que ce 
serait une chouette id√©e de faire une plateforme o√π des personnes 
pourraient promener les chiens des autres, en √©change de cash-money.</p>
<p>C'est dingue comme id√©e&nbsp;: √ßa va mettre tous les VC aux abois. Allez, on le fait&nbsp;!</p>

<h4>2.2.2. Les models</h4>
<p>√Ä priori, les models sont simples&nbsp;: il y a un model <code>dogsitter</code> et un model <code>dog</code> (on te laisse choisir au moins un attribut chacun). Un <code>dogsitter</code> peut promener plusieurs <code>dog</code> lors d'une <code>stroll</code> (promenade, en anglais)&nbsp;; et un <code>dog</code> peut avoir plusieurs <code>dogsitter</code> via les <code>stroll</code>.</p>
<p>Maintenant tu veux pr√©ciser la ville des promeneurs et des chiens 
pour faire un super algorithme de matching. Tu devras donc cr√©er un 
model <code>City</code> avec comme attribut <code>city_name</code>. 
Chaque ville contient plusieurs promeneurs et plusieurs chiens mais un 
chien et un promeneur ne peuvent appartenir qu'a une ville.</p>

<p>Cela ressemble beaucoup √† notre sch√©ma de docteurs tout ceci&nbsp;! 
C'est fait expr√®s, rien de tel pour s'entra√Æner que de refaire les 
exercices. Tu vas d√©rouler tes prochains model gr√¢ce √† √ßa.</p>

<p>Comme la derni√®re fois&nbsp;: fait un seeds.rb et teste le tout en console.</p>

<h3>2.3. The Gossip Project</h3>
<h4>2.3.1 Le pitch</h4>

<p>Allez, on va poser les bases de notre fameux Gossip Project pour le 
transcrire en Rails. Et comme je te l'ai expliqu√©, la premi√®re √©tape est
 la mod√©lisation de sa BDD&nbsp;! <br>
Le parcours utilisateur est le suivant&nbsp;: sur ce super r√©seau 
social, un utilisateur va s'inscrire, renseigner son pr√©nom et nom, son 
mail et son age, puis il pr√©cisera sa ville avec une recherche par code 
postal. <br>
Il aura ensuite toutes les fonctionnalit√©s qui feront de cette appli une future licorne de la Bitchin'Tech&nbsp;: </p>
<ul>
<li>Les utilisateurs peuvent cr√©er des potins&nbsp;: "askip john est c√©lib hihi"</li>
<li>Les utilisateurs, en cr√©ant des potins, peuvent mettre un ou plusieurs tags sur les potins&nbsp;: #romance </li>
<li>Les utilisateurs peuvent commenter des potins&nbsp;: "ahiii j'sav√© pa lol ptdr üíÅ‚Äç‚ôÇÔ∏è"</li>
<li>Et puisque ton appli doit respecter les standards de l'industrie, on
 va faire en sorte qu'il soit possible aussi de commenter des 
commentaires.</li>
<li>Les utilisateurs peuvent liker des potins.</li>
<li>Les utilisateurs peuvent contacter leur comm√®res favoris en MP pour obtenir des exclus mondiales.</li>
</ul>

<p>L'utilisateur pourra donc rechercher les potins par ville, par 
utilisateurs, par date (plus r√©cent ou plus ancien), par nombre de 
likes, par tags, pour trouver les potins les plus croustillants.</p>
<p><b>√áa fait beaucoup&nbsp;??</b> Oui clairement, y a de la fonctionnalit√© de d√©glingos l√†. Pas de panique. On va te guider&nbsp;! Suis-nous.</p>

<h4>2.3.2. Dessine-moi une BDD </h4>
<p>Allez, feuille / tableau / ERD en main et hop! =&gt; Imagine les 
models qu'il faut pour cette app, les relations possibles, puis 
√©videmment les attributs de chaque model. Toute l'architecture de la BDD
 doit tenir sur un dessin que vous allez faire en √©quipe. C'est un 
excellent entra√Ænement au projet final üòá</p>

<p>Une fois que c'est fait, on va te guider et tu vas pouvoir comparer ton sch√©ma √† notre pas √† pas.</p>

<h4>2.3.3. Les models</h4>

<h5>a) LES BASES</h5>
<p>Commence par cr√©er une application Rails, puis mets les bonnes versions de Ruby et Rails dans le Gemfile.</p>

<h5>b) LES USERS</h5>
<p>Cr√©e une classe <code>User</code>, qui aura comme attributs :</p>

<ul>
  <li>Un <code>first_name</code>, qui est un string</li>
  <li>Un <code>last_name</code>, qui est un string</li>
  <li>Un <code>description</code>, qui est un text</li>
  <li>Un <code>email</code>, qui est un string</li>
  <li>Un <code>age</code>, qui est un integer</li>
</ul>

<p>Tu vas faire 10 utilisateurs en base avec Faker.</p>

<h5>c) LES VILLES</h5>
<p>Cr√©e une classe <code>City</code>, qui aura comme attributs :</p>

<ul>
  <li>Un <code>name</code>, qui est un string</li>
  <li>Un <code>zip_code</code>, qui est un string</li>
</ul>
<p>Un utilisateur appartient √† une seule ville mais une ville peut contenir plusieurs utilisateurs. <br>
Tu vas faire 10 villes en base avec Faker et les lier avec les utilisateurs du seed.</p>

<h5>d) LES GOSSIPS</h5>
<p>Cr√©e une classe <code>Gossip</code>, qui aura comme attributs :</p>

<ul>
  <li>Un <code>title</code>, qui est un string</li>
  <li>Un <code>content</code>, qui est un text</li>
</ul>
<p>Un utilisateur peut √©crire plusieurs gossips mais un gossip ne peut √™tre √©crit que par un seul utilisateur. <br>
Tu vas faire 20 gossips en base avec Faker et les lier avec leur auteur.</p>

<h5>e) LES TAGS</h5>
<p>Cr√©e une classe <code>Tag</code>, qui aura comme attributs :</p>
<ul>
  <li>Un <code>title</code>, qui est un string</li>
</ul>
<p>Un gossip peut avoir plusieurs tags et un tag peut √™tre pr√©sent sur plusieurs gossip (genre #bromance). <br>
Tu vas faire 10 tags en base avec Faker. Chaque gossip aura (au minimum) un tag.</p>

<h5>f) LES MESSAGES PRIV√âS</h5>
<p>Cr√©e une classe <code>PrivateMessage</code>, qui aura comme attributs :</p>

<ul>
  <li>Un <code>content</code>, qui est un text</li>
</ul>
<p>Un PM aura un exp√©diteur et un (ou plusieurs) destinataires. <br>
Tu vas faire quelques PM en base avec Faker et leur donner un exp√©diteur et un (ou plusieurs) destinataires.</p>

<p>Bravo si t'es arriv√© jusque-l√† ! <br>
  <b>=== Les exercices ci-dessous sont optionnels et ne seront pas √©valu√© ===</b></p>

<h5>g) LES COMMENTAIRES</h5>
<p>Cr√©e une classe <code>Comment</code>, qui aura comme attributs :</p>
<ul>
  <li>Un <code>content</code>, qui est un text</li>
</ul>
<p>Un gossip peut avoir plusieurs commentaires mais un commentaire ne peut correspondre qu'a un gossip pr√©cis. <br>
Les utilisateurs peuvent √©crire plusieurs commentaires mais un commentaire n'a qu'un seul auteur. <br>
Tu vas faire 20 commentaires en base avec Faker et les lier avec leur auteur et le gossip associ√©.</p>

<h5>h) LES LIKES</h5>
<p>Cr√©e une classe <code>like</code>, qui n'aura pas d'attributs. <br>
Un utilisateur peut mettre des likes sur des gossips ou des commentaires. <br>
Tu vas faire 20 likes en base avec Faker en les mettant √† des commentaires ou des gossips au hasard. </p>
<h5>i) LES COMMENTAIRES (BIS)</h5>
<p>
Pour les chauds de la BDD, vous pouvez faire du commentaire de commentaires. Indice <code>polymorphism</code>.
Bien s√ªr, ton seed fera des commentaires de commentaires ü§ì</p>


<h2>3. Rendu attendu</h2>
<p>3 applications Rails, chacune dans un lien GitHub. En gros 3 r√©po GitHub diff√©rents.<br>
Les standards habituels sont √† respecter (Gemfile, README) mais en plus on veut des jolis seeds.</p>
</div>
</div>
</div>
</div>
</div>
</div>

</div>

      </div>
    </div>

    <div class="thp-flashes"></div>



    <script src="s5j4_fichiers/dashboard-6681459c92372465340c.js"></script>
    <script charset="utf-8">
      $('input[name=authenticity_token]').val($('meta[name=csrf-token]').attr('content'));
    </script>

  


<script type="text/javascript" id="hs-script-loader" src="s5j4_fichiers/9310539.js"></script><script type="text/javascript" id="">(function(e,c){if(!c.__SV){var l,h;window.mixpanel=c;c._i=[];c.init=function(q,r,f){function t(d,a){var g=a.split(".");2==g.length&&(d=d[g[0]],a=g[1]);d[a]=function(){d.push([a].concat(Array.prototype.slice.call(arguments,0)))}}var b=c;"undefined"!==typeof f?b=c[f]=[]:f="mixpanel";b.people=b.people||[];b.toString=function(d){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);d||(a+=" (stub)");return a};b.people.toString=function(){return b.toString(1)+".people (stub)"};l="disable time_event track track_pageview track_links track_forms track_with_groups add_group set_group remove_group register register_once alias unregister identify name_tag set_config reset opt_in_tracking opt_out_tracking has_opted_in_tracking has_opted_out_tracking clear_opt_in_out_tracking start_batch_senders people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user people.remove".split(" ");
for(h=0;h<l.length;h++)t(b,l[h]);var n="set set_once union unset remove delete".split(" ");b.get_group=function(){function d(p){a[p]=function(){call2_args=arguments;call2=[p].concat(Array.prototype.slice.call(call2_args,0));b.push([g,call2])}}for(var a={},g=["get_group"].concat(Array.prototype.slice.call(arguments,0)),m=0;m<n.length;m++)d(n[m]);return a};c._i.push([q,r,f])};c.__SV=1.2;var k=e.createElement("script");k.type="text/javascript";k.async=!0;k.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?
MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";e=e.getElementsByTagName("script")[0];e.parentNode.insertBefore(k,e)}})(document,window.mixpanel||[]);mixpanel.init("ab79c62023f2a925bfe5f7922c70de67");mixpanel.track("Sign up");</script>
<script type="text/javascript" id="">!function(){var a=window.analytics=window.analytics||[];if(!a.initialize)if(a.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{a.invoked=!0;a.methods="trackSubmit trackClick trackLink trackForm pageview identify reset group track ready alias debug page once off on addSourceMiddleware addIntegrationMiddleware setAnonymousId addDestinationMiddleware".split(" ");a.factory=function(b){return function(){var c=Array.prototype.slice.call(arguments);c.unshift(b);
a.push(c);return a}};for(var e=0;e<a.methods.length;e++){var f=a.methods[e];a[f]=a.factory(f)}a.load=function(b,c){var d=document.createElement("script");d.type="text/javascript";d.async=!0;d.src="https://cdn.segment.com/analytics.js/v1/"+b+"/analytics.min.js";b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(d,b);a._loadOptions=c};a._writeKey="HDfubo7D6T7lk8XiL2HZi2hZvIVFuK8j";a.SNIPPET_VERSION="4.13.2";a.load("HDfubo7D6T7lk8XiL2HZi2hZvIVFuK8j");a.page()}}();</script>

<iframe style="display: none; visibility: hidden;" owner="archetype" title="archetype"></iframe></body></html>