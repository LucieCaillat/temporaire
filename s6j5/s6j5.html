<!DOCTYPE html>
<html class="loaded" lang="fr"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<script type="text/javascript" src="s6j5_fichiers/NRJS-71f55aa980e498e276b"></script><script type="text/javascript" async="" src="s6j5_fichiers/insight.js"></script><script src="s6j5_fichiers/nr-1212.js"></script><script type="text/javascript" async="" src="s6j5_fichiers/gtm_002.js"></script><script type="text/javascript" src="s6j5_fichiers/commons.js" async="" status="loaded"></script><script type="text/javascript" src="s6j5_fichiers/google-tag-manager.js" async="" status="loaded"></script><script type="text/javascript" async="" src="s6j5_fichiers/analytics.js"></script><script type="text/javascript" async="" src="s6j5_fichiers/mixpanel-2-latest.js"></script><script type="text/javascript" async="" src="s6j5_fichiers/conversion_async.js"></script><script src="s6j5_fichiers/conversations-embed.js" type="text/javascript" id="hubspot-messages-loader" data-loader="hs-scriptloader" data-hsjs-portal="9310539" data-hsjs-env="prod" data-hsjs-hublet="na1"></script><script src="s6j5_fichiers/9310539.js" type="text/javascript" id="hs-analytics"></script><script src="s6j5_fichiers/9310539_003.js" type="text/javascript" id="cookieBanner-9310539" data-cookieconsent="ignore" data-hs-ignore="true" data-loader="hs-scriptloader" data-hsjs-portal="9310539" data-hsjs-env="prod" data-hsjs-hublet="na1"></script><script src="s6j5_fichiers/fb.js" type="text/javascript" id="hs-ads-pixel-9310539" data-ads-portal-id="9310539" data-ads-env="prod" data-loader="hs-scriptloader" data-hsjs-portal="9310539" data-hsjs-env="prod" data-hsjs-hublet="na1"></script><script src="s6j5_fichiers/collectedforms.js" type="text/javascript" id="CollectedForms-9310539" crossorigin="anonymous" data-leadin-portal-id="9310539" data-leadin-env="prod" data-loader="hs-scriptloader" data-hsjs-portal="9310539" data-hsjs-env="prod" data-hsjs-hublet="na1"></script><script src="s6j5_fichiers/leadflows.js" type="text/javascript" id="LeadFlows-9310539" crossorigin="anonymous" data-leadin-portal-id="9310539" data-leadin-env="prod" data-loader="hs-scriptloader" data-hsjs-portal="9310539" data-hsjs-env="prod" data-hsjs-hublet="na1"></script><script async="" crossorigin="anonymous" src="s6j5_fichiers/fs.js"></script><script src="s6j5_fichiers/773401719499556.js" async=""></script><script async="" src="s6j5_fichiers/fbevents.js"></script><script async="" src="s6j5_fichiers/gtm.js"></script><script type="text/javascript" async="" src="s6j5_fichiers/analytics_002.js"></script><script>window.NREUM||(NREUM={});NREUM.info={"beacon":"bam.nr-data.net","errorBeacon":"bam.nr-data.net","licenseKey":"NRJS-71f55aa980e498e276b","applicationID":"576835834","transactionName":"dgpYEBRYDg9XQh8AA0YNVAsHRQZMVlFJF01GDVkT","queueTime":0,"applicationTime":1681,"agent":""}</script>
<script>(window.NREUM||(NREUM={})).init={ajax:{deny_list:["bam.nr-data.net"]}};(window.NREUM||(NREUM={})).loader_config={licenseKey:"NRJS-71f55aa980e498e276b",applicationID:"576835834"};window.NREUM||(NREUM={}),__nr_require=function(t,e,n){function r(n){if(!e[n]){var i=e[n]={exports:{}};t[n][0].call(i.exports,function(e){var i=t[n][1][e];return r(i||e)},i,i.exports)}return e[n].exports}if("function"==typeof __nr_require)return __nr_require;for(var i=0;i<n.length;i++)r(n[i]);return r}({1:[function(t,e,n){function r(){}function i(t,e,n,r){return function(){return s.recordSupportability("API/"+e+"/called"),o(t+e,[u.now()].concat(c(arguments)),n?null:this,r),n?void 0:this}}var o=t("handle"),a=t(10),c=t(11),f=t("ee").get("tracer"),u=t("loader"),s=t(4),d=NREUM;"undefined"==typeof window.newrelic&&(newrelic=d);var p=["setPageViewName","setCustomAttribute","setErrorHandler","finished","addToTrace","inlineHit","addRelease"],l="api-",v=l+"ixn-";a(p,function(t,e){d[e]=i(l,e,!0,"api")}),d.addPageAction=i(l,"addPageAction",!0),d.setCurrentRouteName=i(l,"routeName",!0),e.exports=newrelic,d.interaction=function(){return(new r).get()};var m=r.prototype={createTracer:function(t,e){var n={},r=this,i="function"==typeof e;return o(v+"tracer",[u.now(),t,n],r),function(){if(f.emit((i?"":"no-")+"fn-start",[u.now(),r,i],n),i)try{return e.apply(this,arguments)}catch(t){throw f.emit("fn-err",[arguments,this,t],n),t}finally{f.emit("fn-end",[u.now()],n)}}}};a("actionText,setName,setAttribute,save,ignore,onEnd,getContext,end,get".split(","),function(t,e){m[e]=i(v,e)}),newrelic.noticeError=function(t,e){"string"==typeof t&&(t=new Error(t)),s.recordSupportability("API/noticeError/called"),o("err",[t,u.now(),!1,e])}},{}],2:[function(t,e,n){function r(t){if(NREUM.init){for(var e=NREUM.init,n=t.split("."),r=0;r<n.length-1;r++)if(e=e[n[r]],"object"!=typeof e)return;return e=e[n[n.length-1]]}}e.exports={getConfiguration:r}},{}],3:[function(t,e,n){var r=!1;try{var i=Object.defineProperty({},"passive",{get:function(){r=!0}});window.addEventListener("testPassive",null,i),window.removeEventListener("testPassive",null,i)}catch(o){}e.exports=function(t){return r?{passive:!0,capture:!!t}:!!t}},{}],4:[function(t,e,n){function r(t,e){var n=[a,t,{name:t},e];return o("storeMetric",n,null,"api"),n}function i(t,e){var n=[c,t,{name:t},e];return o("storeEventMetrics",n,null,"api"),n}var o=t("handle"),a="sm",c="cm";e.exports={constants:{SUPPORTABILITY_METRIC:a,CUSTOM_METRIC:c},recordSupportability:r,recordCustom:i}},{}],5:[function(t,e,n){function r(){return c.exists&&performance.now?Math.round(performance.now()):(o=Math.max((new Date).getTime(),o))-a}function i(){return o}var o=(new Date).getTime(),a=o,c=t(12);e.exports=r,e.exports.offset=a,e.exports.getLastTimestamp=i},{}],6:[function(t,e,n){function r(t){return!(!t||!t.protocol||"file:"===t.protocol)}e.exports=r},{}],7:[function(t,e,n){function r(t,e){var n=t.getEntries();n.forEach(function(t){"first-paint"===t.name?p("timing",["fp",Math.floor(t.startTime)]):"first-contentful-paint"===t.name&&p("timing",["fcp",Math.floor(t.startTime)])})}function i(t,e){var n=t.getEntries();if(n.length>0){var r=n[n.length-1];if(f&&f<r.startTime)return;p("lcp",[r])}}function o(t){t.getEntries().forEach(function(t){t.hadRecentInput||p("cls",[t])})}function a(t){if(t instanceof g&&!y){var e=Math.round(t.timeStamp),n={type:t.type};e<=l.now()?n.fid=l.now()-e:e>l.offset&&e<=Date.now()?(e-=l.offset,n.fid=l.now()-e):e=l.now(),y=!0,p("timing",["fi",e,n])}}function c(t){"hidden"===t&&(f=l.now(),p("pageHide",[f]))}if(!("init"in NREUM&&"page_view_timing"in NREUM.init&&"enabled"in NREUM.init.page_view_timing&&NREUM.init.page_view_timing.enabled===!1)){var f,u,s,d,p=t("handle"),l=t("loader"),v=t(9),m=t(3),g=NREUM.o.EV;if("PerformanceObserver"in window&&"function"==typeof window.PerformanceObserver){u=new PerformanceObserver(r);try{u.observe({entryTypes:["paint"]})}catch(h){}s=new PerformanceObserver(i);try{s.observe({entryTypes:["largest-contentful-paint"]})}catch(h){}d=new PerformanceObserver(o);try{d.observe({type:"layout-shift",buffered:!0})}catch(h){}}if("addEventListener"in document){var y=!1,w=["click","keydown","mousedown","pointerdown","touchstart"];w.forEach(function(t){document.addEventListener(t,a,m(!1))})}v(c)}},{}],8:[function(t,e,n){function r(t,e){if(!i)return!1;if(t!==i)return!1;if(!e)return!0;if(!o)return!1;for(var n=o.split("."),r=e.split("."),a=0;a<r.length;a++)if(r[a]!==n[a])return!1;return!0}var i=null,o=null,a=/Version\/(\S+)\s+Safari/;if(navigator.userAgent){var c=navigator.userAgent,f=c.match(a);f&&c.indexOf("Chrome")===-1&&c.indexOf("Chromium")===-1&&(i="Safari",o=f[1])}e.exports={agent:i,version:o,match:r}},{}],9:[function(t,e,n){function r(t){function e(){t(c&&document[c]?document[c]:document[o]?"hidden":"visible")}"addEventListener"in document&&a&&document.addEventListener(a,e,i(!1))}var i=t(3);e.exports=r;var o,a,c;"undefined"!=typeof document.hidden?(o="hidden",a="visibilitychange",c="visibilityState"):"undefined"!=typeof document.msHidden?(o="msHidden",a="msvisibilitychange"):"undefined"!=typeof document.webkitHidden&&(o="webkitHidden",a="webkitvisibilitychange",c="webkitVisibilityState")},{}],10:[function(t,e,n){function r(t,e){var n=[],r="",o=0;for(r in t)i.call(t,r)&&(n[o]=e(r,t[r]),o+=1);return n}var i=Object.prototype.hasOwnProperty;e.exports=r},{}],11:[function(t,e,n){function r(t,e,n){e||(e=0),"undefined"==typeof n&&(n=t?t.length:0);for(var r=-1,i=n-e||0,o=Array(i<0?0:i);++r<i;)o[r]=t[e+r];return o}e.exports=r},{}],12:[function(t,e,n){e.exports={exists:"undefined"!=typeof window.performance&&window.performance.timing&&"undefined"!=typeof window.performance.timing.navigationStart}},{}],ee:[function(t,e,n){function r(){}function i(t){function e(t){return t&&t instanceof r?t:t?u(t,f,a):a()}function n(n,r,i,o,a){if(a!==!1&&(a=!0),!l.aborted||o){t&&a&&t(n,r,i);for(var c=e(i),f=m(n),u=f.length,s=0;s<u;s++)f[s].apply(c,r);var p=d[w[n]];return p&&p.push([b,n,r,c]),c}}function o(t,e){y[t]=m(t).concat(e)}function v(t,e){var n=y[t];if(n)for(var r=0;r<n.length;r++)n[r]===e&&n.splice(r,1)}function m(t){return y[t]||[]}function g(t){return p[t]=p[t]||i(n)}function h(t,e){l.aborted||s(t,function(t,n){e=e||"feature",w[n]=e,e in d||(d[e]=[])})}var y={},w={},b={on:o,addEventListener:o,removeEventListener:v,emit:n,get:g,listeners:m,context:e,buffer:h,abort:c,aborted:!1};return b}function o(t){return u(t,f,a)}function a(){return new r}function c(){(d.api||d.feature)&&(l.aborted=!0,d=l.backlog={})}var f="nr@context",u=t("gos"),s=t(10),d={},p={},l=e.exports=i();e.exports.getOrSetContext=o,l.backlog=d},{}],gos:[function(t,e,n){function r(t,e,n){if(i.call(t,e))return t[e];var r=n();if(Object.defineProperty&&Object.keys)try{return Object.defineProperty(t,e,{value:r,writable:!0,enumerable:!1}),r}catch(o){}return t[e]=r,r}var i=Object.prototype.hasOwnProperty;e.exports=r},{}],handle:[function(t,e,n){function r(t,e,n,r){i.buffer([t],r),i.emit(t,e,n)}var i=t("ee").get("handle");e.exports=r,r.ee=i},{}],id:[function(t,e,n){function r(t){var e=typeof t;return!t||"object"!==e&&"function"!==e?-1:t===window?0:a(t,o,function(){return i++})}var i=1,o="nr@id",a=t("gos");e.exports=r},{}],loader:[function(t,e,n){function r(){if(!T++){var t=P.info=NREUM.info,e=g.getElementsByTagName("script")[0];if(setTimeout(u.abort,3e4),!(t&&t.licenseKey&&t.applicationID&&e))return u.abort();f(O,function(e,n){t[e]||(t[e]=n)});var n=a();c("mark",["onload",n+P.offset],null,"api"),c("timing",["load",n]);var r=g.createElement("script");0===t.agent.indexOf("http://")||0===t.agent.indexOf("https://")?r.src=t.agent:r.src=v+"://"+t.agent,e.parentNode.insertBefore(r,e)}}function i(){"complete"===g.readyState&&o()}function o(){c("mark",["domContent",a()+P.offset],null,"api")}var a=t(5),c=t("handle"),f=t(10),u=t("ee"),s=t(8),d=t(6),p=t(2),l=t(3),v=p.getConfiguration("ssl")===!1?"http":"https",m=window,g=m.document,h="addEventListener",y="attachEvent",w=m.XMLHttpRequest,b=w&&w.prototype,E=!d(m.location);NREUM.o={ST:setTimeout,SI:m.setImmediate,CT:clearTimeout,XHR:w,REQ:m.Request,EV:m.Event,PR:m.Promise,MO:m.MutationObserver};var x=""+location,O={beacon:"bam.nr-data.net",errorBeacon:"bam.nr-data.net",agent:"js-agent.newrelic.com/nr-1212.min.js"},M=w&&b&&b[h]&&!/CriOS/.test(navigator.userAgent),P=e.exports={offset:a.getLastTimestamp(),now:a,origin:x,features:{},xhrWrappable:M,userAgent:s,disabled:E};if(!E){t(1),t(7),g[h]?(g[h]("DOMContentLoaded",o,l(!1)),m[h]("load",r,l(!1))):(g[y]("onreadystatechange",i),m[y]("onload",r)),c("mark",["firstbyte",a.getLastTimestamp()],null,"api");var T=0}},{}],"wrap-function":[function(t,e,n){function r(t,e){function n(e,n,r,f,u){function nrWrapper(){var o,a,s,p;try{a=this,o=d(arguments),s="function"==typeof r?r(o,a):r||{}}catch(l){i([l,"",[o,a,f],s],t)}c(n+"start",[o,a,f],s,u);try{return p=e.apply(a,o)}catch(v){throw c(n+"err",[o,a,v],s,u),v}finally{c(n+"end",[o,a,p],s,u)}}return a(e)?e:(n||(n=""),nrWrapper[p]=e,o(e,nrWrapper,t),nrWrapper)}function r(t,e,r,i,o){r||(r="");var c,f,u,s="-"===r.charAt(0);for(u=0;u<e.length;u++)f=e[u],c=t[f],a(c)||(t[f]=n(c,s?f+r:r,i,f,o))}function c(n,r,o,a){if(!v||e){var c=v;v=!0;try{t.emit(n,r,o,e,a)}catch(f){i([f,n,r,o],t)}v=c}}return t||(t=s),n.inPlace=r,n.flag=p,n}function i(t,e){e||(e=s);try{e.emit("internal-error",t)}catch(n){}}function o(t,e,n){if(Object.defineProperty&&Object.keys)try{var r=Object.keys(t);return r.forEach(function(n){Object.defineProperty(e,n,{get:function(){return t[n]},set:function(e){return t[n]=e,e}})}),e}catch(o){i([o],n)}for(var a in t)l.call(t,a)&&(e[a]=t[a]);return e}function a(t){return!(t&&t instanceof Function&&t.apply&&!t[p])}function c(t,e){var n=e(t);return n[p]=t,o(t,n,s),n}function f(t,e,n){var r=t[e];t[e]=c(r,n)}function u(){for(var t=arguments.length,e=new Array(t),n=0;n<t;++n)e[n]=arguments[n];return e}var s=t("ee"),d=t(11),p="nr@original",l=Object.prototype.hasOwnProperty,v=!1;e.exports=r,e.exports.wrapFunction=c,e.exports.wrapInPlace=f,e.exports.argsToArray=u},{}]},{},["loader"]);</script>
    <meta name="viewport" content="width=device-width, user-scalable=no">

    <meta name="csrf-param" content="authenticity_token">
<meta name="csrf-token" content="Q0OYoex1kN0fYEDZDbDboZnLWLc+OVs8+F9q9VBM2kow07aFQ5XH7NcxNgjNoWI9PZWrgRCYvnvh+C3BGRp+1g==">
    <title>Le tableau de bord | The Hacking Project</title>
<meta name="description" content="Nous cassons les codes de l'éducation, vous apprenez d'où vous voulez, en communauté.">
<meta name="robots" content="noindex, nofollow">
<meta property="og:title" content="Le tableau de bord">
<meta property="og:site_name" content="The Hacking Project">
<meta name="url" content="https://www.thehackingproject.org/fr/dashboard/courses/1/weeks/3/days/5">
<meta name="image" content="https://www.thehackingproject.org/packs/images/logo/20210910-THP-Logo_color_transparent-31229dd881904e010092de63be97cdfa.png">


    <link rel="apple-touch-icon" sizes="180x180" href="https://www.thehackingproject.org/assets/favicon/apple-touch-icon-c01aaccf467f7cc3d79bbce743d60779f5b833fdc4500cebd07a5e11a07a5c31.png">
<link rel="apple-touch-icon" sizes="120x120" href="https://www.thehackingproject.org/assets/favicon/apple-touch-icon-120x120-precomposed-372de868f08319961b72ba7e3b1ed7121e75e29c8294334cb2c911409ea18131.png">
<link rel="apple-touch-icon" sizes="120x120" href="https://www.thehackingproject.org/assets/favicon/apple-touch-icon-120x120-372de868f08319961b72ba7e3b1ed7121e75e29c8294334cb2c911409ea18131.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://www.thehackingproject.org/assets/favicon/favicon-32x32-804b12d1c41c60fe721477b7c3b0a32811dc610580dd40ac92f1cc04cbd05ca4.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://www.thehackingproject.org/assets/favicon/favicon-16x16-d96ba65e5785d32474df9ebc6fbfd5442c751d527b10981a474bc3b7a4079d01.png">
<link rel="manifest" href="https://www.thehackingproject.org/assets/favicon/manifest-cf975201fd8ac78a1f1a203357573d50031f1cc33436d099743df6428b8a38a2.json">
<link rel="mask-icon" href="https://www.thehackingproject.org/assets/favicon/safari-pinned-tab-8af1cfcf7525ccdccb490f9f5adad396653a4969b419e0a9a9d3a1088140a912.svg" color="#5bbad5">
<link rel="shortcut icon" href="https://www.thehackingproject.org/assets/favicon/favicon-cbf10361dc90b277565960736d4897fddef5468bff6299811ea9498459d56d21.ico">
<meta name="msapplication-config" content="/assets/favicon/browserconfig-dab38db6040ef54ac56e91fdd77e3d7b06746a634e87b68c99b59b216cb8611a.xml">
<meta name="theme-color" content="#ffffff">

    <link rel="stylesheet" media="screen" href="s6j5_fichiers/vendor-dab9e12f0ba58215899de05f149caa5f.css">
    <link rel="stylesheet" media="screen" href="s6j5_fichiers/dashboard-4ab6ba9737cbfc4c38b17a9a4de7833a.css">
    <link rel="stylesheet" media="screen" href="s6j5_fichiers/dashboard-ea5a94b9045ccb8d8ce8974b71b640603915dc183d5907c643.css">
    <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async="" src="s6j5_fichiers/js.js"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-105991867-1');
  </script>
<!-- End Google Analytics -->

<!-- Google Tag Manager -->
<script>
  (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer',"GTM-P8XRQ3M");
</script>
<!-- End Google Tag Manager -->

<!-- Facebook Pixel Code -->
    <script>
        !function(f,b,e,v,n,t,s)
        {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
        n.callMethod.apply(n,arguments):n.queue.push(arguments)};
        if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
        n.queue=[];t=b.createElement(e);t.async=!0;
        t.src=v;s=b.getElementsByTagName(e)[0];
        s.parentNode.insertBefore(t,s)}(window,document,'script',
        'https://connect.facebook.net/en_US/fbevents.js');
         fbq('init', '773401719499556');
        fbq('track', 'PageView');
    </script>
    <noscript>
     <img height="1" width="1"
    src="https://www.facebook.com/tr?id=773401719499556&ev=PageView
    &noscript=1"/>
    </noscript>
<!-- End Facebook Pixel Code -->

<script>
window['_fs_debug'] = false;
window['_fs_host'] = 'fullstory.com';
window['_fs_script'] = 'edge.fullstory.com/s/fs.js';
window['_fs_org'] = '14AEET';
window['_fs_namespace'] = 'FS';
(function(m,n,e,t,l,o,g,y){
    if (e in m) {if(m.console && m.console.log) { m.console.log('FullStory namespace conflict. Please set window["_fs_namespace"].');} return;}
    g=m[e]=function(a,b,s){g.q?g.q.push([a,b,s]):g._api(a,b,s);};g.q=[];
    o=n.createElement(t);o.async=1;o.crossOrigin='anonymous';o.src='https://'+_fs_script;
    y=n.getElementsByTagName(t)[0];y.parentNode.insertBefore(o,y);
    g.identify=function(i,v,s){g(l,{uid:i},s);if(v)g(l,v,s)};g.setUserVars=function(v,s){g(l,v,s)};g.event=function(i,v,s){g('event',{n:i,p:v},s)};
    g.anonymize=function(){g.identify(!!0)};
    g.shutdown=function(){g("rec",!1)};g.restart=function(){g("rec",!0)};
    g.log = function(a,b){g("log",[a,b])};
    g.consent=function(a){g("consent",!arguments.length||a)};
    g.identifyAccount=function(i,v){o='account';v=v||{};v.acctId=i;g(o,v)};
    g.clearUserCookie=function(){};
    g.setVars=function(n, p){g('setVars',[n,p]);};
    g._w={};y='XMLHttpRequest';g._w[y]=m[y];y='fetch';g._w[y]=m[y];
    if(m[y])m[y]=function(){return g._w[y].apply(this,arguments)};
    g._v="1.3.0";
})(window,document,window['_fs_namespace'],'script','user');
</script>
<!-- Start of HubSpot Embed Code -->
<script async="" defer="defer" id="hs-script-loader" src="s6j5_fichiers/9310539_002.js" type="text/javascript"></script>
<!-- End of HubSpot Embed Code -->


    <script src="s6j5_fichiers/thp-3cc5aa6fdf57842a7b6c714621cc7f2d3d31b51cb700b1de4e795d773.js"></script>
    <script src="s6j5_fichiers/manifest-1613feea780cfc5342f4.js"></script>
    <script src="s6j5_fichiers/vendor-ff3cb5540e737de52c97.js"></script>
    <script src="s6j5_fichiers/dashboard-25875e14460b4458b1bccffaa93d4a8cbee9691b06d54976fde.js"></script>

    <link href="s6j5_fichiers/css.css" rel="stylesheet">
  <script src="s6j5_fichiers/a"></script></head>

  <body class="vertical-layout 2-columns fixed-navbar menu-hide vertical-overlay-menu" data-open="click" data-menu="vertical-menu" data-color="bg-gradient-x-primary-blue" data-col="2-columns" data-thp-controller="days" data-thp-action="show" data-thp-layout="dashboard"><style type="text/css">html.hs-messages-widget-open.hs-messages-mobile,html.hs-messages-widget-open.hs-messages-mobile body{overflow:hidden!important;position:relative!important}html.hs-messages-widget-open.hs-messages-mobile body{height:100%!important;margin:0!important}#hubspot-messages-iframe-container{display:initial!important;z-index:2147483647;position:fixed!important;bottom:0!important}#hubspot-messages-iframe-container.widget-align-left{left:0!important}#hubspot-messages-iframe-container.widget-align-right{right:0!important}#hubspot-messages-iframe-container.internal{z-index:1016}#hubspot-messages-iframe-container.internal iframe{min-width:108px}#hubspot-messages-iframe-container .shadow-container{display:initial!important;z-index:-1;position:absolute;width:0;height:0;bottom:0;content:""}#hubspot-messages-iframe-container .shadow-container.internal{display:none!important}#hubspot-messages-iframe-container .shadow-container.active{width:400px;height:400px}#hubspot-messages-iframe-container iframe{display:initial!important;width:100%!important;height:100%!important;border:none!important;position:absolute!important;bottom:0!important;right:0!important;background:transparent!important}</style>
    <!-- Google Tag Manager (noscript) -->
<noscript>
<iframe height='0' src='https://www.googletagmanager.com/ns.html?id=GTM-P8XRQ3M' style='display:none;visibility:hidden' width='0'></iframe>
</noscript>
<!-- End Google Tag Manager (noscript) -->



    <nav class="header-navbar navbar-expand-md navbar navbar-with-menu navbar-without-dd-arrow fixed-top navbar-semi-light" style="padding:0;">
<div class="navbar-wrapper">
<div class="navbar-container content">
<div class="collapse navbar-collapse show" id="navbar-mobile">
<ul class="nav navbar-nav mr-auto float-left">
<li class="nav-item mobile-menu d-md-none mr-auto">
<a class="nav-link nav-menu-main menu-toggle hidden-xs" href="#">
<i class="ft-menu font-large-1"></i>
</a>
</li>
<li class="nav-item d-none d-md-block">
<a class="nav-link nav-menu-main menu-toggle hidden-xs" href="#">
<i class="ft-menu"></i>
</a>
</li>
</ul>
<ul class="nav navbar-nav float-right">
<li class="dropdown dropdown-user nav-item">
<a class="dropdown-toggle nav-link dropdown-user-link" data-toggle="dropdown" href="#">
<span class="avatar avatar-online">

<img alt="avatar" style="max-height: 40px!important; width: auto" class="rounded-circle img-border" src="s6j5_fichiers/default_profile-a3318a5e66467f9958f16a172f9d15d6.jpg">

</span>
</a>
<div class="dropdown-menu dropdown-menu-right">
<div class="arrow_box_right">
<a class="dropdown-toggle nav-link dropdown-user-link" href="https://www.thehackingproject.org/fr/dashboard/profile/user"><span class="avatar avatar-online pt-0">

<img alt="avatar" style="max-height: 40px!important; width: auto" class="rounded-circle img-border" src="s6j5_fichiers/default_profile-a3318a5e66467f9958f16a172f9d15d6.jpg">

</span>
<span class="user-name text-bold-700 ml-1 text-dark">
Lucie
</span>
</a><div class="dropdown-divider"></div>
<a class="dropdown-item" href="https://www.thehackingproject.org/fr/dashboard/profile/user/edit"><i class="ft-edit"></i>Éditer profil
</a><div class="dropdown-divider"></div>
<a class="dropdown-item" href="https://www.thehackingproject.org/fr/dashboard/profile/user/edit?edit=danger"><i class="ft-alert-triangle"></i>Zone à risques
</a><div class="dropdown-divider"></div>
<a class="dropdown-item" rel="nofollow" data-method="delete" href="https://www.thehackingproject.org/users/sign_out?locale=fr"><i class="ft-power"></i>
Déconnexion
</a></div>
</div>
</li>
</ul>
</div>
</div>
</div>
</nav>

      <div class="main-menu menu-fixed menu-light menu-accordion menu-shadow" data-scroll-to-active="true">
<div class="navbar-header">
<ul class="nav navbar-nav flex-row">
<li class="nav-item mr-auto">
<a class="navbar-brand" href="https://www.thehackingproject.org/?locale=fr"><h3 class="brand-text">The Hacking Project</h3>
</a></li>
<li class="nav-item d-md-none">
<a class="nav-link close-navbar">
<i class="ft-x"></i>
</a>
</li>
</ul>
</div>
<div class="main-menu-content">
<ul class="navigation navigation-main" data-menu="menu-navigation" id="main-menu-navigation">
<li class="nav-item">
<a href="https://www.thehackingproject.org/fr/dashboard"><i class="ft-calendar"></i>
<span class="menu-title" data-i18n="">
Aujourd'hui
</span>
</a></li>
<li class="nav-item">
<a href="https://www.thehackingproject.org/fr/dashboard/dashboard"><i class="ft-monitor"></i>
<span class="menu-title" data-i18n="">
Mon dashboard
</span>
</a></li>
<li class="nav-item has-sub">
<a href="#"><i class="fas fa-user-graduate"></i>
<span class="menu-title" data-i18n="">
Mon inscription
</span>
</a><ul class="menu-content">
<li>
<a href="https://www.thehackingproject.org/parcours?locale=fr">Choisir un parcours</a>
</li>
<li>
<a href="https://www.thehackingproject.org/fr/dashboard/profile/curriculum_subscriptions/new">Nouveau parcours</a>
</li>
<li>
<a href="https://www.thehackingproject.org/fr/dashboard/profile/curriculum_subscriptions/7209/edit">Changer parcours</a>
</li>
<li>
<a href="https://www.thehackingproject.org/fr/dashboard/modalites">Modalités</a>
</li>
</ul>
</li>
<li class="nav-item">
<a href="https://www.thehackingproject.org/fr/dashboard/certifications"><i class="fa ft-download"></i>
<span class="menu-title" data-i18n="">
Documents
</span>
</a></li>
<br>
<li>
<a href="https://www.thehackingproject.org/fr/dashboard/help"><i class="fa ft-help-circle"></i>
<span class="menu-title" data-i18n="">
Aide
</span>
</a></li>
</ul>
</div>
</div>



    <div class="app-content content">
      <div class="content-wrapper">
        <div class="content-wrapper-before"></div>
        <div class="content-header row"></div>
        <div class="container">
<div class="row">
<div class="col-12">
<ol class="breadcrumb">
<li class="breadcrumb-item">
<a href="https://www.thehackingproject.org/fr/dashboard/dashboard">Dashboard</a>
</li>
<li class="breadcrumb-item">
<a href="https://www.thehackingproject.org/fr/dashboard/courses/1">Fullstack web</a>
</li>
<li class="breadcrumb-item">
<a href="https://www.thehackingproject.org/fr/dashboard/courses/1/weeks/3">Rails intermédiaire</a>
</li>
<li class="breadcrumb-item active">
Mettre en ligne ton site 🚀 et l'améliorer avec login &amp; Cookies 🍪
</li>
</ol>
</div>
</div>
<!-- / PARTIAL FOR FREE MOUSSES -->
<!-- / PARTIAL FOR NEXT -->
<div class="row">
<div class="col-12">
<div class="card">
<div class="card-body">
<div class="row">
<div class="col-12 col-xl-12 text-center mb-3">
<h2 class="mb-2">
Rails intermédiaire
</h2>
<h3>
Mettre en ligne ton site 🚀 et l'améliorer avec login &amp; Cookies 🍪
</h3>
<h4>
<i class="fa fa-pencil text-success" data-placement="bottom" data-toggle="tooltip" title="" data-original-title="Corrections cette journée là"></i>

</h4>
<h5>
Tu vas faire une app qui sera accessible uniquement aux utilisateurs qui
 sont login. Mais avant, on va apprendre à la mettre en ligne sur Heroku
 !
</h5>
</div>
<div class="col-12 col-xl-12 timeline-left" id="activity">
<div class="timeline pt-2">
<ul class="list-unstyled base-timeline activity-timeline">
<li>
<a href="https://www.thehackingproject.org/fr/dashboard/courses/1/weeks/3/days/1"><div class="timeline-icon bg-dark">
<i class="ft-check font-medium-1"></i>
</div>
</a><div class="act-time">
<a href="https://www.thehackingproject.org/fr/dashboard/courses/1/weeks/3/days/1">Lundi
</a></div>
<div class="base-timeline-info">
<div class="text-dark">
<i class="fa fa-rocket text-danger" data-placement="bottom" data-toggle="tooltip" title="" data-original-title="Projet à rendre ce jour-là"></i>

Découverte de Rails
</div>
</div>
<small class="text-muted">
Maintenant que tu es un champion du backend, nous allons nous attaquer au frontend, et au web.
</small>
</li>
<li>
<a href="https://www.thehackingproject.org/fr/dashboard/courses/1/weeks/3/days/2"><div class="timeline-icon bg-dark">
<i class="ft-check font-medium-1"></i>
</div>
</a><div class="act-time">
<a href="https://www.thehackingproject.org/fr/dashboard/courses/1/weeks/3/days/2">Mardi
</a></div>
<div class="base-timeline-info">
<div class="text-dark">
<i class="fa fa-pencil text-success" data-placement="bottom" data-toggle="tooltip" title="" data-original-title="Corrections cette journée là"></i>

Utiliser les routes et les formulaires
</div>
</div>
<small class="text-muted">
Aujourd'hui tu vas te montrer le monde merveilleux des routes et comment les formulaires les utilisent
</small>
</li>
<li>
<a href="https://www.thehackingproject.org/fr/dashboard/courses/1/weeks/3/days/3"><div class="timeline-icon bg-dark">
<i class="ft-check font-medium-1"></i>
</div>
</a><div class="act-time">
<a href="https://www.thehackingproject.org/fr/dashboard/courses/1/weeks/3/days/3">Mercredi
</a></div>
<div class="base-timeline-info">
<div class="text-dark">

CRUD
</div>
</div>
<small class="text-muted">
Create, Read, Update, Destroy.
</small>
</li>
<li>
<a href="https://www.thehackingproject.org/fr/dashboard/courses/1/weeks/3/days/4"><div class="timeline-icon bg-dark">
<i class="ft-check font-medium-1"></i>
</div>
</a><div class="act-time">
<a href="https://www.thehackingproject.org/fr/dashboard/courses/1/weeks/3/days/4">Jeudi
</a></div>
<div class="base-timeline-info">
<div class="text-dark">
<i class="fa fa-rocket text-danger" data-placement="bottom" data-toggle="tooltip" title="" data-original-title="Projet à rendre ce jour-là"></i>

Pimp du Gossip Project
</div>
</div>
<small class="text-muted">

</small>
</li>
<li>
<div class="timeline-icon bg-primary">
<i class="ft-map-pin font-medium-1"></i>
</div>
<div class="act-time">
Vendredi
</div>
<div class="base-timeline-info">
<div class="text-dark">
<i class="fa fa-pencil text-success" data-placement="bottom" data-toggle="tooltip" title="" data-original-title="Corrections cette journée là"></i>

Mettre en ligne ton site 🚀 et l'améliorer avec login &amp; Cookies 🍪
</div>
</div>
<small class="text-muted">
Tu vas faire une app qui sera accessible uniquement aux utilisateurs qui
 sont login. Mais avant, on va apprendre à la mettre en ligne sur Heroku
 !
</small>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</div>

<!-- Les fameuses corrections qui n'arrivent que les jours concernés -->
<div class="row">
<div class="col-12">
<div class="card">
<div class="card-header" style="border-top: 3px solid #5E66E5">
<h1>
Ressource : 
Déployer un site rails en ligne
</h1>
<a class="heading-elements-toggle">
<i class="la la-ellipsis-v font-medium-3"></i>
</a>
<div class="heading-elements">
<ul class="list-inline mb-0">
<li>
<a href="https://www.thehackingproject.org/fr/dashboard/courses/1/lessons/27/lesson_submissions/new"><i class="ft-edit" data-original-title="Proposer une amélioration" data-placement="top" data-toggle="tooltip"></i>
</a></li>
<li>
<a data-action="collapse">
<i class="ft-minus"></i>
</a>
</li>
<li>
<a data-action="expand">
<i class="ft-maximize"></i>
</a>
</li>
</ul>
</div>
</div>
<div class="card-content collapse show">
<div class="card-body">
<div class="tab-pane active" id="home1" role="tabpanel">
<h2>1. Introduction</h2>
<p>Tes applications rails fracassent. Mais avoue que tu aimerais bien 
les mettre en ligne pour faire profiter la terre entière de tes super 
projets. Tkt, on a prévu le coup, et on va te présenter un superbe outil
 pour mettre en ligne très facilement tes applications : Heroku.</p>

<p>En quelques lignes de commande (et un peu de paramétrage), tu pourras
 faire profiter ta grand-mère des sites que tu vas faire. Much 🔥</p>

<h2>2. Historique</h2>
<p>Il existe plusieurs façons de gérer des applications. La première, 
est celle que tu as vue jusqu'à présent : utiliser un service qui 
s'occupe de tout pour toi. Ce sont les SaaS (Software as a Service). 
Aujourd'hui nous allons voir la seconde : développer soi-même ses 
applications, puis les héberger sur une PaaS (Plateform as a Service). 
Les PaaS s'occupent de préparer tous les serveurs pour toi, et tu as 
juste à pousser le code, et elles s'occupent de compiler l'application, 
et de la faire tourner pour toi.</p>

<p>La dernière solution est pour les personnes qui gèrent en réseau : 
les IaaS (Infrastrucure as a Service). Les IaaS te filent de l'espace 
serveur, de la bande passante, et à toi de te démerder et de paramétrer 
tout cela. Nous ne verrons pas comment brancher tes applications rails 
vers des IaaS car ce n'est pas le but de la formation.</p>


<img src="s6j5_fichiers/4mO87l8.png" class="img-fluid">


<p>Plus tu vas bas dans ce schéma, plus tu as le contrôle dans ce que tu
 fais. Mais aussi plus tu as de paramétrages à faire. Un peu comme 
Sinatra et Rails. Dans Sinatra on a plus de contrôle, mais il faut tout 
paramétrer.</p>

<div class="card box-shadow-0 border-success">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">🎨 EXEMPLE ILLUSTRÉ</h4>
      <p class="card-text">Prenons l'exemple d'une entreprise que tu 
connais bien : The Hacking Project. The Hacking Project développe une 
plateforme où les moussaillons peuvent suivre des cours et mettre à jour
 leur projets. On peut dire que c'est une SaaS (c'est pas ultra vrai, 
mais c'est pour l'exemple). The Hacking Project héberge son code chez 
Heroku, qui est une PaaS. THP a juste à envoyer le code de son 
application à Heroku, qui s'occupera de le faire tourner sur sa 
plateforme de serveurs.</p>
      <p>Enfin, Heroku utilise Amazon Web Services qui est une IaaS. 
Heroku loue de l'espace serveur à AWS, dans lequel il va brancher des 
serveurs sous Linux, qui s'occupent de faire tourner le code que les 
SaaS leur envoient.</p>
    </div>
  </div>
</div>

<p>Heroku est un service de PaaS qui a été créé en 2007. 3 ans après 
leur création, ils ont été rachetés par SalesForce pour 212M$. C'est 
l'un des services d'hébergement de code les plus populaires. Ils ont un 
tarif très sympa : ils te proposent d'héberger gratuitement 100 
applications, et tu ne paieras que si ton application cartonne et que tu
 dois pimp tes serveurs (genre 10 balles par mois, ce qui est très peu 
cher).</p>

<h2>3. La ressource</h2>
<p>Apprendre à mettre en production est une sacrée étape dans la vie de 
développeur web. C'est le moment où "ça passe ou ça casse". Le fameux 
écran d'erreur d'Heroku qui fait des ravages chez les moussaillons te 
demandera de débugger des choses dans ton app. Mais à la fin, elle sera 
en ligne, et c'est ce qui compte. Car, comme dirait notre mentor 
Guillaume "mais ça marchait sur mon ordinateur n'est pas une excuse" : 
en tant que moussaillon, tu te fous de savoir que le site The Hacking 
Project marche sur mon ordinateur ; tout le monde veut un site qui 
marche bien sur thehackingproject.org !</p>

<h3>3.1. Installer Heroku</h3>
<p>C'est assez ultra simple. Tu vas créer un compte Heroku, installer 
Heroku pour le faire marcher depuis ton terminal, te connecter, et puis 
c'est tout ! Pour ceci, je t'invite à suivre <a href="http://installfest.railsbridge.org/installfest/create_a_heroku_account">la partie de l'installation de Heroku</a> sur le RailsBridgeInstallfest, et tu auras installé Heroku.</p>

<p>⚠️ Attention utilise le même mail que tu as utilisé pour git, GitHub et SSH ! ⚠️</p>


<h3>3.2. Mettre en ligne son application sur Heroku</h3>
<p>Heroku a une configuration différente de ton ordinateur. Pour faire 
marcher Heroku, il faut juste paramétrer notre application Rails pour 
qu'elle soit compatible avec le service. Heureusement, c'est juste 
quelques réglages à faire. Voici une marche à suivre assez simple pour 
mettre un site en production.</p>


<div class="card box-shadow-0 border-info">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">🚀 ALERTE BONNE ASTUCE</h4>
      <p class="card-text">Pour éviter les galères en fin de projet 
"mais heuuuu le site il ne veut pas push sur heroku 😢", il est 
recommandé de TOUJOURS commencer son app par la configuration Heroku, 
puis de push une première fois, et de voir si ça marche en ligne. Si ça 
marche, tu peux commencer ton site. Si ça ne marche pas, fais marcher le
 truc, et au pire, relance l'app (c'est plus facile quand tu viens à 
peine de commencer que quand tu as 36 modèles à gérer).</p>
    </div>
  </div>
</div>

<h4>3.2.1. La base de données</h4>
<h5>3.2.1.1. SQLite3</h5>
<p>L'un des bugs classiques quand les gens veulent push sur heroku est la non concordance entre SQLite3 et PG. Quand tu fais <code>$ rails new</code>
 (sans utiliser Postgre), de base rails te sort une application en 
SQLite3. Si tu ouvres ton Gemfile, tu pourras retrouver ces lignes là :

</p><pre class=" language-ruby"><code class=" language-ruby"><span class="token comment"># Use sqlite3 as the database for Active Record
</span>gem <span class="token string">'sqlite3'</span></code></pre>
<p>Ceci veut dire : "pour ma base de données, utilise SQLite3 stp merci". Puis lignes 36 -&gt; 42 tu auras ceci :</p>

<pre class=" language-ruby"><code class=" language-ruby">group <span class="token symbol">:development</span><span class="token punctuation">,</span> <span class="token symbol">:test</span> <span class="token keyword">do</span>
  <span class="token comment"># Call 'byebug' anywhere in the code to stop execution and get a debugger console
</span>  gem <span class="token string">'byebug'</span><span class="token punctuation">,</span> platforms<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token symbol">:mri</span><span class="token punctuation">,</span> <span class="token symbol">:mingw</span><span class="token punctuation">,</span> <span class="token symbol">:x64_mingw</span><span class="token punctuation">]</span>
  <span class="token comment"># Adds support for Capybara system testing and selenium driver
</span>  gem <span class="token string">'capybara'</span><span class="token punctuation">,</span> <span class="token string">'~&gt; 2.13'</span>
  gem <span class="token string">'selenium-webdriver'</span>
<span class="token keyword">end</span></code></pre>

<p>Ceci veut dire : tout ce qui est entre ces lignes sera des gems que 
j'utilise pour le développement et le test. En gros, tout sauf la 
production. C'est peut être un peu complexe pour le moment, mais sache 
une chose, cela veut dire que la ligne 12 n'étant pas dans un <code>group</code>
 spécifique, et bien nous disons à notre application rails "pour ma base
 de données, utilise SQLite3 stp merci, en développement, en test <b>et en production</b>".</p>

<p>Le souci est que Heroku n'utilise pas SQLite3 en production, et dès 
que tu mentionneras SQLite3 en production, il t'enverra chier. Il faut 
donc virer cette ligne 12, puis dire que l'on ne se sert de SQLite3 
qu'en développement et en test, puis pour la production, on va utiliser 
l'outil de base de données de heroku : PostGreSQL. Pour ceci, rien de 
plus simple : 
Remplace les lignes 8 et 9 :</p>

<pre class=" language-ruby"><code class=" language-ruby"><span class="token comment"># Use sqlite3 as the database for Active Record
</span>gem <span class="token string">'sqlite3'</span></code></pre>
<p>et remplace la par :</p>
<pre class=" language-ruby"><code class=" language-ruby">group <span class="token symbol">:development</span><span class="token punctuation">,</span> <span class="token symbol">:test</span> <span class="token keyword">do</span>
  gem <span class="token string">'sqlite3'</span>
<span class="token keyword">end</span>

group <span class="token symbol">:production</span> <span class="token keyword">do</span>
  gem <span class="token string">'pg'</span><span class="token punctuation">,</span> <span class="token string">'&gt;= 0.18'</span>
<span class="token keyword">end</span></code></pre>

<p>Et voilà. Tu utilises SQLite3 en Developpement, en Test ; et tu utilises PostgreSQL en production. Comme Heroku.</p>

<p>Maintenant que l'on a un gemfile compatible on va installer le bundle : <code>bundle install --without production</code> Pourquoi le <code>--without production</code>
 ? Parce que sinon le bundle va installer nos gems de production, qui ne
 nous concernent pas. Il risque de planter si PostGreSQL n'est pas 
installé sur ton ordi et le pg du groupe de production fera de la 💩</p>


<h5>3.2.1.2. PostgreSQL</h5>
<p>Si tu es un moussaillon assidu et que tu as bien PG de branché, et que tes rails new font du <code>rails new -d postgresql</code>, et bien rien à changer, ton app est prête à partir chez Heroku (tu peux voir dans ton Gemfile que pg a remplacé SQLite3).</p>

<h4>3.2.2. git push heroku master</h4>
<p>Une fois que ta base de données est paramétrée, tu n'as plus qu'à push ton application sur Heroku.</p>

<h5>3.2.2.1. Créer ton application</h5>
<p>Avant de push, tu vas créer ton application sur Heroku :</p>
<pre class=" language-bash"><code class=" language-bash">$ heroku create</code></pre>
<p>Ce qui aura pour effet de créer une application sur Heroku, et la lier à ton application</p>

<div class="card box-shadow-0 border-info">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">🚀 ALERTE BONNE ASTUCE</h4>
      <p class="card-text">De base, ton application aura un nom de genre <code>pacific-turkey-4983849</code>. Mais tu peux la changer en un truc plus sympa (à condition que ce ne soit pas pris) du genre <code>nom-de-ton-app</code> avec la ligne suivante :</p>
      <pre class=" language-bash"><code class=" language-bash">$ heroku create nom-de-ton-app</code></pre>
      <p>Et tu peux changer le nom de ton app existante avec :</p>
      <pre class=" language-bash"><code class=" language-bash">heroku apps:rename nouveau-nom-de-ton-app</code></pre>
    </div>
  </div>
</div>

<h5>3.2.2.2. Mettre ton app en prod</h5>
<p>Et voilà, LA partie importante. Avant de faire le push, on va voir un truc ensemble. Fais donc :</p>
<pre class=" language-bash"><code class=" language-bash">$ git remote --v</code></pre>

<p>Il devrait te renvoyer un truc du genre :</p>
<pre class=" language-bash"><code class=" language-bash">heroku https://git.heroku.com/nom-de-ton-app.git (fetch)
heroku  https://git.heroku.com/nom-de-ton-app.git (push)
origin  git@github.com:username/repo.git (fetch)
origin  git@github.com:username/repo.git (push)</code></pre>

<p>Si tu n'es pas trop en galère sur git, tu devrais comprendre qu'en 
créant ton application, tu as branché une nouvelle remote à git. En plus
 de pouvoir push ton joli travail sur Origin (donc GitHub), tu peux le 
push sur la remote Heroku. Et bien testons cela :</p>

<pre class=" language-bash"><code class=" language-bash">$ git push heroku master</code></pre>

<p>Là tu devrais avoir un script assez long, qui peut balancer quelques 
warnings, mais qui à la fin devrait dire un truc du genre : </p>

<pre class=" language-bash"><code class=" language-bash">remote: -----&gt; Compressing...
remote:        Done: 48M
remote: -----&gt; Launching...
remote:        Released v6
remote:        https://nom-de-ton-app.herokuapp.com/ deployed to Heroku
remote: 
remote: Verifying deploy... done.
To https://git.heroku.com/nom-de-ton-app.git
 * [new branch]      master -&gt; master</code></pre>


<p>Et voilà, tu as ton application en production sur Heroku. Tu peux 
aller sur son url et t'amuser avec (à condition qu'elle ne soit pas vide
 😉)</p>


<div class="card box-shadow-0 border-danger">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">⚠️ ALERTE ERREUR COMMUNE</h4>
      <p class="card-text">Alerte générale, cette erreur est un grand classique de Heroku. Alloue un bout de cerveau disponible et <b>enregistre cette information</b>.</p>
      <p>Si ton application a une base de données, et qu'il faut faire une migration, il <b>te faudra dire à heroku de migrer</b>, après avoir push. Si tu ne le fais pas, l'application va te péter à la gueule. Pour ceci, rentre la commande :</p>
      <pre class=" language-ruby"><code class=" language-ruby">$ heroku run rails db<span class="token symbol">:migrate</span></code></pre>
      <p>(C'est comme en local sur ta machine, mais en production).</p>
    </div>
  </div>
</div>

<div class="card box-shadow-0 border-danger">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">⚠️ ALERTE ERREUR COMMUNE (bis)</h4>
      <p class="card-text">Celle-là tu la verras plus tard, mais sache 
que pour l'asset pipeline, il faudra aussi rentrer une manip pour éviter
 que Heroku t'explose à la gueule.</p>
    </div>
  </div>
</div>

<div class="card box-shadow-0 border-info">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">🚀 ALERTE BONNE ASTUCE</h4>
      <p class="card-text">Si jamais tu tombes sur une erreur, ou bien si tu tombes sur ceci :</p>
      <div class="text-center">
        <img class="img-fluid" src="s6j5_fichiers/e74hIFn.png" alt="PaaS">
      </div>
      <br>
      <p>🙏Pour l'amour de dieu, utilise Google et ton bon sens, avant de te précipiter sur #help 🙏</p>
    </div>
  </div>
</div>



<h2>4. Points importants à retenir</h2>
<p>Heroku te permet d'héberger ton app sur des serveurs à eux. Les 
serveurs font tourner postgresql donc il te faudra changer certains 
paramètres en base de données si tu utilises encore SQLite3.</p>

<p>Voici un petit flow pour push une app sur Heroku :</p>
<pre class=" language-bash"><code class=" language-bash">$ rails new myapp
$ cd myapp
$ heroku create un-nom-trop-cool
#Je change le Gemfile pour la BDD si je suis en SQLite3
$ bundle install
$ git add .
$ git commit -m "First commit and pushing to Heroku"
$ git push heroku master
$ heroku run rails db:migrate #optionnel si tu as une migration à migrer</code></pre>

<h2>5. Pour aller plus loin</h2>
<p>Pour ceux qui veulent aller plus loin et connaître les paramétrages, 
voici comment mettre en ligne un site sur Heroku, version BG. Tout 
d'abord, <a href="https://devcenter.heroku.com/articles/getting-started-with-rails5" target="_blank">la doc de Heroku</a> fait le pas à pas pour bien mettre en ligne un site avec Heroku. Tu peux aussi aller sur <a href="https://www.theodinproject.com/courses/ruby-on-rails/lessons/deployment" target="_blank">l'article de la mise en production</a> fait par The Odin Project.</p>
</div>
</div>
</div>
</div>
</div>
</div>

<div class="row">
<div class="col-12">
<div class="card">
<div class="card-header" style="border-top: 3px solid #5E66E5">
<h1>
Ressource : 
Les cookies 🍪
</h1>
<a class="heading-elements-toggle">
<i class="la la-ellipsis-v font-medium-3"></i>
</a>
<div class="heading-elements">
<ul class="list-inline mb-0">
<li>
<a href="https://www.thehackingproject.org/fr/dashboard/courses/1/lessons/31/lesson_submissions/new"><i class="ft-edit" data-original-title="Proposer une amélioration" data-placement="top" data-toggle="tooltip"></i>
</a></li>
<li>
<a data-action="collapse">
<i class="ft-minus"></i>
</a>
</li>
<li>
<a data-action="expand">
<i class="ft-maximize"></i>
</a>
</li>
</ul>
</div>
</div>
<div class="card-content collapse show">
<div class="card-body">
<div class="tab-pane active" id="home1" role="tabpanel">
<h2>1. Introduction</h2>
<p>Hier tu as vu comment faire des sessions temporaires. Aujourd'hui nous allons voir les cookies permanents 😻</p>
<p>
</p><h2>2. Historique</h2>
<p>Avant les cookies, c'était bien galère de conserver les données des 
utilisateurs se baladant sur ton site. Ils étaient déjà utilisés en 
informatique quand Lou Montulli a eu l'idée de s'en servir dans les 
communications web en juin 1994. En ce temps-là, Montulli était employé 
de Netscape Communications qui avait développé une app' de commerce en 
ligne pour un client. Les cookies ont offert une solution au problème de
 fiabilité concernant l'implémentation d'un panier d'achat virtuel.</p>
<p>Aujourd'hui ils sont omniprésents.</p>
<div class="card box-shadow-0 border-success">
<div class="card-content collapse show">
<div class="card-body">
<h4 class="card-title">📚 INSTANT CULTURE GÉ</h4>
<p class="card-text">Tiens d'ailleurs, sais-tu d'où vient le terme "cookie" ? <a href="https://fr.wikipedia.org/wiki/Cookie_(informatique)" target="_blank">D’après Wikipedia, il est dérivé de « magic cookie » </a>, un concept bien connu dans l'informatique d'UNIX qui a inspiré le nom, mais aussi l'idée des cookies de navigation.</p>
</div>
</div>
</div>
<h2>3. La ressource</h2>
<h3>3.1. Introduction aux cookies</h3>

<h4>3.1.1. Les cookies</h4>

<p>Comme tu as pu le voir hier, <code>session[:user_id]</code> est 
sécurisé grâce à une clé de chiffrement. Il n'est donc pas possible de 
changer à la main la session à partir de la console Chrome / Firefox 
pour usurper l'identité d'un utilisateur. Les sessions sont pratiques et
 sécurisées. Cependant, si un utilisateur ferme sa fenêtre, il est 
déconnecté de l'application. On aimerait bien mettre en place un système
 pour se souvenir de lui la prochaine fois qu'il revient sur le site. 
C'est ainsi que sont nés les cookies !</p>

<p>Un cookie est comme une session, sauf qu'il reste dans ton navigateur
 pour une durée déterminée. Il est stocké au format hash, un peu comme 
les sessions. Si tu vas dans ton controller et que tu tapes la ligne :</p>

<pre class=" language-ruby"><code class=" language-ruby">cookies<span class="token punctuation">[</span><span class="token symbol">:user_id</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> value<span class="token punctuation">:</span> <span class="token inst-var">@user</span><span class="token punctuation">.</span>id<span class="token punctuation">,</span> expires<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">.</span>years<span class="token punctuation">.</span>from_now<span class="token punctuation">.</span>utc <span class="token punctuation">}</span></code></pre>

<p>Tu vas créer un cookie qui périme dans 20 ans et qui stocke l'id de l'utilisateur.</p>

<p>Par souci de praticité, on va utiliser la méthode <code>.permanent</code> qui revient à dire à un cookie de rester 20 ans. Par exemple, pour stocker le <code>user_id</code> dans un cookie pour 20 ans, tu as juste à écrire :</p>

<pre class=" language-ruby"><code class=" language-ruby">cookies<span class="token punctuation">.</span>permanent<span class="token punctuation">[</span><span class="token symbol">:user_id</span><span class="token punctuation">]</span> <span class="token operator">=</span> user_id</code></pre>

<p>Et pour récupérer les données stockées dans le cookie, tu n'as qu'à faire :</p>

<pre class=" language-ruby"><code class=" language-ruby">user_id <span class="token operator">=</span> cookies<span class="token punctuation">[</span><span class="token symbol">:user_id</span><span class="token punctuation">]</span></code></pre>


<div class="card box-shadow-0 border-info">
<div class="card-content collapse show">
<div class="card-body">
<h4 class="card-title">🤓 QUESTION RÉCURRENTE</h4>
<p><b>Eh bien Jamy, il suffit de récupérer le projet d'hier, puis de 
remplacer toutes les occurrences de sessions par cookies, et à nous la 
gloire ?</b></p>

<p>Non, désolé ! En fait, si stocker le <code>user_id</code> dans les 
sessions marche, ce n'est pas sécurisé dans les cookies. Il nous faut 
une astuce similaire à celle des mots de passe : utiliser un token dans 
le cookie, ne stocker en base que la version hashée de ce token, puis de
 comparer la version hashée du token avec celle de la DB. Nous allons 
voir dans cette ressource comment gérer ça.</p>
</div>
</div>
</div>

<div class="card box-shadow-0 border-info">
<div class="card-content collapse show">
<div class="card-body">
<h4 class="card-title">🤓 L'INSTANT QUESTION BÊTE - mais intelligente</h4>
<p class="card-text"><b>Mais Jamy, c’est pas super dangereux de stocker des identifiants de façon permanente dans son navigateur ?</b></p>
<p>Tu as tout à fait raison ! Contrairement aux informations stockées dans une session, les <b>cookies permanents</b> sont vulnérables aux attaques appelées <b>« session hijacking »</b>, c’est-à-dire le vol d’un <code>remember_token</code> permettant à l’attaquant de se loguer sur le compte de l’utilisateur.</p>
<p><b>😎PETITE LEÇON DE HIJACKING</b></p>
<p>Il y a 4 façons de voler des cookies :</p>
<ul>
<li>Utiliser ce qu’on appelle <a href="https://en.wikipedia.org/wiki/Packet_analyzer" target="_blank">un renifleur de paquet (ou « packet sniffer
»)</a> pour repérer et récupérer les cookies circulant sur des réseaux non sécurisés.</li>
<li>Voler une database stockant des <code>remember_token</code> en clair.</li>
<li>Utiliser la méthode du <a href="https://fr.wikipedia.org/wiki/Cross-site_scripting" target="_blank">XSS (cross-site-scripting)</a>.</li>
<li>Voler une machine et accéder aux identifiants de l’utilisateur.</li>
</ul>
<p>Heureusement, il existe des solutions pour chacune de ces failles :</p>
<ul>
<li>
Utiliser des <a href="https://fr.wikipedia.org/wiki/Transport_Layer_Security" target="_blank">SSL (Secure Sockets Layer)</a> (protocoles de
sécurisation des échanges sur Internet).
</li>
<li>
Ne pas stocker des <code>remember_token</code> en clair dans une DB, mais seulement une version cryptée (hash digest). Note qu’en
théorie, <b>un hacker ne peut pas reconstituer un token à partir de son hash digest.</b>
</li>
<li>Rails résout 99% de ce problème tout seul en prévenant l’insertion de contenu dans les vues.</li>
<li>
Et pour le vol de machine, bah on n'y peut pas grand chose, à part <b>renouveler les tokens chaque fois qu’un utilisateur se déconnecte d’un
site.</b> Ça ne ramènera pas ta machine, mais rendra au moins la tâche plus ardue au potentiel hacker qui a mis la main dessus.
</li>
</ul>
</div>
</div>
</div>


<h4>3.1.2. Concrètement dans notre app</h4>


<p>Avant de te montrer le code à ajouter pour mettre en place un système
 de cookies, voyons ensemble les étapes nécessaires pour le faire 
marcher.</p>

<p>Nous allons stocker deux cookies dans le navigateur de l'utilisateur :</p>

<ul>
  <li>un qui stocke le <code>id</code> de l'utilisateur</li>
  <li>un qui stocke un <code>remember_token</code> lié à l'utilisateur</li>
</ul>

<p>En base de données, nous allons créer dans la table des utilisateurs une colonne <code>remember_digest</code> qui est la version hashée du <code>remember_token</code> présent dans le cookie.</p>

<p>Plus précisément :</p>

<p>Quand un utilisateur se login, on va créer un <code>remember_token</code> au hasard et le stocker dans un cookie. On va ensuite générer une version hashée de ce <code>remember_token</code> que l'on va stocker en DB dans la colonne <code>remember_digest</code>.</p>

<p>Enfin, pour définir le <code>current_user</code>, il nous faudra récupérer le <code>user_id</code> depuis l'un des cookies et le <code>remember_token</code> depuis l'autre. On va ensuite hasher ce <code>remember_token</code> puis le comparer avec le <code>remember_digest</code> de l'utilisateur trouvé grâce au <code>user_id</code>. S'ils concordent, c'est que tout va bien !</p>

<p>Pour se déconnecter, on va simplement retirer les cookies du navigateur de l'utilisateur, puis passer son <code>remember_digest</code>  à <code>nil</code>.</p>

<p>Bref. Cela fait beaucoup d'informations, mais avec la pratique et le 
reste de la ressource, tout va mieux s'imbriquer, ne t'en fais pas ;)</p>


<h3>3.2. Le modèle : migration et méthode d'instance</h3>
<h4>3.2.1. Une colonne <code>remember_digest</code></h4>

<p>Afin de pouvoir procéder à l'authentification, on va comparer le remember_token stocké dans le cookie avec le <code>remember_digest</code> que l'on a en bas. Il faut donc créer une colonne remember_digest dans la table des utilisateurs.</p>

<pre class=" language-shell"><code class=" language-shell">$ rails generate migration add_remember_digest_to_users remember_digest:string</code></pre>

<p>Tu devrais maintenant trouver ta migration dans le dossier <code>db/migrate</code> :</p>

<pre class=" language-ruby"><code class=" language-ruby"><span class="token keyword">class</span> <span class="token const">AddRememberDigestToUsers</span> &lt; <span class="token const">ActiveRecord</span><span class="token punctuation">:</span><span class="token symbol">:Migration</span><span class="token punctuation">[</span><span class="token number">5.0</span><span class="token punctuation">]</span>
  <span class="token keyword">def</span> change
    add_column <span class="token symbol">:users</span><span class="token punctuation">,</span> <span class="token symbol">:remember_digest</span><span class="token punctuation">,</span> <span class="token symbol">:string</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span></code></pre>


<p>Il ne te reste plus qu’à exécuter ta migration avec le classique : <code>$ rails db:migrate</code></p>

<h4>3.2.2. Méthode d'instance</h4>

<p>Maintenant, nous allons mettre en place une méthode permettant de stocker en base le fameux <code>remember_digest</code> de l'utilisateur. Va dans ton model des utilisateurs :</p>

<pre class=" language-ruby"><code class=" language-ruby"><span class="token keyword">class</span> <span class="token const">User</span> &lt; <span class="token const">ApplicationRecord</span>

  <span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>

  <span class="token keyword">def</span> remember<span class="token punctuation">(</span>remember_token<span class="token punctuation">)</span>
    remember_digest <span class="token operator">=</span> <span class="token const">BCrypt</span><span class="token punctuation">:</span><span class="token symbol">:Password</span><span class="token punctuation">.</span>create<span class="token punctuation">(</span>remember_token<span class="token punctuation">)</span>
    <span class="token keyword">self</span><span class="token punctuation">.</span>update<span class="token punctuation">(</span>remember_digest<span class="token punctuation">:</span> remember_digest<span class="token punctuation">)</span>
  <span class="token keyword">end</span>

<span class="token keyword">end</span></code></pre>

<p>Cette méthode est assez simple. Nous allons faire passer en variable locale un <code>remember_token</code>, puis stocker sa version hashée en base de données. La fonction <code>BCrypt::Password.create(string)</code>
 permet de générer un hash sécurisé à partir d'un string. Cette string 
peut être un mot de passe ("azerty") ou une suite aléatoire de 
caractères ("b8ius4wAyCQeEcLmHpS-7g"). Une fois ton digest obtenu, tu 
n'as plus qu'à le sauvegarder en DB, comme pour les mots de passe ! Si 
jamais tu te fais hacker ta base, aucun identifiant en clair ne sera 
compromis.</p>

<div class="card box-shadow-0 border-info">
<div class="card-content collapse show">
<div class="card-body">
<h4 class="card-title">🤓 QUESTION RÉCURRENTE</h4>
<p class="card-text"><b>Attends, Jamy… Pourquoi est-ce qu’on se casse la tête à faire des </b><code>remember_token</code><b> quand il suffirait de stocker dans les cookies une version cryptée du </b><code>user_id</code><b> ? </b></p>
<p>Ok, imagine qu’un hacker prenne possession de ton signed cookie. 
Comment ferais-tu pour l’empêcher de se loguer sur ton compte Ad vitam 
æternam ? En effet, tu ne peux pas changer ton id utilisateur… (à moins 
de fermer ton compte et t’en créer un nouveau, certes 😏)</p>
<p>En revanche, il te suffit de te déconnecter d’un site pour brûler ton <code>remember_token</code> et en générer un nouveau en te re-connectant avec ton mot de passe (que ne possède pas l’attaquant). Ce <code>remember_token</code> t’offre donc la possibilité de contrer le vol de tes cookies (en te déconnectant) !</p>
<p>C’est pour cette raison que les 2 cookies sont nécessaires.</p>
<p></p>
<p></p>
</div>
</div>
</div>


<h3>3.3. On enfourne les cookies : le controller</h3>

<p>Ok, nous avons stocké en base de façon sécurisée un <code>remember_digest</code>. Maintenant, il nous reste à gérer trois éléments dans les controllers :</p>

<ul>
  <li>Comme pour la méthode <code>login(user)</code> que nous avons vue hier, nous allons créer dans le helper une méthode <code>remember(user)</code> qui permet de créer les cookies pour l'utilisateur et de stocker le hash du cookie en base de données.</li>
  <li>Nous allons appeler cette méthode dans le <code>sessions_controller</code> quand l'utilisateur se login au site.</li>
  <li>Enfin, nous allons changer la méthode <code>current_user</code> afin d'authentifier facilement l'utilisateur à partir du cookie.</li>
</ul>

<h4>3.3.1. <code>remember(user)</code></h4>

<p>La méthode <code>remember(user)</code> ressemble à la méthode <code>login(user)</code> : elle va nous servir à créer le cookie, puis à stocker le <code>remember_digest</code> en base de données. Voici à quoi elle va ressembler dans le fichier <code>app/helpers/sessions_helper.rb</code> :</p>

<pre class=" language-ruby"><code class=" language-ruby"><span class="token keyword">def</span> remember<span class="token punctuation">(</span>user<span class="token punctuation">)</span>
  <span class="token comment"># ici je vais créer un remember_token qui est une suite aléatoire de caractères
</span>  remember_token <span class="token operator">=</span> <span class="token const">SecureRandom</span><span class="token punctuation">.</span>urlsafe_base64

  <span class="token comment"># j'ai mon token, je vais stocker son digest en base de données :    
</span>  user<span class="token punctuation">.</span>remember<span class="token punctuation">(</span>remember_token<span class="token punctuation">)</span>

  <span class="token comment">#  maintenant, je vais créer les cookies : un cookie qui va conserver l'user_id, et un autre qui va enregistrer le remember_token
</span>  cookies<span class="token punctuation">.</span>permanent<span class="token punctuation">[</span><span class="token symbol">:user_id</span><span class="token punctuation">]</span> <span class="token operator">=</span> user<span class="token punctuation">.</span>id
  cookies<span class="token punctuation">.</span>permanent<span class="token punctuation">[</span><span class="token symbol">:remember_token</span><span class="token punctuation">]</span> <span class="token operator">=</span> remember_token

<span class="token keyword">end</span></code></pre>

<p>Grâce à ces lignes, tu crées un <code>remember_token</code> que tu stockes dans un cookie dans le navigateur de l'utilisateur. Ce que toi tu gardes en base, c'est le digest de ce <code>remember_token</code>. Ainsi, si jamais tu te fais hacker ta base de données, impossible pour les hackeurs de récupérer les <code>remember_token</code> des utilisateurs et de se connecter à leur place.</p>

<div class="card box-shadow-0 border-info">
<div class="card-content collapse show">
<div class="card-body">
<h4 class="card-title">🤓 QUESTION RÉCURRENTE</h4>
<p><b>Mais dis-donc Jamy, c'est quoi <code>SecureRandom.urlsafe_base64</code> ?</b></p>

<p>C'est une commande assez pratique permettant de générer une string au
 hasard. Tu peux essayer en lançant la console avec rails console puis 
en rentrant plusieurs fois cette ligne :</p>
<pre class=" language-ruby"><code class=" language-ruby">&gt; <span class="token const">SecureRandom</span><span class="token punctuation">.</span>urlsafe_base64
 <span class="token operator">=</span>&gt; <span class="token string">"MPQWxQ4K1gYpfJ9f1v0KAA"</span> 
&gt; <span class="token const">SecureRandom</span><span class="token punctuation">.</span>urlsafe_base64
 <span class="token operator">=</span>&gt; <span class="token string">"JhpQ9GYx2X4odYdzVZYVTQ"</span> 
&gt; <span class="token const">SecureRandom</span><span class="token punctuation">.</span>urlsafe_base64
 <span class="token operator">=</span>&gt; <span class="token string">"B683OcT80nl0BA-H-UoQ6A"</span> </code></pre>
</div>
</div>
</div>

<p>Un peu comme un utilisateur choisissant "azerty" comme mot de passe, toi tu prends une suite de caractères au hasard.</p>

<p>Tu as maintenant ta méthode remember_user permettant de cuisiner les 
cookies de notre utilisateur ! Parfait. Il ne nous reste plus qu'à 
l'appeler pour stocker les cookies chez l'utilisateur. Nous allons le 
faire quand l'utilisateur se login au site, donc dans la méthode create 
du <code>sessions_controller</code>.</p>

<h4>3.3.2. <code>sessions#create</code></h4>

<p>Bon. Maintenant, il faut cuisiner le cookie à chaque fois qu'un 
utilisateur se login au site. Pour ceci, il faut simplement ajouter la 
ligne <code>remember(user)</code> dans la méthode create du <code>sessions_controller</code>. Voici à quoi cette dernière devrait ressembler :</p>

<pre class=" language-ruby"><code class=" language-ruby"><span class="token keyword">def</span> create
  user <span class="token operator">=</span> <span class="token const">User</span><span class="token punctuation">.</span>find_by<span class="token punctuation">(</span>email<span class="token punctuation">:</span> email_dans_ton_params<span class="token punctuation">)</span>
  <span class="token keyword">if</span> user &amp;&amp; user<span class="token punctuation">.</span>authenticate<span class="token punctuation">(</span>password_dans_ton_params<span class="token punctuation">)</span>
    login<span class="token punctuation">(</span>user<span class="token punctuation">)</span>

    <span class="token comment"># on va cuisiner le cookie pour l'utilisateur
</span>    remember<span class="token punctuation">(</span>user<span class="token punctuation">)</span>

    <span class="token comment"># redirige où tu veux, avec un flash ou pas
</span>
  <span class="token keyword">else</span>
    flash<span class="token punctuation">.</span>now<span class="token punctuation">[</span><span class="token symbol">:danger</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'Invalid email/password combination'</span>
    render <span class="token string">'new'</span>
  <span class="token keyword">end</span>

<span class="token keyword">end</span></code></pre>



<p>Tout simplement ! Les helpers permettent de juste insérer une ligne 
pour ce que tu veux faire. Cela décharge le controller et les rend hyper
 lisibles. Tu peux appeler cette méthode ailleurs, par exemple à la 
création de l'utilisateur !</p>

<div class="card box-shadow-0 border-info">
<div class="card-content collapse show">
<div class="card-body">
<h4 class="card-title">🤓 QUESTION RÉCURRENTE</h4>
<p><b>Jamy, c'est quoi la différence entre <code>remember(user)</code> et <code>user.remember</code> ?</b></p>

<p>Excellente question. <code>remember(user)</code> appelle la méthode dans le helper. Cette méthode va cuisiner les cookies et sauvegarder le <code>remember_digest</code> en base. <code>user.remember(token)</code> appelle la méthode d'instance <code>remember</code> qui est dans le model <code>User</code>. Cette méthode va prendre un token en paramètre et stocker son digest dans la colonne <code>remember_digest</code> de l'utilisateur. Les deux sont différentes, donc sache laquelle appeler au bon moment ;)</p>
</div>
</div>
</div>


<p>Maintenant que nous savons cuisiner nos cookies, il est l'heure d'en 
profiter, non ? Voyons comment les utiliser pour reconnaitre qui est 
l'utilisateur caché derrière.</p>

<h4>3.3.3. <code>current_user</code></h4>

<p>Grâce aux helpers, nous avons une méthode permettant de récupérer facilement l'utilisateur connecté : <code>current_user</code>. Afin de savoir si un utilisateur est bien login, nous allons comparer le <code>remember_token</code> avec celui stocké en base. Si le hash du <code>remember_token</code>
 est identique à celui de la DB, c'est que nous avons affaire à la bonne
 personne. Avant de donner la méthode current_user, voyons comment 
comparer un token avec son digest sur BCrypt. Va en console et lance les
 méthodes suivantes :</p>

<pre class=" language-ruby"><code class=" language-ruby">&gt; token <span class="token operator">=</span> <span class="token const">SecureRandom</span><span class="token punctuation">.</span>urlsafe_base64
 <span class="token operator">=</span>&gt; <span class="token string">"gaWWRiG-9BdBB89Zysi63w"</span> 
&gt; digest <span class="token operator">=</span> <span class="token const">BCrypt</span><span class="token punctuation">:</span><span class="token symbol">:Password</span><span class="token punctuation">.</span>create<span class="token punctuation">(</span>token<span class="token punctuation">)</span>
 <span class="token operator">=</span>&gt; <span class="token string">"$2a$10$5bV3cjd6OYun.AW6LuPi9OcA4efD39Oa2VHUWiL5j9LZAhOQ4Yzcu"</span> 
&gt; <span class="token const">BCrypt</span><span class="token punctuation">:</span><span class="token symbol">:Password</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span>digest<span class="token punctuation">)</span><span class="token punctuation">.</span>is_password<span class="token operator">?</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span>
 <span class="token operator">=</span>&gt; <span class="token keyword">true</span> 
&gt; other_token <span class="token operator">=</span> <span class="token const">SecureRandom</span><span class="token punctuation">.</span>urlsafe_base64
 <span class="token operator">=</span>&gt; <span class="token string">"J2bvuq9rj7HMyOag4VKKHA"</span> 
&gt; <span class="token const">BCrypt</span><span class="token punctuation">:</span><span class="token symbol">:Password</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span>digest<span class="token punctuation">)</span><span class="token punctuation">.</span>is_password<span class="token operator">?</span><span class="token punctuation">(</span>other_token<span class="token punctuation">)</span>
 <span class="token operator">=</span>&gt; <span class="token keyword">false</span></code></pre>
 

<p>Dans ces quelques lignes, nous avons créé un token de manière 
aléatoire, puis généré son digest, puis comparé les deux avec la ligne <code>BCrypt::Password.new(digest).is_password?(token)</code>. Comme ils concordaient, BCrypt nous a répondu <code>true</code>. Pour les deux dernières lignes, le <code>other_token</code> ne correspond pas au premier digest. BCrypt nous a répondu <code>false</code>.</p>


<p>Maintenant que tu sais vérifier un token et son digest, voyons voir comment changer la méthode <code>current_user</code> pour faire notre système d'authentification :</p>

<pre class=" language-ruby"><code class=" language-ruby"><span class="token keyword">def</span> current_user
  <span class="token keyword">if</span> session<span class="token punctuation">[</span><span class="token symbol">:user_id</span><span class="token punctuation">]</span>
    <span class="token comment"># même chose que hier
</span>    current_user <span class="token operator">=</span> <span class="token const">User</span><span class="token punctuation">.</span>find_by<span class="token punctuation">(</span>id<span class="token punctuation">:</span> session<span class="token punctuation">[</span><span class="token symbol">:user_id</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token comment"># nous allons vérifier s'il y a bien un cookie contenant l'id de notre utilisateur
</span>  <span class="token keyword">elsif</span> cookies<span class="token punctuation">[</span><span class="token symbol">:user_id</span><span class="token punctuation">]</span>

    <span class="token comment"># nous allons trouver l'utilisateur en DB à partir du cookie qui stocke le user_id
</span>    user <span class="token operator">=</span> <span class="token const">User</span><span class="token punctuation">.</span>find_by<span class="token punctuation">(</span>id<span class="token punctuation">:</span> cookies<span class="token punctuation">[</span><span class="token symbol">:user_id</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> user

      <span class="token comment"># nous allons prendre le remember_token stocké en cookie, le hasher, puis le comparer avec notre remember_digest stocké en base
</span>      remember_token <span class="token operator">=</span> cookies<span class="token punctuation">[</span><span class="token symbol">:remember_token</span><span class="token punctuation">]</span>
      remember_digest <span class="token operator">=</span> user<span class="token punctuation">.</span>remember_digest
      user_authenticated <span class="token operator">=</span> <span class="token const">BCrypt</span><span class="token punctuation">:</span><span class="token symbol">:Password</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span>remember_digest<span class="token punctuation">)</span><span class="token punctuation">.</span>is_password<span class="token operator">?</span><span class="token punctuation">(</span>remember_token<span class="token punctuation">)</span>

      <span class="token comment"># si tout est bon, il ne nous reste plus qu'à souhaiter bienvenue à l'utilisateur !
</span>      <span class="token keyword">if</span> user_authenticated
        log_in user
        current_user <span class="token operator">=</span> user
      <span class="token keyword">end</span>

    <span class="token keyword">end</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span></code></pre>

<p>Voici la version "compréhensible" de la méthode, en mode pas à pas. 
Pour t'aider, voici une version un peu plus condensée de la méthode :</p>

<pre class=" language-ruby"><code class=" language-ruby"><span class="token keyword">def</span> current_user
  <span class="token keyword">if</span> session<span class="token punctuation">[</span><span class="token symbol">:user_id</span><span class="token punctuation">]</span>
    current_user <span class="token operator">=</span> <span class="token const">User</span><span class="token punctuation">.</span>find_by<span class="token punctuation">(</span>id<span class="token punctuation">:</span> session<span class="token punctuation">[</span><span class="token symbol">:user_id</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token keyword">elsif</span> cookies<span class="token punctuation">[</span><span class="token symbol">:user_id</span><span class="token punctuation">]</span>
    user <span class="token operator">=</span> <span class="token const">User</span><span class="token punctuation">.</span>find_by<span class="token punctuation">(</span>id<span class="token punctuation">:</span> cookies<span class="token punctuation">[</span><span class="token symbol">:user_id</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> user &amp;&amp; <span class="token const">BCrypt</span><span class="token punctuation">:</span><span class="token symbol">:Password</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>remember_digest<span class="token punctuation">)</span><span class="token punctuation">.</span>is_password<span class="token operator">?</span><span class="token punctuation">(</span>cookies<span class="token punctuation">[</span><span class="token symbol">:remember_token</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
      log_in user
      current_user <span class="token operator">=</span> user
    <span class="token keyword">end</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span></code></pre>


<div class="card box-shadow-0 border-info">
<div class="card-content collapse show">
<div class="card-body">
<h4 class="card-title">🤓 QUESTION RÉCURRENTE</h4>
<p><b>Mais dis-donc Jamy, pourquoi on login(user) si ce dernier est bien authentifié avec les cookies ?</b></p>

<p>Bien vu ! Si tu vas dans ton helper, <code>login(user)</code> permet de générer un <code>session[:user_id]</code>
 qui permet d'identifier plus rapidement l'utilisateur grâce aux 
sessions. Cela t'évite de devoir vérifier les cookies à chaque 
chargement de page !</p>
</div>
</div>
</div>

 
<p>Et voilà ! Tu viens de mettre en place un système d'authentification 
d'utilisateurs à partir de cookies. Nous allons voir une dernière chose :
 permettre à l'utilisateur de se déconnecter. Pour le moment, s'il 
souhaite se déconnecter, il n'a pas d'autre choix que d'effacer à la 
main ses cookies avec la console Chrome. Pas ouf. On va donc modifier 
les méthode logout pour détruire les cookies.</p>

<h3>3.4. Déconnexion</h3>

<p>Bon, que voulons-nous faire quand on se logout ? C'est assez simple, 
il suffit d'effacer les cookies et de remettre le remember_digest à nil.
 C'est tout ! Crée donc une méthode <code>forget(user)</code> dans <code>app/helpers/sessions_helper.rb</code> :</p>

<pre class=" language-ruby"><code class=" language-ruby"><span class="token keyword">def</span> forget<span class="token punctuation">(</span>user<span class="token punctuation">)</span>

  <span class="token comment"># on remet le remember_digest à nil puisqu'il ne nous servira plus :
</span>  user<span class="token punctuation">.</span>update<span class="token punctuation">(</span>remember_digest<span class="token punctuation">:</span> <span class="token keyword">nil</span><span class="token punctuation">)</span>

  <span class="token comment"># on efface les cookies dans le navigateur de l'utilisateur
</span>  cookies<span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token symbol">:user_id</span><span class="token punctuation">)</span>
  cookies<span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token symbol">:remember_token</span><span class="token punctuation">)</span>

<span class="token keyword">end</span></code></pre>


<p>Puis, on ajoute la méthode logout dans ce même helper :</p>

<pre class=" language-ruby"><code class=" language-ruby"><span class="token keyword">def</span> log_out<span class="token punctuation">(</span>user<span class="token punctuation">)</span>
  session<span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token symbol">:user_id</span><span class="token punctuation">)</span>
  forget<span class="token punctuation">(</span>user<span class="token punctuation">)</span>
<span class="token keyword">end</span></code></pre>

<p>Voilà, tu n'as plus qu'à appeler la méthode <code>log_out(user)</code> dans la méthode destroy du <code>sessions_controller</code> !</p>


<h2>4. Pour aller plus loin</h2>
<p>Voici quelques ressources sur les sessions et cookies :</p>
<ul>
<li>Jonathan de Grafikart explique les sessions et cookies dans une vidéo dédiée. Tu peux <a href="https://www.grafikart.fr/formations/ruby-on-rails/sessions-cookies" target="_blank">la regarder</a>.</li>
<li>The Odin Project a un chapitre dédié aux sessions et aux authentifications. Tu peux <a href="https://www.theodinproject.com/courses/ruby-on-rails/lessons/sessions-cookies-and-authentication" target="_blank">y jeter un oeil</a> aussi ✌️</li>
<li>La doc est toujours là <a href="http://guides.rubyonrails.org/action_controller_overview.html#session" target="_blank">pour aider</a>.</li>
</ul>

</div>
</div>
</div>
</div>
</div>
</div>

<div class="row">
<div class="col-12">
<div class="card">
<div class="card-header" style="border-top: 3px solid #FF4081">
<h1>
Projets : 
The Gossip Project - Cookies, remember me, maybe ?
</h1>
<a class="heading-elements-toggle">
<i class="la la-ellipsis-v font-medium-3"></i>
</a>
<div class="heading-elements">
<ul class="list-inline mb-0">
<li>
<a href="https://www.thehackingproject.org/fr/dashboard/courses/1/projects/98/project_submissions/new"><i class="ft-edit" data-original-title="Proposer une amélioration" data-placement="top" data-toggle="tooltip"></i>
</a></li>
<li>
<a data-action="collapse">
<i class="ft-minus"></i>
</a>
</li>
<li>
<a data-action="expand">
<i class="ft-maximize"></i>
</a>
</li>
</ul>
</div>
</div>
<div class="card-content collapse show">
<div class="card-body">
<div class="tab-pane active" id="home1" role="tabpanel">
<h2>1. Introduction</h2>
<p>Nous voici dans la dernière partie du Gossip Project. Ce site aura 
été génial et on espère que tu as kiffé être le champion des potins. 
Aujourd'hui nous allons  :</p>

<ul>
    <li>Mettre le site en ligne sur Heroku</li>
	<li>Implémenter un système de cookies</li>
	<li>Implémenter la fameuse checkbox "Se souvenir de moi"</li>
</ul>

<h2>2. Le projet</h2>

<h3>2.1. En production !</h3>
<p>Commence par mettre en ligne l'application que tu as codée hier. 
Attention, on te prévient : la première fois qu'on met en ligne, ça peut
 piquer, car on se tape un max de problèmes. Impossible pour nous de 
lister ici tous les soucis que tu risques de rencontrer en chemin : il 
faut en passer par là pour te former à Heroku. Nos conseils : </p>
<ul>
  <li>Vas-y pas à pas au début pour ne pas oublier une étape de base (genre de passer les migrations) ;</li>
  <li>Lis bien les messages d'erreur, essaye de les comprendre et sinon utilise Google et StackOverflow ;</li>
  <li>Évidemment, appuie-toi sur la communauté et appelle à l'aide sur Slack ;</li>
  <li>Surtout ne te décourage jamais : on y arrive toujours à push sur Heroku au bout d'un moment !</li>
</ul>

<h3>2.2. Système de cookies</h3>
<h4>2.2.1. Cookies miam</h4>
<p>Reprends le projet de hier, et remplace le système sessions par un 
système de cookies pour que les utilisateurs puissent rester sur le site
 même en fermant l'application.</p>

<h4>2.2.2. Enfournage à la création d'un utilisateur</h4>
<p>Fais en sorte que ton application se souvienne de l'utilisateur quand
 le dernier s'inscrit sur le site. C'est à dire tu devras cuisiner des 
cookiers au moment où une personne se signup sur le site.</p>


<h3>2.3. Remember me</h3>
<p>Quand tu vas sur un site, ce dernier en général te propose si tu veux <a href="https://www.servicenowguru.com/wp-content/uploads/2015/08/RememberMe.png" target="_blank">qu'il se souvienne de toi</a>.
 En gros, il te demande si tu veux que l'on cuisine des cookies et que 
tu n'ais pas besoin de te connecter la prochaine fois que tu reviens 
dessus. Nous allons te demander de mettre en place la checkbox éponyme à
 <a href="https://www.youtube.com/watch?v=fKKNPLowteY" target="_blank">super chanson</a> de BlueBoy.</p>

<p>En gros, aux formulaires concernés, nous allons te demander d'ajouter
 une petite case qui propose à l'utilisateur de se souvenir de lui. S'il
 coche cette case, l'application va cuisiner des cookies pour se 
souvenir de lui. S'il ne coche pas cette case, l'application ne va pas 
cuisiner de cookies.</p>

<p>⚠️ l'application devra quand même utiliser les sessions afin d'éviter à une personne de rester bloquée dans l'application.</p>

<h4>2.3.1. Au signup</h4>
<p>Propose la checkbox au signup d'un utilisateur, c'est à dire quand ce dernier s'enregistre sur ton site.</p>

<h4>2.3.2. Au login</h4>
<p>Propose la checkbox au login d'un utilisateur, c'est à dire quand ce dernier se connecte à ton application.</p>


<h2>3. Rendu attendu</h2>
<p>La version finale de The Gossip Project !</p>

<p>Et voilà ! Bravo, tu viens de passer toute une semaine à coder from 
scratch une application simple, mais fonctionnelle et avec un système 
d'authentification. Cela n'aura pas été facile, mais tu auras appris 
plein de choses et tu fais marcher une application basique en Rails. 
Peut être que tu n'es pas trop serein pour tes controllers, mais c'est 
normal d'être dans le doute. Cela ne fait après tout qu'une semaine que 
tu fais du Rails. Tu auras donc tout ce weekend pour réviser en douceur 
si tu te sens trop fébrile et/ou profiter de la semaine prochaine pour 
consolider ces bases.</p>

<p>Petit bonus, ces deux derniers jours t'auront donné des bases en 
cybersécurité qui pourront te faire briller en entretien et/ou qui 
seront fondamentales pour ta culture générale de la compréhension de 
l'univers du web. Tu sais enfin comment un cookie marche et c'est ultra 
indispensable au vu de leur omniprésence sur le web. On aurait pu te 
donner une gem qui fait le café en même temps que tes cookies, mais nous
 savons que d'apprendre ces bases en sécurité web te seront plus 
qu'utiles dans le futur.</p>


<p>La semaine prochaine nous allons voir comment utiliser des gems pour 
t'aider à coder plus rapidement tes applications. Ainsi la gem Devise 
fera un système d'authentification complet pour toi. Tu apprendras à 
utiliser des APIs pour donner un peu de pep's à ton application, puis tu
 verra comment ajouter du front.</p>

<p>Bref, tu peux archiver The Gossip Project, et nous te souhaitons une 
bonne fin de semaine et un bon courage pour la semaine prochaine. Tu 
feras tout au long de la semaine un clone d'Eventbrite. Stylé, n'est-ce 
pas ?</p>
</div>
</div>
</div>
</div>
</div>
</div>

</div>

      </div>
    </div>

    <div class="thp-flashes"></div>



    <script src="s6j5_fichiers/dashboard-6681459c92372465340c.js"></script>
    <script charset="utf-8">
      $('input[name=authenticity_token]').val($('meta[name=csrf-token]').attr('content'));
    </script>

  


<script type="text/javascript" id="hs-script-loader" src="s6j5_fichiers/9310539_002.js"></script><script type="text/javascript" id="">(function(e,c){if(!c.__SV){var l,h;window.mixpanel=c;c._i=[];c.init=function(q,r,f){function t(d,a){var g=a.split(".");2==g.length&&(d=d[g[0]],a=g[1]);d[a]=function(){d.push([a].concat(Array.prototype.slice.call(arguments,0)))}}var b=c;"undefined"!==typeof f?b=c[f]=[]:f="mixpanel";b.people=b.people||[];b.toString=function(d){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);d||(a+=" (stub)");return a};b.people.toString=function(){return b.toString(1)+".people (stub)"};l="disable time_event track track_pageview track_links track_forms track_with_groups add_group set_group remove_group register register_once alias unregister identify name_tag set_config reset opt_in_tracking opt_out_tracking has_opted_in_tracking has_opted_out_tracking clear_opt_in_out_tracking start_batch_senders people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user people.remove".split(" ");
for(h=0;h<l.length;h++)t(b,l[h]);var n="set set_once union unset remove delete".split(" ");b.get_group=function(){function d(p){a[p]=function(){call2_args=arguments;call2=[p].concat(Array.prototype.slice.call(call2_args,0));b.push([g,call2])}}for(var a={},g=["get_group"].concat(Array.prototype.slice.call(arguments,0)),m=0;m<n.length;m++)d(n[m]);return a};c._i.push([q,r,f])};c.__SV=1.2;var k=e.createElement("script");k.type="text/javascript";k.async=!0;k.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?
MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";e=e.getElementsByTagName("script")[0];e.parentNode.insertBefore(k,e)}})(document,window.mixpanel||[]);mixpanel.init("ab79c62023f2a925bfe5f7922c70de67");mixpanel.track("Sign up");</script>
<script type="text/javascript" id="">!function(){var a=window.analytics=window.analytics||[];if(!a.initialize)if(a.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{a.invoked=!0;a.methods="trackSubmit trackClick trackLink trackForm pageview identify reset group track ready alias debug page once off on addSourceMiddleware addIntegrationMiddleware setAnonymousId addDestinationMiddleware".split(" ");a.factory=function(b){return function(){var c=Array.prototype.slice.call(arguments);c.unshift(b);
a.push(c);return a}};for(var e=0;e<a.methods.length;e++){var f=a.methods[e];a[f]=a.factory(f)}a.load=function(b,c){var d=document.createElement("script");d.type="text/javascript";d.async=!0;d.src="https://cdn.segment.com/analytics.js/v1/"+b+"/analytics.min.js";b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(d,b);a._loadOptions=c};a._writeKey="HDfubo7D6T7lk8XiL2HZi2hZvIVFuK8j";a.SNIPPET_VERSION="4.13.2";a.load("HDfubo7D6T7lk8XiL2HZi2hZvIVFuK8j");a.page()}}();</script>

<iframe style="display: none; visibility: hidden;" owner="archetype" title="archetype"></iframe></body></html>