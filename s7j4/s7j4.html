<!DOCTYPE html>
<html class="loaded" lang="fr"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<script type="text/javascript" async="" src="s7j4_fichiers/insight.js"></script><script type="text/javascript" src="s7j4_fichiers/NRJS-71f55aa980e498e276b"></script><script src="s7j4_fichiers/nr-1212.js"></script><script type="text/javascript" async="" src="s7j4_fichiers/gtm_002.js"></script><script type="text/javascript" src="s7j4_fichiers/commons.js" async="" status="loaded"></script><script type="text/javascript" src="s7j4_fichiers/google-tag-manager.js" async="" status="loaded"></script><script type="text/javascript" async="" src="s7j4_fichiers/analytics.js"></script><script type="text/javascript" async="" src="s7j4_fichiers/mixpanel-2-latest.js"></script><script src="s7j4_fichiers/conversations-embed.js" type="text/javascript" id="hubspot-messages-loader" data-loader="hs-scriptloader" data-hsjs-portal="9310539" data-hsjs-env="prod" data-hsjs-hublet="na1"></script><script src="s7j4_fichiers/9310539.js" type="text/javascript" id="hs-analytics"></script><script src="s7j4_fichiers/9310539_003.js" type="text/javascript" id="cookieBanner-9310539" data-cookieconsent="ignore" data-hs-ignore="true" data-loader="hs-scriptloader" data-hsjs-portal="9310539" data-hsjs-env="prod" data-hsjs-hublet="na1"></script><script src="s7j4_fichiers/fb.js" type="text/javascript" id="hs-ads-pixel-9310539" data-ads-portal-id="9310539" data-ads-env="prod" data-loader="hs-scriptloader" data-hsjs-portal="9310539" data-hsjs-env="prod" data-hsjs-hublet="na1"></script><script src="s7j4_fichiers/collectedforms.js" type="text/javascript" id="CollectedForms-9310539" crossorigin="anonymous" data-leadin-portal-id="9310539" data-leadin-env="prod" data-loader="hs-scriptloader" data-hsjs-portal="9310539" data-hsjs-env="prod" data-hsjs-hublet="na1"></script><script src="s7j4_fichiers/leadflows.js" type="text/javascript" id="LeadFlows-9310539" crossorigin="anonymous" data-leadin-portal-id="9310539" data-leadin-env="prod" data-loader="hs-scriptloader" data-hsjs-portal="9310539" data-hsjs-env="prod" data-hsjs-hublet="na1"></script><script type="text/javascript" async="" src="s7j4_fichiers/conversion_async.js"></script><script async="" crossorigin="anonymous" src="s7j4_fichiers/fs.js"></script><script src="s7j4_fichiers/773401719499556.js" async=""></script><script async="" src="s7j4_fichiers/fbevents.js"></script><script async="" src="s7j4_fichiers/gtm.js"></script><script type="text/javascript" async="" src="s7j4_fichiers/analytics_002.js"></script><script>window.NREUM||(NREUM={});NREUM.info={"beacon":"bam.nr-data.net","errorBeacon":"bam.nr-data.net","licenseKey":"NRJS-71f55aa980e498e276b","applicationID":"576835834","transactionName":"dgpYEBRYDg9XQh8AA0YNVAsHRQZMVlFJF01GDVkT","queueTime":4,"applicationTime":464,"agent":""}</script>
<script>(window.NREUM||(NREUM={})).init={ajax:{deny_list:["bam.nr-data.net"]}};(window.NREUM||(NREUM={})).loader_config={licenseKey:"NRJS-71f55aa980e498e276b",applicationID:"576835834"};window.NREUM||(NREUM={}),__nr_require=function(t,e,n){function r(n){if(!e[n]){var i=e[n]={exports:{}};t[n][0].call(i.exports,function(e){var i=t[n][1][e];return r(i||e)},i,i.exports)}return e[n].exports}if("function"==typeof __nr_require)return __nr_require;for(var i=0;i<n.length;i++)r(n[i]);return r}({1:[function(t,e,n){function r(){}function i(t,e,n,r){return function(){return s.recordSupportability("API/"+e+"/called"),o(t+e,[u.now()].concat(c(arguments)),n?null:this,r),n?void 0:this}}var o=t("handle"),a=t(10),c=t(11),f=t("ee").get("tracer"),u=t("loader"),s=t(4),d=NREUM;"undefined"==typeof window.newrelic&&(newrelic=d);var p=["setPageViewName","setCustomAttribute","setErrorHandler","finished","addToTrace","inlineHit","addRelease"],l="api-",v=l+"ixn-";a(p,function(t,e){d[e]=i(l,e,!0,"api")}),d.addPageAction=i(l,"addPageAction",!0),d.setCurrentRouteName=i(l,"routeName",!0),e.exports=newrelic,d.interaction=function(){return(new r).get()};var m=r.prototype={createTracer:function(t,e){var n={},r=this,i="function"==typeof e;return o(v+"tracer",[u.now(),t,n],r),function(){if(f.emit((i?"":"no-")+"fn-start",[u.now(),r,i],n),i)try{return e.apply(this,arguments)}catch(t){throw f.emit("fn-err",[arguments,this,t],n),t}finally{f.emit("fn-end",[u.now()],n)}}}};a("actionText,setName,setAttribute,save,ignore,onEnd,getContext,end,get".split(","),function(t,e){m[e]=i(v,e)}),newrelic.noticeError=function(t,e){"string"==typeof t&&(t=new Error(t)),s.recordSupportability("API/noticeError/called"),o("err",[t,u.now(),!1,e])}},{}],2:[function(t,e,n){function r(t){if(NREUM.init){for(var e=NREUM.init,n=t.split("."),r=0;r<n.length-1;r++)if(e=e[n[r]],"object"!=typeof e)return;return e=e[n[n.length-1]]}}e.exports={getConfiguration:r}},{}],3:[function(t,e,n){var r=!1;try{var i=Object.defineProperty({},"passive",{get:function(){r=!0}});window.addEventListener("testPassive",null,i),window.removeEventListener("testPassive",null,i)}catch(o){}e.exports=function(t){return r?{passive:!0,capture:!!t}:!!t}},{}],4:[function(t,e,n){function r(t,e){var n=[a,t,{name:t},e];return o("storeMetric",n,null,"api"),n}function i(t,e){var n=[c,t,{name:t},e];return o("storeEventMetrics",n,null,"api"),n}var o=t("handle"),a="sm",c="cm";e.exports={constants:{SUPPORTABILITY_METRIC:a,CUSTOM_METRIC:c},recordSupportability:r,recordCustom:i}},{}],5:[function(t,e,n){function r(){return c.exists&&performance.now?Math.round(performance.now()):(o=Math.max((new Date).getTime(),o))-a}function i(){return o}var o=(new Date).getTime(),a=o,c=t(12);e.exports=r,e.exports.offset=a,e.exports.getLastTimestamp=i},{}],6:[function(t,e,n){function r(t){return!(!t||!t.protocol||"file:"===t.protocol)}e.exports=r},{}],7:[function(t,e,n){function r(t,e){var n=t.getEntries();n.forEach(function(t){"first-paint"===t.name?p("timing",["fp",Math.floor(t.startTime)]):"first-contentful-paint"===t.name&&p("timing",["fcp",Math.floor(t.startTime)])})}function i(t,e){var n=t.getEntries();if(n.length>0){var r=n[n.length-1];if(f&&f<r.startTime)return;p("lcp",[r])}}function o(t){t.getEntries().forEach(function(t){t.hadRecentInput||p("cls",[t])})}function a(t){if(t instanceof g&&!y){var e=Math.round(t.timeStamp),n={type:t.type};e<=l.now()?n.fid=l.now()-e:e>l.offset&&e<=Date.now()?(e-=l.offset,n.fid=l.now()-e):e=l.now(),y=!0,p("timing",["fi",e,n])}}function c(t){"hidden"===t&&(f=l.now(),p("pageHide",[f]))}if(!("init"in NREUM&&"page_view_timing"in NREUM.init&&"enabled"in NREUM.init.page_view_timing&&NREUM.init.page_view_timing.enabled===!1)){var f,u,s,d,p=t("handle"),l=t("loader"),v=t(9),m=t(3),g=NREUM.o.EV;if("PerformanceObserver"in window&&"function"==typeof window.PerformanceObserver){u=new PerformanceObserver(r);try{u.observe({entryTypes:["paint"]})}catch(h){}s=new PerformanceObserver(i);try{s.observe({entryTypes:["largest-contentful-paint"]})}catch(h){}d=new PerformanceObserver(o);try{d.observe({type:"layout-shift",buffered:!0})}catch(h){}}if("addEventListener"in document){var y=!1,w=["click","keydown","mousedown","pointerdown","touchstart"];w.forEach(function(t){document.addEventListener(t,a,m(!1))})}v(c)}},{}],8:[function(t,e,n){function r(t,e){if(!i)return!1;if(t!==i)return!1;if(!e)return!0;if(!o)return!1;for(var n=o.split("."),r=e.split("."),a=0;a<r.length;a++)if(r[a]!==n[a])return!1;return!0}var i=null,o=null,a=/Version\/(\S+)\s+Safari/;if(navigator.userAgent){var c=navigator.userAgent,f=c.match(a);f&&c.indexOf("Chrome")===-1&&c.indexOf("Chromium")===-1&&(i="Safari",o=f[1])}e.exports={agent:i,version:o,match:r}},{}],9:[function(t,e,n){function r(t){function e(){t(c&&document[c]?document[c]:document[o]?"hidden":"visible")}"addEventListener"in document&&a&&document.addEventListener(a,e,i(!1))}var i=t(3);e.exports=r;var o,a,c;"undefined"!=typeof document.hidden?(o="hidden",a="visibilitychange",c="visibilityState"):"undefined"!=typeof document.msHidden?(o="msHidden",a="msvisibilitychange"):"undefined"!=typeof document.webkitHidden&&(o="webkitHidden",a="webkitvisibilitychange",c="webkitVisibilityState")},{}],10:[function(t,e,n){function r(t,e){var n=[],r="",o=0;for(r in t)i.call(t,r)&&(n[o]=e(r,t[r]),o+=1);return n}var i=Object.prototype.hasOwnProperty;e.exports=r},{}],11:[function(t,e,n){function r(t,e,n){e||(e=0),"undefined"==typeof n&&(n=t?t.length:0);for(var r=-1,i=n-e||0,o=Array(i<0?0:i);++r<i;)o[r]=t[e+r];return o}e.exports=r},{}],12:[function(t,e,n){e.exports={exists:"undefined"!=typeof window.performance&&window.performance.timing&&"undefined"!=typeof window.performance.timing.navigationStart}},{}],ee:[function(t,e,n){function r(){}function i(t){function e(t){return t&&t instanceof r?t:t?u(t,f,a):a()}function n(n,r,i,o,a){if(a!==!1&&(a=!0),!l.aborted||o){t&&a&&t(n,r,i);for(var c=e(i),f=m(n),u=f.length,s=0;s<u;s++)f[s].apply(c,r);var p=d[w[n]];return p&&p.push([b,n,r,c]),c}}function o(t,e){y[t]=m(t).concat(e)}function v(t,e){var n=y[t];if(n)for(var r=0;r<n.length;r++)n[r]===e&&n.splice(r,1)}function m(t){return y[t]||[]}function g(t){return p[t]=p[t]||i(n)}function h(t,e){l.aborted||s(t,function(t,n){e=e||"feature",w[n]=e,e in d||(d[e]=[])})}var y={},w={},b={on:o,addEventListener:o,removeEventListener:v,emit:n,get:g,listeners:m,context:e,buffer:h,abort:c,aborted:!1};return b}function o(t){return u(t,f,a)}function a(){return new r}function c(){(d.api||d.feature)&&(l.aborted=!0,d=l.backlog={})}var f="nr@context",u=t("gos"),s=t(10),d={},p={},l=e.exports=i();e.exports.getOrSetContext=o,l.backlog=d},{}],gos:[function(t,e,n){function r(t,e,n){if(i.call(t,e))return t[e];var r=n();if(Object.defineProperty&&Object.keys)try{return Object.defineProperty(t,e,{value:r,writable:!0,enumerable:!1}),r}catch(o){}return t[e]=r,r}var i=Object.prototype.hasOwnProperty;e.exports=r},{}],handle:[function(t,e,n){function r(t,e,n,r){i.buffer([t],r),i.emit(t,e,n)}var i=t("ee").get("handle");e.exports=r,r.ee=i},{}],id:[function(t,e,n){function r(t){var e=typeof t;return!t||"object"!==e&&"function"!==e?-1:t===window?0:a(t,o,function(){return i++})}var i=1,o="nr@id",a=t("gos");e.exports=r},{}],loader:[function(t,e,n){function r(){if(!T++){var t=P.info=NREUM.info,e=g.getElementsByTagName("script")[0];if(setTimeout(u.abort,3e4),!(t&&t.licenseKey&&t.applicationID&&e))return u.abort();f(O,function(e,n){t[e]||(t[e]=n)});var n=a();c("mark",["onload",n+P.offset],null,"api"),c("timing",["load",n]);var r=g.createElement("script");0===t.agent.indexOf("http://")||0===t.agent.indexOf("https://")?r.src=t.agent:r.src=v+"://"+t.agent,e.parentNode.insertBefore(r,e)}}function i(){"complete"===g.readyState&&o()}function o(){c("mark",["domContent",a()+P.offset],null,"api")}var a=t(5),c=t("handle"),f=t(10),u=t("ee"),s=t(8),d=t(6),p=t(2),l=t(3),v=p.getConfiguration("ssl")===!1?"http":"https",m=window,g=m.document,h="addEventListener",y="attachEvent",w=m.XMLHttpRequest,b=w&&w.prototype,E=!d(m.location);NREUM.o={ST:setTimeout,SI:m.setImmediate,CT:clearTimeout,XHR:w,REQ:m.Request,EV:m.Event,PR:m.Promise,MO:m.MutationObserver};var x=""+location,O={beacon:"bam.nr-data.net",errorBeacon:"bam.nr-data.net",agent:"js-agent.newrelic.com/nr-1212.min.js"},M=w&&b&&b[h]&&!/CriOS/.test(navigator.userAgent),P=e.exports={offset:a.getLastTimestamp(),now:a,origin:x,features:{},xhrWrappable:M,userAgent:s,disabled:E};if(!E){t(1),t(7),g[h]?(g[h]("DOMContentLoaded",o,l(!1)),m[h]("load",r,l(!1))):(g[y]("onreadystatechange",i),m[y]("onload",r)),c("mark",["firstbyte",a.getLastTimestamp()],null,"api");var T=0}},{}],"wrap-function":[function(t,e,n){function r(t,e){function n(e,n,r,f,u){function nrWrapper(){var o,a,s,p;try{a=this,o=d(arguments),s="function"==typeof r?r(o,a):r||{}}catch(l){i([l,"",[o,a,f],s],t)}c(n+"start",[o,a,f],s,u);try{return p=e.apply(a,o)}catch(v){throw c(n+"err",[o,a,v],s,u),v}finally{c(n+"end",[o,a,p],s,u)}}return a(e)?e:(n||(n=""),nrWrapper[p]=e,o(e,nrWrapper,t),nrWrapper)}function r(t,e,r,i,o){r||(r="");var c,f,u,s="-"===r.charAt(0);for(u=0;u<e.length;u++)f=e[u],c=t[f],a(c)||(t[f]=n(c,s?f+r:r,i,f,o))}function c(n,r,o,a){if(!v||e){var c=v;v=!0;try{t.emit(n,r,o,e,a)}catch(f){i([f,n,r,o],t)}v=c}}return t||(t=s),n.inPlace=r,n.flag=p,n}function i(t,e){e||(e=s);try{e.emit("internal-error",t)}catch(n){}}function o(t,e,n){if(Object.defineProperty&&Object.keys)try{var r=Object.keys(t);return r.forEach(function(n){Object.defineProperty(e,n,{get:function(){return t[n]},set:function(e){return t[n]=e,e}})}),e}catch(o){i([o],n)}for(var a in t)l.call(t,a)&&(e[a]=t[a]);return e}function a(t){return!(t&&t instanceof Function&&t.apply&&!t[p])}function c(t,e){var n=e(t);return n[p]=t,o(t,n,s),n}function f(t,e,n){var r=t[e];t[e]=c(r,n)}function u(){for(var t=arguments.length,e=new Array(t),n=0;n<t;++n)e[n]=arguments[n];return e}var s=t("ee"),d=t(11),p="nr@original",l=Object.prototype.hasOwnProperty,v=!1;e.exports=r,e.exports.wrapFunction=c,e.exports.wrapInPlace=f,e.exports.argsToArray=u},{}]},{},["loader"]);</script>
    <meta name="viewport" content="width=device-width, user-scalable=no">

    <meta name="csrf-param" content="authenticity_token">
<meta name="csrf-token" content="oYY8b9bWzeGlnGz1b2dYHr323hxSfvIz2GsRclfPFErSFhJLeTaa0G3NGiSvduGCGagtKnzfF3TBzFZGHpmw1g==">
    <title>Le tableau de bord | The Hacking Project</title>
<meta name="description" content="Nous cassons les codes de l'éducation, vous apprenez d'où vous voulez, en communauté.">
<meta name="robots" content="noindex, nofollow">
<meta property="og:title" content="Le tableau de bord">
<meta property="og:site_name" content="The Hacking Project">
<meta name="url" content="https://www.thehackingproject.org/fr/dashboard/courses/1/weeks/4/days/4">
<meta name="image" content="https://www.thehackingproject.org/packs/images/logo/20210910-THP-Logo_color_transparent-31229dd881904e010092de63be97cdfa.png">


    <link rel="apple-touch-icon" sizes="180x180" href="https://www.thehackingproject.org/assets/favicon/apple-touch-icon-c01aaccf467f7cc3d79bbce743d60779f5b833fdc4500cebd07a5e11a07a5c31.png">
<link rel="apple-touch-icon" sizes="120x120" href="https://www.thehackingproject.org/assets/favicon/apple-touch-icon-120x120-precomposed-372de868f08319961b72ba7e3b1ed7121e75e29c8294334cb2c911409ea18131.png">
<link rel="apple-touch-icon" sizes="120x120" href="https://www.thehackingproject.org/assets/favicon/apple-touch-icon-120x120-372de868f08319961b72ba7e3b1ed7121e75e29c8294334cb2c911409ea18131.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://www.thehackingproject.org/assets/favicon/favicon-32x32-804b12d1c41c60fe721477b7c3b0a32811dc610580dd40ac92f1cc04cbd05ca4.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://www.thehackingproject.org/assets/favicon/favicon-16x16-d96ba65e5785d32474df9ebc6fbfd5442c751d527b10981a474bc3b7a4079d01.png">
<link rel="manifest" href="https://www.thehackingproject.org/assets/favicon/manifest-cf975201fd8ac78a1f1a203357573d50031f1cc33436d099743df6428b8a38a2.json">
<link rel="mask-icon" href="https://www.thehackingproject.org/assets/favicon/safari-pinned-tab-8af1cfcf7525ccdccb490f9f5adad396653a4969b419e0a9a9d3a1088140a912.svg" color="#5bbad5">
<link rel="shortcut icon" href="https://www.thehackingproject.org/assets/favicon/favicon-cbf10361dc90b277565960736d4897fddef5468bff6299811ea9498459d56d21.ico">
<meta name="msapplication-config" content="/assets/favicon/browserconfig-dab38db6040ef54ac56e91fdd77e3d7b06746a634e87b68c99b59b216cb8611a.xml">
<meta name="theme-color" content="#ffffff">

    <link rel="stylesheet" media="screen" href="s7j4_fichiers/vendor-dab9e12f0ba58215899de05f149caa5f.css">
    <link rel="stylesheet" media="screen" href="s7j4_fichiers/dashboard-4ab6ba9737cbfc4c38b17a9a4de7833a.css">
    <link rel="stylesheet" media="screen" href="s7j4_fichiers/dashboard-ea5a94b9045ccb8d8ce8974b71b640603915dc183d5907c643.css">
    <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async="" src="s7j4_fichiers/js.js"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-105991867-1');
  </script>
<!-- End Google Analytics -->

<!-- Google Tag Manager -->
<script>
  (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer',"GTM-P8XRQ3M");
</script>
<!-- End Google Tag Manager -->

<!-- Facebook Pixel Code -->
    <script>
        !function(f,b,e,v,n,t,s)
        {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
        n.callMethod.apply(n,arguments):n.queue.push(arguments)};
        if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
        n.queue=[];t=b.createElement(e);t.async=!0;
        t.src=v;s=b.getElementsByTagName(e)[0];
        s.parentNode.insertBefore(t,s)}(window,document,'script',
        'https://connect.facebook.net/en_US/fbevents.js');
         fbq('init', '773401719499556');
        fbq('track', 'PageView');
    </script>
    <noscript>
     <img height="1" width="1"
    src="https://www.facebook.com/tr?id=773401719499556&ev=PageView
    &noscript=1"/>
    </noscript>
<!-- End Facebook Pixel Code -->

<script>
window['_fs_debug'] = false;
window['_fs_host'] = 'fullstory.com';
window['_fs_script'] = 'edge.fullstory.com/s/fs.js';
window['_fs_org'] = '14AEET';
window['_fs_namespace'] = 'FS';
(function(m,n,e,t,l,o,g,y){
    if (e in m) {if(m.console && m.console.log) { m.console.log('FullStory namespace conflict. Please set window["_fs_namespace"].');} return;}
    g=m[e]=function(a,b,s){g.q?g.q.push([a,b,s]):g._api(a,b,s);};g.q=[];
    o=n.createElement(t);o.async=1;o.crossOrigin='anonymous';o.src='https://'+_fs_script;
    y=n.getElementsByTagName(t)[0];y.parentNode.insertBefore(o,y);
    g.identify=function(i,v,s){g(l,{uid:i},s);if(v)g(l,v,s)};g.setUserVars=function(v,s){g(l,v,s)};g.event=function(i,v,s){g('event',{n:i,p:v},s)};
    g.anonymize=function(){g.identify(!!0)};
    g.shutdown=function(){g("rec",!1)};g.restart=function(){g("rec",!0)};
    g.log = function(a,b){g("log",[a,b])};
    g.consent=function(a){g("consent",!arguments.length||a)};
    g.identifyAccount=function(i,v){o='account';v=v||{};v.acctId=i;g(o,v)};
    g.clearUserCookie=function(){};
    g.setVars=function(n, p){g('setVars',[n,p]);};
    g._w={};y='XMLHttpRequest';g._w[y]=m[y];y='fetch';g._w[y]=m[y];
    if(m[y])m[y]=function(){return g._w[y].apply(this,arguments)};
    g._v="1.3.0";
})(window,document,window['_fs_namespace'],'script','user');
</script>
<!-- Start of HubSpot Embed Code -->
<script async="" defer="defer" id="hs-script-loader" src="s7j4_fichiers/9310539_002.js" type="text/javascript"></script>
<!-- End of HubSpot Embed Code -->


    <script src="s7j4_fichiers/thp-3cc5aa6fdf57842a7b6c714621cc7f2d3d31b51cb700b1de4e795d773.js"></script>
    <script src="s7j4_fichiers/manifest-1613feea780cfc5342f4.js"></script>
    <script src="s7j4_fichiers/vendor-ff3cb5540e737de52c97.js"></script><script src="s7j4_fichiers/a"></script>
    <script src="s7j4_fichiers/dashboard-25875e14460b4458b1bccffaa93d4a8cbee9691b06d54976fde.js"></script>

    <link href="s7j4_fichiers/css.css" rel="stylesheet">
  </head>

  <body class="vertical-layout 2-columns fixed-navbar menu-hide vertical-overlay-menu" data-open="click" data-menu="vertical-menu" data-color="bg-gradient-x-primary-blue" data-col="2-columns" data-thp-controller="days" data-thp-action="show" data-thp-layout="dashboard"><style type="text/css">html.hs-messages-widget-open.hs-messages-mobile,html.hs-messages-widget-open.hs-messages-mobile body{overflow:hidden!important;position:relative!important}html.hs-messages-widget-open.hs-messages-mobile body{height:100%!important;margin:0!important}#hubspot-messages-iframe-container{display:initial!important;z-index:2147483647;position:fixed!important;bottom:0!important}#hubspot-messages-iframe-container.widget-align-left{left:0!important}#hubspot-messages-iframe-container.widget-align-right{right:0!important}#hubspot-messages-iframe-container.internal{z-index:1016}#hubspot-messages-iframe-container.internal iframe{min-width:108px}#hubspot-messages-iframe-container .shadow-container{display:initial!important;z-index:-1;position:absolute;width:0;height:0;bottom:0;content:""}#hubspot-messages-iframe-container .shadow-container.internal{display:none!important}#hubspot-messages-iframe-container .shadow-container.active{width:400px;height:400px}#hubspot-messages-iframe-container iframe{display:initial!important;width:100%!important;height:100%!important;border:none!important;position:absolute!important;bottom:0!important;right:0!important;background:transparent!important}</style>
    <!-- Google Tag Manager (noscript) -->
<noscript>
<iframe height='0' src='https://www.googletagmanager.com/ns.html?id=GTM-P8XRQ3M' style='display:none;visibility:hidden' width='0'></iframe>
</noscript>
<!-- End Google Tag Manager (noscript) -->



    <nav class="header-navbar navbar-expand-md navbar navbar-with-menu navbar-without-dd-arrow fixed-top navbar-semi-light" style="padding:0;">
<div class="navbar-wrapper">
<div class="navbar-container content">
<div class="collapse navbar-collapse show" id="navbar-mobile">
<ul class="nav navbar-nav mr-auto float-left">
<li class="nav-item mobile-menu d-md-none mr-auto">
<a class="nav-link nav-menu-main menu-toggle hidden-xs" href="#">
<i class="ft-menu font-large-1"></i>
</a>
</li>
<li class="nav-item d-none d-md-block">
<a class="nav-link nav-menu-main menu-toggle hidden-xs" href="#">
<i class="ft-menu"></i>
</a>
</li>
</ul>
<ul class="nav navbar-nav float-right">
<li class="dropdown dropdown-user nav-item">
<a class="dropdown-toggle nav-link dropdown-user-link" data-toggle="dropdown" href="#">
<span class="avatar avatar-online">

<img alt="avatar" style="max-height: 40px!important; width: auto" class="rounded-circle img-border" src="s7j4_fichiers/default_profile-a3318a5e66467f9958f16a172f9d15d6.jpg">

</span>
</a>
<div class="dropdown-menu dropdown-menu-right">
<div class="arrow_box_right">
<a class="dropdown-toggle nav-link dropdown-user-link" href="https://www.thehackingproject.org/fr/dashboard/profile/user"><span class="avatar avatar-online pt-0">

<img alt="avatar" style="max-height: 40px!important; width: auto" class="rounded-circle img-border" src="s7j4_fichiers/default_profile-a3318a5e66467f9958f16a172f9d15d6.jpg">

</span>
<span class="user-name text-bold-700 ml-1 text-dark">
Lucie
</span>
</a><div class="dropdown-divider"></div>
<a class="dropdown-item" href="https://www.thehackingproject.org/fr/dashboard/profile/user/edit"><i class="ft-edit"></i>Éditer profil
</a><div class="dropdown-divider"></div>
<a class="dropdown-item" href="https://www.thehackingproject.org/fr/dashboard/profile/user/edit?edit=danger"><i class="ft-alert-triangle"></i>Zone à risques
</a><div class="dropdown-divider"></div>
<a class="dropdown-item" rel="nofollow" data-method="delete" href="https://www.thehackingproject.org/users/sign_out?locale=fr"><i class="ft-power"></i>
Déconnexion
</a></div>
</div>
</li>
</ul>
</div>
</div>
</div>
</nav>

      <div class="main-menu menu-fixed menu-light menu-accordion menu-shadow" data-scroll-to-active="true">
<div class="navbar-header">
<ul class="nav navbar-nav flex-row">
<li class="nav-item mr-auto">
<a class="navbar-brand" href="https://www.thehackingproject.org/?locale=fr"><h3 class="brand-text">The Hacking Project</h3>
</a></li>
<li class="nav-item d-md-none">
<a class="nav-link close-navbar">
<i class="ft-x"></i>
</a>
</li>
</ul>
</div>
<div class="main-menu-content">
<ul class="navigation navigation-main" data-menu="menu-navigation" id="main-menu-navigation">
<li class="nav-item">
<a href="https://www.thehackingproject.org/fr/dashboard"><i class="ft-calendar"></i>
<span class="menu-title" data-i18n="">
Aujourd'hui
</span>
</a></li>
<li class="nav-item">
<a href="https://www.thehackingproject.org/fr/dashboard/dashboard"><i class="ft-monitor"></i>
<span class="menu-title" data-i18n="">
Mon dashboard
</span>
</a></li>
<li class="nav-item has-sub">
<a href="#"><i class="fas fa-user-graduate"></i>
<span class="menu-title" data-i18n="">
Mon inscription
</span>
</a><ul class="menu-content">
<li>
<a href="https://www.thehackingproject.org/parcours?locale=fr">Choisir un parcours</a>
</li>
<li>
<a href="https://www.thehackingproject.org/fr/dashboard/profile/curriculum_subscriptions/new">Nouveau parcours</a>
</li>
<li>
<a href="https://www.thehackingproject.org/fr/dashboard/profile/curriculum_subscriptions/7209/edit">Changer parcours</a>
</li>
<li>
<a href="https://www.thehackingproject.org/fr/dashboard/modalites">Modalités</a>
</li>
</ul>
</li>
<li class="nav-item">
<a href="https://www.thehackingproject.org/fr/dashboard/certifications"><i class="fa ft-download"></i>
<span class="menu-title" data-i18n="">
Documents
</span>
</a></li>
<br>
<li>
<a href="https://www.thehackingproject.org/fr/dashboard/help"><i class="fa ft-help-circle"></i>
<span class="menu-title" data-i18n="">
Aide
</span>
</a></li>
</ul>
</div>
</div>



    <div class="app-content content">
      <div class="content-wrapper">
        <div class="content-wrapper-before"></div>
        <div class="content-header row"></div>
        <div class="container">
<div class="row">
<div class="col-12">
<ol class="breadcrumb">
<li class="breadcrumb-item">
<a href="https://www.thehackingproject.org/fr/dashboard/dashboard">Dashboard</a>
</li>
<li class="breadcrumb-item">
<a href="https://www.thehackingproject.org/fr/dashboard/courses/1">Fullstack web</a>
</li>
<li class="breadcrumb-item">
<a href="https://www.thehackingproject.org/fr/dashboard/courses/1/weeks/4">Rails avancé</a>
</li>
<li class="breadcrumb-item active">
Asset Pipeline &amp; Active Storage
</li>
</ol>
</div>
</div>
<!-- / PARTIAL FOR FREE MOUSSES -->
<!-- / PARTIAL FOR NEXT -->
<div class="row">
<div class="col-12">
<div class="card">
<div class="card-body">
<div class="row">
<div class="col-12 col-xl-12 text-center mb-3">
<h2 class="mb-2">
Rails avancé
</h2>
<h3>
Asset Pipeline &amp; Active Storage
</h3>
<h4>

</h4>
<h5>
Tu vas voir deux éléments importants qui vont bien ensemble : nous te 
montrerons l'Asset Pipeline qui te donnera la possibilité d'afficher des
 images et de jouer avec le CSS et JavaScript de manière avancée. 
Ensuite, grâce à Active Storage, tu vas savoir comment gérer l'upload de
 fichiers (notamment d'images) dans Rails.
</h5>
</div>
<div class="col-12 col-xl-12 timeline-left" id="activity">
<div class="timeline pt-2">
<ul class="list-unstyled base-timeline activity-timeline">
<li>
<a href="https://www.thehackingproject.org/fr/dashboard/courses/1/weeks/4/days/1"><div class="timeline-icon bg-dark">
<i class="ft-check font-medium-1"></i>
</div>
</a><div class="act-time">
<a href="https://www.thehackingproject.org/fr/dashboard/courses/1/weeks/4/days/1">Lundi
</a></div>
<div class="base-timeline-info">
<div class="text-dark">

Mailer et événements
</div>
</div>
<small class="text-muted">
Nous allons te montrer comment te servir du mailer de Rails, qui permet 
d'envoyer des emails. On te donnera les bonnes astuces pour que ton 
mailer fonctionne en production.
</small>
</li>
<li>
<a href="https://www.thehackingproject.org/fr/dashboard/courses/1/weeks/4/days/2"><div class="timeline-icon bg-dark">
<i class="ft-check font-medium-1"></i>
</div>
</a><div class="act-time">
<a href="https://www.thehackingproject.org/fr/dashboard/courses/1/weeks/4/days/2">Mardi
</a></div>
<div class="base-timeline-info">
<div class="text-dark">
<i class="fa fa-rocket text-danger" data-placement="bottom" data-toggle="tooltip" title="" data-original-title="Projet à rendre ce jour-là"></i>

Devise
</div>
</div>
<small class="text-muted">
Découverte de Devise: Gérer des utilisateurs très facilement
</small>
</li>
<li>
<a href="https://www.thehackingproject.org/fr/dashboard/courses/1/weeks/4/days/3"><div class="timeline-icon bg-dark">
<i class="ft-check font-medium-1"></i>
</div>
</a><div class="act-time">
<a href="https://www.thehackingproject.org/fr/dashboard/courses/1/weeks/4/days/3">Mercredi
</a></div>
<div class="base-timeline-info">
<div class="text-dark">
<i class="fa fa-pencil text-success" data-placement="bottom" data-toggle="tooltip" title="" data-original-title="Corrections cette journée là"></i>

Services et API 
</div>
</div>
<small class="text-muted">
Ce jour là va se couper en deux parties : - tu vas commencer par 
découvrir comment insérer de manière propre tes programmes de Plain Old 
Ruby Object (PORO) qui n'ont rien à voir avec Rails : les services - 
ensuite tu vas jouer avec des APIs pour insérer des fonctionnalités très
 pratique comme le paiement ou la localisation.
</small>
</li>
<li>
<div class="timeline-icon bg-primary">
<i class="ft-map-pin font-medium-1"></i>
</div>
<div class="act-time">
Jeudi
</div>
<div class="base-timeline-info">
<div class="text-dark">

Asset Pipeline &amp; Active Storage
</div>
</div>
<small class="text-muted">
Tu vas voir deux éléments importants qui vont bien ensemble : nous te 
montrerons l'Asset Pipeline qui te donnera la possibilité d'afficher des
 images et de jouer avec le CSS et JavaScript de manière avancée. 
Ensuite, grâce à Active Storage, tu vas savoir comment gérer l'upload de
 fichiers (notamment d'images) dans Rails.
</small>
</li>
<li>
<a href="https://www.thehackingproject.org/fr/dashboard/courses/1/weeks/4/days/5"><div class="timeline-icon bg-dark">
<i class="ft-calendar font-medium-1"></i>
</div>
</a><div class="act-time">
<a href="https://www.thehackingproject.org/fr/dashboard/courses/1/weeks/4/days/5">Vendredi
</a></div>
<div class="base-timeline-info">
<div class="text-dark">

Interface administrateur
</div>
</div>
<small class="text-muted">
Tu vas voir comment faire une belle interface administrateur pour gérer tes utilisateurs 😈
</small>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</div>

<!-- Les fameuses corrections qui n'arrivent que les jours concernés -->
<div class="row">
<div class="col-12">
<div class="card">
<div class="card-header" style="border-top: 3px solid #5E66E5">
<h1>
Ressource : 
Projet final : ouverture du mercato
</h1>
<a class="heading-elements-toggle">
<i class="la la-ellipsis-v font-medium-3"></i>
</a>
<div class="heading-elements">
<ul class="list-inline mb-0">
<li>
<a href="https://www.thehackingproject.org/fr/dashboard/courses/1/lessons/119/lesson_submissions/new"><i class="ft-edit" data-original-title="Proposer une amélioration" data-placement="top" data-toggle="tooltip"></i>
</a></li>
<li>
<a data-action="collapse">
<i class="ft-minus"></i>
</a>
</li>
<li>
<a data-action="expand">
<i class="ft-maximize"></i>
</a>
</li>
</ul>
</div>
</div>
<div class="card-content collapse show">
<div class="card-body">
<div class="tab-pane active" id="home1" role="tabpanel">
<p>Bienvenue dans le mercato de The Hacking Project ! Dans cette période
 vous allez discuter entre vous afin de monter une équipe pour votre 
projet final. Nous allons vous donner toutes les astuces pour réussir 
avec brio cette étape importante de la vie d'un moussaillon.</p>
<h3>Qu'est-ce que les projets finaux ?</h3>
<p>En théorie, nous avons fait une récapitulatif complet des projets 
finaux depuis ton dashboard dans la partie "Mes Projets". Si malgré tout
 des questions demeurent, posez-les-nous dans la chaîne dédiée aux 
projets finaux. Nous y répondrons avec plaisir et améliorerons la 
ressource pour que tout soit clair.</p>
<h3>Comment proposer un projet</h3>
<p>Si tu as une idée de projet final à soumettre, il te faut aller dans 
"Projets Finaux" -&gt; "Proposer un projet final" puis remplir le 
formulaire. L’équipe reviendra vers toi si la proposition est trop 
ambitieuse ou trop légère. Une fois validée, d’autres moussaillons 
pourront rejoindre ton projet. Attention, l'équipe se réserve le droit 
de refuser ton projet s'il ne répond pas à nos critères de complexité.</p>
<p>Voici quelques exemples de projets finaux valides:</p>
<ul>
<li>✅ Une marketplace (ex: le Airbnb des promenades de chien)</li>
<li>✅ Un site orienté mobile (ex: un site qui affiche sur une carte les bars sympas du coin)</li>
<li>✅ Une plateforme de comparaison d’offre en fonction de critères saisis par l’utilisateur (ex: un comparateur de prix)</li>
</ul>
<p>Et voici quelques exemples de projets finaux non-valides:</p>
<ul>
<li>❌ Un site vitrine réalisable avec un éditeur en ligne type WordPress ou SquareSpace</li>
<li>❌ Un site avec du contenu non-adapté au grand public (pornographie, insultes, etc)</li>
</ul>
<h3>Comment trouver ou constituer une bonne équipe ?</h3>
<h4>Tu as un projet à proposer</h4>
<p>Il te faut trouver suffisamment de membres pour avoir une équipe de 4
 ou 5 personnes. Pour ceci, essaye de discuter avec les gens, pitche 
leur ton projet en disant que c'est super chouette. Essaie de trouver 
des gens qui partagent les mêmes intérêts pour le projet. Bref, à toi de
 jouer :)</p>
<h4>Tu veux rejoindre un projet</h4>
<p>Parles-en avec l'auteur du projet, puis vois si ton profil 
l'intéresse. Si tu as travaillé et a été sérieux durant la formation, 
cela devrait bien se passer. Si tu as passé ton temps à esquiver les 
corrections pour gratter et obtenir un max de <code>oui</code> et/ou tu 
as pompé les repo github de tes co-moussaillons, tu te retrouveras très 
sûrement tout seul ou avec une équipe de loosers dans ton cas. Désolés 
¯\_(ツ)_/¯</p>
<h3>Comment bien présenter un projet ?</h3>
<p>Afin que l'équipe administratrice et que tes co-moussaillons puissent
 comprendre ce que va faire ton projet, il te faudra faire une 
description de ce dernier qui soit claire, compréhensible, et qui sache à
 peu près de quoi le projet va parler.</p>
<p>Voici un plan recommandé de description de projet :</p>
<pre class=" language-markdown"><code class=" language-markdown">## 1. Présentation
Présente en un ou deux paragraphes ton application. Commence par le besoin : à quel besoin réponds-tu ? Puis décris ton application brièvement de manière compréhensible. Si c'est long chiant et ennuyeux, les gens vont s'arrêter à ce paragraphe. Si c'est trop vague, les gens vont penser que tu ne sais pas ce que tu veux. C'est normal d'être dans le brouillard, mais ce n'est pas normal de ne pas pouvoir décrire son application en un paragraphe. 

## 2. Parcours utilisateur
Décris le parcours utilisateur de ton application. En terme de produit à quoi elle ressemblera. 

## 3. Concrètement et techniquement
Dans cette partie, tu pourras décrire l'aspect technique du projet.

### 3.1. Base de données
Comment tu vois la base de données de l'application ?

### 3.2. Front
Quels sont les composants dont vous aurez besoin ? Aurez-vous besoin d'un peu de front dynamique avec JavaScript pour la faire fonctionner ? 

### 3.3. Backend
De quoi avez-vous besoin pour le backend ? Quelles sont les APIs en back que vous allez brancher et utiliser ?

### 3.4. Mes besoins techniques
Balance ici tes compétences, puis tes besoins pour les 3-4 personnes restantes.

## 4. La version minimaliste mais fonctionnelle qu'il faut avoir livré la première semaine
Nous allons vous demander de livrer une version minimaliste mais fonctionnelle à la fin de la première semaine. Décris ce que vous voulez avoir fait à la fin de la première semaine. Pense minimaliste, fonctionnel, efficace. Comment avec le moins de code possible vous arrivez à donner une version fonctionnelle de l'application. 

Ceci s'appelle le MVP, pour Minimum Viable Product. Voici un exemple de MVP pour un site que tu connais bien, celui de THP : les gens peuvent s'enregistrer sur le site, puis s'inscrire à une session. S'ils s'inscrivent, ils ont accès à tout le cursus qui est hébergé sur la plateforme. Nous nous occuperons à la main d'envoyer des emails pour annoncer le début de la session et nous ferons les groupes à la main. Spoiler : THP a commencé comme ceci ;)

## 5. La version que l'on présentera aux jury
La deuxième semaine vous allez ajouter des fonctionnalités pour améliorer l'expérience utilisateurs de votre application. Quelles fonctionnalités tu aimerais bien ajouter ?

## 6. Notre mentor
Qui est ton mentor ?</code></pre>

<div class="card box-shadow-0 border-info">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">🚀 ALERTE BONNE ASTUCE</h4>
      <p>Le texte d'un projet final est en markdown, c'est à dire que tu
 peux lui donner le même style qu'un README d'un GitHub. Nous te 
conseillons de lui donner un peu de mise en forme.</p>
    </div>
  </div>
</div>


<h3>Les types de projets appréciés</h3>
<p>Le secret d'un bon projet final est d'aller à l'essentiel. Nombreux 
sont les moussaillons qui partent dans tous les sens et qui font 
n'importe quoi. La question à ce poser est : quel est mon besoin, et 
comment je réponds à ce besoin avec le moins de lignes de code possible.
 Va à l'essentiel, décris ton projet, ne va pas dans tous les sens, et 
tout se passera bien.</p>
<h3>Les dates importantes</h3>
<h4>Jeudi de la semaine 6 : ouverture du mercato</h4>
<p>Ça commence. Vous discutez entre vous, et constituez les équipes</p>
<h4>Avant le jeudi de la semaine 8 à 23h59</h4>
<p>Il faut impérativement avoir fait valider votre projet par l'équipe 
administrative, puis il faut impérativement verrouiller votre projet 
pour dire à hackbot "c'est bon on est prêt".</p>
<h4>Jeudi de la semaine 8 à 23h59</h4>
<p>Fin du mercato. Hackbot passe sur les projets et met pirate toute 
personne qui n'est pas dans un projet validé et verrouillé. Donc 
arrangez-vous pour faire valider votre projet et verrouillez-le avant le
 délai imparti, et tout se passera bien !</p>

</div>
</div>
</div>
</div>
</div>
</div>

<div class="row">
<div class="col-12">
<div class="card">
<div class="card-header" style="border-top: 3px solid #5E66E5">
<h1>
Ressource : 
L'Asset Pipeline
</h1>
<a class="heading-elements-toggle">
<i class="la la-ellipsis-v font-medium-3"></i>
</a>
<div class="heading-elements">
<ul class="list-inline mb-0">
<li>
<a href="https://www.thehackingproject.org/fr/dashboard/courses/1/lessons/63/lesson_submissions/new"><i class="ft-edit" data-original-title="Proposer une amélioration" data-placement="top" data-toggle="tooltip"></i>
</a></li>
<li>
<a data-action="collapse">
<i class="ft-minus"></i>
</a>
</li>
<li>
<a data-action="expand">
<i class="ft-maximize"></i>
</a>
</li>
</ul>
</div>
</div>
<div class="card-content collapse show">
<div class="card-body">
<div class="tab-pane active" id="home1" role="tabpanel">
<h2>1. Introduction</h2>
<p>Pour mettre du CSS et du JavaScript avec Ruby on Rails en production,
 nous allons utiliser ce que l'on appelle l'Asset Pipeline. Nous allons 
voir dans cette ressource comment s'en servir en détail.</p>

<p>En gros, l’Asset Pipeline va te permettre d’avoir des fichiers CSS et
 JS bien rangés en local (pour que tu puisses travailler efficacement), 
et te compressera tout quand tu enverras ton application en production 
(comme ça ton site sera rapide et optimisé). L’Asset Pipeline est 
responsable de beaucoup de cheveux perdus lors de passages en 
production, mais avec un bon tuto tout se passera bien lors de ton futur
 git push heroku master.</p>

<h2>2. Historique</h2>
<p>Quand on fait du développement, nous recherchons en priorité :</p>

<ul>
  <li>la lisibilité de notre code</li>
  <li>un rangement qui optimise la lisibilité et l'édition dans le futur</li>
</ul>

<p>Quand notre code est en production, nous recherchons en priorité :</p>

<ul>
  <li>la rapidité d’exécution</li>
  <li>l’optimisation en vitesse</li>
</ul>

<p>Forcément, ces deux objectifs sont différents et difficilement 
compatibles : dur d’avoir du code qui s’exécute rapidement si ce dernier
 est bien rangé dans 40 dossiers et 50 fichiers. C’est pour cela que les
 langages de programmation web ont pour la majorité une solution de 
gestion de CSS, JS et images. Rails a l’Asset Pipeline, une solution 
efficace qui a fait ses preuves depuis quelques années et qui a inspiré 
d’autres outils de gestion d’assets par la suite.</p>

<h2>3. La ressources</h2>

<div class="card box-shadow-0 border-info">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">🚀 ALERTE BONNE ASTUCE</h4>
      <p>On va parler ici de l'Asset Pipeline, le système mis en place 
par RAILS pour gérer les fichiers JS et CSS; il existe plein d'autres 
systèmes pour ça, et en particulier un qui monte beaucoup dans la 
communauté JS, c'est WebPack. Il est très costaud et complet, tellement 
d'ailleurs, que Rails intègre maintenant la possibilité d'utiliser 
WebPack comme gestionnaire d'assets. MAIS cet outil est tellement 
complexe qu'il en est difficile à maîtriser ! Par conséquence, pour 
l'instant on va se limiter à l'asset pipeline ; quand tu auras déjà 
déployé plusieurs applis sur le net et que tu comprendras quelles sont 
les limites de l'Asset Pipeline, tu pourras aller t'attaquer à WebPack 
(je te conseille quand même de prévoir un doliprane ou deux hein !).</p>
      <p>Donc : si tu viens du monde JS et que tu maitrises déjà 
Webpack, pas la peine de te prendre la tête : lis ce cours histoire 
d'être au courant de comment ça fonctionne de base dans Rails 
(d'ailleurs ça devrait te rappeler des choses), mais libre à toi de 
continuer à utiliser Webpack. Tu sais déjà chercher de l'information 
comme un(e) grand(e) donc tu cherches "Webpacker" (la gem qui permet 
d'adapter Webpack à Rails), regarde éventuellement 1 ou 2 tuto et ça 
devrait le faire ;)</p>
    </div>
  </div>
</div>

<h3>3.1. Pourquoi utiliser l'Asset Pipeline</h3>

<p>En développement, on passe son temps à modifier et debugger son code,
 donc on cherche à avoir le plus d'informations possible sur son code : 
on met plein de logs et pour chaque ressource que Rails <code>generate</code>
 pour nous. Il crée un fichier SCSS et un fichier JS : c'est bien rangé 
donc on sait où chercher son code, on dev vite 😈 Lorsqu'on va sur la 
page "/users", on peut utiliser les styles "user.scss" et les scripts de
 "user.js".</p>

<p>Mais si on utilise une navbar dans notre app, on va avoir en plus les
 fichiers "navbar.scss" et "navbar.js" à charger avec la page.  Ca 
commence à faire beaucoup de fichiers à charger.  Si tu te souviens de 
comment un browser affiche une page web, à chaque fois qu'une page fait 
référence à un script JS (tag <code>&lt;script&gt;</code> dans le head de la page) ou un style CSS (tag <code>&lt;link rel='stylesheet'&gt;</code>
 dans le head de la page), le browser lance une requête pour aller 
chercher le fichier en question : cette accumulation de requêtes rend 
l'affichage complet de la page forcement un peu plus lent pour chaque 
lien.</p>

<p>Et autant en dev, c'est pas grave si la page met un tout petit peu de
 temps à s'afficher (puisqu'on est tout seul sur son ordi, on ne va pas 
voir la différence) et on est plutôt content d'avoir plein de logs, 
autant en prod, on a beaucoup d'utilisateurs c'est pas à eux de lire les
 logs ! Par conséquense, on va tout faire pour optimiser : on n'affiche 
pas de logs et on fait en sorte que télécharger les script JS et CSS ne 
prenne pas 15 ans !</p>

<p>Pour ça, ya pas mal de techniques qui existent : au lieu de 
télécharger plein de petits fichiers, on colle tous les scripts JS les 
uns après les autres et on télécharge ça d'un coup ! Pareil pour les CSS
 ! L’Asset Pipeline s’occupe de tout ça pour toi : il prend tous tes 
fichiers et se débrouille pour compresser tout ça en un seul, le plus 
petit possible et fait le lien avec tes pages web automatiquement ! 
C’est pas beau ça ?!</p>

<div class="card box-shadow-0 border-success">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">📚 INSTANT CULTURE GÉ</h4>
      <p>D’ailleurs, dans les fichiers CSS et JS, il y a plein de sauts 
de lignes d'espaces et autres commentaires qui ne sont pas utilisés par 
le browser : ça sert à l'humain qui débuggue (oui, oui, je parle de toi 
le moussaillon ou pirate ou corsaire) à comprendre où il a codé comme un
 cochon, mais une fois en prod, ça sert plus à rien ! On va donc virer 
toutes ces lignes inutiles (pour info, cette étape là s'appelle la <b>minification</b>).</p>
    </div>
  </div>
</div>

<h3>3.2. L'Asset Pipeline en détails</h3>
<h4>3.2.1. Introduction</h4>
<h5>3.2.1.1. On y va à la cool</h5>
<p>Comme on a travaillé seulement sur du CSS pour l’instant et que tu 
vas avoir un cours complet sur le JS un peu plus tard, on ne va parler 
de l’Asset Pipeline que pour les CSS 😉 Ca va te permettre de comprendre
 les mécanismes facilement et quand tu verras le Javascript dans 
quelques jours, t’auras juste à adapter les mêmes mécanismes pour le JS,
 ça va passer crème !</p>

<div class="card box-shadow-0 border-danger">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">⚠️ ALERTE ERREUR COMMUNE</h4>
      <p>Toutes les explications et pas à pas de fichiers précis de 
cette ressource concernent la version 5 de Rails. Rails 6 a changé 
légèrement la façon dont l’Asset Pipeline est organisé. Si tu es sur la 
version 6, passe à la version 5 ou alors attends-toi à avoir des erreurs
 à prévoir.</p>
    </div>
  </div>
</div>

<h5>3.2.1.2. Comprendre ce que l'on va faire</h5>
<p>Si tu vas dans ton fichier <code>app/views/layouts/application.html.erb</code> tu devrais voir les lignes suivantes :</p>

<pre class=" language-ruby"><code class=" language-ruby">&lt;%<span class="token operator">=</span> stylesheet_link_tag    <span class="token string">'application'</span><span class="token punctuation">,</span> media<span class="token punctuation">:</span> <span class="token string">'all'</span><span class="token punctuation">,</span> <span class="token string">'data-turbolinks-track'</span><span class="token punctuation">:</span> <span class="token string">'reload'</span> %&gt;
&lt;%<span class="token operator">=</span> javascript_include_tag <span class="token string">'application'</span><span class="token punctuation">,</span> <span class="token string">'data-turbolinks-track'</span><span class="token punctuation">:</span> <span class="token string">'reload'</span> %&gt;</code></pre>

<p>Ces lignes indiquent à Rails que toutes tes views (<code>application.html.erb</code> est le fichier de base de toutes tes views) vont appeler deux fichiers importants :</p>

<ul>
  <li><code>app/assets/stylesheets/application.css</code></li>
  <li><code>app/assets/javascripts/application.js</code></li>
</ul>

<p>Ces fichiers sont les fichiers <b>manifest</b>, c’est à dire ce sont 
des fichiers qui vont dire à Rails d’appeler les bons fichiers et bonnes
 librairies. Par exemple le fichier <code>application.css</code> ressemble à ça :</p>

<pre class=" language-css"><code class=" language-css"><span class="token comment">/*
 * This is a manifest file that'll be compiled into application.css, which will include all the files
 * listed below.
 *
 * Any CSS and SCSS file within this directory, lib/assets/stylesheets, or any plugin's
 * vendor/assets/stylesheets directory can be referenced here using a relative path.
 *
 * You're free to add application-wide styles to this file and they'll appear at the bottom of the
 * compiled file so the styles you add here take precedence over styles defined in any other CSS/SCSS
 * files in this directory. Styles in this file should be added after the last require_* statement.
 * It is generally better to create a new file per style scope.
 *
 *= require_tree .
 *= require_self
 */</span></code></pre>

<p>En gros, Rails te demande d’ajouter les fichiers que tu veux intégrer
 dans ton gestionnaire de CSS. Ainsi, si tu veux ajouter le fichier css 
de ton thème, tu ajouterais la ligne suivante :</p>

<pre class=" language-css"><code class=" language-css"> *= require ton_thème</code></pre>

<p>Puis au moment de passer en production, l’Asset Pipeline va 
compresser tous les fichiers appelés dans tes manifest et les convertir 
en deux gros fichiers. Si tu as bien paramétré ce dernier, il te dira 
que tout est bon. </p>

<p>Dans cette ressource, nous allons t’expliquer comment bien remplir 
ton manifest et utiliser l’Asset Pipeline pour que tes fichiers CSS 
soient bien rangés.</p>

<p>Cette ressource sera une jolie introduction au monde du front et notamment la gestion des librairies externes.</p>


<h5>3.2.1.3. Les bases basiques de l'Asset Pipeline</h5>
<p>L’Asset Pipeline est directement intégré dans une application Rails quand tu fais <code>$ rails new</code>. En gros pour faire marcher tes assets tu devras :</p>

<ul>
  <li>réfléchir à l’organisation des assets de ton application. En 
fonction de ton utilisation de templates ou pas, cette dernière va 
changer</li>
  <li>faire un peu de configuration pour brancher l’Asset Pipeline, appeler tes assets dans les fichiers manifest</li>
  <li>développer tes assets (images, CSS, JS)</li>
  <li>envoyer le tout en production</li>
</ul>

<p>Nous allons te montrer le pas à pas dans cette ressource.</p>

<h4>3.2.2. Organiser ses fichiers</h4>
<p>Dans un projet web classique d’entreprise, on a 3 sources de CSS différentes: </p>

<ul>
  <li>Les CSS du projet (“Comment on affiche le petit chat sur la page principale”)</li>
  <li>Les CSS de son entreprise (“Quelle est la couleur officielle du logo de la boîte”)</li>
  <li>Les CSS des librairies externes (“Comment Bootstrap affiche un bouton”)</li>
</ul>

<p>Ces différents fichiers n’ont pas les mêmes façons d’évoluer et vont donc être placés dans des répertoires différents:</p>

<ul>
  <li>Les fichiers du projet vont dans <code>app/assets/stylesheets/</code></li>
  <li>Les fichiers de l’entreprise vont dans <code>lib/assets/stylesheets/</code></li>
  <li>Les fichiers des librairies externes vont dans <code>vendor/assets/stylesheets</code> (ou en CDN)</li>
</ul>

<div class="card box-shadow-0 border-success">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">📚 INSTANT CULTURE GÉ</h4>
      <p>En front, une librairie externe est un bout de code en CSS et 
JS qui est codé à ta place. La plus connue des librairies externes est 
évidemment Bootstrap (que l’on peut appeler framework tellement elle est
 puissante).</p>
      <p>Il existe plein de librairies qui permettent de te mâcher le travail, par exemple :</p>
      <ul>
        <li><a href="https://www.chartjs.org/" target="_blank">chart.js</a>
 est une super librairie qui permet d’afficher des graphes : idéal si tu
 as besoin d’afficher tes données dans un dashboard admin</li>
        <li><a href="https://daneden.github.io/animate.css/" target="_blank">Animate.css</a> fait des animations</li>
        <li><a href="https://revealjs.com/#/" target="_blank">Reveal.js</a> est une super librairie pour faire des présentations de type PowerPoint : très pratique pour faire des présentations à la volée</li>
        <li><a href="https://fontawesome.com/" target="_blank">Font Awesome</a> propose plein d’icônes pour aider ton app à être plus lisible</li>
        <li><a href="https://codemirror.net/" target="_blank">Code Mirror</a> est un outil te permettant  d’intégrer un éditeur de code dans ton application : idéal pour lancer le futur CodeCademy !</li>
      </ul>
        <p>Quand tu achètes un template Bootstrap, ce dernier va 
généralement venir avec plein de librairies que tu devras ranger dans 
ton dossier <code>vendor/</code>.</p>

        <p>Cela fait un peu peur car il n’y a pas de convention pour les
 libraires. Ce qui fait que quand tu télécharges une librairie, tu 
recevras toujours un dossier avec plein de fichiers qui partent dans 
tous les sens. Cependant, c’est au final assez simple à manipuler et 
mettre les mains dans le cambouis des librairies permet d’apprendre très
 rapidement les principes du front.</p>

    </div>
  </div>
</div>

<p>Voilà pour l’organisation de ton application. Concrètement quand tu 
voudras lancer ton site web, tu iras prendre un template tout fait, lui 
appliquer un kit UI adapté à ton entreprise, puis insérer le CSS 
personnalisé à tes éléments.</p>

<p>Nous prendrons plus tard un exemple pas à pas, mais retiens juste 
ceci : tout ce qui est externe et trouvé sur internet (framework, 
snippets) =&gt; bien rangé dans <code>vendor/</code>. Le kit UI de ton entreprise =&gt; bien rangé dans <code>lib/</code>. Le CSS que tu codes toi même =&gt; <code>app/assets/</code>.</p>

<h4>3.2.3. Configuration de l'Asset Pipeline</h4>
<p>Maintenant que tu as les différents fichiers et que tu sais où les 
ranger, nous allons avoir besoin de les ranger (faudra bien le faire à 
un moment), puis de configurer ton application pour lui dire “hey, j’ai 
tous ces fichiers ; quand tu vas tourner merci de les prendre en compte 
pour que mon site soit joli”. C’est la partie qui fait le plus peur aux 
moussaillons car elle demande de se poser 2 minutes et de réfléchir. 
Mais si tu comprends bien les quelques fichiers à manipuler, cela peut 
être plié en 10 minutes !</p>

<p>En gros dans cette partie, tu vas devoir :</p>

<ul>
  <li>Bien ranger tes fichiers d'assets dans les bons dossiers</li>
  <li>configurer ton Asset Pipeline dans <code>config/initializers/assets.rb</code> pour qu’il sache où appeler tes fichiers</li>
  <li>Appeler tes librairies et assets dans ton manifest <code>app/stylesheets/application.css</code>, dans le bon ordre</li>
  <li>Enjoy !</li>
</ul>


<h5>3.2.3.1. Créer fichiers et dossiers</h5>
<p>Si tu as bien retenu, tu sais que ton application est répartie dans trois dossiers : les fichiers du projet vont dans <code>app/assets/stylesheets</code>, les fichiers de l’entreprise vont dans <code>lib/assets/stylesheets</code>, les fichiers des librairies externes vont dans <code>vendor/assets/stylesheets</code> (ou en CDN).</p>

<p>Les sous-dossiers ne sont pas créés, je t’invite donc à créer les dossiers suivants :</p>

<ul>
  <li><code>lib/assets/</code></li>
  <li><code>lib/assets/stylesheets/</code></li>
  <li><code>lib/assets/javascripts/</code> (nous verrons plus en détails
 comment s’occuper de JS quand on fera du JS, mais ça ne mange pas de 
pain de créer ce simple dossier)</li>
  <li><code>vendor/assets/</code></li>
  <li><code>vendor/assets/stylesheets/</code></li>
  <li><code>vendor/assets/javascripts/</code> (nous verrons plus en 
détails comment s’occuper de JS quand on fera du JS, mais ça ne mange 
pas de pain de créer ce simple dossier)</li>
</ul>

<p>Tu as créé les dossiers, maintenant on va ajouter les fichiers des 
librairies externes. Prenons l’exemple d’un thème qui vient avec les 
librairies suivantes :</p>

<ul>
  <li>bootstrap</li>
  <li>chart.js</li>
  <li>le_thème (c'est le fichier CSS de ton thème)</li>
</ul>

<p>Ton dossier vendor sera organisé comme suit :</p>

<pre class=" language-shell"><code class=" language-shell">vendor/assets/
├── javascripts
│   ├── bootstrap.js
│   ├── chart.js
│   └── le_thème.js
└── stylesheets
    ├── bootstrap.css
    ├── chart.css
    └── le_thème.css</code></pre>

<p>Voilà ce que je voulais dire dans “se poser deux minutes pour 
réfléchir” : il te faudra juger les différentes librairies externes que 
tu veux ajouter à ton application afin de bien les ranger dans ton 
dossier vendor. Pour certains templates tu peux avoir une vingtaine de 
librairies à ranger. Rien d’insurmontable.</p>

<p>Pour tes librairies internes (dans le dossier <code>lib/</code>), c’est la même chose. Heureusement en général tu en as très peu donc cela ira beaucoup plus vite.</p>

<p>Pour les fichiers CSS custom, il n’y a rien à ranger ! Les dossiers 
sont déjà créés et les fichiers s’ajouteront au fur et à mesure de ton 
application. Ouf !</p>



<h5>3.2.3.2. Configurer le fichier <code>assets.rb</code></h5>
<p>Actuellement, ton Asset Pipeline est un peu con : il ne sait pas qu’il faut qu’il aille chercher des fichiers dans les dossiers <code>lib/</code> et <code>vendor/</code>.
 Donc quand tu lui diras “hey bro ajoute au manifest le fichier 
bootstrap.css stp”, il te sortira une erreur en mode “je suis con je ne 
trouve pas le fichier bootstrap.css”. Il faut donc lui dire “hey banane,
 quand tu cherches le fichier bootstrap.css, cherche le aussi dans 
vendor/stylesheets/ 🍌”. Pour ceci il faut que tu ailles dans le fichier
 <code>config/initializers/assets.rb</code> et que tu rentres les lignes suivantes :</p>

<pre class=" language-ruby"><code class=" language-ruby"><span class="token const">Rails</span><span class="token punctuation">.</span>application<span class="token punctuation">.</span>config<span class="token punctuation">.</span>assets<span class="token punctuation">.</span>paths &lt;&lt; <span class="token const">Rails</span><span class="token punctuation">.</span>root<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string">"lib"</span><span class="token punctuation">,</span> <span class="token string">"assets"</span><span class="token punctuation">,</span> <span class="token string">"stylesheets"</span><span class="token punctuation">)</span>
<span class="token const">Rails</span><span class="token punctuation">.</span>application<span class="token punctuation">.</span>config<span class="token punctuation">.</span>assets<span class="token punctuation">.</span>paths &lt;&lt; <span class="token const">Rails</span><span class="token punctuation">.</span>root<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string">"lib"</span><span class="token punctuation">,</span> <span class="token string">"assets"</span><span class="token punctuation">,</span> <span class="token string">"javascripts"</span><span class="token punctuation">)</span>
<span class="token const">Rails</span><span class="token punctuation">.</span>application<span class="token punctuation">.</span>config<span class="token punctuation">.</span>assets<span class="token punctuation">.</span>paths &lt;&lt; <span class="token const">Rails</span><span class="token punctuation">.</span>root<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string">"vendor"</span><span class="token punctuation">,</span> <span class="token string">"assets"</span><span class="token punctuation">,</span> <span class="token string">"stylesheets"</span><span class="token punctuation">)</span>
<span class="token const">Rails</span><span class="token punctuation">.</span>application<span class="token punctuation">.</span>config<span class="token punctuation">.</span>assets<span class="token punctuation">.</span>paths &lt;&lt; <span class="token const">Rails</span><span class="token punctuation">.</span>root<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string">"vendor"</span><span class="token punctuation">,</span> <span class="token string">"assets"</span><span class="token punctuation">,</span> <span class="token string">"javascripts"</span><span class="token punctuation">)</span></code></pre>

<p>Ainsi, quand tu appelleras les fichiers CSS et JS, Rails ira les chercher dans les dossiers qui t’intéressent.</p>

<div class="card box-shadow-0 border-danger">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">⚠️ ALERTE ERREUR COMMUNE</h4>
      <p>Le fichier assets.rb est un fichier dans le dossier <code>config/initializers/</code>.
 C’est un fichier qui s’exécute à l’initialisation de ton serveur. C’est
 à dire que si tu le modifies, il te faudra redémarrer le serveur pour 
que Rails prenne en compte les modifications. Attention à ne pas te 
faire avoir 😉</p>
    </div>
  </div>
</div>

<p>Et voilà ! Tu as fait les branchements de configuration. Maintenant 
on va devoir appeler tous ces fichiers dans l’ordre dans nos fichiers 
manifest.</p>

<h5>3.2.3.3. Appel des librairies dans tes manifests</h5>
<p>Pour que Rails s’y retrouve (et sache ce qu’il doit charger), il 
possède, de base, un fichier manifest : un fichier dans lequel on va 
lister tous les fichiers qu’on veut charger dans notre app : <code>app\assets\stylesheets\application.css</code>. </p>

<p>Comme tu as bien paramétré ton application, Rails cherchera les fichiers de l'Asset Pipeline dans les dossiers suivants :</p>

<ul>
  <li><code>app/assets/stylesheets/</code></li>
  <li><code>lib/assets/stylesheets/</code></li>
  <li><code>vendor/assets/stylesheets/</code></li>
</ul>

<p>Dans le manifest, tu rentreras donc dans l'ordre les fichiers que tu veux appeler dans ton application.</p>

<div class="card box-shadow-0 border-info">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">🤓 QUESTION RÉCURRENTE</h4>
      <p><b>Mais dis-donc Jamy, le CSS de mon application, celui que j'ai codé, je le mets où ?</b></p>
      <p>Excellente question ! Le CSS qui concerne toute l'application sera mis dans un fichier qui s'appelle <code>main.css</code>. Ce fichier sera dans <code>app/assets/stylesheets/</code>
 et il faut que tu le créés. Le CSS qui concerne un élément précis (ta 
navbar, le controller des users, etc) sera mis dans un fichier CSS 
éponyme (<code>navbar.css</code>, <code>user.css</code>, etc). Tu n'auras qu'à appeler ces fichiers dans ton manifest avec les lignes exemples suivantes :</p>
      <pre class=" language-css"><code class=" language-css">*= require main
*= require navbar
*= require user</code></pre>
    </div>
  </div>
</div>

<div class="card box-shadow-0 border-info">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">🚀 ALERTE BONNE ASTUCE</h4>
      <p>Dans ton fichier manifest il y a deux lignes que nous préférons que tu enlèves : <code>require_tree .</code> et <code>require_self</code>. Nous allons t'expliquer pourquoi :</p>
      <p><code>require_tree</code> dit à ton manifest : ajouter à l'Asset Pipeline tous les fichiers qui sont dans <code>app/assets/stylesheets</code>. Exactement comme la commande <code>git add .</code>
 qui permet de tout ajouter, cette dernière est fort pratique, mais te 
donnera des résultats inattendus : déjà tu ne maitrises pas l'ordre 
d'ajout, mais aussi il se peut que tu ne veuilles pas ajouter certains 
fichiers CSS à ton manifest. Une bonne maîtrise de ce dernier t'évitera 
ce genre de soucis.</p>
      <p><code>require_self</code> dis à ton manifest : hey les lignes 
de CSS qui sont dans ce fichier sont aussi à prendre en compte. La force
 du Ruby est la lisibilité, et le code bien rangé. Avoir un fichier qui 
fait deux choses à la fois (manifest + du CSS) est antithétique à la 
philosophie de Ruby. Il te faudra donc deux fichiers :</p>
      <ul>
        <li>Un fichier <code>application.css</code> qui est le manifest</li>
        <li>Un fichier <code>main.css</code> qui contient le CSS au niveau global de ton application</li>
      </ul>
    </div>
  </div>
</div>

<p>Prenons un exemple concret: pour un petit projet de calendrier 
interne de la boite ACME_inc, tu veux utiliser Bootstrap pour faire une 
design simple mais efficace, mais la Direction Artistique insiste pour 
qu’on utilise les couleurs officielles définies dans le fichier idoine.</p>

<p>L'organisation de notre projet sera comme ça :</p>
<pre class=" language-shell"><code class=" language-shell">.
├── app/assets/stylesheets/
│   ├── application.css
│   ├── main.css
│   └── day.css
├── lib/assets/stylesheets/
│   └── acme_ui_kit.css
└── vendor/assets/stylesheets
    └── bootstrap.css</code></pre>

<p>On pourrait se dire que ça va être un joyeux bazar de gérer autant de
 fichiers dans autant de répertoires, mais c’est en fait assez simple : 
il suffit de lister les fichiers qu’on veut utiliser dans l’ordre dans 
lequel on veut les charger pour l’application. </p>

<p>On obtient donc le fichier manifest suivant :</p>

<pre class=" language-css"><code class=" language-css"><span class="token comment">/* ...
*= require bootstrap
*= require acme_ui_kit
*= require main
*= require day
*/</span></code></pre>

<p>On part donc d’une base solide (la librairie Bootstrap) à laquelle on
 va rajouter des briques les unes après les autres pour bâtir notre 
édifice : on ajoute les styles de l’entreprise qui vont probablement 
beaucoup modifier les couleurs mais pas toucher aux formes de Bootstrap.
 On peut ensuite finir par inclure les styles qui concernent de plus en 
plus les “détails” de l’application: du style principal de l’appli (basé
 sur les styles de la boîte) on va passer au styles d’affichage d’une 
journée de calendrier.</p>

<div class="card box-shadow-0 border-danger">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">⚠️ ALERTE ERREUR COMMUNE</h4>
      <p>Rien ne t’empêche d’inclure un style CSS général dans le 
fichier “day.css”; et comme il est listé dans le manifest, il sera pris 
en compte et donc ça fonctionnera ! MAIS C’EST UNE TRES MAUVAISE IDEE ! 
Ce sera un style que les autres dev de ton équipe/entreprise auront du 
mal à retrouver puisqu’il n’est pas censé être là ! (Je ne parle même 
pas de ton futur toi qui, dans 6 mois, suite à un bug, se demandera QUI a
 bien eu l’idée de mettre ce style général dans un fichier spécifique 
pas adapté !?!! ... Oups !).</p>
      <p>Par conséquence, on est bien d’accord, dans le fichier <code>day.css</code>, la règle de base est un truc du style :</p>
      <pre class=" language-css"><code class=" language-css"><span class="token selector">body .day</span> <span class="token punctuation">{</span>
  <span class="token property">background-color</span><span class="token punctuation">:</span>    red<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
      <p>C’est d’ailleurs pour ça que tu as créé un fichier <code>main.css</code> : il te permet de placer tous les styles un peu plus généraux pour toute l’application 😉</p>
    </div>
  </div>
</div>

<h4>3.2.4. L'Asset Pipeline en action</h4>
<p>Comme on l’a vu pour le CSS au dessus, l'Asset Pipeline va prendre 
les listings de fichiers JS et CSS (les manifests) qu'on lui donne et 
nous préparer de jolis paquets avec.</p>

<p>Une fois qu’on a bien préparé ses manifest, on peut lancer l’Asset Pipeline avec la commande suivante :</p>

<pre class=" language-shell"><code class=" language-shell">$ rails assets:precompile</code></pre>

<p>Cette commande permet de préparer ton Asset Pipeline pour que tu 
voies à quoi ce dernier va ressembler quand tu seras en production. 
Rails va parcourir les 2 manifests et générer un fichier qui réunira 
tout le code pour chacun. Voilà ce à quoi peuvent par exemple ressembler
 les logs si au moins un script JS et un style CSS ont changé :</p>

<pre class=" language-shell"><code class=" language-shell">INFO -- : Writing /thp/public/assets/application-ff05acb16c68bfa2f1464c09aeeba8ce0374d32bfd5cb007f366f5e7d69234c1.css
INFO -- : Writing /thp/public/assets/application-ff05acb16c68bfa2f1464c09aeeba8ce0374d32bfd5cb007f366f5e7d69234c1.css.gz
INFO -- : Writing /thp/public/assets/favicon/apple-touch-icon-120x120-precomposed-372de868f08319961b72ba7e3b1ed7121e75e29c8294334cb2c911409ea18131.png
INFO -- : Writing /thp/public/assets/favicon/apple-touch-icon-120x120-372de868f08319961b72ba7e3b1ed7121e75e29c8294334cb2c911409ea18131.png
INFO -- : Writing /thp/public/assets/application-661b0c4ab5de949af640c3fb9b4c885edc3beeec72f2e393338b3eee2f9daf39.js
INFO -- : Writing /thp/public/assets/application-661b0c4ab5de949af640c3fb9b4c885edc3beeec72f2e393338b3eee2f9daf39.js.gz</code></pre>

<p>En faisant quelques essais avec tes fichiers CSS et l’Asset Pipeline, tu remarqueras (au moins !) 3 choses : </p>

<ul>
  <li>Ces caractères chelous sont ce qu’on appelle une clef de hashage :
 c’est une chaine unique générée à partir du contenu de tous les 
fichiers qu’il a intégrés. Si le contenu d’un des fichiers CSS change, 
même d’un caractère, cette chaîne sera différente. Comme les navigateurs
 web se basent (trop souvent) sur le nom du fichier pour savoir s’il 
peut utiliser celui qu’il a en cache (plutôt que de le re-télécharger), 
rails utilise une technique simple : on change artificiellement le nom 
du fichier pour forcer le navigateur à télécharger la bonne version ! Ce
 procédé (ajouter la clef de hashage dans le nom du fichier) est appelé 
le <b>fingerprinting</b>.</li>
  <li>Par conséquence, si tu ne changes rien à tes fichiers CSS (et le manifest), même si tu relances <code>assets:precompile</code>, il ne va pas regénérer de fichier <code>application-xxxxxx.css</code>
 : en effet, celui qui avait généré la fois d’avant est toujours valide 
puisque rien n’a changé ! Du coup, on gagne du temps en réutilisant le 
même !</li>
  <li>Les fichiers sont générés dans le répertoire <code>public/assets/</code>. C’est effectivement dans le répertoire <code>public/</code>
 que le serveur (en production) va aller chercher les fichiers statiques
 dont il a besoin. L’Asset Pipeline va les générer là. Mais attention: 
les fichiers dans <code>public/assets/</code> sont donc générés et tu ne
 dois pas y  toucher (ça annihilerait tout l’intérêt de l’Asset 
Pipeline) et encore moins les historiser avec git (ça prends du temps, 
de l’espace de stockage et ça n’a pas de sens !!). Donc hésite pas à 
rajouter <code>public/assets</code> dans ton <code>.gitignore</code> s’il n’y est pas déjà 😉</li>
</ul>

<p>Pour toi, quelques commandes pratiques. Quand tu veux faire le ménage
 sur ta machine en mode production, tu peux utiliser 2 commandes :</p>

<ul>
  <li><code>$ rails assets:clean</code> va supprimer tous les assets précompilés avant et ne laisser que ceux créés par la dernière génération de l’Asset Pipeline</li>
  <li><code>$ rails assets:clobber</code> va simplement supprimer tout le répertoire <code>public/assets</code>. Comme ça au moins, c’est clair et propre, ya juste plus rien !! On peut repartir sur de bonnes bases</li>
</ul>


<p>Enfin, sache une chose très sympa elle aussi : quand tu déploies sur 
Heroku dans une appli rails, à moins d’envoyer vraiment beaucoup de 
fichiers CSS, JS et d’images, c’est Heroku qui se charge de lancer ces 
commandes tout seul, t’as pas à te prendre la tête à précompiler les 
assets !</p>

<p>Contente-toi de jeter un coup d’oeil dans les logs lors de ton deploy, tu va voir les lignes de l’Asset Pipeline passer.</p>



<h4>3.2.5. Rails en mode Production</h4>
<p>Comme dit plus haut, Heroku s'occupera de compiler les assets pour toi. Donc à quoi sert la commande <code>rails assets:precompile</code>
 ? Elle sert à te permettre de regarder à quoi va ressembler ton 
application quand elle sera en production. C'est très frustrant de push 
son travail sur Heroku, puis de se rendre compte que ce dernier affiche 
mal certains éléments de CSS ou pire ne veut pas précompiler. Faut 
corriger, commit, repush. Bref c'est long. Dans ce chapitre, nous allons
 te montrer comment faire semblant d'être en production.</p>

<p>Tout ce que tu as à faire, c'est de précompiler tes assets, et de 
lancer ton serveur en mode "comme si j'étais en production". Pour 
précompiler tes assets :</p>

<pre class=" language-shell"><code class=" language-shell">$ rails assets:precompile</code></pre>

<p>Pour lancer le serveur comme si tu étais en production :</p>

<pre class=" language-shell"><code class=" language-shell">$ RAILS_ENV=production RAILS_SERVE_STATIC_FILES=true rails server
# n'hésite pas à créer un alias pour cette commande, genre rsprod</code></pre>

<p>Tu remarqueras que ton serveur affichera les lignes suivantes : </p>

<pre class=" language-shell"><code class=" language-shell">=&gt; Booting Puma
=&gt; Rails 5.2.3 application starting in production 
=&gt; Run `rails server -h` for more startup options
Puma starting in single mode...
* Version 3.12.1 (ruby 2.6.4-p104), codename: Llamas in Pajamas
* Min threads: 5, max threads: 5
* Environment: production
* Listening on tcp://0.0.0.0:3000
Use Ctrl-C to stop</code></pre>

<p>Il affiche <code>Environment: production</code>, tu es bien en production !</p>

<p>D'ailleurs si tu vas sur la page et que tu affiches le code source, 
tu peux voir que Rails appelle un fichier CSS et un fichier JS. C'est 
ton fichier d'assets qui est compilé par Rails ! Tu peux cliquer dessus 
pour voir à quoi il ressemble si tu veux 🤓</p>

<h4>3.2.6. Et les images dans tout ça ?</h4>
<p>Pour les images, c’est un peu près la même chose : on stocke les fichiers dans un répertoire <code>app/assets/images/</code> et ce sera l’Asset Pipeline qui fera le lien entre le fichier et son chemin “réel” une fois en production.</p>

<p>Il ne faut pas oublier de préciser à l’Asset Pipeline qu’on veut 
utiliser une image provenant des assets; pour une intégration dans une 
fichier CSS, ça va par exemple donner ça:</p>

<pre class=" language-css"><code class=" language-css"><span class="token selector">body</span> <span class="token punctuation">{</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">url</span><span class="token punctuation">(</span>asset_<span class="token function">path</span><span class="token punctuation">(</span><span class="token string">'backgrounds/bg1.png'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> no-repeat center center<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>

<p>Cette ligne veut dire que la source de notre background sera une URL 
et que l’URL en question est déterminée par l’Asset Pipeline pour une 
fichier dont la fin du chemin est <code>backgrounds/bg1.png</code></p>

<p>A noter : tu peux utiliser <code>image_path</code> au lieu de <code>asset_path</code> si tu veux. La fonction <code>asset_path</code> sait retrouver toute ressource présente dans le répertoire <code>app/assets/</code>,
 ce qui fait qu’elle fonctionne aussi pour les fonts ou même les vidéos 
si tu en stockes dans les assets (mauvaise idée pour les vidéos).</p>

<p>Pense aussi à créer un répertoire <code>app/assets/fonts/</code> par exemple, histoire que tes fichiers restent bien rangés ;)</p>

<h3>3.3. Tuto pas à pas : intégration d'un thème Bootstrap</h3>
<p>Nous allons intégrer ensemble un template pour une application Rails. Comme ça tu verras qu’il n’y a rien de sorcier.</p>

<p>Va sur StartBootstrap puis va sur la page de <a href="https://startbootstrap.com/templates/modern-business/" target="_blank">ce template</a>.
 Avant de télécharger le thème sans réfléchir, pose-toi deux minutes et 
essaie de comprendre ce que fait ce dernier. Pour celui-là ce sera 
simple : il n’ajoute pas grand chose par rapport à Bootstrap classique. 
En effet, à part un carousel et plein d’exemples de molécules y’aura pas
 beaucoup de CSS à intégrer. C’est un exemple parfait pour notre tuto.</p>

<div class="card box-shadow-0 border-info">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">🚀 ALERTE BONNE ASTUCE</h4>
      <p>Ce thème propose plein de molécules exemples. C’est vraiment 
assez chouette car grâce à ce dernier, tu peux désigner facilement des 
pages web sans te prendre la tête. Bien souvent je vois des moussaillons
 essayer de recoder des molécules affreuses (désolé, mais faut appeler 
un chat un chat) alors qu’un simple copier-coller d’une molécule d’un 
template préexistant fait le taf. N’hésite pas à utiliser des molécules 
préexistantes : plus de jolies pages, et moins de code pour ta gueule. 
Perso je fais ça aussi, et le site de THP n'est pas moche.</p>
    </div>
  </div>
</div>

<p>Ce thème te plait, télécharge-donc le dossier zip, extrais le 
dossier, puis ouvre-le. Catastrophe, c’est un dossier qui part dans tous
 les sens, c’est le bordel, c’est l’enfer. Tu te dis que tu ne comprends
 rien au front, puis tu te résous à créer un thème toi-même. Ce thème 
sera moche, tu te diras que le développement full stack n’est au final 
pas pour toi, tu sombreras par conséquence dans l’alcool, la drogue, 
puis nous te retrouverons avec une overdose dans quelques mois. Et nous 
ne voulons pas ça, nous allons t’aider à comprendre ce thème pour qu’au 
final cela se passe bien.</p>

<p>Ce pas à pas va être en deux parties :</p>

<ul>
  <li>la première est la compréhension d’une librairie externe. En 
comprenant ce que tu as dans le dossier, son intégration sera d’autant 
plus simple</li>
  <li>le seconde sera son intégration : une fois que tu as compris comment marche le template</li>
</ul>

<h4>3.3.1. Comprendre un thème</h4>
<p>La première chose à faire dans l’informatique est de lire la doc, donc je t’invite à lire le fichier <code>README.md</code>. Malheureusement, ce fichier parle de npm, ce qui ne t’intéresse pas. Mince, te voici livré à toi-même. </p>

<p>Ce thème est emblématique de libraires en front : c’est du yolo et il
 faut se pencher dessus pour la comprendre. Prenons les fichiers et 
réflechissons :</p>

<pre class=" language-shell"><code class=" language-shell">.
├── 404.html
├── about.html
├── blog-home-1.html
├── blog-home-2.html
├── blog-post.html
├── contact.html
├── css
│   └── modern-business.css
├── faq.html
├── full-width.html
├── gulpfile.js
├── index.html
├── js
│   ├── contact_me.js
│   └── jqBootstrapValidation.js
├── LICENSE
├── mail
│   └── contact_me.php
├── package.json
├── package-lock.json
├── portfolio-1-col.html
├── portfolio-2-col.html
├── portfolio-3-col.html
├── portfolio-4-col.html
├── portfolio-item.html
├── pricing.html
├── README.md
├── services.html
├── sidebar.html
└── vendor
    ├── bootstrap
    │   ├── css
    │   │   ├── bootstrap.css
    │   │   ├── bootstrap.css.map
    │   │   ├── bootstrap-grid.css
    │   │   ├── bootstrap-grid.css.map
    │   │   ├── bootstrap-grid.min.css
    │   │   ├── bootstrap-grid.min.css.map
    │   │   ├── bootstrap.min.css
    │   │   ├── bootstrap.min.css.map
    │   │   ├── bootstrap-reboot.css
    │   │   ├── bootstrap-reboot.css.map
    │   │   ├── bootstrap-reboot.min.css
    │   │   └── bootstrap-reboot.min.css.map
    │   └── js
    │       ├── bootstrap.bundle.js
    │       ├── bootstrap.bundle.js.map
    │       ├── bootstrap.bundle.min.js
    │       ├── bootstrap.bundle.min.js.map
    │       ├── bootstrap.js
    │       ├── bootstrap.js.map
    │       ├── bootstrap.min.js
    │       └── bootstrap.min.js.map
    └── jquery
        ├── jquery.js
        ├── jquery.min.js
        ├── jquery.min.map
        ├── jquery.slim.js
        ├── jquery.slim.min.js
        └── jquery.slim.min.map</code></pre>

<p>Un fait intéressant : il y a beaucoup de fichiers HTML. En effet, 
quand tu télécharges une librairie, les développeurs en général 
t’envoient le dossier qui contient la démo de la librairie. Si tu 
t’amuses donc à ouvrir le fichier <code>index.html</code> avec ton 
navigateur Internet, tu pourras naviguer dans l’application comme si tu 
naviguais dans la démo. C’est parfait car cela montre que ce que tu as 
téléchargé marche très bien. Il faut juste faire en sorte d’arriver à 
prendre les fichiers qui nous intéressent, et les brancher à l’Asset 
Pipeline. 
</p>

<p>Si l’on ne prend pas en compte les fichiers HTML, notre dossier va ressembler à ceci :</p>

<pre class=" language-shell"><code class=" language-shell">├── css
│   └── modern-business.css
├── gulpfile.js
├── js
│   ├── contact_me.js
│   └── jqBootstrapValidation.js
├── LICENSE
├── mail
│   └── contact_me.php
├── package.json
├── package-lock.json
├── README.md
└── vendor
    ├── bootstrap
    │   ├── css
    │   │   ├── bootstrap.css
    │   │   ├── et plein d’autres fchiers CSS de Bootstrap
    │   └── js
    │       ├── bootstrap.js
    │       ├── et plein d’autre fichiers JS de Bootstrap
    └── jquery
            ├── jquery.js
            └── et plein d’autres fichiers pour jQuery</code></pre>

<p>C’est bien plus compréhensible ; il y a :</p>

<ul>
  <li>un dossier <code>css/</code> qui contient le css du thème : c’est important pour nous</li>
  <li>un fichier <code>gulpfile.js</code> : après une recherche 
Internet, on peut voir que ce dernier permet d’automatiser des tâches. 
Cela ne nous concerne pas pour la librairie</li>
  <li>un dossier <code>js/</code> qui contient le javascript de notre 
application. On verra avec JS tout ce qui est JS : pas besoin d’en tenir
 compte pour le moment</li>
  <li>un fichier <code>LICENSE</code> qui nous explique la license de la librairie. Elle est en MIT license donc c’est cool</li>
  <li>un dossier <code>mail/</code> qui contient un programme en PHP pour faire tourner le mailer. Nous on s’en fout : poubelle</li>
  <li>deux fichiers <code>package.json</code> qui permettent à Webpack de gérer la librairie : on n’en n’a pas besoin non plus</li>
  <li>un dossier <code>vendor/</code> qui contient deux librairies : Bootstrap et jQuery. C’est important pour nous</li>
</ul>

<p>Grosso modo, voici ce qui nous intéresse :</p>

<ul>
  <li>le dossier <code>vendor/</code> qui contient les librairies externes</li>
  <li>le dossier <code>css/</code> qui contient le CSS de notre thème</li>
  <li>le dossier <code>js/</code> qui contient le js de notre app (mais on verra cela plus tard)</li>
</ul>

<p>C’est bien plus simple que cela en a l’air au final !</p>

<div class="card box-shadow-0 border-info">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">🚀 ALERTE BONNE ASTUCE</h4>
      <p>Il existe une technique assez efficace pour reconnaitre 
rapidement les librairies qui nous intéressent à partir du dossier de 
cette dernière (et c'est celle que j'utilise personnellement). Si tu 
ouvres le fichier <code>index.html</code>, ce dernier marche très bien 
sur ton ordinateur. Avec un peu de logique, tu peux te dire que ce 
dernier a téléchargé les bons fichiers CSS et JS. Si tu ouvres le code 
source de la page, il te suffit de voir quels fichiers il appelle dans 
le head, et à la fin du body. Par exemple pour le fichier index.html de 
notre thème, on peut voir :</p>
      <pre class=" language-html"><code class=" language-html"><span class="token comment">&lt;!-- Bootstrap core CSS --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>vendor/bootstrap/css/bootstrap.min.css<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- Custom styles for this template --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>css/modern-business.css<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>

(plein de lignes de HTML)

<span class="token comment">&lt;!-- Bootstrap core JavaScript --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>vendor/jquery/jquery.min.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>vendor/bootstrap/js/bootstrap.bundle.min.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span></code></pre>
    <p>Cela veut dire que le fichier <code>index.html</code> pour marcher parfaitement a besoin de :</p>

    <ul>
      <li>le fichier css de Bootstrap</li>
      <li>le fichier css du thème</li>
      <li>le fichier JS de jQuery</li>
      <li>le fichier JS de Bootstrap</li>
    </ul>

    <p>Bam, cela veut dire que tu as besoin des librairies suivantes :</p>
    <ul>
      <li>Bootstrap (CSS et JS)</li>
      <li>du thème (CSS)</li>
      <li>jQuery (JS)</li>
    </ul>

    <p>Et voilà, il ne te reste plus qu’à les installer dans ton Asset Pipeline. Cette technique ne marche que pour la page <code>index.html</code>, pour reprendre les molécules de la page <code>about.html</code>, pense à vérifier que cette dernière n'utilise pas d'autres librairies en refaisant la même technique.</p>

    </div>
  </div>
</div>


<h4>3.3.2. Installation du thème dans l'Asset Pipeline</h4>
<p>Maintenant que tu as compris comment marche ton thème, nous allons 
l’installer dans l’Asset Pipeline. Pour rappel, voici les étapes pour 
faire marcher l’Asset Pipeline :</p>

<ul>
  <li>réfléchir à l’organisation des assets de ton application. En 
fonction de ton utilisation de templates ou pas, cette dernière va 
changer</li>
  <li>faire un peu de configuration pour brancher l’Asset Pipeline
    <ul>
      <li>créer les fichiers et dossiers qui t’intéressent</li>
      <li>configurer ton Asset Pipeline dans <code>config/initializers/assets.rb</code> pour qu’il sache où appeler tes fichier</li>
      <li>Appeler tes librairies dans ton fichier <code>app/stylesheets/application.css</code> dans le bon ordre</li>
    </ul></li>
  <li>développer tes assets (images, CSS, JS)</li>
  <li>envoyer le tout en production</li>
</ul>

<p>Pour la première partie tout est bon. Maintenant passons à la deuxième partie.</p>

<h5>3.3.2.1. Configuration</h5>
<h6>3.3.2.1.1. Création des fichiers et dossier</h6>
<p>Il faut mettre les librairies dans l’Asset Pipeline. Nous avons trois librairies à installer :</p>

<ul>
  <li>Bootstrap (CSS et JS)</li>
  <li>le thème (CSS)</li>
  <li>jQuery (JS)</li>
</ul>

<p>Ces trois librairies iront dans le dossier <code>vendor/</code> donc je te laisse créer les bons sous-dossiers :</p>

<ul>
  <li><code>vendor/assets/</code></li>
  <li><code>vendor/assets/stylesheets/</code></li>
  <li><code>vendor/assets/javascripts/</code> (nous verrons plus en détails comment s’occuper de JS quand on fera du JS, mais je te montre quelques bases)</li>
</ul>

<p>Ensuite, tu vas devoir intégrer 4 fichiers :</p>
<ul>
  <li><code>vendor/assets/stylesheets/bootstrap.css</code> que tu trouves dans <code>ton_thème/vendor/bootstrap/css/</code></li>
  <li><code>vendor/assets/stylesheets/modern-business.css</code> que tu trouves dans <code>ton_thème/css/</code></li>
  <li><code>vendor/assets/javascripts/bootstrap.bundle.js</code> que tu trouves dans <code>ton_thème/vendor/bootstrap/js/</code></li>
  <li><code>vendor/assets/javascripts/jquery.js</code> que tu trouves dans <code>vendor/jquery/</code></li>
</ul>

<div class="card box-shadow-0 border-info">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">🤓 QUESTION RÉCURRENTE</h4>
      <p><b>Jamy, pourquoi ajouter uniquement ces fichiers alors que 
dans le dossier du thème ils mettent 8 fichiers 12 fichiers pour le CSS 
de Bootstrap ?</b></p>
      <p>Quand je te disais que l’univers du front c’est le far west, 
c’est pas une blague ! Les gens te filent un dossier ultra bordélique et
 tu dois te démerder avec. Cela décourage les pauvres moussaillons et me
 force à écrire une belle ressource qui te dit “nan mais en fait c’est 
pas compliqué, c’est juste que faut juste connaître les bases”. Pour 
savoir quel fichier prendre pour la librairie, tu peux naviguer dans les
 fichiers html et regarder lesquels sont appelés. Si cela marche à 
merveille dans ton navigateur, tu as juste à reprendre le code qui fait 
tout bien marcher, et à toi la gloire !</p>
    </div>
  </div>
</div>

<p>Étant donné que tu n’as pas pour le moment de kit-UI pour ton projet, rien à mettre dans le dossier <code>lib/</code> ! On peut passer à la configuration du fichier <code>assets.rb</code></p>

<h6>3.3.2.1.2. <code>assets.rb</code></h6>
<p>Tu as un dossier <code>vendor/</code> qui contient des nouveaux 
dossiers. L’Asset Pipeline ne sait pas encore que ces dossiers 
contiennent les librairies qui t’intéressent. On va donc dire à l’Asset 
Pipeline “yo, quand je vais appeler ces librairies dans mon manifest, 
fais pas le con et n’oublie pas de checker dans les dossiers vendor ;)”.
 Dans le fichier <code>assets.rb</code>, ajoute les lignes suivantes :</p>
<pre class=" language-ruby"><code class=" language-ruby"><span class="token const">Rails</span><span class="token punctuation">.</span>application<span class="token punctuation">.</span>config<span class="token punctuation">.</span>assets<span class="token punctuation">.</span>paths &lt;&lt; <span class="token const">Rails</span><span class="token punctuation">.</span>root<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string">"vendor"</span><span class="token punctuation">,</span> <span class="token string">"assets"</span><span class="token punctuation">,</span> <span class="token string">"stylesheets"</span><span class="token punctuation">)</span>
<span class="token const">Rails</span><span class="token punctuation">.</span>application<span class="token punctuation">.</span>config<span class="token punctuation">.</span>assets<span class="token punctuation">.</span>paths &lt;&lt; <span class="token const">Rails</span><span class="token punctuation">.</span>root<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string">"vendor"</span><span class="token punctuation">,</span> <span class="token string">"assets"</span><span class="token punctuation">,</span> <span class="token string">"javascripts"</span><span class="token punctuation">)</span></code></pre>

<p>Top, maintenant que c’est configuré, relance le serveur, et il ne 
nous reste plus qu’à appeler les librairies dans le bon ordre !</p>



<h6>3.3.2.1.3. Les manifests</h6>
<p>Dans cette partie, nous allons appeler les librairies dans nos 
manifest pour que l’application les utilise. Si tu vas dans le fichier 
application.css, tu verras que cette dernière n’appelle pas tes 
librairies, on va donc les appeler dans le bon ordre. Retire les lignes </p>

<pre class=" language-css"><code class=" language-css"> *= require_tree .
 *= require_self</code></pre>

 <p>Et remplace-les par les lignes suivantes :</p>

 <pre class=" language-css"><code class=" language-css"> *= require bootstrap
 *= require modern-business</code></pre>

 <p>Idem pour le fichier application.js, retire la ligne <code>//= require_tree .</code> et remplace-la par les lignes suivantes :</p>

 <pre class=" language-js"><code class=" language-js"><span class="token comment">//= require jquery</span>
<span class="token comment">//= require bootstrap</span></code></pre>

<p>Maintenant, tu peux copier-coller le body du fichier index.html du 
thème, puis l’ouvrir dans une page de ton serveur. Tu verras que ce 
dernier affiche à la perfection la page ! Si ce n’est pas le cas, c’est 
que tu as du mal faire un élément du tuto et/ou que tu as oublié un s 
quelque part. Relis-toi :)</p>




<div class="card box-shadow-0 border-info">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">🤓 QUESTION RÉCURRENTE</h4>
      <p><b>Jamy, tu es gentil de me donner l’ordre, mais dans le futur,
 comment je ferai pour savoir le bon ordre pour l’installation des 
librairies ?</b></p>
      <p>Excellente question ! Voici un indice d’ordre : en général tu 
vas du plus gros au plus petit. Donc un ordre de référence serait :</p>
      <ul>
        <li>jQuery</li>
        <li>Bootstrap</li>
        <li>les librairies externes au thème</li>
        <li>ton thème</li>
        <li>ce que tu as dans le dossier <code>lib/</code></li>
        <li>le code que tu as fait</li>
      </ul>
      <p>Une autre méthode consiste à regarder l’ordre dans lequel sont appelées les librairies dans ton fichier exemple <code>index.html</code> (décidément). C’est l’ordre qu’ont utilisé les développeurs du thème donc en théorie c’est le bon ;)</p>
    </div>
  </div>
</div>

<p>Bon ton thème marche à merveille, faisons-en profiter la terre entière.</p>





<h5>3.3.2.2. En production</h5>
<p>Pour envoyer ton thème en production, rien de plus simple. Commit ton
 travail, puis git push heroku master. Pas d’erreur ? C’est top !</p>

<div class="card box-shadow-0 border-info">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">🚀 ALERTE BONNE ASTUCE</h4>
      <p>Des fois tu vas te tromper dans l’ordre des assets, des fois tu
 vas oublier un s ou une virgule, ce qui fait que ton push sur heroku ne
 va pas marcher ou alors en production cela ne ressemblera pas du tout à
 ce que tu avais en local. Et c’est très frustrant car cela arrive si 
près du but. Afin d’éviter cela, nous te recommandons de voir à quoi ton
 Asset Pipeline ressemble s’il était en production.</p>

      <p>Pour ceci, il te faut précompiler les assets comme si tu étais en production :</p>
      <pre class=" language-shell"><code class=" language-shell">$ rails assets:precompile</code></pre>

      <p>Ensuite il te faut lancer le serveur comme si tu étais en production (et avec un paramètre en plus à renseigner) : </p>

      <pre class=" language-shell"><code class=" language-shell">$ RAILS_ENV=production RAILS_SERVE_STATIC_FILES=true rails s</code></pre>
      <p>Regarde ton appli. Elle est jolie ? C’est top ! Tu as des erreurs ou des trucs qui s’affichent mal ? À toi de débugger 🚚</p>
    </div>
  </div>
</div>


<h2>4. Points importants à retenir</h2>
<p>En gros pour faire marcher tes assets tu devras :</p>

<ul>
  <li>réfléchir à l’organisation des assets de ton application. En 
fonction de ton utilisation de templates ou pas, cette dernière va 
changer</li>
  <li>faire un peu de configuration pour brancher l’Asset Pipeline</li>
  <li>développer tes assets (images, CSS, JS)</li>
  <li>envoyer le tout en production</li>
</ul>

<h2>5. Pour aller plus loin</h2>
<ul>
  <li>Nos amis de LaunchSchool ont écrit un <a href="https://launchschool.com/blog/rails-asset-pipeline-best-practices" target="_blank" class="text-primary">bon tuto</a> sur l'asset pipeline</li>
  <li>Tu peux ensuite lire les premières parties de <a href="http://guides.rubyonrails.org/asAet%20Pipeline.html" target="_blank" class="text-primary">la doc de Rails</a> sur l'asset pipeline</li>
  <li>Nos amis de The Odin Project ont fait une <a href="https://www.theodinproject.com/courses/ruby-on-rails/lessons/the-asset-pipeline" target="_blank" class="text-primary">petite introduction</a> sur l'asset pipeline</li>
  <li>Tu peux checker <a href="https://medium.com/@adamzerner/rails-asset-pipeline-982f3ea75596" target="_blank" class="text-primary">cet article</a> qui explique un ou deux concepts de l'asset pipeline</li>
</ul>


</div>
</div>
</div>
</div>
</div>
</div>

<div class="row">
<div class="col-12">
<div class="card">
<div class="card-header" style="border-top: 3px solid #5E66E5">
<h1>
Ressource : 
ActiveStorage
</h1>
<a class="heading-elements-toggle">
<i class="la la-ellipsis-v font-medium-3"></i>
</a>
<div class="heading-elements">
<ul class="list-inline mb-0">
<li>
<a href="https://www.thehackingproject.org/fr/dashboard/courses/1/lessons/103/lesson_submissions/new"><i class="ft-edit" data-original-title="Proposer une amélioration" data-placement="top" data-toggle="tooltip"></i>
</a></li>
<li>
<a data-action="collapse">
<i class="ft-minus"></i>
</a>
</li>
<li>
<a data-action="expand">
<i class="ft-maximize"></i>
</a>
</li>
</ul>
</div>
</div>
<div class="card-content collapse show">
<div class="card-body">
<div class="tab-pane active" id="home1" role="tabpanel">

<h2>1. Introduction</h2>
<p>Active Storage est une fonctionnalité sympathique de Rails qui permet
 à un utilisateur de votre app de mettre en ligne des fichiers qui 
pourront ensuite être utilisés dans son site web. L'exemple typique est 
le fait d'envoyer une photo de profil&nbsp;: celle-ci est alors stockée 
dans le cloud et l'app Rails peut l'appeler à tout moment afin de 
l'afficher où bon vous semble. Il est bien évidemment possible de 
l'utiliser pour d'autres fichiers comme des pdf ou autres.</p>

<h2>2. Historique et contexte</h2>
<p>ActiveStorage est une nouveauté assez récente dans Rails car 
introduite dans la version 5.2. Avant ça, il fallait forcément passer 
par des applications tierces pour effectuer de l'upload (Paperclip, 
Shrine ou CarrierWave pour ne citer qu'elles). À présent, on gère cela 
en natif&nbsp;! Ce qui est cool pour une fonctionnalité, somme toute 
très courante dans les app web modernes. </p>

<h2>3. La ressource</h2>

<h3>3.1. Les concepts de base d'Active Storage</h3>
 <p>Active Storage permet facilement à tes utilisateurs d'uploader des 
fichiers et de lier ces fichiers à des objets de ta BDD. En 
environnement de développement, Active Storage permet une sauvegarde en 
local afin d'effectuer des tests. En production, il faudra le configurer
 afin que les fichiers soient stockés dans des services comme Amazon S3,
 Google Cloud, ou Microsoft Azure (Malheureusement, ils sont tous 
payants). </p>
 <p>Au niveau de l'app Rails, Active Storage fonctionne grâce à l'existence de 2 tables dans ta BDD : <code>active_storage_blobs</code> et <code>active_storage_attachments</code>. Nous allons voir comment mettre tout ça en route. 🚚 🚛</p>

<h3>3.2. Mettre en place Active Storage</h3>
<p>Allez, on va pratiquer en mettant sur pied un premier Active Storage ensemble.</p>

<div class="card box-shadow-0 border-danger">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">⚠️ ALERTE ERREUR COMMUNE</h4>
      <p class="card-text">Les tuto pas à pas, c'est le pied pour les 
mouss'&nbsp;: il faut être un peu rigoureux, attentif et POF&nbsp;! Ça 
marche. Pourtant, on remarque à chaque session des personnes qui font du
 copier-coller bête et mécanique. Si tu ne prends pas le temps de bien 
piger chaque étape, en te demandant, avant d'appliquer "ok, pourquoi ça 
va marcher ça&nbsp;?", tu n'apprendras rien&nbsp;! </p>
      <p>En résumé&nbsp;: <b>pose-toi, à chaque étape du pas à pas, la 
question&nbsp;: "tiens, pourquoi est-ce qu'il me fait faire ça&nbsp;? 
Quelle est la logique&nbsp;?"</b>.</p>
    </div>
  </div>
</div>

<h4>3.2.1. Les bases pour bosser</h4>
<p> Commence par préparer tout ce qu'il faut pour disposer d'une application de test&nbsp;: </p>
<ul>
  <li>Génère une application Rails <code>test_active_storage</code>&nbsp;et va dans son dossier&nbsp;;</li>
  <li>Crée-lui un model <code>User</code> (sans aucun champ additionnel)&nbsp;;</li>
  <li>Crée un <code>users_controller</code> avec un <code>show</code> en faisant <code>$ rails g controller users show</code>&nbsp;;</li>
  <li>A présent, crée ta BDD (si tu es en PostGre) et passe la migration.</li>
</ul>

<h4>3.2.2. Installation d'Active Storage</h4>
<p>Pour installer Active Storage sur ton app, lance <code>$ rails active_storage:install</code>. Cette commande a pour effet de générer une migration permettant de créer 2 tables dans ta BDD :</p>
<ul>
  <li><code>active_storage_blobs</code> : qui contient toutes les métadonnées des fichiers uploadés (taille, nom, type, etc.).</li>
  <li><code>active_storage_attachments</code> : une table jointe entre tes modèles et les uploads.</li>
</ul>
<p>Par curiosité, va dans ton dossier <code>/db/migrate/</code>pour jeter un œil à la migration&nbsp;: ça te permet de voir les champs qui vont constituer ces 2 tables.</p>
<p>Maintenant passe la migration.</p>

<h4>3.2.3. Lier des fichiers à des entrées en BDD</h4>
<p>Active Storage est installé&nbsp;: il faut à présent être capable de 
lier un fichier qu'on upload avec un objet de notre BDD. Prenons 
l'exemple de nos <code>users</code> à qui on va vouloir attribuer un avatar (une photo de profil quoi). La première étape est d'indiquer au model <code>User</code> qu'il pourra être lié à un objet d'Active Storage portant le nom <code>avatar</code> (c'est nous qui avons décidé de l'appeler comme ça. On aurait pu choisir <code>profil_picture</code>). Il faut utiliser la mention <code>has_one_attached</code> ou <code>has_many_attached</code> dans le code du model&nbsp;: dans notre cas, nous utiliserons le premier (l'avatar étant unique).</p>

<pre class=" language-ruby"><code class=" language-ruby"><span class="token keyword">class</span> <span class="token const">User</span> &lt; <span class="token const">ApplicationRecord</span>
  has_one_attached <span class="token symbol">:avatar</span>
<span class="token keyword">end</span></code></pre>

<p>En faisant cela, tu rends plusieurs méthodes disponibles sur une instance de type <code>User</code> (on te présentera plus loin comment les implémenter avec un cas concret): </p>
<ul>
  <li>Tu peux tester si une instance dispose d'un avatar en faisant <code>user.avatar.attached?</code>. Il te retourne le booléen correspondant.</li>
  <li>Tu peux permettre l'upload de fichier en utilisant un formulaire de type <code>&lt;%= form.file_field :avatar %&gt;</code> dans ta view.</li>
  <li>Finalement, tu peux lier à un <code>user</code> l'avatar fraîchement uploadé, depuis le controller qui traite le formulaire d'upload. Cela se fait ainsi&nbsp;: <code>user.avatar.attach(params[:avatar])</code></li>
</ul>

<h4>3.2.4. Mise en place d'une page <code>show</code> basique</h4>
<p>Nous allons mettre en place une interface minimaliste pour lier un 
avatar à tes utilisateurs. Pour cela, commençons par mettre en place une
 page "profil" de base. Va dans ton <code>users_controller</code> et prépare le minimum basique pour cette page show&nbsp;: </p>

<pre class=" language-ruby"><code class=" language-ruby"><span class="token keyword">class</span> <span class="token const">UsersController</span> &lt; <span class="token const">ApplicationController</span>
  <span class="token keyword">def</span> show
    <span class="token inst-var">@user</span> <span class="token operator">=</span> <span class="token const">User</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span>params<span class="token punctuation">[</span><span class="token symbol">:id</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span></code></pre>

<p>Bien sûr, il nous faut la route correspondante dans le routeur : </p>

<pre class=" language-ruby"><code class=" language-ruby"><span class="token const">Rails</span><span class="token punctuation">.</span>application<span class="token punctuation">.</span>routes<span class="token punctuation">.</span>draw <span class="token keyword">do</span>
  resources <span class="token symbol">:users</span><span class="token punctuation">,</span> only<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token symbol">:show</span><span class="token punctuation">]</span>
<span class="token keyword">end</span></code></pre>

<p>Va en console et crée un utilisateur. Maintenant, si tu lances ton serveur, tu peux tester que l'URL <code>/users/1</code> te renvoie bien vers la page <code>show.html.erb</code> standard (celle générée en même temps que <code>users_controller</code>).</p>
<p>Modifie le contenu de cette view afin qu'elle affiche l'<code>id</code> du user et l'avatar (s'il existe)&nbsp;: </p>

<pre class=" language-html"><code class=" language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Page Profil<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Bienvenue sur la page d'ajout d'un avatar pour le User portant l'id : &lt;%=@user.id%&gt;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">&gt;</span></span>Avatar actuel<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>
&lt;%if @user.avatar.attached?%&gt;
  &lt;%= image_tag @user.avatar, alt: 'avatar' %&gt;
&lt;%else%&gt;
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>=== Il n'y a pas encore d'avatar lié à cet utilisateur ===<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
&lt;%end%&gt;
</code></pre>
<p>Teste que tout s'affiche bien en relançant ton serveur et en allant sur l'URL <code>/users/1</code>.</p>

<h4>3.2.5. Premiers éléments concernant le formulaire d'upload</h4>
<p>Parfait. À présent passons au formulaire qui va permettre de mettre à jour l'avatar. Nous allons le faire en <code>form_tag</code> et du coup inclure dedans le champ <code>&lt;%= file_field_tag :avatar %&gt;</code>
 qui va rajouter dans la view un bouton permettant d'aller sélection un 
fichier à uploader. Le formulaire aura un tronche proche de cela (pour 
le moment, ne copie-colle pas le formulaire - je te le montre juste pour
 info)&nbsp;: </p>

<pre class=" language-html"><code class=" language-html">&lt;%= form_tag do %&gt;
  &lt;%= file_field_tag :avatar %&gt;
  &lt;%= submit_tag "uploader l'avatar" %&gt;
&lt;% end %&gt;</code></pre>

<p>Mais avant de pouvoir le finaliser, on doit se poser 2 questions&nbsp;: </p>
<ol>
  <li>Quelle méthode (dans quel controller) va s'occuper de traiter son contenu&nbsp;?</li>
  <li>Du coup quelle route va-t-on utiliser&nbsp;?</li>
</ol>

<h4>3.2.6. Un controller <code>avatars</code></h4>
<p>Si tu as une très bonne mémoire, tu te rappelleras que, dans le cours
 sur les conventions REST et CRUD, nous avions évoqué la gestion des 
jokers dans le site de THP. Bien que ceux-ci ne sont pas des entrées à 
part entière de notre BDD, nous leur consacrons quand même un controller
 afin de gérer leur suppression/ajout. Et bien ici, on va faire pareil 
avec les avatars&nbsp;! <b>En effet, bien qu'ils ne constituent pas une 
entrée en BDD (ils sont juste un lien entre les entrées Active Storage 
et les entrées de nos users), les avatars peuvent être considérés comme 
une ressource à part entière.</b> </p>
<p>Tu vas donc créer un <code>avatars_controller</code>.</p>
<p>Celui-ci va héberger une méthode <code>create</code> qui aura pour rôle d'ajouter un avatar à un user donné. Voici le contenu du controller :</p>

<pre class=" language-ruby"><code class=" language-ruby"><span class="token keyword">class</span> <span class="token const">AvatarsController</span> &lt; <span class="token const">ApplicationController</span>
  <span class="token keyword">def</span> create
    <span class="token inst-var">@user</span> <span class="token operator">=</span> <span class="token const">User</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span>params<span class="token punctuation">[</span><span class="token symbol">:user_id</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token inst-var">@user</span><span class="token punctuation">.</span>avatar<span class="token punctuation">.</span>attach<span class="token punctuation">(</span>params<span class="token punctuation">[</span><span class="token symbol">:avatar</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    redirect_to<span class="token punctuation">(</span>user_path<span class="token punctuation">(</span><span class="token inst-var">@user</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span></code></pre>

<p><b>Explications du code </b>: la ligne <code>@user = User.find(params[:user_id])</code> nous permet d'identifier l'utilisateur concerné. Ensuite nous lui attribuons l'avatar dont la référence est contenue dans <code>params[:avatar]</code> avec la commande <code>@user.avatar.attach(params[:avatar])</code>. Une fois cette association faite, on redirige vers la page show de cet utilisateur en suivant la route dynamique <code>user_path(@user)</code>.</p>

<p>Évidemment, pour que cette méthode <code>create</code> fonctionne (notamment la partie avec <code>params[:user_id]</code>), il faut une route adéquate. Cette route sera, sans surprise <code>resources :avatars, only: [:create]</code>.
 Mais par contre, elle doit contenir l'information "sur quel utilisateur
 travaille-t-on&nbsp;?", autrement dit, elle doit contenir l'<code>id</code> d'un <code>user</code>&nbsp;: on va donc imbriquer la route dans le <code>resources :users</code> pour lui rajouter un <code>/users/user_id/</code> en amont. <br>
Ça donne&nbsp;: </p>

<pre class=" language-ruby"><code class=" language-ruby"><span class="token const">Rails</span><span class="token punctuation">.</span>application<span class="token punctuation">.</span>routes<span class="token punctuation">.</span>draw <span class="token keyword">do</span>
  resources <span class="token symbol">:users</span><span class="token punctuation">,</span> only<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token symbol">:show</span><span class="token punctuation">]</span> <span class="token keyword">do</span>
    resources <span class="token symbol">:avatars</span><span class="token punctuation">,</span> only<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token symbol">:create</span><span class="token punctuation">]</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span></code></pre>

<p>Si tu tapes maintenant un <code>$rails routes</code>, tu vois apparaître les 2 routes qui vont te servir&nbsp;: la page <code>show</code> des users en <code>GET</code> et la page <code>create</code> des avatars en <code>POST</code>. Et cette dernière est bien imbriquée avec un <code>/users/user_id/</code>. Illustration&nbsp;: </p>

<pre class=" language-bash"><code class=" language-bash">             Prefix Verb URI Pattern                                                                              Controller#Action
             user_avatars POST /users/:user_id/avatars(.:format)                                                        avatars#create
                     user GET  /users/:id(.:format)                                                                     users#show</code></pre>

<p>Au top&nbsp;! Il ne reste qu'à finaliser notre formulaire dans la view <code>show.html.erb</code> afin qu'il pointe vers la méthode&nbsp;!</p>

<div class="card box-shadow-0 border-info">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">🤓 QUESTION RÉCURRENTE</h4>
      <p class="card-text"><b>Dis, pourquoi on passe par la méthode <code>create</code> et pas par la méthode <code>update</code>&nbsp;?</b></p>
      <p>En effet les deux options pourraient, théoriquement, se 
valoir&nbsp;: dans les faits, la méthode va soit créer un avatar (si 
l'utilisateur n'en a pas), soit le modifier (s'il en a déjà un).</p>
      <p>Toutefois, j'ai fait le choix ici de passer par la méthode <code>create</code> car la route qui l'accompagne est plus adaptée&nbsp;: c'est un <code>POST</code> sur <code>/avatars</code> alors que pour <code>update</code>, on ferait un <code>PUT</code> sur <code>/avatars/:id</code> (essaye de mettre <code>resources :avatars, only: [:update]</code> pour tester la route). Or, il n'y a pas vraiment d'utilité ici de préciser l'<code>id</code> de l'avatar&nbsp;: si on sait à quel <code>user</code> on se réfère, on a tout ce qu'il nous faut.</p>
    </div>
  </div>
</div>

<h4>3.2.7. Le formulaire d'upload complet</h4>
<p>Dans la partie 3.2.5, on avait un embryon de formulaire, mais il 
était incomplet. Il manquait deux choses pour qu'il puisse fonctionner :</p>
<ul>
  <li>Lui indiquer la route qu'il doit pointer (par défaut, <code>form_tag</code> est déjà en <code>POST</code> donc ça, c'est ok)&nbsp;;</li>
  <li>Rajouter un élément indispensable à un <code>form_tag</code> lorsqu'on veut qu'il puisse uploader des fichiers&nbsp;: l'option <code>multipart: true</code> </li>
</ul>

<p>Rajoute donc le formulaire suivant à la fin du fichier <code>show.html.erb</code> :</p>

<pre class=" language-html"><code class=" language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">&gt;</span></span>Changer d'avatar ?<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>
&lt;%= form_tag user_avatars_path(@user), multipart: true do %&gt;
  &lt;%= file_field_tag :avatar %&gt;
  &lt;%= submit_tag "mettre à jour" %&gt;
&lt;% end %&gt;</code></pre>

<p>Et voilà, c'est prêt&nbsp;! 👨‍🍳 </p>
<p>Fais le test en uploadant un avatar sur ton <code>user</code>, 
change-le ensuite, voire crée plusieurs utilisateurs en console et 
attribue-leur chacun une photo de profil&nbsp;! Même en éteignant puis 
relançant ton serveur, ou même en fermant ton navigateur, l'avatar 
réapparaît tel quel quand tu relances tout&nbsp;: il est bien sauvegardé
 en local.</p>

<h3>3.3. Configurer Active Storage en production</h3>

<h4>3.3.1. Stockage en local</h4>
<p>Si tu vas dans les fichiers de configuration des environnements de développement (<code>config/environments/development.rb</code>) et production (<code>config/environments/production.rb</code>), tu verras qu'ils contiennent tous les deux cette ligne&nbsp;: </p>

<pre class=" language-ruby"><code class=" language-ruby">config<span class="token punctuation">.</span>active_storage<span class="token punctuation">.</span>service <span class="token operator">=</span> <span class="token symbol">:local</span></code></pre>

<p>C'est elle qui indique que, par défaut, Active Storage stockera les 
fichiers directement sur l'ordinateur qui fait tourner l'app Rails. En 
développement, pas de souci&nbsp;: ça stocke tout sur ton ordi et tu 
peux tester que tout marche. Par contre en production, ça a ses 
limites&nbsp;: de nombreux services refuseront de faire fonctionner 
Active Storage de cette façon, car ils ne veulent pas se retrouver à 
stocker des fichiers (ça peut vite peser lourd les milliers de photos de
 profil de tes futurs utilisateurs).</p>

<p><b>Chez Heroku</b>, ils sont plutôt cools car <a href="https://devcenter.heroku.com/articles/active-storage-on-heroku">ils mettent à ta disposition un disque dur éphémère</a>&nbsp;: en gros, sans rien changer dans la configuration d'Active Storage (on reste en <code>:local</code>),
 ils acceptent les uploads de fichiers pour les sauver en local mais 
ceux-ci disparaîtront au bout de 24&nbsp;h. C'est suffisant pour tester 
ton app… mais pas pour faire un produit pro. </p>

<h4>3.3.2. Stockage "dans le cloud"</h4>

<p>Pour stocker les fichiers de ton app en production de façon pérenne, 
tu vas devoir passer par un hébergeur. Rails en recommande 3&nbsp;: 
Amazon Web Services (AWS), Google Cloud Storage et Microsoft Azure. Il 
va donc te falloir&nbsp;: </p>
<ol>
  <li>Ouvrir un compte chez un de ces hébergeurs. Attention&nbsp;: ils 
vont tous te demander ta carte bancaire à l'inscription (même s'ils ont 
des offres gratuites)&nbsp;;</li>
  <li>Récupérer tes clefs d'API pour connecter Active Storage chez eux&nbsp;;</li>
  <li>Mettre tes clefs dans ton app <b>de façon sécurisée</b>&nbsp;;</li>
  <li>Configurer Active Storage pour qu'il envoie les fichiers à ton hébergeur.</li>
</ol>

<div class="card box-shadow-0 border-danger">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">⚠️ ALERTE ERREUR COMMUNE</h4>
      <p class="card-text">Attention, cette fois-ci tu n'as plus le 
droit à l'erreur&nbsp;: si jamais tu push tes clefs d'API sur GitHub, vu
 que tu auras donné ta carte bleue au fournisseur, les conséquences 
pourraient être désastreuses pour ton compte en banque&nbsp;! Si jamais 
ça t'arrivait, fonce sur le site de l'hébergeur (Amazon / Google / 
Microsoft) et révoque les clefs d'API qui ont été compromises. Ainsi 
elles cesseront de fonctionner et aucun petit malin ne pourra te ruiner 
en les utilisant.</p>
      <p>Mais le mieux reste quand même de bien te concentrer et de ne pas te rater dans l'utilisation de Dotenv et ton .gitignore.</p>
    </div>
  </div>
</div>

<h4>3.3.3. Exemple avec Amazon</h4>
<p>⚠️ <b>Le pas à pas s'arrête ici</b>. Ci-dessous nous te donnons les 
billes afin de pouvoir implémenter Active Storage en PROD sur Amazon S3.
 Si tu as pu faire fonctionner Active Storage en local (cf. ci-dessus - 
tu peux même tester après push sur Heroku), il n'est pas prioritaire 
aujourd'hui de passer du temps sur la configuration sur Amazon. Tu 
pourras revenir ici lors des projets finaux et le faire.</p>

<h5>a) Récupérer des clefs d'API</h5>
<p>Ouvre un compte chez Amazon S3 en <a href="https://medium.com/alturasoluciones/setting-up-rails-5-active-storage-with-amazon-s3-3d158cf021ff">suivant ce tutoriel</a>
 et récupère des clefs d'API. Arrête-toi juste avant la partie "Rails 
Setup", une fois que tu as l'ID de la clef publique et la clef secrète.</p>


<h5>b) Configurer Active Storage</h5>
<p>Maintenant va dans le fichier <code>storage.yml</code>&nbsp;: tu 
verras qu'il contient des configurations de bases pour les 3 
prestataires recommandés par Rails. Dé-commente la partie qui concerne 
Amazon&nbsp;: </p>

<pre class=" language-ruby"><code class=" language-ruby">amazon<span class="token punctuation">:</span>
	service<span class="token punctuation">:</span> <span class="token const">S3</span>
	access_key_id<span class="token punctuation">:</span> &lt;%<span class="token operator">=</span> <span class="token const">Rails</span><span class="token punctuation">.</span>application<span class="token punctuation">.</span>credentials<span class="token punctuation">.</span>dig<span class="token punctuation">(</span><span class="token symbol">:aws</span><span class="token punctuation">,</span> <span class="token symbol">:access_key_id</span><span class="token punctuation">)</span> %&gt;
	secret_access_key<span class="token punctuation">:</span> &lt;%<span class="token operator">=</span> <span class="token const">Rails</span><span class="token punctuation">.</span>application<span class="token punctuation">.</span>credentials<span class="token punctuation">.</span>dig<span class="token punctuation">(</span><span class="token symbol">:aws</span><span class="token punctuation">,</span> <span class="token symbol">:secret_access_key</span><span class="token punctuation">)</span> %&gt;
	region<span class="token punctuation">:</span> us<span class="token operator">-</span>east<span class="token number">-1</span>
	bucket<span class="token punctuation">:</span> your_own_bucket</code></pre>

<p>À présent, pour indiquer à Active Storage de bosser via Amazon (et non plus en local), va dans <code>config/environments/production.rb</code> et change la ligne <code>config.active_storage.service = :local</code> en&nbsp;: <code>config.active_storage.service = :amazon</code></p>
<p>Dernière étape indispensable pour que Amazon S3 fonctionne&nbsp;: rajoute à ton Gemfile <code>gem "aws-sdk-s3", require: false</code> puis bundle install.</p>

<h5>c) Saisir les clefs d'API de façon sécurisée</h5>
<p>On va passer par <code>dotenv-rails</code> pour sécuriser tes clefs d'API. Du coup rajoute la gem, bundle install, puis change <code>storage.yml</code> de la façon suivante :</p>

<pre class=" language-ruby"><code class=" language-ruby">amazon<span class="token punctuation">:</span>
	service<span class="token punctuation">:</span> <span class="token const">S3</span>
	access_key_id<span class="token punctuation">:</span> &lt;%<span class="token operator">=</span> <span class="token const">ENV</span><span class="token punctuation">[</span><span class="token string">'AMAZON_ACCESS_KEY_ID'</span><span class="token punctuation">]</span> %&gt;
	secret_access_key<span class="token punctuation">:</span> &lt;%<span class="token operator">=</span> <span class="token const">ENV</span><span class="token punctuation">[</span><span class="token string">'AMAZON_SECRET_ACCESS_KEY'</span><span class="token punctuation">]</span> %&gt;
	region<span class="token punctuation">:</span> us<span class="token operator">-</span>east<span class="token number">-1</span> <span class="token comment">#a priori, si tu es en France, il faut mettre ici : eu-west-3
</span>	bucket<span class="token punctuation">:</span> your_own_bucket <span class="token comment">#Mets ici le nom de ton bucket. Par exemple : prisme</span></code></pre>

<p>Maintenant, crée un fichier <code>.env</code>, <b>rajoute-le à ton <code>.gitignore</code></b> puis saisis dedans tes clefs d'API récupérée sur Amazon. Exemple&nbsp;: </p>

<pre class=" language-ruby"><code class=" language-ruby"><span class="token const">AMAZON_ACCESS_KEY_ID</span><span class="token operator">=</span> <span class="token string">'AKIAKOB5SEYHW8APSIYQ'</span>
<span class="token const">AMAZON_SECRET_ACCESS_KEY</span><span class="token operator">=</span> <span class="token string">'vCxbJWzolEJCLqZ4zXcSBgT5i9mAQCYMSw1zXyu'</span></code></pre>


<h5>d) Passer les clefs d'API à Heroku</h5>
<p>Maintenant que tes clefs d'API sont bien au chaud dans ton <code>.env</code>,
 il faut trouver un moyen pour qu'Heroku les ait. Sans elles, ton app 
Rails déployée chez eux n'a aucune chance de pouvoir accéder à Amazon 
S3&nbsp;!</p>
<p>Tout est <a href="https://devcenter.heroku.com/articles/config-vars">expliqué ici</a>. En résumé, tu vas devoir passer des commandes du genre <code>$ heroku config:set AMAZON_ACCESS_KEY_ID=AKIAKOB5SEYHW8APSIYQ</code> (on te laisse lire la doc).</p>

<div class="card box-shadow-0 border-info">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">🚀 ALERTE BONNE ASTUCE</h4>
      <p class="card-text">Comment savoir si tu as bien paramétré tes variables d'environnement (ex: ENV['AMAZON_ACCESS_KEY_ID']) via <code>dotenv</code>&nbsp;? C'est simple&nbsp;: va dans la console Heroku <code>$ heroku run rails console</code> et tapes tout simplement <code>ENV['AMAZON_ACCESS_KEY_ID']</code>.</p>
      <p>Si le résultat est <code>nil</code>, c'est que tu as fait une erreur&nbsp;: la variable est vide et donc mal définie.</p>
      <p>Si le résultat est un truc du genre <code>AKIAKOB5SEYHW8APSIYQ</code>, c'est parfait&nbsp;: la clef est bien définie, elle est prête à être utilisée&nbsp;!</p>
    </div>
  </div>
</div>

<div class="card box-shadow-0 border-danger">
  <div class="card-content collapse show">
    <div class="card-body">
      <h4 class="card-title">⚠️ ALERTE ERREUR COMMUNE</h4>
      <p class="card-text">Si tu as déjà lié des instances avec des 
fichiers Active Storage stockés en local, le passage à un hébergeur dans
 le cloud va t'obliger à supprimer ces liens. En effet, Rails ne sait 
pas gérer à la fois des fichiers stockés en local et des fichiers 
stockés dans le cloud. </p>
      <p>Seule solution pour toi&nbsp;: supprimer (par exemple depuis la console) les liens avec les fichiers uploadés.</p>
    </div>
  </div>
</div>
<p>A partir de là, Amazon S3 devrait fonctionner sur Heroku.</p>

<h2>4. Points importants à retenir</h2>
<p>Active Storage permet facilement à tes utilisateurs d'uploader des fichiers et de lier ces fichiers à des objets de ta BDD.</p>
<p>Pour installer Active Storage sur ton app, lance <code>$ rails active_storage:install</code> puis passe la migration.</p>
<p>Pour pouvoir lier un fichier uploadé avec un objet de ta BDD, rajoute <code>has_one_attached :avatar</code> ou <code>has_many_attached :images</code> dans le model concerné.</p>
<p>A présent tu peux:</p>
<ul>
  <li>tester si une instance dispose d'un avatar en faisant <code>user.avatar.attached?</code>.</li>
  <li>upload un fichier en utilisant un formulaire de type <code>&lt;%= form.file_field :avatar %&gt;</code> dans une view. Exemple complet en <code>form_tag</code> :</li>
  <pre class=" language-html"><code class=" language-html">&lt;%= form_tag user_avatars_path(@user), multipart: true do %&gt;
  &lt;%= file_field_tag :avatar %&gt;
  &lt;%= submit_tag "mettre à jour" %&gt;
&lt;% end %&gt;</code></pre>
  <li>tu peux lier à un user l'avatar fraîchement uploadé, depuis le controller qui traite le formulaire d'upload en faisant <code>user.avatar.attach(params[:avatar])</code>.</li>
</ul> 
<p>Pour configurer Active Storage en production, passes de préférence 
par Amazon Web Services (AWS), Google Cloud Storage ou Microsoft Azure 
(inscrit toi et récupère des clefs d'API). <br>
Ensuite, dans <code>config/environments/production.rb</code>, change <code>config.active_storage.service = :local</code> avec la valeur correspondant au cloud que tu as choisi et dé-commente les bonnes configurations dans <code>storage.yml</code>.</p>
<p>Pense bien à rendre secrètes tes clefs d'API via <code>dotenv-rails</code> puis à les passer à Heroku</p>


<h2>5. Pour aller plus loin</h2>
<p>Pour plus d'informations, tu trouveras la <a href="https://github.com/rails/rails/tree/master/activestorage" target="_blank"> doc de la gem ActiveStorage</a>. Elle parle d'autres options intéressantes notamment pour supprimer les fichiers avec <code>user.avatar.purge</code>.</p>
<p>La documentation <a href="https://edgeguides.rubyonrails.org/active_storage_overview.html">Active Storage dans les Rails Guides</a> est également top&nbsp;! Ce pas à pas en est inspiré.</p>
<p>Tu peux facilement redimensionner les images avec <a href="https://github.com/minimagick/minimagick">la gem Minimagick</a> afin d'accélerer le chargement des images (notamment). Les Rails Guides expliquent comment faire. </p>
<p>Ce <a href="https://youtu.be/jtKEP_lsLco" target="_blank">tuto</a> vidéo va un peu plus loin&nbsp;: redimensionnement, upload de fichier pdf et svg</p>
</div>
</div>
</div>
</div>
</div>
</div>

<div class="row">
<div class="col-12">
<div class="card">
<div class="card-header" style="border-top: 3px solid #FF4081">
<h1>
Projets : 
Eventbrite : thème bootstrap, et mise en ligne de photos
</h1>
<a class="heading-elements-toggle">
<i class="la la-ellipsis-v font-medium-3"></i>
</a>
<div class="heading-elements">
<ul class="list-inline mb-0">
<li>
<a href="https://www.thehackingproject.org/fr/dashboard/courses/1/projects/103/project_submissions/new"><i class="ft-edit" data-original-title="Proposer une amélioration" data-placement="top" data-toggle="tooltip"></i>
</a></li>
<li>
<a data-action="collapse">
<i class="ft-minus"></i>
</a>
</li>
<li>
<a data-action="expand">
<i class="ft-maximize"></i>
</a>
</li>
</ul>
</div>
</div>
<div class="card-content collapse show">
<div class="card-body">
<div class="tab-pane active" id="home1" role="tabpanel">
<h2>1. Introduction</h2>
<p>Maintenant que ton application d'événements stylés est fonctionnelle,
 nous allons lui donner deux fonctionnalités qui vont être extrêmement 
pratiques :</p>

<ul>
  <li>La première est la possibilité aux utilisateurs d'attacher une photo à l'événement qu'ils crééent</li>
  <li>La seconde est de lui donne un template Bootstrap</li>
</ul>

<h2>2. Le projet</h2>
<h3>2.1. Ajout de photo</h3>
<p>Branche Active Storage et fais en sorte qu'il est possible pour le 
créateur d'un événement d'ajouter une photo à l'événement. La photo est 
obligatoire.</p>


<p>Bien entendu, le tout doit fonctionner en production.</p>


<h3>2.2. Template externe</h3>
<p>Utilise le cours sur l'Asset Pipeline et intègre un template à ton 
application Eventbrite. Nous te demandons d'intégrer un template qui 
fait un peu tout, avec plein de molécules exemples. Prends le template <a href="https://startbootstrap.com/templates/modern-business/" target="_blank">Modern Business</a> qui est un bon exemple d'un template simple qui fait plein de choses.</p>

<p>Bien entendu, le tout doit fonctionner en production.</p>

<h3>2.3. Photo de profil des utilisateurs</h3>
<p>Dernier élément, nous allons mettre en place un système de photo de 
profil des utilisateurs de ton site. Les photos de profil peuvent être 
mises en ligne à la modification du profil. De base, un utilisateur aura
 une photo de profil random.</p>

<h2>3. Rendu attendu</h2>
<p>Eventbrite en production qui a un nouveau thème et une possibilité de mettre en ligne des photos.</p>

</div>
</div>
</div>
</div>
</div>
</div>

</div>

      </div>
    </div>

    <div class="thp-flashes"></div>



    <script src="s7j4_fichiers/dashboard-6681459c92372465340c.js"></script>
    <script charset="utf-8">
      $('input[name=authenticity_token]').val($('meta[name=csrf-token]').attr('content'));
    </script>

  

<iframe style="display: none; visibility: hidden;" owner="archetype" title="archetype"></iframe>
<script type="text/javascript" id="hs-script-loader" src="s7j4_fichiers/9310539_002.js"></script><script type="text/javascript" id="">(function(e,c){if(!c.__SV){var l,h;window.mixpanel=c;c._i=[];c.init=function(q,r,f){function t(d,a){var g=a.split(".");2==g.length&&(d=d[g[0]],a=g[1]);d[a]=function(){d.push([a].concat(Array.prototype.slice.call(arguments,0)))}}var b=c;"undefined"!==typeof f?b=c[f]=[]:f="mixpanel";b.people=b.people||[];b.toString=function(d){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);d||(a+=" (stub)");return a};b.people.toString=function(){return b.toString(1)+".people (stub)"};l="disable time_event track track_pageview track_links track_forms track_with_groups add_group set_group remove_group register register_once alias unregister identify name_tag set_config reset opt_in_tracking opt_out_tracking has_opted_in_tracking has_opted_out_tracking clear_opt_in_out_tracking start_batch_senders people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user people.remove".split(" ");
for(h=0;h<l.length;h++)t(b,l[h]);var n="set set_once union unset remove delete".split(" ");b.get_group=function(){function d(p){a[p]=function(){call2_args=arguments;call2=[p].concat(Array.prototype.slice.call(call2_args,0));b.push([g,call2])}}for(var a={},g=["get_group"].concat(Array.prototype.slice.call(arguments,0)),m=0;m<n.length;m++)d(n[m]);return a};c._i.push([q,r,f])};c.__SV=1.2;var k=e.createElement("script");k.type="text/javascript";k.async=!0;k.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?
MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";e=e.getElementsByTagName("script")[0];e.parentNode.insertBefore(k,e)}})(document,window.mixpanel||[]);mixpanel.init("ab79c62023f2a925bfe5f7922c70de67");mixpanel.track("Sign up");</script>
<script type="text/javascript" id="">!function(){var a=window.analytics=window.analytics||[];if(!a.initialize)if(a.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{a.invoked=!0;a.methods="trackSubmit trackClick trackLink trackForm pageview identify reset group track ready alias debug page once off on addSourceMiddleware addIntegrationMiddleware setAnonymousId addDestinationMiddleware".split(" ");a.factory=function(b){return function(){var c=Array.prototype.slice.call(arguments);c.unshift(b);
a.push(c);return a}};for(var e=0;e<a.methods.length;e++){var f=a.methods[e];a[f]=a.factory(f)}a.load=function(b,c){var d=document.createElement("script");d.type="text/javascript";d.async=!0;d.src="https://cdn.segment.com/analytics.js/v1/"+b+"/analytics.min.js";b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(d,b);a._loadOptions=c};a._writeKey="HDfubo7D6T7lk8XiL2HZi2hZvIVFuK8j";a.SNIPPET_VERSION="4.13.2";a.load("HDfubo7D6T7lk8XiL2HZi2hZvIVFuK8j");a.page()}}();</script>

</body></html>